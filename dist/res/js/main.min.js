!function(){"use strict";function t(s,n,e){return n=void 0===n?1:n,(e=e||n+1)-n<=1?function(){if(arguments.length<=n||"string"===l.type(arguments[n]))return s.apply(this,arguments);var e,t,i=arguments[n];for(t in i){var r=Array.prototype.slice.call(arguments);r.splice(n,1,t,i[t]),e=s.apply(this,r)}return e}:t(t(s,n+1,e),n,e-1)}function a(t,i,e){var r=o(e);if("string"===r){var s=Object.getOwnPropertyDescriptor(i,e);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?t[e]=i[e]:(delete t[e],Object.defineProperty(t,e,s))}else if("array"===r)e.forEach(function(e){e in i&&a(t,i,e)});else for(var n in i)e&&("regexp"===r&&!e.test(n)||"function"===r&&!e.call(i,n))||a(t,i,n);return t}function o(e){var t;return null===e?"null":void 0===e?"undefined":"number"==(t=(Object.prototype.toString.call(e).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase())&&isNaN(e)?"nan":t}var l=self.Bliss=a(function(e,t){return 2==arguments.length&&!t||!e?null:"string"===l.type(e)?(t||document).querySelector(e):e||null},self.Bliss),i=(a(l,{extend:a,overload:t,type:o,property:l.property||"_",listeners:new(self.WeakMap?WeakMap:Map),original:{addEventListener:(self.EventTarget||Node).prototype.addEventListener,removeEventListener:(self.EventTarget||Node).prototype.removeEventListener},sources:{},noop:function(){},$:function(e,t){return e instanceof Node||e instanceof Window?[e]:2!=arguments.length||t?Array.prototype.slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[]):[]},defined:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},create:function(e,t){return e instanceof Node?l.set(e,t):(1===arguments.length&&(t="string"===l.type(e)?{}:(e=(t=e).tag,l.extend({},t,function(e){return"tag"!==e}))),l.set(document.createElement(e||"div"),t))},each:function(e,t,i){for(var r in i=i||{},e)i[r]=t.call(e,r,e[r]);return i},ready:function(t,e,i){if("function"!=typeof t||e||(e=t,t=void 0),t=t||document,e&&("loading"!==t.readyState?e():l.once(t,"DOMContentLoaded",function(){e()})),!i)return new Promise(function(e){l.ready(t,e,!0)})},Class:function(e){var t,i,r=["constructor","extends","abstract","static"].concat(Object.keys(l.classProps)),s=e.hasOwnProperty("constructor")?e.constructor:l.noop;function n(e){return this.hasOwnProperty(e)&&-1===r.indexOf(e)}if(2==arguments.length?(i=arguments[0],e=arguments[1]):((i=function(){if(this.constructor.__abstract&&this.constructor===i)throw new Error("Abstract classes cannot be directly instantiated.");i.super&&!t&&i.super.apply(this,arguments),s.apply(this,arguments)}).super=e.extends||null,i.super&&(t=0===(i.super+"").indexOf("class "))&&console.error(`You are using $.Class() to create a fake function-based class that extends a native JS class. This will not work.
You should convert your code to use native JS classes too. You can still pass a class into $.Class() to use its conveniences.`),i.prototype=l.extend(Object.create(i.super?i.super.prototype:Object),{constructor:i}),i.prototype.super=i.super?i.super.prototype:null,i.__abstract=!!e.abstract),e.static)for(var a in l.extend(i,e.static,n),l.classProps)a in e.static&&l.classProps[a](i,e.static[a]);for(a in l.extend(i.prototype,e,n),l.classProps)a in e&&l.classProps[a](i.prototype,e[a]);return i},classProps:{lazy:t(function(e,t,i){return Object.defineProperty(e,t,{get:function(){var e=i.call(this);return Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0}),e},set:function(e){Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),e}),live:t(function(e,i,r){return"function"===l.type(r)&&(r={set:r}),Object.defineProperty(e,i,{get:function(){var e=this["_"+i],t=r.get&&r.get.call(this,e);return void 0!==t?t:e},set:function(e){var t=this["_"+i],t=r.set&&r.set.call(this,e,t);this["_"+i]=void 0!==t?t:e},configurable:r.configurable,enumerable:r.enumerable}),e})},include:function(){var i=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],r=document.createElement("script");return e?Promise.resolve():new Promise(function(e,t){l.set(r,{async:!0,onload:function(){e(r),r.parentNode&&r.parentNode.removeChild(r)},onerror:function(){t(r)},src:i,inside:document.head})})},load:function e(r,t){return t=t?new URL(t,location.href):location.href,r=new URL(r,t),(t=e.loading=e.loading||{})[r+""]||(/\.css$/.test(r.pathname)?t[r+""]=new Promise(function(e,t){var i=l.create("link",{href:r,rel:"stylesheet",inside:document.head,onload:function(){e(i)},onerror:function(){t(i)}})}):t[r+""]=l.include(r))},fetch:function(e,t){if(!e)throw new TypeError("URL parameter is mandatory and cannot be "+e);var i,r=a({url:new URL(e,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},t);for(i in r.method=r.method.toUpperCase(),l.hooks.run("fetch-args",r),"GET"===r.method&&r.data&&(r.url.search+=r.data),document.body.setAttribute("data-loading",r.url),r.xhr.open(r.method,r.url.href,!1!==r.async,r.user,r.password),t)if("upload"===i)r.xhr.upload&&"object"==typeof t[i]&&l.extend(r.xhr.upload,t[i]);else if(i in r.xhr)try{r.xhr[i]=t[i]}catch(e){self.console&&console.error(e)}var s,e=Object.keys(r.headers).map(function(e){return e.toLowerCase()});for(s in"GET"!==r.method&&-1===e.indexOf("content-type")&&r.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.headers)void 0!==r.headers[s]&&r.xhr.setRequestHeader(s,r.headers[s]);return(e=new Promise(function(e,t){r.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===r.xhr.status||200<=r.xhr.status&&r.xhr.status<300||304===r.xhr.status?e(r.xhr):t(l.extend(Error(r.xhr.statusText),{xhr:r.xhr,get status(){return this.xhr.status}}))},r.xhr.onerror=function(){document.body.removeAttribute("data-loading"),t(l.extend(Error("Network Error"),{xhr:r.xhr}))},r.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),t(l.extend(Error("Network Timeout"),{xhr:r.xhr}))},r.xhr.send("GET"===r.method?null:r.data)})).xhr=r.xhr,e},value:function(e){var t="string"!=typeof e;return l.$(arguments).slice(+t).reduce(function(e,t){return e&&e[t]},t?e:self)}}),l.Hooks=new l.Class({add:function(e,t,i){if("string"==typeof arguments[0])(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][i?"unshift":"push"](t)},this);else for(var e in arguments[0])this.add(e,arguments[0][e],t)},run:function(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}}),l.hooks=new l.Hooks,l.property,l.Element=function(e){this.subject=e,this.data={},this.bliss={}},l.Element.prototype={set:t(function(e,t){e in l.setProps?l.setProps[e].call(this,t):e in this?this[e]=t:this.setAttribute(e,t)},0),transition:function(s,n){return new Promise(function(e,t){var i,r;"transition"in this.style&&0!==n?(i=l.extend({},this.style,/^transition(Duration|Property)$/),l.style(this,{transitionDuration:(n||400)+"ms",transitionProperty:Object.keys(s).join(", ")}),l.once(this,"transitionend",function(){clearTimeout(r),l.style(this,i),e(this)}),r=setTimeout(e,n+50,this),l.style(this,s)):(l.style(this,s),e(this))}.bind(this))},fire:function(e,t){var i=document.createEvent("HTMLEvents");return i.initEvent(e,!0,!0),this.dispatchEvent(l.extend(i,t))},bind:t(function(e,i){1<arguments.length&&("function"===l.type(i)||i.handleEvent)&&(t=i,(i="object"===l.type(arguments[2])?arguments[2]:{capture:!!arguments[2]}).callback=t);var t,r=l.listeners.get(this)||{};e.trim().split(/\s+/).forEach(function(e){var t;-1<e.indexOf(".")&&(t=(e=e.split("."))[1],e=e[0]),r[e]=r[e]||[],0===r[e].filter(function(e){return e.callback===i.callback&&e.capture==i.capture}).length&&r[e].push(l.extend({className:t},i)),l.original.addEventListener.call(this,e,i.callback,i)},this),l.listeners.set(this,r)},0),unbind:t(function(e,n){n&&("function"===l.type(n)||n.handleEvent)&&(t=n,n=arguments[2]),(n=("boolean"==l.type(n)?{capture:n}:n)||{}).callback=n.callback||t;var t,a=l.listeners.get(this);(e||"").trim().split(/\s+/).forEach(function(e){var t,i;if(-1<e.indexOf(".")&&(t=(e=e.split("."))[1],e=e[0]),!a)return e&&n.callback?l.original.removeEventListener.call(this,e,n.callback,n.capture):void 0;for(i in a)if(!e||i===e)for(var r,s=0;r=a[i][s];s++)t&&t!==r.className||n.callback&&n.callback!==r.callback||!!n.capture!=!!r.capture&&(e||n.callback||void 0!==n.capture)||(a[i].splice(s,1),l.original.removeEventListener.call(this,i,r.callback,r.capture),s--)},this)},0),when:function(r,s){var e=this;return new Promise(function(i){e.addEventListener(r,function e(t){s&&!s.call(this,t)||(this.removeEventListener(r,e),i(t))})})},toggleAttribute:function(e,t,i){(i=arguments.length<3?null!==t:i)?this.setAttribute(e,t):this.removeAttribute(e)}},l.setProps={style:function(e){for(var t in e)t in this.style?this.style[t]=e[t]:this.style.setProperty(t,e[t])},attributes:function(e){for(var t in e)this.setAttribute(t,e[t])},properties:function(e){l.extend(this,e)},events:function(e){if(1!=arguments.length||!e||!e.addEventListener)return l.bind.apply(this,[this].concat(l.$(arguments)));var t,i=this;if(l.listeners){var r,s=l.listeners.get(e);for(r in s)s[r].forEach(function(e){l.bind(i,r,e.callback,e.capture)})}for(t in e)0===t.indexOf("on")&&(this[t]=e[t])},once:t(function(t,i){var r=this;l.bind(this,t,function e(){return l.unbind(r,t,e),i.apply(r,arguments)},{once:!0})},0),delegate:t(function(e,t,i){l.bind(this,e,function(e){e.target.closest(t)&&i.call(this,e)})},0,2),contents:function(e){!e&&0!==e||(Array.isArray(e)?e:[e]).forEach(function(e){var t=l.type(e);/^(string|number)$/.test(t)?e=document.createTextNode(e+""):"object"===t&&(e=l.create(e)),e instanceof Node&&this.appendChild(e)},this)},inside:function(e){e&&e.appendChild(this)},before:function(e){e&&e.parentNode.insertBefore(this,e)},after:function(e){e&&e.parentNode.insertBefore(this,e.nextSibling)},start:function(e){e&&e.insertBefore(this,e.firstChild)},around:function(e){e&&e.parentNode&&l.before(this,e),this.appendChild(e)}},l.Array=function(e){this.subject=e},l.Array.prototype={all:function(e){var t=l.$(arguments).slice(1);return this[e].apply(this,t)}},l.add=t(function(r,i,s,e){s=l.extend({$:!0,element:!0,array:!0},s),"function"==l.type(i)&&(!s.element||r in l.Element.prototype&&e||(l.Element.prototype[r]=function(){return this.subject&&l.defined(i.apply(this.subject,arguments),this.subject)}),!s.array||r in l.Array.prototype&&e||(l.Array.prototype[r]=function(){var t=arguments;return this.subject.map(function(e){return e&&l.defined(i.apply(e,t),e)})}),s.$)&&(l.sources[r]=l[r]=i,s.array||s.element)&&(l[r]=function(){var e=[].slice.apply(arguments),t=e.shift(),i=s.array&&Array.isArray(t)?"Array":"Element";return l[i].prototype[r].apply({subject:t},e)})},0),l.add(l.Array.prototype,{element:!1}),l.add(l.Element.prototype),l.add(l.setProps),l.add(l.classProps,{element:!1,array:!1}),document.createElement("_"));l.add(l.extend({},HTMLElement.prototype,function(e){return"function"===l.type(i[e])}),null,!0)}();var fullSearchIndex,fullSearchData,psaumeIndex,psaumeData,autresChantsIndex,autresChantsData,bibleIndex,bibleData,lecturesIndex,lecturesData,jsep=function(e){"use strict";const f="Compound",g="MemberExpression",y="Literal";function b(e,t){var i=new Error(e+" at character "+t);throw i.index=t,i.description=e,i}function t(e){return Math.max(0,...Object.keys(e).map(e=>e.length))}function x(e){return A[e]||0}function M(e,t,i){return{type:"BinaryExpression",operator:e,left:t,right:i}}function w(e){return O(e)||L(e)}function i(s){function n(){var e=o(u),t=u;for(O(e)?u++:b("Unexpected "+a(u),u);u<l&&(e=o(u),w(e));)u++;return t=s.slice(t,u),S.hasOwnProperty(t)?{type:y,value:S[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}}let e,t,u=0,i=s.charAt,r=s.charCodeAt,a=function(e){return i.call(s,e)},o=function(e){return r.call(s,e)},l=s.length,h=function(){let e=o(u);for(;32===e||9===e||10===e||13===e;)e=o(++u)},c=function(){var e,t,i=function(){let e,t,i,r,s,n,a,o,l;if(n=p(),!(t=d()))return n;for(s={value:t,prec:x(t)},(a=p())||b("Expected expression after "+t,u),r=[n,s,a];(t=d())&&0!==(i=x(t));){for(s={value:t,prec:i},l=t;r.length>2&&i<=r[r.length-2].prec;)a=r.pop(),t=r.pop().value,n=r.pop(),e=M(t,n,a),r.push(e);e=p(),e||b("Expected expression after "+l,u),r.push(s,e)}for(o=r.length-1,e=r[o];o>1;)e=M(r[o-1].value,r[o-2],e),o-=2;return e}();return h(),63!==o(u)?i:(u++,(e=c())||b("Expected expression",u),h(),58===o(u)?(u++,(t=c())||b("Expected expression",u),{type:"ConditionalExpression",test:i,consequent:e,alternate:t}):void b("Expected :",u))},d=function(){h();let e=s.substr(u,C),t=e.length;for(;0<t;){if(A.hasOwnProperty(e)&&(!O(o(u))||u+e.length<s.length&&!w(o(u+e.length))))return u+=t,e;e=e.substr(0,--t)}return!1},p=function(){let e,t,i,r;if(h(),e=o(u),L(e)||46===e){let e,t,i="";for(;L(o(u));)i+=a(u++);if(46===o(u))for(i+=a(u++);L(o(u));)i+=a(u++);if("e"===(e=a(u))||"E"===e){for(i+=a(u++),"+"!==(e=a(u))&&"-"!==e||(i+=a(u++));L(o(u));)i+=a(u++);L(o(u-1))||b("Expected exponent ("+i+a(u)+")",u)}return t=o(u),O(t)?b("Variable names cannot start with a number ("+i+a(u)+")",u):46===t&&b("Unexpected period",u),{type:y,value:parseFloat(i),raw:i}}if(39===e||34===e)r=function(){let t="",i=a(u++),r=!1;for(;u<l;){let e=a(u++);if(e===i){r=!0;break}if("\\"===e)switch(e=a(u++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return r||b('Unclosed quote after "'+t+'"',u),{type:y,value:t,raw:i+t+i}}();else if(91===e)r=(u++,{type:"ArrayExpression",elements:m(93)});else{for(t=s.substr(u,k),i=t.length;0<i;){if(E.hasOwnProperty(t)&&(!O(o(u))||u+t.length<s.length&&!w(o(u+t.length))))return u+=i,{type:"UnaryExpression",operator:t,argument:p(),prefix:!0};t=t.substr(0,--i)}O(e)?r=n():40===e&&(r=function(){u++;let e=c();if(h(),41===o(u))return u++,e;b("Unclosed (",u)}())}if(!r)return!1;for(h(),e=o(u);46===e||91===e||40===e;)u++,46===e?(h(),r={type:g,computed:!1,object:r,property:n()}):91===e?(r={type:g,computed:!0,object:r,property:c()},h(),93!==(e=o(u))&&b("Unclosed [",u),u++):40===e&&(r={type:"CallExpression",arguments:m(41),callee:r}),h(),e=o(u);return r},m=function(e){let t=[],i=!1,r=0;for(;u<l;){h();var s=o(u);if(s===e){i=!0,u++,41===e&&r&&r>=t.length&&b("Unexpected token "+String.fromCharCode(e),u);break}if(44===s){if(u++,++r!==t.length)if(41===e)b("Unexpected token ,",u);else if(93===e)for(let e=t.length;e<r;e++)t.push(null)}else{s=c();s&&s.type!==f||b("Expected comma",u),t.push(s)}}return i||b("Expected "+String.fromCharCode(e),u),t},v=[];for(;u<l;)59===(e=o(u))||44===e?u++:(t=c())?v.push(t):u<l&&b('Unexpected "'+a(u)+'"',u);return 1===v.length?v[0]:{type:f,body:v}}let E={"-":1,"!":1,"~":1,"+":1},A={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},r={$:1,_:1},k=t(E),C=t(A),S={true:!0,false:!1,null:null},L=function(e){return 48<=e&&e<=57},O=function(e){return 65<=e&&e<=90||97<=e&&e<=122||128<=e&&!A[String.fromCharCode(e)]||r.hasOwnProperty(String.fromCharCode(e))};return i.version="0.4.0",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(e){return k=Math.max(e.length,k),E[e]=1,this},i.addBinaryOp=function(e,t){return C=Math.max(e.length,C),A[e]=t,this},i.addIdentifierChar=function(e){return r[e]=1,this},i.addLiteral=function(e,t){return S[e]=t,this},i.removeUnaryOp=function(e){return delete E[e],e.length===k&&(k=t(E)),this},i.removeAllUnaryOps=function(){return E={},k=0,this},i.removeIdentifierChar=function(e){return delete r[e],this},i.removeBinaryOp=function(e){return delete A[e],e.length===C&&(C=t(A)),this},i.removeAllBinaryOps=function(){return A={},C=0,this},i.removeLiteral=function(e){return delete S[e],this},i.removeAllLiterals=function(){return S={},this},e.default=i,Object.defineProperty(e,"__esModule",{value:!0}),e}({}),contactLoaded=(!function(e){"use strict";function M(e,t){var i=new Error(e+" at character "+t);throw i.index=t,i.description=e,i}function t(e){var t,i,r=0;for(i in e)(t=i.length)>r&&e.hasOwnProperty(i)&&(r=t);return r}function w(e){return s[e]||0}function E(e,t,i){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:i}}function A(e){return 48<=e&&e<=57}function k(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||128<=e&&!s[String.fromCharCode(e)]}function C(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||128<=e&&!s[String.fromCharCode(e)]}function i(u){for(var e,h=0,t=u.charAt,i=u.charCodeAt,c=function(e){return t.call(u,e)},d=function(e){return i.call(u,e)},p=u.length,m=function(){for(var e=d(h);32===e||9===e||10===e||13===e;)e=d(++h)},v=function(){var e,t,i=function(){var e,t,i,r,s,n,a,o,l,n=g();if(!(t=f()))return n;for(s={value:t,prec:w(t)},(a=g())||M("Expected expression after "+t,h),r=[n,s,a];(t=f())&&0!==(i=w(t));){for(s={value:t,prec:i},l=t;2<r.length&&i<=r[r.length-2].prec;)a=r.pop(),t=r.pop().value,n=r.pop(),e=E(t,n,a),r.push(e);(e=g())||M("Expected expression after "+l,h),r.push(s,e)}for(e=r[o=r.length-1];1<o;)e=E(r[o-1].value,r[o-2],e),o-=2;return e}();return m(),63!==d(h)?i:(h++,(e=v())||M("Expected expression",h),m(),58===d(h)?(h++,(t=v())||M("Expected expression",h),{type:"ConditionalExpression",test:i,consequent:e,alternate:t}):void M("Expected :",h))},f=function(){m();for(var e=u.substr(h,n),t=e.length;0<t;){if(s.hasOwnProperty(e)&&(!k(d(h))||h+e.length<u.length&&!C(d(h+e.length))))return h+=t,e;e=e.substr(0,--t)}return!1},g=function(){var e,t,i;if(m(),e=d(h),A(e)||46===e){for(var r,s="";A(d(h));)s+=c(h++);if(46===d(h))for(s+=c(h++);A(d(h));)s+=c(h++);if("e"===(r=c(h))||"E"===r){for(s+=c(h++),"+"!==(r=c(h))&&"-"!==r||(s+=c(h++));A(d(h));)s+=c(h++);A(d(h-1))||M("Expected exponent ("+s+c(h)+")",h)}return r=d(h),k(r)?M("Variable names cannot start with a number ("+s+c(h)+")",h):46===r&&M("Unexpected period",h),{type:L,value:parseFloat(s),raw:s}}if(39===e||34===e){for(var n,a="",o=c(h++),l=!1;h<p;){if((n=c(h++))===o){l=!0;break}if("\\"===n)switch(n=c(h++)){case"n":a+="\n";break;case"r":a+="\r";break;case"t":a+="\t";break;case"b":a+="\b";break;case"f":a+="\f";break;case"v":a+="\v";break;default:a+=n}else a+=n}return l||M('Unclosed quote after "'+a+'"',h),{type:L,value:a,raw:o+a+o}}if(91===e)return h++,{type:"ArrayExpression",elements:b(93)};for(i=(t=u.substr(h,P)).length;0<i;){if(O.hasOwnProperty(t)&&(!k(d(h))||h+t.length<u.length&&!C(d(h+t.length))))return h+=i,{type:"UnaryExpression",operator:t,argument:g(),prefix:!0};t=t.substr(0,--i)}return!(!k(e)&&40!==e)&&function(){var e,t,t=40===(e=d(h))?x():y();for(m(),e=d(h);46===e||91===e||40===e;)h++,46===e?(m(),t={type:S,computed:!1,object:t,property:y()}):91===e?(t={type:S,computed:!0,object:t,property:v()},m(),93!==(e=d(h))&&M("Unclosed [",h),h++):40===e&&(t={type:"CallExpression",arguments:b(41),callee:t}),m(),e=d(h);return t}()},y=function(){var e=d(h),t=h;for(k(e)?h++:M("Unexpected "+c(h),h);h<p&&(e=d(h),C(e));)h++;return t=u.slice(t,h),o.hasOwnProperty(t)?{type:L,value:o[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},b=function(e){for(var t,i=[],r=!1,s=0;h<p;){if(m(),(t=d(h))===e){r=!0,h++,41===e&&s&&i.length<=s&&M("Unexpected token "+String.fromCharCode(e),h);break}if(44===t){if(h++,++s!==i.length)if(41===e)M("Unexpected token ,",h);else if(93===e)for(var n=i.length;n<s;n++)i.push(null)}else(t=v())&&t.type!==a||M("Expected comma",h),i.push(t)}return r||M("Expected "+String.fromCharCode(e),h),i},x=function(){h++;var e=v();if(m(),41===d(h))return h++,e;M("Unclosed (",h)},r=[];h<p;)59===(e=d(h))||44===e?h++:(e=v())?r.push(e):h<p&&M('Unexpected "'+c(h)+'"',h);return 1===r.length?r[0]:{type:a,body:r}}var r,a="Compound",S="MemberExpression",L="Literal",O={"-":!0,"!":!0,"~":!0,"+":!0},s={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},P=t(O),n=t(s),o={true:!0,false:!1,null:null};i.version="0.3.4",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(e){return P=Math.max(e.length,P),O[e]=!0,this},i.addBinaryOp=function(e,t){return n=Math.max(e.length,n),s[e]=t,this},i.addLiteral=function(e,t){return o[e]=t,this},i.removeUnaryOp=function(e){return delete O[e],e.length===P&&(P=t(O)),this},i.removeAllUnaryOps=function(){return O={},P=0,this},i.removeBinaryOp=function(e){return delete s[e],e.length===n&&(n=t(s)),this},i.removeAllBinaryOps=function(){return s={},n=0,this},i.removeLiteral=function(e){return delete o[e],this},i.removeAllLiterals=function(){return o={},this},"undefined"==typeof exports?(r=e.jsep,(e.jsep=i).noConflict=function(){return e.jsep===i&&(e.jsep=r),i}):"undefined"!=typeof module&&module.exports?exports=module.exports=i:exports.parse=i}(this),!function(){var c,e;function t(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[])}self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)&&(c=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text number url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||t("script").pop(),resize:function(e){if(c.resizes(e)){var t,i=getComputedStyle(e),r=0,s=(!e.value&&e.placeholder&&(t=!0,e.value=e.placeholder),e.nodeName.toLowerCase());if("textarea"==s)e.style.height="0","border-box"==i.boxSizing?r=e.offsetHeight:"content-box"==i.boxSizing&&(r=-e.clientHeight+parseFloat(i.minHeight)),e.style.height=e.scrollHeight+r+"px";else if("input"==s)if(e.style.width="1000px",e.offsetWidth){e.style.width="0","border-box"==i.boxSizing?r=e.offsetWidth:"padding-box"==i.boxSizing?r=e.clientWidth:"content-box"==i.boxSizing&&(r=parseFloat(i.minWidth));var n=Math.max(r,e.scrollWidth-e.clientWidth);e.style.width=n+"px";for(var a=0;a<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);a++)n+=e.scrollLeft,e.style.width=n+"px"}else e.style.width=e.value.length+1+"ch";else if("select"==s){if(-1==e.selectedIndex)return;var o,l,r=0<e.selectedIndex?e.selectedIndex:0,u=document.createElement("_");for(l in u.textContent=e.options[r].textContent,e.parentNode.insertBefore(u,e.nextSibling),i){var h=i[l];/^(width|webkitLogicalWidth|length)$/.test(l)||"string"!=typeof h||(u.style[l]=h,/appearance$/i.test(l)&&(o=l))}u.style.width="",0<u.offsetWidth&&(e.style.width=u.offsetWidth+"px",i[o]&&"none"===i[o]||(e.style.width="calc("+e.style.width+" + 2em)")),u.parentNode.removeChild(u),u=null}t&&(e.value="")}},resizeAll:function(e){t(e||c.selectors.base).forEach(function(e){c.resize(e)})},active:!0,resizes:function(e){return e&&e.parentNode&&e.matches&&e.matches(c.selectors.base)&&e.matches(c.selectors.filter)},init:function(){c.selectors.filter=c.script.getAttribute("data-filter")||(t("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||c.selectors.filter,c.resizeAll(),self.MutationObserver&&!c.observer&&(c.observer=new MutationObserver(function(e){c.active&&e.forEach(function(e){"childList"==e.type&&c.resizeAll(e.addedNodes)})}),c.observer.observe(document.documentElement,{childList:!0,subtree:!0}))},$$:t},"loading"!==document.readyState?requestAnimationFrame(c.init):document.addEventListener("DOMContentLoaded",c.init),window.addEventListener("load",function(){c.resizeAll()}),e=function(e){c.active&&c.resize(e.target)},document.documentElement.addEventListener("input",e),document.documentElement.addEventListener("change",e))}(),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize",!async function(a,r){self.$=self.$||a,self.$$=self.$$||r;let o=self.Mavo=a.Class(class Mavo{constructor(e){if(this.treeBuilt=Mavo.promise(),this.dataLoaded=Mavo.promise(),this.deleted=[],this.element=e,this.inProgress=!1,this.index=Object.keys(o.all).length+1,Object.defineProperty(o.all,this.index-1,{value:this,configurable:!0}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index,this.id in o.all){for(var t=2;this.id+t in o.all;t++);this.id=this.id+t}(o.all[this.id]=this).element.setAttribute("mv-app",this.id),this.observe({attribute:"lang",deep:!1},()=>{var e=Mavo.getClosestAttribute(this.element,"lang")||Mavo.locale;this.locale=Mavo.Locale.get(e)})(),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||0),Mavo.setAttributeShy(this.element,"typeof",""),Mavo.hooks.run("init-start",this),r(o.selectors.primitive,this.element).forEach(e=>{var t;a(o.selectors.property,e)&&(!(t=Mavo.Primitive.getConfig(e)).attribute&&!t.hasChildren||e.hasAttribute("mv-list-item"))&&e.setAttribute("mv-group","")}),this.expressions=new Mavo.Expressions(this),o.observers=o.observers||new Mavo.Observers,o.observers.observer.observe(this.element,{characterData:!0,childList:!0,subtree:!0,attributes:!0}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var i=["source","storage","init","uploads"];i.forEach(e=>this.updateBackend(e)),this.observe({deep:!1,attribute:!0},({attribute:e})=>{0===e.indexOf("mv-")&&(e=e?.replace(/^mv-/,"")?.split("-")?.[0],i.includes(e))&&(this.updateBackend(e),"source"!==e&&(this.source||"storage"!==e&&("init"!==e||this.root.data))||this.load())}),this.permissions.can("login",()=>{let e;var t;null!==Mavo.Functions.url("login")&&1===this.index?e="login":null!==Mavo.Functions.url(this.id+"-login")&&(e=this.id+"-login"),void 0!==e&&((t=new URL(location.href)).searchParams.delete(e),history.replaceState(null,"",t),this.primaryBackend.login())}),a.bind(this.element,"mv-login.mavo",e=>{e.backend!=(this.source||this.storage)||this.root.data||this.unsavedChanges||this.load()}),this.bar=new Mavo.UI.Bar(this),this.needsEdit=this.calculateNeedsEdit(),this.setUnsavedChanges(!1),this.permissions.onchange(({action:t,value:e})=>{var i=(i=this.element.getAttribute("mv-permissions")||"").trim().split(/\s+/).filter(e=>e!=t);e&&i.push(t),this.element.setAttribute("mv-permissions",i.join(" "))}),this.permissions.can(["edit","add","delete"],()=>{this.autoEdit&&this.edit()}),this.observe({attribute:"mv-mode"},({element:r})=>{if(this.permissions.edit||this.permissions.add||this.permissions.delete){var s=o.Node.children(r);for(let i=0;i<s.length;i++){var n=s[i];let e=n.mode,t;if(n.element==r)t=n.element.getAttribute("mv-mode"),n.modes=t;else{if(n.modes)continue;t=o.getStyle(n.element.parentNode,"--mv-mode")}n.mode=t,e!=n.mode&&n["edit"==n.mode?"edit":"done"]()}}}),this.primaryBackend?this.permissions.can("read",()=>this.load()):requestAnimationFrame(()=>{this.dataLoaded.resolve(),this.expressions.update(),this.element.dispatchEvent(new Event("mv-load",{bubbles:!0}))}),a.bind(this.element,"mv-load.mavo",e=>{var t;location.hash&&!(t=()=>{var e=document.getElementById(location.hash.slice(1));return!e&&location.hash||this.element.contains(e)&&requestAnimationFrame(()=>{Mavo.scrollIntoViewIfNeeded(e)}),e})()&&this.observe({attribute:"id",once:!0},t),requestAnimationFrame(()=>Stretchy.resizeAll())}),this.dataLoaded.then(async e=>{await Mavo.defer(),this.permissions.can("save",()=>{if(this.autoSave){let t=o.debounce(()=>{this.save()},this.autoSaveDelay);a.bind(this.element,"mv-change.mavo:autosave",e=>{e.node.saved&&this.autoSave&&t()})}},()=>{a.unbind(this.element,"mv-change.mavo:autosave")})}),this.element.addEventListener("keydown",e=>{var t,i=e.target;this.permissions.save&&"S"==e.key&&e[o.superKey]&&!e.altKey?(e.preventDefault(),this.save()):"ArrowUp"!==e.key&&"ArrowDown"!==e.key||i.matches("textarea, input[type=range], input[type=number]")||(i.matches(".mv-editor")&&(t=!0,i=i.parentNode),(i=Mavo.Node.get(i))?.closestCollection&&(i=i.getCousin("ArrowUp"===e.key?-1:1,{wrap:!0}))&&((t&&i.editing?(i.edit(),i.editor):i.element).focus(),e.preventDefault()))}),a.bind(this.element,"click submit",o.Actions.listener),Mavo.hooks.run("init-end",this)}get editing(){return this.root.editing}observe(e={},t){e=Object.assign({element:this.element},e);return o.observers?.observe(e,t)}unobserve(e,t){e=Object.assign({element:this.element},e);return o.observers?.unobserve(e,t)}getData(e){var t={context:this,options:e};return t.data=this.root.getData(e),o.hooks.run("getdata-end",t),t.data}toJSON(){return o.toJSON(this.getData())}message(e,t={}){return new o.UI.Message(this,e,t)}error(e,...t){this.message(e,{type:"error",dismiss:["button","timeout"]}),0<t.length&&console.log(`%c${this.id}: `+e,"color: red; font-weight: bold",...t)}render(e){e={context:this,data:e};o.hooks.run("render-start",e),e.data&&this.root.render(e.data),this.unsavedChanges=!1,o.hooks.run("render-end",e)}edit(){this.bar?.edit&&this.bar.edit.click(),this.root.edit(),a.bind(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",e=>{var t;e.target.matches(o.selectors.multiple)&&(e.target.classList.remove("mv-has-hovered-item"),t=e.target.parentNode.closest(o.selectors.multiple))&&t.classList.toggle("mv-has-hovered-item","mouseenter"==e.type)},!0),this.setUnsavedChanges()}done(){this.root.done(),a.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1}setUnsavedChanges(t){var i=!!t;return t||this.walk(e=>{if(e.unsavedChanges)return!(i=!0)===t&&(e.unsavedChanges=!1),!1}),this.unsavedChanges=i}updateBackend(e){let i=this[e],r,s;var n="mv-"+e;if(r=(r=(r=1==this.index?o.Functions.url(e):r)||o.Functions.url(this.id+"-"+e)||o.Functions.url(this.id.toLowerCase()+"-"+e)||this.element.getAttribute(n)||null)&&"none"==(r=r.trim())?null:r){let t=n+"-";n=Mavo.getAttributes(this.element,RegExp("^"+t)),n=Object.fromEntries(n.map(e=>[e.replace(t,""),this.element.getAttribute(e)]));i?.equals?.(r)||(this[e]=r=o.Backend.create(r,{format:this.element.getAttribute("mv-format"),...n,mavo:this},i),s=!0,a.bind(r,"mv-login mv-logout",e=>{a.fire(this.element,e.type,{backend:r})}))}else this[e]=null;if(s=s||(r?!r.equals(i):Boolean(i))){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);n=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});n.parent=this.source?.permissions,this.permissions.parent=n,this.primaryBackend=this.storage||this.source,this.sourceBackend=this.source||this.storage||this.init;let t=e=>{e.target!==this.sourceBackend?e.target.removeEventListener("mv-remotedatachange",t):this.push(e.data)};this.sourceBackend?.addEventListener("mv-remotedatachange",t)}return s}async push(e,{conflictPolicy:t="stop"}={}){if(this.unsavedChanges)if("ask"===t){if(!confirm(this._("remote-data-conflict")))return}else if("stop"===t)return;return this.load({data:e})}async load({backend:e,data:i}={}){var r=e;if((e=e??this.sourceBackend)||i){var t=this.autoSave;if(this.autoSave=!1,void 0===i){this.inProgress="Loading",await e.ready,i=null;try{i=await e.load()}catch(t){if(!r&&this.init&&this.init!==e){await this.init.ready;try{i=await this.init.load(),e=this.init}catch(e){}}if(t&&null===i){r=t instanceof Response||t instanceof XMLHttpRequest?t:t.xhr;if(404!==r?.status){let e=this._("problem-loading");r&&(e+=r.status?this._("http-error",t):": "+this._("cant-connect")),this.error(e,t)}}}this.inProgress=!1}this.render(i),await Mavo.defer(),this.dataLoaded.resolve(),this.element.dispatchEvent(new CustomEvent("mv-load",{detail:e,bubbles:!0})),this.autoSave=t}}async store(){if(this.storage){this.inProgress="Saving";let t;try{t=await this.storage.store(this.getData())}catch(e){var i;e&&(i=this._("problem-saving"),e instanceof XMLHttpRequest&&(i+=": "+(e.status?this._("http-error",e):this._("cant-connect"))),this.error(i,e)),t=null}return this.inProgress=!1,t}}upload(e,t="images/"+e.name){return this.uploadBackend?(this.inProgress="Uploading",this.uploadBackend.upload(e,t).then(e=>(this.inProgress=!1,e)).catch(e=>(this.error(this._("error-uploading"),e),this.inProgress=!1,null))):Promise.reject()}async save(){o.hooks.run("save-start",this);var e=await this.store();e&&(a.fire(this.element,"mv-save",e),this.lastSaved=Date.now(),this.root.save(),this.unsavedChanges=!1)}walk(){return this.root.walk(...arguments)}calculateNeedsEdit(){var i=!1;return this.walk((e,t)=>!i&&(i=!(e.modes||e instanceof Mavo.Group),!e.modes),void 0,{descentReturn:!0}),i}changed(e){this.root&&this.expressions.active&&this.expressions.updateThrottled(e)}setDeleted(...e){if(this.deleted.forEach(e=>e.destroy()),this.deleted.length=0,this.deletionNotice?.close(),e.length){if(this.deleted.push(...e),1==e.length)var t=e[0].name;else{var i,r={},s=[];for(i in e.forEach(e=>{r[e.name]=(r[e.name]||0)+1}),r)s.push(this._("n-items",{name:i,n:r[i]}));t=s.join(", ")}var n=this.deletionNotice=this.message([this._("item-deleted",{name:t}),{tag:"button",type:"button",textContent:this._("undo"),events:{click:e=>{this.undoDelete(),this.deletionNotice.close(!0)}}}],{classes:"mv-deleted",dismiss:{button:!0,timeout:2e4}});n.closed.then(e=>{!e&&this.deleted.length&&(this.deleted.forEach(e=>e.destroy()),this.deleted.length=0),this.deletionNotice==n&&(this.deletionNotice=null)})}}undoDelete(){this.deleted.forEach(e=>e.collection.add(e,e.index)),this.deleted.length=0}destroy(){Mavo.hooks.run("mavo-destroy-start",this),this.editing&&this.done(),this.observer.destroy(),this.bar?.destroy(),Mavo.all[this.id]=Mavo.all[this.index-1]=null,this.root.destroy(),Mavo.hooks.run("mavo-destroy-end",this)}static version="v0.2.4";static all={};static get(e){if(e instanceof Element){for(var t in o.all)if(o.all[t].element==e)return o.all[t];return null}var i="number"==typeof e?Object.keys(o.all)[e]:e;return o.all[i]||null}static superKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey";static base=["blob:","about:"].includes(location.protocol)?document.currentScript?.src||"https://mavo.io":location;static dependencies=[a.ready().then(()=>o.Plugins.load())];static polyfillsNeeded={blissfuljs:Array.from&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype,"Intl.~locale.en":self.Intl,IntersectionObserver:self.IntersectionObserver,Symbol:self.Symbol,"Element.prototype.remove":Element.prototype.remove,"Element.prototype.before":Element.prototype.before,"Element.prototype.after":Element.prototype.after,"Element.prototype.prepend":Element.prototype.prepend,"Array.prototype.flat":Array.prototype.flat,"Array.prototype.flatMap":Array.prototype.flatMap};static polyfills=[];static init(e=document){return(Array.isArray(arguments[0])?arguments[0]:r(o.selectors.init,e)).filter(e=>!o.get(e)).map(e=>new o(e))}static observe(e,t){return o.observers=o.observers||new Mavo.Observers,o.observers.observe(e,t)}static unobserve(e,t){o.observers.unobserve(e,t)}static warn(e,t={}){o.warn.history=o.warn.history||new Set,o.warn.history.has(e)||console.warn(e),!1!==t.once&&o.warn.history.add(e)}static thenAll(t){return r(t).forEach(e=>{"promise"==a.type(e)&&e.catch(e=>e)}),Promise.all(t).then(e=>t.length!=e.length?o.thenAll(t):e)}static promise(i){let r,s,t=new Promise((e,t)=>{"function"==typeof i?i(e,t):i instanceof Promise&&(i.then(e),i.catch(t)),r=e,s=t});return t.resolve=e=>(r(e),t),t.reject=e=>(s(e),t),t}static defer=t=>new Promise(e=>void 0===t?requestAnimationFrame(e):setTimeout(e,t));static UI={};static hooks=new a.Hooks;static properties=new Set;static attributes=["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-editor","mv-permisssions","mv-rel","mv-value"]},{live:{inProgress(e){a.toggleAttribute(this.element,"mv-progress",e,e),a.toggleAttribute(this.element,"aria-busy",!!e,!!e),this.element.style.setProperty("--mv-progress-text",e?`"${this._(e)}"`:"")},unsavedChanges(e){this.element.classList.toggle("mv-unsaved-changes",e)},needsEdit(e){this.bar&&this.bar.toggle("edit",e&&this.permissions.edit)},storage(e){e===this._storage||e||((e=new Mavo.Permissions({edit:!0,save:!1})).parent=this.permissions.parent,this.permissions.parent=e)},primaryBackend(e){if((e=e||null)!=this._primaryBackend)return e},uploadBackend:{get(){var e=this.uploads;return e?.upload?(e.permissions.login&&e.login(),this.uploads):this.storage?.upload?this.storage:void 0}}},lazy:{locale:()=>document.documentElement.lang||"en-GB"}});["toNode","isProxy","route","parent","property","mavo","groupedBy","as"].forEach(e=>{a.lazy(o,e,()=>Symbol(e))}),Object.defineProperty(o.all,"length",{get:function(){return Object.keys(this).length}});var e=o.selectors={init:"[mv-app], [data-mv-app]",property:"[property]",group:"[typeof], [mv-group]",list:"[mv-list]",multiple:"[mv-list-item]",formControl:"input, select, option, textarea",textInput:["text","email","url","tel","search","number"].map(e=>`input[type=${e}]`).join(", ")+", input:not([type]), textarea",ui:".mv-ui"};e.primitive=e.property+`:not(${e.group}, ${e.list})`,e.childGroup=e.property+`:is(${e.group})`,e.scope=`:is(${e.group}, ${e.multiple}, ${e.list})`,e.item=e.multiple+", "+e.group,e.output="[property=output], .mv-output",a.each(o.polyfillsNeeded,(e,t)=>{t||o.polyfills.push(e)}),o.ready=o.thenAll(o.dependencies),o.inited=o.promise(),await o.defer(),0<o.polyfills.length&&(e="https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features="+o.polyfills.map(e=>e+"|gated").join(","),o.dependencies.push(a.include(e))),await a.ready(),Mavo.attributeStartsWith("data-mv-").forEach(e=>{var t=e.ownerElement,i=e.name.replace("data-","");Mavo.setAttributeShy(t,i,e.value)}),r("[mv-list]:not([property])").forEach(e=>e.setAttribute("property",e.getAttribute("mv-list"))),r("[mv-list-item]:not([property])").forEach(e=>e.setAttribute("property",e.getAttribute("mv-list-item"))),o.containers={TR:"TBODY",OPTION:"OPTGROUP"},r("[mv-list]").forEach(t=>{var e;a(":scope > [mv-list-item]",t)||(1!==t.children.length||t.children[0].matches("[property]")?(e=Object.entries(o.containers).filter(([,e])=>e===t.tagName)[0]||"div",a.create(e,{className:"mv-container","mv-list-item":"",contents:[...t.childNodes],inside:t})):t.children[0].setAttribute("mv-list-item",""))}),r("[mv-list-item], [mv-multiple]").forEach(e=>{let t;e.hasAttribute("mv-list-item")||(i=e.getAttribute("mv-multiple"),e.setAttribute("mv-list-item",i),e.hasAttribute("property")||(i?e.setAttribute("property",i):(i=o.Node.getImplicitPropertyName(e)||o.Node.generatePropertyName("collection",e),e.setAttribute("property",i))),t=!0,Mavo.warn("@mv-multiple is deprecated. Please use @mv-list-item and @mv-list instead")),e.hasAttribute("property")||e.setAttribute("property",e.getAttribute("mv-list-item"));var i=e.parentNode;let r=i;var s=Mavo.Node.getProperty(e),i=(i.hasAttribute("mv-list")||(1===i.children.length&&!i.matches("[mv-app], [property], [mv-list-item]")||(i=o.containers[e.tagName]||"div",r=a.create(i,{className:"mv-container",around:e})),r.setAttribute("mv-list",""),s&&r.setAttribute("property",s),Mavo.moveAttribute("mv-initial-items",e,r),Mavo.moveAttribute("mv-order",e,r),Mavo.moveAttribute("mv-accepts",e,r),t?(Mavo.moveAttribute("mv-value",e,r),Mavo.moveAttribute("mv-mode",e,r),Mavo.moveAttribute("mv-multiple-path",e,r,{rename:"mv-path"})):Mavo.warn("Please wrap @mv-list-item elements with @mv-list elements")),r.getAttribute("property")),s=e.getAttribute("property");!i&&s?r.setAttribute("property",s):i===s&&i||(s=Mavo.Node.getProperty(r)||Mavo.Node.generatePropertyName("item",r),i||r.setAttribute("property",s),e.setAttribute("property",s))}),r("[property='']").forEach(e=>{var t=Mavo.Node.getProperty(e)||Mavo.Node.generatePropertyName("prop",e);e.setAttribute("property",t)}),r(o.selectors.init).forEach(function(e){o.get(e)||e.setAttribute("mv-progress","Loading")}),window.CSSPropertyRule&&document.documentElement.classList.add("mv-supports-atproperty"),await o.ready,o.init(),o.inited.resolve()}(Bliss,Bliss.$),!function(n,i){var a=n.extend(Mavo,{load:(e,t=document.currentScript?.src??location)=>n.load(e,t),readFile:(i,r="DataURL")=>{var s=new FileReader;return new Promise((t,e)=>{s.onload=e=>t(s.result),s.onerror=s.onabort=e,s["readAs"+r](i)})},toJSON:e=>{if(null===e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,"\t")}catch(e){return e}},safeToJSON:function(e){var i=new WeakSet;return JSON.stringify(e,(e,t)=>{if("object"==typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t})},isPlainObject:e=>{return"object"===n.type(e)&&"Object"===Object.getPrototypeOf(e).constructor?.name},primitivify:(e,t)=>(e&&(t&&"object"==typeof t&&(Object.assign(e,t),t=Mavo.value(t)),e.valueOf=e.toJSON=e[Symbol.toPrimitive]=()=>t),e),objectify:(e,t)=>{var i,r=Mavo.value(e);return"object"==typeof e&&null!==e||(null===e?e={[Symbol.toStringTag]:"Null",toJSON:()=>null}:(e=new(i=e.constructor)(r))[Symbol.toStringTag]=i.name,a.primitivify(e,r)),n.extend(e,t)},value:e=>e?.valueOf?e.valueOf():e,toArray:e=>void 0===e?[]:Array.isArray(e)?e:[e],union:(t,e)=>t instanceof Set&&e?(e.forEach(e=>t.add(e)),t):new Set([...t||[],...e||[]]),getStyle:(e,t)=>{if(e)return getComputedStyle(e).getPropertyValue(t)?.trim()},data:function(e,t,i){var r,s;return e?(r=a.elementData.get(e)||{},2==arguments.length?s=r[t]:void 0===i?delete r[t]:s=r[t]=i,a.elementData.set(e,r),s):null},elementData:new WeakMap,elementPath:function(e,t){if(Array.isArray(t)){var i=(a=t).reduce((e,t)=>e.children[t>>0]||e,e),r=a[a.length-1];if(r!=r>>0){var s=+(r+"").split(".")[1];r>>0<0&&(i=i.firstChild,s--);for(var n=0;n<s;n++)i=i.nextSibling}return i}for(var a=[],o=t;o&&o!=e;o=o.parentNode){for(var l=0,u=o===t&&1!==t.nodeType,s=u?1:0,h=o;h=h[`previous${u?"":"Element"}Sibling`];)u?(s++,1==h.nodeType&&(u=!1)):l++;a.unshift(l=0<s?l-1+"."+s:l)}return o?a:null},revocably:{add:function(e,t){var i=a.revocably.isRemoved(e);return i?.parentNode?i.parentNode.replaceChild(e,i):e&&t&&!e.parentNode&&("function"==typeof t?t(e):t.appendChild(e)),i},remove:function(e,t){var i;if(e)return(i=a.data(e,"commentstub"))||(t=t||e.id||e.className||e.nodeName,i=a.data(e,"commentstub",document.createComment(t))),e.parentNode&&e.parentNode.replaceChild(i,e),i},isRemoved:function(e){return!(!e||e.parentNode||!(e=a.data(e,"commentstub"))?.parentNode)&&e},setAttribute:function(e,t,i){void 0===a.data(e,"attribute-"+t)&&a.data(e,"attribute-"+t,e.getAttribute(t)),e.setAttribute(t,i)},restoreAttribute:function(e,t){var i=a.data(e,"attribute-"+t);void 0!==i&&(n.toggleAttribute(e,t,i),a.data(e,"attribute-"+t,void 0))}},inView:{is:e=>{e=e.getBoundingClientRect();return(0<=e.bottom&&e.bottom<=innerHeight||0<=e.top&&e.top<=innerHeight)&&(0<=e.right&&e.right<=innerWidth||0<=e.left&&e.left<=innerWidth)},when:(r,e=`${innerHeight/2}px ${innerWidth/2}px`)=>{var s=a.inView.observer=a.inView.observer||new IntersectionObserver(function(e,t){e.forEach(e=>{0<e.intersectionRatio&&(t.unobserve(e.target),n.fire(e.target,"mv-inview",{entry:e}))})},{rootMargin:e});return new Promise(t=>{a.inView.is(r)&&t(),s.observe(r);var i=e=>{r.removeEventListener("mv-inview",i),e.stopPropagation(),t()};r.addEventListener("mv-inview",i)})}},scrollIntoViewIfNeeded:e=>{e&&!Mavo.inView.is(e)&&e.scrollIntoView({behavior:"smooth"})},setAttributeShy:function(e,t,i){e.hasAttribute(t)||e.setAttribute(t,i)},getAttribute:function(i,...r){for(let e=0,t;t=r[e];e++){var s=i.getAttribute(t);if(s)return s}return null},getClosestAttribute:function(e,t){return e.closest(`[${t}]`)?.getAttribute(t)??null},moveAttribute(e,t,i,r={}){var s=t.getAttribute(e);null!==s&&(r=r.rename||e,i.setAttribute(r,s),t.removeAttribute(e))},getTarget:function(){var e=location.hash.substr(1);return document.getElementById(e)},XPath:function(e,t=document){var i,r=t.ownerDocument||t,s=[];if(r.evaluate)for(var n=r.evaluate(e,t,null,XPathResult.ANY_TYPE,null);i=n.iterateNext();)s.push(i);return s},attributeStartsWith:function(e,t=document.documentElement){return a.XPath(`.//@*[starts-with(name(), "${e}")]`,t)},getAttributes:function(e,t){return e.getAttributeNames().filter(e=>t.test(e))},usePropertyInsteadOfAttribute:function(e,t){return!(-1<["href","src"].indexOf(t)||t.startsWith("on")||"http://www.w3.org/2000/svg"==e.namespaceURI)},in:function(e,t){if(t)return"object"==typeof t&&e in t||void 0!==t[e]},getCanonicalProperty:function(e,t){if(e&&(t||0===t))return a.in(t,e)?t:t.toLowerCase?(t=t.toLowerCase(),a.in(t,e)?t:-1<(t=(e=Object.keys(e)).map(e=>e.toLowerCase()).indexOf(t))?e[t]:void 0):void 0},subset:function(e,a,t){var i,r;return 3==arguments.length?a.length?(i=a[a.length-1],r=n.value(e,...a.slice(0,-1)),Array.isArray(r)&&Array.isArray(t)?r.splice(i,1,...t):r&&(r[a[a.length-1]]=t),e):t:"object"==typeof e&&a?.length?a.reduce((e,t,i)=>{let r,s=t?.startsWith?.("id=")?t.substring(3):null;var n;return null!==s?(n=e.findIndex(e=>Mavo.Functions.get(e,"id")==s),r=-1<n?e[n]:{id:s},a[i]=-1<n?n:e.length):(r=Mavo.Functions.get(e,t),a[i]=t),r},e):e},clone:function(e){return e&&"object"==typeof e?JSON.parse(a.safeToJSON(e)):e},shallowClone:function(e){return e&&"object"==typeof e?Array.isArray(e)?[...e]:n.extend({},e):e},debounce:function(i,r){var s,n;return r?(s=null,function(){var e=this,t=arguments;n=function(){i.apply(e,t),removeEventListener("beforeunload",n)},clearTimeout(s),s=setTimeout(n,r),addEventListener("beforeunload",n)}):i},escapeRegExp:e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),observeResize:function(e,i){var r,t;if(self.ResizeObserver)return r=null,(t=i instanceof ResizeObserver?i:new ResizeObserver(e=>{var t=e[e.length-1].contentRect;r&&r.width==t.width&&r.height==t.height||(i(e),r=t)})).observe(e),t},Observer:class{constructor(e,t,i,r={}){i instanceof MutationObserver&&(this.observer=i),this.observer=this.observer||new MutationObserver(i),this.callback=i,this.update(e,t,r),this.run()}update(e,t,i){this.element=e,this.attribute=t,this.options=n.extend({},i),void 0!==i&&(i.attributes||i.childList||i.characterData)||(this.attribute&&Object.assign(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!i.oldValue}),this.attribute&&"all"!=this.attribute)||Object.assign(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!i.oldValue}),this.observer?.running&&(this.stop(),this.run())}flush(){var e=this.observer?.takeRecords();e&&this.callback(e)}stop(){return this.observer?.disconnect(),this.running=!1,this}run(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this}pause(){this.runOnResume=this.running,this.stop()}resume(){!1!==this.runOnResume&&this.run(),delete this.runOnResume}destroy(){this.stop(),this.observer=this.element=null}},rr:function(e){return e(),e},wrap:(e,t)=>e<0?t-1:t<=e?0:e,options:(e,{map:s}={})=>{var n=s?new Map:{};return e.trim().match(/(?:\\[,;]|[^,;])+/g)?.forEach(i=>{if(i){var r=(i=i.trim().replace(/\\([,;])/g,"$1")).match(/^\s*((?:\\:|[^:])*?)\s*:\s*(.+)$/);let e,t;t=r?(e=r[1].replace(/\\:/g,":"),"false"!==r[2]&&r[2]):(e=i,!0),s?n.set(e,t):n[e]=t}}),n},BucketMap:class{constructor({arrays:e=!1}={}){this.map=new Map,this[Symbol.iterator]=this.map[Symbol.iterator],this.arrays=e}set(e,t){var i;this.arrays?(i=this.map.get(e)||[]).push(t):(i=this.map.get(e)||new Set).add(t),this.map.set(e,i)}delete(e,t){var i,r;2==arguments.length?(i=this.map.get(e))&&(this.arrays?-1<(r=i.indexOf(t))&&i.splice(r,1):i.delete(t)):this.map.delete(e)}forEach(...e){return this.map.forEach(...e)}}});function e(){var e=a.getTarget();const t="mv-target-within";for(i("."+t).forEach(e=>e.classList.remove(t));e?.classList;)e.classList.add(t),e=e.parentNode}a.Observers=class extends Map{constructor({observer:e,callback:t}={}){super();var i=a.Observers;this.callback=t||i.callback,this.observer=e||(i.observer=i.observer||new MutationObserver(this.callback))}applyRecord(e){for(var[t,i]of this.entries()){var r;a.Observers.matchesRecord(t,e)&&(r=Mavo.Node.get(e.target,!0),i.call(this,{node:r,element:e.target,type:e.type,attribute:e.attributeName,record:e}),t.once)&&this.unobserve(t,i)}}static matchesRecord(e,t){if(!1===e.active)return!1;var i=t.target;if(e.selector&&!i.matches?.(e.selector))return!1;if(e.attribute){if("attributes"!==t.type)return!1;if(!0!==e.attribute&&e.attribute!==t.attributeName&&!e.attribute.includes?.(t.attributeName))return!1}else if("attributes"===t.type&&!1===e.attribute)return!1;return!e.element||(!1===e.deep?i===e.element:e.element.contains(i))}flush(){var e=this.observer.takeRecords();e&&this.callback(e)}observe(e={},t){return this.set(e,t),t}unobserve(e,t){var i,r;for([i,r]of this.find(e,t).entries())this.delete(i)}pause(e){var t,i,e=this.find(e);for([t,i]of e.entries())t._active=!1!==t.active&&!1!==t._active,t.active=!1;return this.flush(),e}resume(e){e instanceof a.Observers||(e=this.find(e)),this.flush();for(var[t,i]of e.entries())t.active=t.active||t._active,delete t._active}find(i={},r){var s=Object.keys(i),n=new Mavo.Observers;for(let[t,e]of this.entries())r&&r!==e||s.every(e=>t[e]===i[e])&&n.set(t,e);return n}},a.Observers.callback=e=>{if(0!==this.size)for(var t of e)a.observers.applyRecord(t)},n.proxy=n.classProps.proxy=n.overload(function(e,t,i){return Object.defineProperty(e,t,{get:function(){return this[i][t]},set:function(e){this[i][t]=e},configurable:!0,enumerable:!0}),e}),document.addEventListener("mv-load",e),addEventListener("hashchange",e),Mavo.observe({attribute:"id"},e)}(Bliss,Bliss.$),!function(t,i){var r=Mavo.Locale=t.Class({constructor:function(e,t){this.lang=e,this.phrases={},this.extend(t)},get fallback(){return r.all[this.baseLang]||(this!==r.default?r.default:void 0)},extend:function(e){t.extend(this.phrases,e)},phrase:function(e,t){var e=e.toLowerCase(),i=this.phrases[e];return void 0===(i=void 0===i&&this.fallback?this.fallback.phrase(e):i)?i=e.replace(/\b-\b/g," "):t&&(e=i.match(/\{\w+(?=\})/g)?.map(e=>e.slice(1))??[],Mavo.Functions.unique(e).forEach(e=>{e in t&&(i=i.replace(RegExp(`{${e}}`,"gi"),t[e]))})),i},live:{lang:function(e){this.baseLang=r.getBaseLang(e),e==this.baseLang&&(this.baseLang=null)}},static:{all:{},register:function(e,t){r.all[e]?r.all[e].extend(t):r.all[e]=new r(e,t)},match:function(e=""){return r.all[e]||r.all[r.getBaseLang(e)]},get:function(e){return r.match(e)||r.default},getBaseLang:function(e){return e.split("-")[0]},lazy:{default:()=>r.match(Mavo.locale)||r.all.en}}});Mavo.prototype._=function(e,t){return this.locale&&e?this.locale.phrase(e,t):e},Mavo.ready.then(()=>{i("datalist.mv-phrases[lang]").forEach(e=>{var t=i("option",e).reduce((e,t)=>(e[t.value]=t.textContent.trim(),e),{});Mavo.Locale.register(e.lang,t)})})}(Bliss,Bliss.$),Mavo.Locale.register("en",{second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",edit:"Edit",editing:"Editing",save:"Save",import:"Import",export:"Export",logout:"Logout",login:"Login",loading:"Loading",uploading:"Uploading",saving:"Saving",dismiss:"Dismiss","logged-in-as":"Logged in to {id} as ","login-to":"Login to {id}","error-uploading":"Error uploading file","cannot-load-uploaded-file":"Cannot load uploaded file",filename:"Filename?","problem-saving":"Problem saving data","problem-loading":"Problem loading data","cannot-parse":"Can’t understand this file","http-error":"HTTP error {status}: {statusText}","cant-connect":"Can’t connect to the Internet","add-item":"Add {name}","add-item-before":"Add new {name} before","add-item-after":"Add new {name} after","drag-to-reorder":"Drag to reorder {name}","delete-item":"Delete this {name}","item-deleted":"{name} deleted","n-items":"{n} {name} items",undo:"Undo","gh-updated-file":"Updated {name}","gh-login-fork-options":"You have your own copy of this page, would you like to use it?","gh-use-my-fork":"Yes, show me my data.","remote-data-conflict":"There is new data but you have unsaved changes. Loading it will overwrite your changes. Load new data?"}),!function(a,t){Mavo.attributes.push("mv-plugins");let o=Mavo.Plugins={loaded:{},async load(){o.plugins=new Set;let s={};var e;if(t("[mv-plugins]").forEach(e=>{e.getAttribute("mv-plugins").trim().split(/\s+/).forEach(e=>{var[e,t]=e.split("@");o.plugins.add(e),s[e]=t})}),o.plugins.size)return e=(await(await fetch(o.url+"/plugins.json")).json()).plugin,Mavo.thenAll(e.filter(e=>o.plugins.has(e.id)).map(async t=>{if(o.loaded[t.id])return Promise.resolve();var i=`mavo-${t.id}.js`;let r;if(t.repo){var e=s[t.id]||"latest";r=`https://cdn.jsdelivr.net/gh/${t.repo}@${e}/`+i;try{return await a.include(o.loaded[t.id],r)}catch(e){r=`https://cdn.jsdelivr.net/gh/${t.repo}/`+i;try{return await a.include(o.loaded[t.id],r)}catch(e){r="/res/js/lib/"+i}}}else r=`${o.url}/${t.id}/`+i;return a.include(o.loaded[t.id],r)}))},register:function(e,i={}){if(!o.loaded[e]){for(var t in Mavo.hooks.add(i.hooks),i.extend){var r="Mavo"==t?Mavo:Mavo[t];"function"===a.type(r)?a.Class(r,i.extend[t]):a.extend(r,i.extend[t])}var s=[];if(i.ready&&s.push(i.ready),i.dependencies){let t=document.currentScript?document.currentScript.src:location;var n=i.dependencies.map(e=>Mavo.load(e,t));s.push(...n)}s.length&&Mavo.dependencies.push(...s),(o.loaded[e]=i).init&&Promise.all(s).then(()=>i.init())}},url:"https://plugins.mavo.io"}}(Bliss,Bliss.$),!function(s,e){Mavo.attributes.push("mv-bar");let u=Mavo.UI.Bar=class{constructor(e){if(this.mavo=e,this.element=s(".mv-bar",this.mavo.element),this.template=this.mavo.element.getAttribute("mv-bar")||"",Mavo.observers.pause(),this.element)for(var t in this.custom=!0,this.template+=" "+(this.element.getAttribute("mv-bar")||""),this.template=this.template.trim(),u.controls)this[t]=s(".mv-"+t,this.element),this[t]&&(this.template=this.template||"with",this.template+=" "+t);else this.element=s.create({className:"mv-bar mv-ui",start:"HTML"===this.mavo.element.tagName?document.body:this.mavo.element,innerHTML:"<button>&nbsp;</button>"});this.element.classList.contains("mv-compact")&&(this.noResize=!0),this.controls=u.getControls(this.template),this.controls.length&&(this.targetHeight=this.element.offsetHeight),this.custom||(this.element.innerHTML="");for(let t of this.controls){let e=u.controls[t];for(var i in this[t]&&this[t].remove(),e.create?this[t]=e.create.call(this.mavo,this[t]):this[t]||(this[t]=s.create("button",{type:"button",className:"mv-"+t,textContent:this.mavo._(t)})),this.add(t),e.permission?this.permissions.can(e.permission,()=>{this.toggle(t,!e.condition||e.condition.call(this.mavo))},()=>{this.remove(t)}):e.condition&&!e.condition.call(this.mavo)&&this.remove(t),e.events)s.bind(this[t],i,e.events[i].bind(this.mavo))}for(var r in u.controls){let t=u.controls[r];t.action&&s.delegate(this.mavo.element,"click",".mv-"+r,e=>{t.permission&&!this.permissions.is(t.permission)||(t.action.call(this.mavo),e.preventDefault())})}this.controls.length&&!this.noResize&&(this.resize(),self.ResizeObserver)&&(this.resizeObserver=Mavo.observeResize(this.element,e=>{this.resize()})),Mavo.observers.resume()}resize(){this.targetHeight?(this.resizeObserver?.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),e("button, .mv-button",this.element).forEach(e=>{e.title===e.textContent&&(e.title="")}),this.element.offsetHeight>1.6*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight)&&(this.element.classList.add("mv-tiny"),e("button, .mv-button",this.element).forEach(e=>{e.title||(e.title=e.textContent)})),this.resizeObserver?.observe(this.element)):this.targetHeight=this.element.offsetHeight}add(e){var t=u.controls[e];t.prepare&&t.prepare.call(this.mavo),Mavo.revocably.add(this[e],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())}remove(e){var t=u.controls[e];Mavo.revocably.remove(this[e],"mv-"+e),t.cleanup&&t.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())}toggle(e,t){return this[t?"add":"remove"](e)}get permissions(){return this.mavo.permissions}destroy(){this.resizeObserver.disconnect(),this.resizeObserver=null}static getControls(e,t=u.controls){if("none"===(e=e?.trim()))return[];let i=Object.keys(t);if(!e)return i.filter(e=>!t[e].optional);var r,s,n,a,o=/^with\s|\bno-\w+\b/.test(e);let l=(e=e.replace(/\b^with\s+/g,"")).split(/\s+/);i=new Set(i);for(r of l=new Set(l))r.startsWith("no-")?(l.delete(r),r=r.slice(3),l.has(r)||i.delete(r)):i.has(r)||l.delete(r);if(!o)return[...l];for(s of i)t[s].optional&&!l.has(s)&&i.delete(s);return i=[...i],0===l.size?i:(e=[...l].map(e=>i.indexOf(e)),o=Math.min(...e),e=Math.max(...e),n=i.slice(0,o),a=i.slice(e+1),o=i.slice(o,e+1).filter(e=>!l.has(e)),[...n,...o,...l,...a])}};u.controls={status:{create:function(e){return e||s.create({className:"mv-status"})},prepare:function(){var t=this.primaryBackend;if(t?.user){var i=t.user;let e=[i.name||""];i.avatar&&e.unshift(s.create("img",{className:"mv-avatar",src:i.avatar})," "),i.url&&(e=[s.create("a",{href:i.url,target:"_blank",contents:e})]),this.bar.status.textContent="",s.contents(this.bar.status,[{tag:"span",innerHTML:this._("logged-in-as",t)}," ",...e])}},permission:"logout"},edit:{action:function(){this.editing?(this.done(),this.bar.edit.textContent=this._("edit")):(this.edit(),this.bar.edit.textContent=this._("editing"))},permission:["edit","add","delete"],cleanup:function(){this.editing&&(this.done(),this.bar?.edit)&&(this.bar.edit.textContent=this._("edit"))},condition:function(){return this.needsEdit}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},export:{create:function(e){let t;return(t=e?e.matches("a")?e:s.create("a",{className:"mv-button",around:e}):s.create("a",{className:"mv-export mv-button",textContent:this._("export")})).setAttribute("download",this.id+".json"),t},events:{mousedown:function(){this.bar.export.href="data:application/json;charset=UTF-8,"+encodeURIComponent(this.toJSON())}},permission:"edit",optional:!0},import:{create:function(e){e=e||s.create("span",{role:"button",tabIndex:"0",className:"mv-import mv-button",textContent:this._("import"),events:{focus:e=>{t.focus()}}});let t=s.create("input",{type:"file",inside:e,events:{change:e=>{e=e.target.files[0];if(e){let i=s.extend(new FileReader,{onload:e=>{this.inProgress=!1;try{var t=JSON.parse(i.result);this.render(t)}catch(e){this.error(this._("cannot-parse"))}},onerror:e=>{this.error(this._("problem-loading"))}});this.inProgress=this._("uploading"),i.readAsText(e)}}}});return e},optional:!0},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}(Bliss,Bliss.$),!function(n){Mavo.UI.Message=n.Class({constructor:function(e,t,i={}){var r,s;this.mavo=e,this.message=t,this.closed=Mavo.promise(),this.options=i,this.element=n.create({className:"mv-ui mv-message"+(i.type?" mv-"+i.type:""),["string"==n.type(this.message)?"innerHTML":"contents"]:this.message,events:{click:e=>Mavo.scrollIntoViewIfNeeded(this.mavo.element)},[this.mavo.bar?"after":"start"]:(this.mavo.bar||this.mavo).element}),i.style&&n.style(this.element,i.style),i.classes&&this.element.classList.add(...i.classes.split(/\s+/)),"error"==i.type?this.element.setAttribute("role","alert"):this.element.setAttribute("aria-live","polite"),i.dismiss=i.dismiss||{},"string"!=typeof i.dismiss&&!Array.isArray(i.dismiss)||(r={},Mavo.toArray(i.dismiss).forEach(e=>{r[e]=!0}),i.dismiss=r),i.dismiss.button&&n.create("button",{type:"button",className:"mv-close mv-ui",textContent:"×",events:{click:e=>this.close()},start:this.element,title:this.mavo._("dismiss")}),i.dismiss.timeout&&(s="number"==typeof i.dismiss.timeout?i.dismiss.timeout:5e3,n.bind(this.element,{mouseenter:e=>clearTimeout(this.closeTimeout),mouseleave:Mavo.rr(e=>this.closeTimeout=setTimeout(()=>this.close(),s))})),i.dismiss.submit&&this.element.addEventListener("submit",e=>{e.preventDefault(),this.close(e.target)})},async close(e){clearTimeout(this.closeTimeout);var t=this.element.style.transition?1e3*parseFloat(window.getComputedStyle(this.element,null).transitionDuration):400;await n.transition(this.element,{opacity:0},t),n.remove(this.element),this.closed.resolve(e)}})}(Bliss,Bliss.$),!function(t){var s=Mavo.Permissions=t.Class({constructor:function(e){this.triggers=[],this.hooks=new t.Hooks,this.parentChanged=s.prototype.parentChanged.bind(this),this.set(e)},set:function(e){for(var t in e)this[t]=e[t]},on:function(e){return Mavo.toArray(e).forEach(e=>this[e]=!0),this},off:function(e){return(e=Array.isArray(e)?e:[e]).forEach(e=>this[e]=!1),this},can:function(e,t,i){this.observe(e,!0,t),i&&this.cannot(e,i)},cannot:function(e,t){this.observe(e,!1,t)},observe:function(e,t,i){e=Mavo.toArray(e),this.is(e,t)&&i(),this.triggers.push({actions:e,value:t,callback:i,active:!0})},is:function(e,t=!0){e=Mavo.toArray(e).map(e=>!!this[e]).reduce((e,t)=>e||t);return t?e:!e},onchange:function(t){this.hooks.add("change",t),s.actions.forEach(e=>{t.call(this,{action:e,value:this[e]})})},parentChanged:function(e={}){void 0===this["_"+e.action]&&e.from!=e.value&&(this.fireTriggers(e.action),this.hooks.run("change",t.extend({context:this},e)))},changed:function(e,t,i){(t=!!t)!=(i=!!i)&&(this["_"+e]=t,this.fireTriggers(e),this.hooks.run("change",{action:e,value:t,from:i,context:this}))},fireTriggers:function(i){this.triggers.forEach(e=>{var t=this.is(e.actions,e.value);e.active&&-1<e.actions.indexOf(i)&&t?(e.active=!1,e.callback()):t||(e.active=!0)})},or:function(t){return s.actions.forEach(e=>{this[e]=this[e]||t[e]}),this},live:{parent:function(t){var e,i=this._parent;i!=t&&(this._parent=t,i&&-1<(e=i.hooks.change.indexOf(this.parentChanged))&&i.hooks.change.splice(e,1),s.actions.forEach(e=>{this.parentChanged({action:e,value:t?t[e]:void 0,from:i?i[e]:void 0})}),t)&&t.onchange(this.parentChanged)}},static:{actions:[],register:function(i,r){Array.isArray(i)?i.forEach(e=>s.register(e,r)):(t.live(s.prototype,i,{get:function(){var e=this["_"+i];return void 0===e&&this.parent?this.parent[i]:e},set:function(e,t){r&&r.call(this,e,t),this.changed(i,e,t)}}),s.actions.push(i))}}});s.register(["read","save"]),s.register("login",function(e){e&&this.logout&&(this.logout=!1)}),s.register("logout",function(e){e&&this.login&&(this.login=!1)}),s.register("edit",function(e){e&&(this.add=this.delete=!0)}),s.register(["add","delete"],function(e){e||(this.edit=!1)})}(Bliss,Bliss.$),!function(o){var s=Mavo.Backend=class extends EventTarget{constructor(e,t={}){super(),this.permissions=new Mavo.Permissions,this.update(e,t)}update(e,t={}){this.source=e,this.url=new URL(this.source,Mavo.base),this.options=t,this.mavo=t.mavo,this.format=Mavo.Formats.create(t.format,this),(this.constructor.key??t.key)&&(this.key=t.key??this.constructor.key)}async get(e=new URL(this.url)){"data:"!=e.protocol&&!1!==this.constructor.useCache&&e.searchParams.set("timestamp",Date.now());try{var t=await fetch(e.href);return t.ok?t.text():Promise.reject(t)}catch(e){return null}}async load(){await this.ready;let e=await this.get();return"string"!=typeof e?e:(e=e.replace(/^\ufeff/,""),this.format.parse(e))}async store(e,{path:t,format:i=this.format}={}){await this.ready;i="string"==typeof e?e:await i.stringify(e);return await this.put(i,t),{data:e,serialized:i}}ready=Promise.resolve();async login(){}async logout(){}put(){return Promise.reject()}isAuthenticated(){return!!this.accessToken}oAuthParams=()=>"";toString(){return`${this.id} (${this.url})`}equals(e){return e===this||e&&this.id==e.id&&this.source==e.source}async request(e,t,i="GET",r={}){if((r=Object.assign({},r)).method=r.method||i,r.responseType=r.responseType||"json",r.headers=Object.assign({"Content-Type":"application/json; charset=utf-8"},r.headers||{}),this.isAuthenticated()&&(r.headers.Authorization=r.headers.Authorization||"Bearer "+this.accessToken),r.body=t,e=new URL(e,this.constructor.apiDomain),"GET"==r.method&&!1!==this.constructor.useCache&&e.searchParams.set("timestamp",Date.now()),"object"===o.type(r.body))if("GET"===r.method||"HEAD"===r.method){for(var s in r.body){var n=void 0===r.body[s]?"delete":"set";e.searchParams[n](s,r.body[s])}delete r.body}else r.body=JSON.stringify(r.body);let a;try{a=await fetch(e,r)}catch(e){this.mavo.error("Something went wrong while connecting to "+this.id,e)}if(a?.ok)return"HEAD"===r.method||"response"===r.responseType?a:a[r.responseType]();throw a}oAuthenticate(n){return this.ready.then(()=>this.isAuthenticated()?Promise.resolve():new Promise((i,r)=>{var e,t,s=this.id.toLowerCase();n?(this.accessToken=localStorage[`mavo:${s}token`],this.accessToken&&i(this.accessToken)):((e={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)}).top=(screen.height-e.height)/2,e.left=(screen.width-e.width)/2,t={url:location.href,backend:this.id},this.authPopup=open(`${this.constructor.oAuth}?client_id=${this.key}&state=`+encodeURIComponent(JSON.stringify(t))+this.oAuthParams(),"popup",`width=${e.width},height=${e.height},left=${e.left},top=`+e.top),this.authPopup||(this.mavo.error(t="Login popup was blocked! Please check your popup blocker settings."),r(Error(t))),addEventListener("message",e=>{if(e.source===this.authPopup)for(var t in e.data.backend==this.id&&(this.accessToken=localStorage[`mavo:${s}token`]=e.data.token),this.accessToken||r(Error("Authentication error")),i(this.accessToken),Mavo.all){t=Mavo.all[t].primaryBackend;t&&t.id===this.id&&t!==this&&!t.isAuthenticated()&&t.login(!0)}}))}))}oAuthLogout(){var e;return this.isAuthenticated()&&(e=this.id.toLowerCase(),localStorage.removeItem(`mavo:${e}token`),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),o.fire(this,"mv-logout")),Promise.resolve()}static create(t,i={},e){let r;return i.type&&(r=Mavo.Functions.get(s,i.type)),(r=t&&!r?s.types.find(e=>e.test(t,i))||s.Remote:r)&&e?.constructor===r&&e.constructor.prototype.hasOwnProperty("update")?(e.update(t,i),e):r?new r(t,i):null}static types=[];static register(e){return s[e.name]=e,s.types.push(e),e}};s.register(class extends s{id="Element";constructor(e,t){super(e,t),this.permissions.on(["read","edit","save"])}update(e,t){super.update(e,t),this.observer?.disconnect(),this.element=o(this.source)??o.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body}),this.observer=this.observer??new MutationObserver(e=>{o.fire(this,"mv-remotedatachange")}),this.observer.observe(this.element,{childList:!0,characterData:!0,subtree:!0})}async get(){return this.element.textContent}async put(e){this.observer.disconnect();e=this.element.textContent=e;return this.observer.observe(this.element,{childList:!0,characterData:!0,subtree:!0}),e}static test(e){return 0===e.indexOf("#")}}),s.register(class extends s{id="Remote";constructor(e,t){super(e,t),this.permissions.on("read")}static test(e){return!1}}),s.register(class extends s{id="Local";constructor(e,t){super(e,t),this.permissions.on(["read","edit","save"])}update(e,t){super.update(e,t),this.key=t.key||this.mavo.id}get(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])}put(e){return e?localStorage[this.key]=e:delete localStorage[this.key],Promise.resolve(e)}static test(e){return"local"==e}})}(Bliss,Bliss.$),!function(t){var n=Mavo.Formats={},e=n.Base=t.Class({abstract:!0,constructor:function(e){this.backend=e},proxy:{mavo:"backend"},parse:function(e){return this.constructor.parse(e,this)},stringify:function(e){return this.constructor.stringify(e,this)},static:{parse:e=>Promise.resolve(e),stringify:e=>Promise.resolve(e),extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(e=>t.include(e.test(),e.url)))}}}),r=(n.JSON=t.Class({extends:n.Base,static:{parse:e=>Promise.resolve(e?JSON.parse(e):null),stringify:e=>Promise.resolve(Mavo.toJSON(e)),extensions:[".json",".jsonld"]}}),n.Text=t.Class({extends:n.Base,constructor:function(e){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:(e,t)=>Promise.resolve({[t?t.property:"content"]:e}),stringify:(e,t)=>Promise.resolve(e[t?t.property:"content"])}}),n.CSV=t.Class({extends:n.Base,constructor:function(e){this.property=this.mavo.root.getNames("Collection")[0],this.options=t.extend({},n.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:()=>self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:e.ready,parse:async(e,t)=>{await r.ready();var e=Papa.parse(e,r.defaultOptions),i=t?t.property:"content";if(t&&(t.options.delimiter=e.meta.delimiter,t.options.linebreak=e.meta.linebreak),e.meta.aborted)throw e.meta.errors.pop();return{[i]:e.data}},stringify:async(e,t)=>{await r.ready();var i=t?t.property:"content",t=t?t.options:r.defaultOptions;return Papa.unparse(e[i],t)}}}));Object.defineProperty(n,"create",{value:function(e,t){if(e&&"object"==typeof e)return e;if("string"==typeof e)for(var i in e=e.toLowerCase(),n){var r=n[i];if(i.toLowerCase()==e)return new r(t)}if(!e){var s=(t.url?t.url.pathname:t.source).match(/\.\w+$/)?.[0]??".json",r=n.JSON;for(i in n)-1<n[i].extensions.indexOf(s)&&(r=n[i]);return new r(t)}}})}(Bliss,Bliss.$),!function(s,n){var a=Mavo.Node=class{constructor(e,t,i={}){if(!e||!t)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");i={context:this,options:i},this.uid=a.all.push(this)-1,this.property=null,this.element=e,this.isHelperVariable=this.element.matches("meta"),s.extend(this,i.options),a.elements.set(e,[...a.elements.get(this.element)||[],this]),this.mavo=t,this.group=this.parent=this.parentGroup=i.options.group,this.template=i.options.template,this.alias=this.element.getAttribute("mv-alias"),this.template?this.template.copies.add(this):this.copies=new Set,this.fromTemplate("property","type","storage","path")||(this.property=a.getProperty(e),this.type=Mavo.Group.normalize(e),this.storage=this.element.getAttribute("mv-storage"),this.path=this.getPath()),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",i),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=i.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup),t=this.template;if(t?.expressions){this.expressions=new Set;for(var r of t.expressions)this.expressions.add(new Mavo.DOMExpression({template:r,item:this,mavo:this.mavo}))}this instanceof Mavo.Primitive||(e=Mavo.DOMExpression.search(this.element).filter(e=>"mv-value"==e.originalAttribute)[0])&&((e.mavoNode=this).expressionText=e,this.storage=this.storage||"none",this.modes=this.modes||"read"),Mavo.hooks.run("node-init-end",i)}get editing(){return"edit"==this.mode}get isRoot(){return!this.property}get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()}get saved(){return"none"!==this.storage}get properties(){var e=this.liveData.data[Mavo.route];return e?Object.keys(e):[]}postInit(){"edit"==this.modes&&this.edit()}destroy(){this.template&&this.template.copies.delete(this),this.expressions&&this.expressions.forEach(e=>e.destroy()),this.itembar&&this.itembar.destroy(),delete a.all[this.uid],this.propagate("destroy")}getLiveData(){return this.liveData.proxy}isDataNull(e={}){e={context:this,options:e,result:!this.saved&&!e.live};return Mavo.hooks.run("node-isdatanull",e),e.result}walk(n,e=[],a={}){var o=(e,t)=>{if(!1!==(r=n(e,t)))for(var i in e.children){var r,s=e.children[i];if(s instanceof Mavo.Node)if(!1===(r=o.call(s,s,[...t,i]))&&!a.descentReturn)return!1}return!1!==r};return o(this,e)}walkUp(e){for(var t=this;t=t.parentGroup;){var i=e(t);if(void 0!==i)return i}}edit({force:e}={}){if(this.mode="edit",!e&&"edit"!=this.mode)return!1;s.fire(this.element,"mv-edit",{mavo:this.mavo,node:this}),Mavo.hooks.run("node-edit-end",this)}done({force:e}={}){if(this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read",!e&&"read"!=this.mode)return!1;s.unbind(this.element,".mavo:edit"),s.fire(this.element,"mv-done",{mavo:this.mavo,node:this}),this.propagate("done"),Mavo.hooks.run("node-done-end",this)}save(){this.unsavedChanges=!1,this.propagate("save")}propagate(e){for(var t in this.children){t=this.children[t];t instanceof Mavo.Node&&("function"==typeof e?e.call(t,t):e in t&&t[e]())}}fromTemplate(...e){return this.template&&e.forEach(e=>this[e]=this.template[e]),!!this.template}async render(t,e={}){if(e.live=e.live||Mavo.in(Mavo.isProxy,t),e.root=e.root||this,delete this.pending,"promise"===s.type(t)){var i=this.pending=t;try{t=await i}catch(e){t=e}if(this.pending!==i)return;delete this.pending}e.live&&(t=Mavo.clone(t)),this.oldData=this.data,this.data=t;var i={context:this,data:t=e.live?t:Mavo.subset(t,this.inPath),options:e},t=(Mavo.hooks.run("node-render-start",i),this.isHelperVariable||e.live||(!Array.isArray(this.children)&&Array.isArray(i.data)?(this.isRoot&&(r=this.children.main instanceof Mavo.Collection?"main":this.getNames((e,t)=>t instanceof Mavo.Collection&&!t.expressions?.[0]?.isDynamicObject)[0])&&(i.data={[r]:i.data}),this.isRoot&&r||(this.inPath.push("0"),i.data=i.data[0])):1==this.childrenNames?.length&&this.childrenNames[0]===this.property&&null!==i.data&&Mavo.isPlainObject(i.data)&&(i.data=i.data[this.property])),this===e.root&&(this.expressionsEnabled=!1),this.editing),r=(t&&this.done(),this.dataRender(i.data,e));return t&&this.edit(),this===e.root&&(this.save(),this.expressionsEnabled=!0,r)&&requestAnimationFrame(()=>this.mavo.expressions.update(this)),Mavo.hooks.run("node-render-end",i),r}dataChanged(e,t={}){e=s.extend({action:e,property:this.property,mavo:this.mavo,node:this},t);s.fire(t.element||this.element,"mv-change",e),this.mavo.changed(e)}toString(){return`#${this.uid}: ${this.constructor.name} (${this.property})`}getClosestCollection(){var e=this.closestItem;return e?e.collection:null}getClosestItem(){return Array.isArray(this.collection?.children)?this:this.parentGroup?.closestItem||null}getPath(){var e=this.parent?.path||[];return this.property?[...e,this.property]:e}pathFrom(e){for(var t=this.path,i=e.path,r=0;r<t.length&&i[r]==t[r];r++);return t.slice(r)}getDescendant(e){return e.reduce((e,t)=>e.children[t],this)}getCousin(e,t={}){if(!this.closestCollection)return null;var i=this.closestCollection,r=Math.abs(e),s=e<0?-1:1;if(i.length<r+1)return null;var n=this.closestItem.index+e;t.wrap&&(n=Mavo.wrap(n,i.length));for(var a=0;a<i.length;a++){var o=n+a*s,l=(t.wrap&&(o=Mavo.wrap(o,i.length)),i.children[o]);if(l)break}return l&&l!=this.closestItem?this.collection?l:(r=this.pathFrom(this.closestItem),l.getDescendant(r)):null}contains(e){do{if(e===this)return!0}while(e=e.parent);return!1}eval(e,t){return new Mavo.Expression(e).eval(this.getLiveData(),t)}static create(e,t,i={}){var r;return new(e.hasAttribute("mv-list")?Mavo.Collection:(r=e.matches(Mavo.selectors.group),Mavo[r?"Group":"Primitive"]))(e,t,i)}static getImplicitPropertyName(e){return e.getAttribute("itemprop")||e.getAttribute("mv-list")||e.getAttribute("mv-list-item")||e.name||e.id||[...e.classList].filter(e=>!e.startsWith("mv-"))[0]}static getProperty(e){if(!e.hasAttribute("property"))return null;let t=e.getAttribute("property");return t||(t=a.getImplicitPropertyName(e))&&e.setAttribute("property",t),t}static generatePropertyName(t,e=document.documentElement){var e=e.closest(Mavo.selectors.init),i=new Set(...n("[property]",e).map(e=>e.getAttribute("property")));for(let e="";e<1e3;e++){var r=t+e;if(!i.has(r))return r}}static get(e,t){let i=a.elements.get(e)||[];return(i=i.filter(e=>!(e instanceof Mavo.ImplicitCollection))).length<2||!t?i[0]:i[0]instanceof Mavo.Group?i[1]:void 0}static getClosest(e,t){let i;for(;!(i=a.get(e,t))&&(e=e?.parentNode););return i}static getClosestItem(e){e=a.getClosest(e);return e instanceof Mavo.Primitive&&!e.collection?e.parent:e}static children(t){var e=Mavo.Node.get(t);return e?[e]:(e=n(Mavo.selectors.property,t).map(e=>Mavo.Node.get(e)).filter(e=>!t.contains(e.parentGroup.element)).map(e=>e.collection||e),Mavo.Functions.unique(e))}};s.Class(a,{toJSON:Mavo.prototype.toJSON,lazy:{closestCollection:function(){return this.getClosestCollection()},closestItem:function(){return this.getClosestItem()},inPath:function(){return(this.element.getAttribute("mv-path")||"").split("/").filter(e=>e.length)}},live:{store:function(e){s.toggleAttribute(this.element,"mv-storage",e)},unsavedChanges:function(e){return!e||this.saved&&this.editing||(e=!1),Array.isArray(this.children)||this.element.classList.toggle("mv-unsaved-changes",e),e},mode:function(e){var t,i;if(this._mode!=e)return this.modes&&e!=this.modes&&(e=this.modes),this._mode=e,!Array.isArray(this.children)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))&&(t=this.modes||"edit"==e,i=Mavo.observers.pause({attribute:"mv-mode"}),s.toggleAttribute(this.element,"mv-mode",e,t),Mavo.observers.resume(i)),e},modes:function(e){if(e&&"read"!=e&&"edit"!=e)return null;(this._modes=e)&&this.mode!=e&&(this.mode=e)},collection:function(e){this.parent=e||this.parentGroup},index:function(e){this._index!==e&&(this._index=e,this.liveData.updateKey())},expressionsEnabled:{get:function(){return!1!==this._expressionsEnabled&&(!this.parent||this.parent.expressionsEnabled)}}},static:{all:[],elements:new WeakMap}}),Mavo.observe({attribute:"mv-storage"},function({node:e}){e&&(e.storage=e.element.getAttribute("mv-storage"))})}(Bliss,Bliss.$),!function(u,l){var n=Mavo.Group=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element)&&(this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this}));var r=l(`[property]:not(:scope ${Mavo.selectors.scope} [property])`,this.element),s=r.map(e=>Mavo.Node.getProperty(e));for(let e=0,t;t=r[e];e++){var n=Mavo.Node.getProperty(t),a=this.children[n],o={template:this.template?this.template.children[n]:null,group:this};a?a.add(t):s.lastIndexOf(n)!==e?this.children[n]=new Mavo.ImplicitCollection(t,this.mavo,o):this.children[n]=Mavo.Node.create(t,this.mavo,o)}this.childrenNames=Object.keys(this.children),this.vocab=Mavo.getClosestAttribute(this.element,"vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)}get isRoot(){return!this.property}getNames(i="Node"){var t="function"==typeof i?i:(e,t)=>t instanceof Mavo[i];return Object.keys(this.children).filter(e=>t(e,this.children[e]))}getData(e={}){var t,i={context:this,options:e};if(this.isDataNull(e))return null;for(t in i.data=Mavo.shallowClone(Mavo.subset(this.data,this.inPath))||{},this.children){var r,s=this.children[t];s.saved&&(r=s.getData(i.options)),s.saved&&null!==Mavo.value(r)?i.data[s.property]=r:delete i.data[s.property]}return this.childrenNames.length||this.isRoot||this.collection?1===this.childrenNames.length&&this.property in this.children?i.data=i.data[this.property]:i.data&&"object"==typeof i.data&&(this.type&&this.type!=n.DEFAULT_TYPE&&(i.data["@type"]=this.type),this.vocab)&&(i.data["@context"]=this.vocab):i.data=null,i.data=Mavo.subset(this.data,this.inPath,i.data),Mavo.hooks.run("node-getdata-end",i),i.data}edit(t={}){return!1!==super.edit()&&Promise.all(Object.keys(this.children).map(e=>this.children[e].edit(t)))}dataRender(a,o={}){if(a){let e=!1,t,i;if("object"!=typeof a){i=!0;let e=this.property;if(!(this.property in this.children)){let t=u.type(a),i=e=>(this.children[e]instanceof Mavo.Primitive)+(this.children[e].datatype==t);e=Object.keys(this.children).filter(e=>!this.children[e].expressionText).sort((e,t)=>i(e)-i(t)).reverse()[0]}e||(e=this.property,t=!0),a={[e]:a},this.data=Mavo.subset(this.data,this.inPath,a)}let n;if(this.propagate(t=>{let i=a[t.property];if(t.alias){var r=t.alias.split(" ");for(let e=0;e<r.length;e++){var s=r[e];if(void 0!==a[s]){t.currentAlias=s,n=n||u.extend({},a),i=a[t.currentAlias];break}}}e=t.render(i,o)||e}),n&&this.propagate(e=>{e.currentAlias&&(a[e.property]=n[e.currentAlias],e.currentAlias in this.children||delete a[e.currentAlias])}),!i||t){var r,s,l=Mavo.subset(this.oldData,this.inPath);for(r in a)r in this.children||(s=a[r],e=e||a[r]!==this.liveData.data[r],this.liveData.set(r,s),!1===this.expressionsEnabled)||"object"==typeof s||l&&l[r]==s||this.dataChanged("propertychange",{property:r})}return e}}static normalize(e){var t;return e.matches(Mavo.selectors.group)?(t=Mavo.getAttribute(e,"typeof","mv-group")||n.DEFAULT_TYPE,e.setAttribute("typeof",t),t):null}};u.Class(n,{lazy:{liveData:function(){return new Mavo.Data(this,{})}},static:{all:new WeakMap,DEFAULT_TYPE:"Item"}})}(Bliss,Bliss.$),!async function(o,t){var s=Mavo.Primitive=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.liveData=new Mavo.Data(this),this.fromTemplate("config","attribute","templateValue","originalEditor")||(this.config=s.getConfig(e),this.attribute=this.config.attribute,this.attribute&&!document.xmlVersion&&(this.attribute=this.attribute.toLowerCase())),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=this.expressionText||Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&((this.expressionText.mavoNode=this).storage=this.storage||"none",this.modes="read",this.element.setAttribute("aria-live","polite")),this.config.init&&this.config.init.call(this,this.element),this.config.initOnce&&!this.config.initOnce.called&&(this.config.initOnce.call(this,this.element),this.config.initOnce.called=!0),this.config.changeEvents&&o.bind(this.element,this.config.changeEvents,e=>{e.target===this.element&&(this.value=this.getValue())}),this.expressionText?this.setValue(this.expressionText.value,{silent:!0}):(this.element.hasAttribute("aria-label")?this.label=this.element.getAttribute("aria-label"):(this.label=Mavo.Functions.readable(this.property),this.pauseObserver(),this.element.setAttribute("aria-label",this.label),this.resumeObserver()),this.element.hasAttribute("mv-editor")?(this.originalEditorUpdated({force:!0}),t=this.editorValue,this.datatype||"number"!=typeof t&&"boolean"!=typeof t||(this.datatype=typeof t)):this.element.hasAttribute("mv-options")&&this.updateOptions(),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this.modes?(this._default=this.templateValue,this.defaultSource="template"):(this._default=this.editorValue,this.options&&(i=this.options.keys().next().value,this._default=this._default??i),this.defaultSource="editor"):""===this.default?(this._default=this.templateValue,this.defaultSource="template"):(this.defaultExpression=Mavo.DOMExpression.search(this.element,"mv-default"),this.defaultExpression&&(this.defaultExpression.output=e=>this.default=e),this.defaultSource="attribute"),this.setValue(this.initialValue,{silent:!0})),this.postInit(),Mavo.hooks.run("primitive-init-end",this)}get initialValue(){let e;var t=!this.template||this.template.templateValue!=this.templateValue||"edit"==this.modes;return e=void 0===(e=void 0===this.default&&t?this.templateValue:this.default)?this.emptyValue:e}get editorValue(){var e=this.editor||this.originalEditor;if(e)return s.isFormControl(e)?s.getValue(e,{datatype:this.datatype}):(e=o(Mavo.selectors.output+", "+Mavo.selectors.formControl,e))?s.getValue(e):void 0}set editorValue(t){if(this.config.setEditorValue&&"boolean"!==this.datatype)return this.config.setEditorValue.call(this,t);var e;this.editor&&(s.isFormControl(this.editor)?(this.editor.matches("select")&&void 0===[...this.editor.options].find(e=>e.value==t)?.textContent&&o.create("option",{className:"mv-volatile",textContent:t,inside:this.editor,selected:!0,disabled:!0}),s.setValue(this.editor,t,{config:this.editorDefaults})):(e=o(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor))&&s.setValue(e,t))}destroy(){super.destroy(),this.originalEditorObserver?.destroy()}isDataNull(e){return super.isDataNull(e)||null===this._value||void 0===this._value}getData(e={}){var t={context:this,options:e};return this.isDataNull(e)?null:(t.data=this.value,""!==t.data||this.templateValue&&this.initialValue===this.templateValue||(t.data=null),this.inPath.length&&(t.data=Mavo.subset(this.data,this.inPath,t.data)),Mavo.hooks.run("node-getdata-end",t),t.data)}get pausedObserver(){return 0<this.observerPauses?.length}pauseObserver(){Mavo.observers.flush(),this.observerPauses=this.observerPauses||[],this.observerPauses.push(1)}resumeObserver(){Mavo.observers.flush(),this.observerPauses?.pop?.()}save(){this.savedValue=this.value,this.unsavedChanges=!1}initEdit(){!this.editor&&this.originalEditor&&(this.editor=this.originalEditor.cloneNode(!0)),this.editorUpdated(),this.initEdit=null}updateOptions(){var e,t,i=Mavo.options(this.element.getAttribute("mv-options"),{map:!0});for([e,t]of i)!0===t&&i.set(e,e);this.options=i}generateDefaultEditor(){if(this.element.hasAttribute("mv-options")){this.options||this.updateOptions();var e=[...this.options].map(([e,t])=>({tag:"option",value:e,textContent:t}));this.editor=o.create("select",{className:"mv-editor mv-options-select",contents:e})}else{let e=this.config.editor;e&&"boolean"!=this.datatype||(e=Mavo.Elements.defaultConfig[this.datatype||"string"].editor),this.editor=o.create("function"===o.type(e)?e.call(this):e)}this.editorValue=this.value}updateEditType(){let e=this.element.getAttribute("mv-edit-type")?.trim()??"auto";return"auto"===(e="auto"===e?this.config.editType??"auto":e)&&(e=this.attribute?"popup":"inline"),this.editType=e}editorUpdated(){var e;this.editor||this.generateDefaultEditor(),o.bind(this.editor,{"input change":e=>{this.value=this.editorValue},"mv-change":e=>{"output"===e.property&&(e.stopPropagation(),o.fire(this.editor,"input"))}}),this.editor.matches("textarea")||this.editor.addEventListener("focus",e=>{this.editor.select?.()});for(e of Mavo.getAttributes(this.element,/^mv-editor-/)){var t=this.element.getAttribute(e);e=e.replace(/^mv-editor-/,""),this.editor.setAttribute(e,t)}"placeholder"in this.editor&&!this.editor.placeholder&&(this.editor.placeholder="number"===this.editor.type?this.editor.min||0:`(${this.label})`),this.editor.matches("select")||delete this.options}originalEditorUpdated({force:e}={}){var t=this.originalEditor,i=this.element.getAttribute("mv-editor");try{this.originalEditor=o(i)}catch(e){this.originalEditor=null}(e||t!==this.originalEditor)&&(this.originalEditor?(this.editor&&(this.editor=this.originalEditor.cloneNode(!0),this.setValue(this.value,{force:!0,silent:!0})),"editor"==this.defaultSource&&(this.default=this.originalEditor.value),this.template&&this.originalEditor===this.template.originalEditor||(this.originalEditorObserver?.destroy(),this.originalEditorObserver=new Mavo.Observer(this.originalEditor,"all",e=>{var t,i=[this];if(this.copies)for(var r of this.copies)r.originalEditor===this.originalEditor&&i.push(r);for(t of i)t.originalEditorUpdated({force:!0}),t.setValue(t.value,{force:!0,silent:!0})}))):this.editor&&(this.generateDefaultEditor(),this.editorUpdated()),(i=this.editor??this.originalEditor)?.matches("select:not(.mv-options-select"))&&(e=[...i.options].filter(e=>!e.classList.contains("mv-volatile")).map(e=>[e.value,e.textContent]),this.options=new Map(e))}edit(e={}){var t=this.editing;if(!1===super.edit(e))return!1;if(e.force||!t||this.initEdit){if("object"===o.type(this._value))return!1;if(t||(-1===this.element.tabIndex&&Mavo.revocably.setAttribute(this.element,"tabindex","0"),o.bind(this.element,"click.mavo:edit",e=>{"edit"===this.mode&&e.target.closest("summary, a")&&e.preventDefault()})),this.config.edit?(this.config.edit.call(this),this.initEdit=null):(this.pauseObserver(),this.initEdit&&this.initEdit(),this.editor.classList.toggle("mv-editor","popup"!==this.editType),"popup"===this.editType?(this.popup||(this.popup=new Mavo.UI.Popup(this)),this.popup.prepare(),e="mousedown focus dragover dragenter".split(" ").map(e=>e+".mavo:edit").join(" "),o.bind(this.element,e,e=>this.popup.show())):"inline"===this.editType&&(this.editor.isConnected||(this.editorValue=this.value,this.config.hasChildren?this.element.textContent="":s.setText(this.element,""),this.contentExpression||(this.contentExpression=Mavo.DOMExpression.search(this.element,null)),this.contentExpression&&(this.contentExpression.active=!1),this.element.prepend(this.editor)),this.collection||Mavo.revocably.restoreAttribute(this.element,"tabindex")),this.resumeObserver()),this.closestCollection&&"inline"===this.editType&&this.editor?.matches(Mavo.selectors.textInput)){let r=this.editor.matches("textarea");r||o.bind(this.editor,"paste.mavo:edit",e=>{if(this.closestCollection.editing&&e.clipboardData){var t=e.clipboardData.getData("text/plain"),i=/\r?\n|\r/;if(i.test(t)){e.preventDefault();var r=t.split(i),s=(this.editor.setRangeText(r[0]),o.fire(this.editor,"input"),this.closestCollection),n=closestItem?.index||0;for(let e=1;e<r.length;e++){this.closestItem;var a=s.add(void 0,n+e);s.editItem(a),this.getCousin(e).render(r[e])}}}}),o.bind(this.editor,"keydown.mavo:edit",t=>{if(this.closestCollection.editing)if("Enter"!=t.key||!t.shiftKey&&r)"Backspace"==t.key&&this.empty&&(i=this.getCousin(1)||this.getCousin(-1),this.closestCollection.delete(this.closestItem),i&&(i.edit(),i.editor.focus()),t.preventDefault());else if(!this.bottomUp){var i=this.closestItem,i=this.closestCollection.add(void 0,i?.index+1);this.closestCollection.editItem(i);let e=this.getCousin(1);requestAnimationFrame(()=>{e.edit(),e.editor.focus()}),r&&t.preventDefault()}})}}return!0}done(e){if(!1===super.done(e))return!1;o.unbind(this.element,".mavo:edit"),this.pauseObserver(),this.config.done?this.config.done.call(this):("popup"===this.editType?this.popup?.close():"inline"===this.editType&&this.editor&&(this.editor.remove(),this.contentExpression&&(this.contentExpression.active=!0,this.contentExpression.update({force:!0})),this.setValue(this.editorValue,{silent:!0,force:!0})),this.editor?.matches("select")&&t(".mv-volatile",this.editor).forEach(e=>{e.selected||e.remove()}),this.resumeObserver(),this.collection||Mavo.revocably.restoreAttribute(this.element,"tabindex"))}dataRender(e,{}={}){var t=this._value;return"object"===o.type(e)&&(Symbol.toPrimitive in e?e=e[Symbol.toPrimitive]("default"):this.editing&&this.done()),void 0===e?this.modes||this.value!==this.templateValue||(this.value=this.closestCollection?this.default:this.templateValue):this.value=e,this._value!==t}find(e,t={}){if(this.property==e&&t.exclude!==this)return this}getValue(e){return this.editing&&this.editor&&this.editor!==this.element?this.editorValue:s.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})}setValue(t,e={}){void 0===t&&(t=null);var i=this.datatype;if(this.datatype||"number"!=typeof t&&"boolean"!=typeof t||(this.datatype=typeof t),t=s.safeCast(t,this.datatype),e.force||t!==this._value||i!=this.datatype){if(this.pauseObserver(),this.editor&&this.editorValue!=t&&(this.editorValue=t),"popup"==this.editType||!this.editor||this.editor!==document.activeElement&&!this.element.contains(this.editor))if(this.config.setValue)this.config.setValue.call(this,this.element,t);else if(!e.dataOnly){let e;this.options&&(e=this.options.get(t)),s.setValue(this.element,t,{config:this.config,attribute:this.attribute,datatype:this.datatype,presentational:e,node:this})}this.empty=!t&&0!==t,this._value=t,this.liveData.update(),e.silent||(this.saved&&(this.unsavedChanges=this.mavo.unsavedChanges=!0),this.dataChanged("propertychange",{value:t})),this.resumeObserver()}return t}dataChanged(e="propertychange",t){return super.dataChanged(e,t)}async upload(t,i=t.name){if(this.mavo.uploadBackend&&self.FileReader){var r=URL.createObjectURL(t);this.pauseObserver(),this.element.setAttribute(this.attribute,r),this.resumeObserver();i=(this.element.getAttribute("mv-upload-path")||"")+"/"+i;let e=await this.mavo.upload(t,i);var s=Mavo.getClosestAttribute(this.element,"mv-upload-url");s&&(e=new URL(i,new URL(s,location))+""),this.value=e,this.element.matches("a")||(this.pauseObserver(),this.element.setAttribute(this.attribute,r),this.resumeObserver())}}createUploadPopup(s,n="file",e){var a,t={context:this,type:s,kind:n,ext:e};return t.mainInput=o.create("input",{type:"url",placeholder:`http://example.com/${n}.`+e,className:"mv-output","aria-label":"URL to "+n}),this.mavo.uploadBackend&&self.FileReader?(a=e=>e&&(!s||0===e.type.indexOf(s.replace("*",""))),t.events={paste:e=>{var t,i=Array.from(e.clipboardData.items).find(e=>"file"===e.kind),r=i?.type.split("/")[1];i&&a(i)&&(r=e.clipboardData.getData("text")||`pasted-${n}-${Date.now()}.`+r,null!==(t=""===(t=prompt(this.mavo._("filename"),r))?r:t))&&(this.upload(i.getAsFile(),t,s),e.preventDefault())},"drag dragstart dragend dragover dragenter dragleave drop":e=>{e.preventDefault(),e.stopPropagation()},"dragover dragenter":e=>{t.popup.classList.add("mv-dragover"),this.element.classList.add("mv-dragover")},"dragleave dragend drop":e=>{t.popup.classList.remove("mv-dragover"),this.element.classList.remove("mv-dragover")},drop:e=>{e=e.dataTransfer.files[0];e&&a(e)&&this.upload(e)}},Mavo.hooks.run("primitive-createuploadpopup-beforecreate",t),t.popup=o.create({className:"mv-upload-popup",contents:[t.mainInput,{tag:"input",type:"file","aria-label":"Upload "+n,accept:s,events:{change:e=>{e=e.target.files[0];e&&a(e)&&this.upload(e)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:t.events}),o.bind(this.element,t.events),Mavo.hooks.run("primitive-createuploadpopup-beforereturn",t),t.popup):t.mainInput}static getText(e){e=e.nodeType===Node.TEXT_NODE?e:e.firstChild;return e?.nodeType===Node.TEXT_NODE?e.nodeValue:""}static setText(e,t){var i=e.nodeType===Node.TEXT_NODE?e:e.firstChild;i?.nodeType===Node.TEXT_NODE?i.nodeValue=t:e.prepend(t)}static getValueAttribute(e,t=Mavo.Elements.search(e)){t=e.getAttribute("mv-attribute")||t.attribute;return t=t&&"null"!==t&&"none"!==t?t:null}static safeCast(e,t){var i=s.cast(e,t);return"boolean"==t?!!e&&("true"===e||0<e||e):"number"==t?/^[-+]?[0-9.e]+$/i.test(e+"")?i:e:null==e?e:i}static cast(e,t){switch(t){case"number":return+e;case"boolean":return!!e;case"string":return e+""}return e}static getValue(e,{config:t,attribute:i,datatype:r}={}){return i=(t=t||s.getConfig(e,i)).attribute,r=t.datatype,t.getValue&&i==t.attribute?t.getValue(e):(t=i in e&&Mavo.usePropertyInsteadOfAttribute(e,i)?e[i]:i?e.getAttribute(i):e.getAttribute("content")||s.getText(e)||null,s.safeCast(t,r))}static getConfig(e,t,i){var r=e.getAttribute("mv-edit-as");return r&&r in Mavo.Elements?Mavo.Elements[r]:(r=void 0===(t="null"!=(t=void 0===t?e.getAttribute("mv-attribute")||void 0:t)&&"none"!=t?t:null)||t==s.getValueAttribute(e),!i&&r&&(i=e.getAttribute("datatype")||void 0),r=Mavo.Elements.search(e,t,i),void 0===(r=Object.assign({},r)).attribute&&(r.attribute=t||null),void 0===r.datatype&&(r.datatype=i),r)}static async setValue(e,t,i={}){if(delete s.pending.get(e)?.[i.attribute],"promise"===o.type(t)){s.pending.has(e)||s.pending.set(e,{});var r=t;s.pending.get(e)[i.attribute]=r;try{t=await r}catch(e){t=e}if(s.pending.get(e)[i.attribute]!==r)return;delete s.pending.get(e)?.[i.attribute]}if(1===e.nodeType&&(i.config||(i.config=s.getConfig(e,i.attribute)),i.attribute=(void 0!==i.attribute?i:i.config).attribute,i.datatype=(void 0!==i.datatype?i:i.config).datatype,i.config.setValue)&&i.attribute==i.config.attribute)return i.config.setValue(e,t,i.attribute);if(null!==t||i.datatype||(t=""),i.attribute){if(i.attribute in e&&Mavo.usePropertyInsteadOfAttribute(e,i.attribute)&&e[i.attribute]!==t)try{e[i.attribute],e[i.attribute]=t}catch(e){}"boolean"==i.datatype?t!=e.hasAttribute(i.attribute)&&o.toggleAttribute(e,i.attribute,t,t):e.getAttribute(i.attribute)!=t&&e.setAttribute(i.attribute,t)}else{r=i.presentational??s.format(t,i);i.node&&!i.config.hasChildren?s.setText(e,r):e.textContent=r,r!==t&&e.setAttribute&&e.setAttribute("content",t)}}static format(e,t={}){if("number"===o.type(e)||"number"==t.datatype){if(null===e)return"";if(!(t.attribute||t.element?.matches("style, pre")))return s.formatNumber(e)}return Array.isArray(e)?e.map(s.format).join(", "):"object"===o.type(e)?Mavo.toJSON(e):e}static isFormControl(e){return e.matches(Mavo.selectors.formControl)||e.matches('[mv-edit-as="formControl"]')}};o.Class(s,{lazy:{emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0}return""},editorDefaults:function(){return this.editor&&s.getConfig(this.editor)},editType:function(){return this.updateEditType()}},live:{editor:function(e){this._editor!==e&&(this._editor?.replaceWith(e),this._editor=e,"editor"===this.defaultSource&&(this.default=this.editorValue),this.editorUpdated())},default:function(e){this.value==this._default&&(this.value=e)},value:function(e){return this.setValue(e)},datatype:function(e){e!==this._datatype&&("boolean"!=e||this.attribute||(this.attribute=Mavo.Elements.defaultConfig.boolean.attribute),o.toggleAttribute(this.element,"datatype",e,e&&"string"!==e))},empty:function(e){e=e&&!this.modes&&(!this.attribute||!o(Mavo.selectors.property,this.element))&&("boolean"!==this.datatype||this.attribute===Mavo.Elements.defaultConfig.boolean.attribute);this.element.classList.toggle("mv-empty",!!e)}},static:{all:new WeakMap,pending:new Map,lazy:{formatNumber:()=>{var t=new Intl.NumberFormat(Mavo.locale,{maximumFractionDigits:2});return function(e){return e===1/0||e===-1/0?e<0?"-∞":"∞":t.format(e)}}}}}),Mavo.observe({id:"primitive"},function({node:t,type:i,attribute:r,element:e}){if(t instanceof Mavo.Primitive&&t.config&&!t.pausedObserver)if("mv-default"!==r||t.defaultExpression){if("aria-label"===r)t.label=e.getAttribute("aria-label"),Mavo.in("placeholder",t.editor)&&(t.editor.placeholder="number"===t.editor.type?t.editor.min||0:`(${t.label})`);else if("mv-editor"===r)t.originalEditorUpdated();else if("mv-edit-type"===r){var s=t.editing;s&&t.done({force:!0}),t.updateEditType(),s&&t.edit({force:!0})}else if("mv-options"===r)t.updateOptions(),t.editor&&t.generateDefaultEditor();else if(r&&0===r.indexOf("mv-editor-"))t.editor?.setAttribute(r.slice(10),e.getAttribute(r));else if(!1!==t.config.observer){let e=t.config.subtree;(e=e||t.editing&&"edit"!==t.modes?e:r===t.attribute||t.config.observedAttributes?.includes(r)||"characterData"===i&&!t.attribute)&&(t.value=t.getValue())}}else t.default=e.getAttribute("mv-default");else{s=Mavo.Node.getClosest(e.parentNode,!0);s?.config?.subtree&&(s.value=s.getValue())}}),await o.ready();let i=["checkbox","color","date","datetime-local","email","file","month","number","password","radio","range","search","submit","tel","text","time","url","week","datetime"];var e,r=Mavo.attributeStartsWith("mv-edit-").filter(e=>("mv-edit-type"!==e.name||i.includes(e.value))&&!["mv-edit-as"].includes(e.name)).map(e=>e.name);Mavo.attributeStartsWith("mv-editor-");if(o("[mv-edit]")&&r.unshift("mv-edit"),0<r.length)for(e of[...new Set(r)]){var n,a=e.replace(/^mv-edit(-|$)/,"mv-editor$1"),l=t(`[${e}]`);console.log(`You are using attribute ${e} on ${l.length} element(s). This syntax is deprecated and will be removed in the next version of Mavo. Please use ${a} instead.`);for(n of l)Mavo.setAttributeShy(n,a,n.getAttribute(e))}}(Bliss,Bliss.$),!function(n){Mavo.UI.Popup=n.Class({constructor:function(e){this.primitive=e,this.position=e=>{var t=this.primitive.element.getBoundingClientRect(),i=t.left,r=t.bottom,s=!1;this.element.offsetHeight&&(this.height=this.element.getBoundingClientRect().height||this.height),this.height+r+20>innerHeight&&(r=20<t.top-this.height?(s=!0,t.top-this.height-20):innerHeight-this.height-20),this.element.classList.toggle("mv-point-down",s),n.style(this.element,{top:r+"px",left:i+"px"})},this.element=n.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:e=>{13!=e.keyCode&&27!=e.keyCode||(this.element.contains(document.activeElement)&&this.primitive.element.focus(),e.stopPropagation(),this.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length)),this.hideCallback=e=>{this.element.contains(e.target)||this.primitive.element.contains(e.target)||this.hide()}},show:function(){n.unbind([this.primitive.element,this.element],".mavo:showpopup"),this.shown=!0,this.element.style.transition="none",this.element.removeAttribute("hidden"),this.position(),this.element.setAttribute("hidden",""),this.element.style.transition="",document.body.appendChild(this.element),setTimeout(()=>{this.element.removeAttribute("hidden")},100),n.bind(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position,{passive:!0})},hide:function(){n.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position,{passive:!0}),this.element.setAttribute("hidden",""),this.shown=!1,setTimeout(()=>{n.remove(this.element)},1e3*parseFloat(getComputedStyle(this.element).transitionDuration)||400)},prepare:function(){n.bind(this.primitive.element,{"click.mavo:edit":e=>{this.show()},"keyup.mavo:edit":e=>{-1<[13,113].indexOf(e.keyCode)&&(this.show(),this.editor.focus())}}),this.element.contains(this.editor)||this.element.append(this.editor)},close:function(){this.hide(),n.unbind(this.primitive.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive"}})}(Bliss,Bliss.$),!function(a,r){var o=Mavo.Elements={};Object.defineProperties(o,{register:{value:function(i,r){var e,t;if("object"!=typeof i)return r.extend&&(e=o[r.extend],r=a.extend(a.extend({},e),r)),-1<i.indexOf("@")&&(e=i.split("@"),r.selector=r.selector||e[0]||"*",void 0===r.attribute)&&(r.attribute=e[1]),r.selector=r.selector||i,r.id=i,Array.isArray(r.attribute)?r.attribute.forEach(e=>{var t=a.extend({},r);t.attribute=e,o[i+"@"+e]=t}):o[i]=r,o;for(t in i)o.register(t,i[t])}},search:{value:function(e,t,i){var r=o.matches(e,t,i),e=(r=0===r.length&&i?o.matches(e,t):r)[r.length-1];return e||((r=a.extend({},o.defaultConfig[i||"string"])).attribute=void 0===t?r.attribute:t,r)}},matches:{value:function(e,t,i){var r,s=[];for(r in o){var n,a=o[r];!(void 0===t&&a.default||t===a.attribute)||void 0!==i&&"string"!==i&&i!==a.datatype||(n=a.selector||r,!e.matches(n))||a.test&&!a.test(e,t,i)||s.push(a)}return s}},isSVG:{value:e=>"http://www.w3.org/2000/svg"==e.namespaceURI},defaultConfig:{value:{string:{editor:{tag:"input"}},number:{editor:{tag:"input",type:"number"}},boolean:{attribute:"content",editor:{tag:"input",type:"checkbox"}}}}}),o.register({"@hidden":{datatype:"boolean"},"@y":{test:o.isSVG,datatype:"number"},"@x":{default:!0,test:o.isSVG,datatype:"number"},media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var e="img"==(e=this.element.nodeName.toLowerCase())?"image":e;return Mavo.setAttributeShy(this.element,"mv-upload-path",e+"s"),this.createUploadPopup(e+"/*",e,"png")}},"a, link":{default:!0,attribute:"href"},"a[mv-upload-path], link[mv-upload-path]":{default:!0,attribute:"href",editor:function(){var e=this.element.getAttribute("type"),t=e&&!/\/\*$/.test(e)?e.split("/")[1]:"pdf";return this.createUploadPopup(e,void 0,t)}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},details:{attribute:"open",datatype:"boolean"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},formControl:{selector:"input",default:!0,attribute:"value",modes:"edit",editType:"self",changeEvents:"input change",edit:()=>{},done:()=>{},init:function(){this._editor=this.element}},select:{extend:"formControl",selector:"select",subtree:!0},"select[multiple]":{extend:"select",selector:"select[multiple]",getValue:e=>Array.from(e.selectedOptions).map(e=>e.value).join(),setValue:(e,t)=>{t=Array.isArray(t)?t:(t+"").split(/\s*,/),Array.from(e.options).forEach(e=>{e.selected=!1,(t=t.map(e=>e+"")).includes(e.value)&&(e.selected=!0)})}},option:{attribute:null,modes:"read",default:!0},textarea:{extend:"formControl",selector:"textarea",attribute:null,getValue:e=>e.value,setValue:(e,t)=>e.value=t},formNumber:{extend:"formControl",selector:"input[type=range], input[type=number]",datatype:"number",setValue:function(t,e){t.value=e,t.setAttribute("value",e);var i=e>t.value?"max":"min";isNaN(e)||t.value==e||Mavo.data(t,"boundObserver")||(0===Mavo.observers.find({element:t,id:"oob"}).size&&Mavo.observe({id:"oob",element:t,attribute:i,once:!0},()=>t.value=e),requestAnimationFrame(()=>{a.bind(t,"input mv-change",function e(){Mavo.unobserve({element:t,id:"oob"}),a.unbind(t,"input mv-change",e)})}))},observedAttributes:["min","max"]},checkbox:{extend:"formControl",selector:"input[type=checkbox]",attribute:"checked",datatype:"boolean",changeEvents:"click"},"input[type=checkbox]":{attribute:"indeterminate",datatype:"boolean"},radio:{extend:"formControl",selector:"input[type=radio]",attribute:"checked",modes:"edit",getValue:e=>{return e.form?e.form[e.name].value:(e=a(`input[type=radio][name="${e.name}"]:checked`))&&e.value},setValue:(e,t)=>{e.form?e.form[e.name].value=t:(e=a(`input[type=radio][name="${e.name}"][value="${t}"]`))&&(e.checked=!0)},initOnce:function(e){function t(e){var t;e.name;for(t of r(`input[type=radio][name="${e.name}"]`)){var i=Mavo.Node.get(t,!0);i&&(i.value=i.getValue())}}document.addEventListener("change",e=>{e.target.matches("input[type=radio]")&&t(e.target)}),Mavo.observe({attribute:"value",selector:"input[type=radio]"},e=>t(e.element))},observedAttributes:["value"]},counter:{extend:"formControl",selector:"button, .counter",attribute:"mv-clicked",datatype:"number",init:function(i){"mv-clicked"===this.attribute&&(i.setAttribute("mv-clicked","0"),i.addEventListener("click",e=>{var t=+i.getAttribute("mv-clicked")||0;this.value=++t}))}},meter:{default:!0,selector:"meter, progress",attribute:"value",datatype:"number",edit:function(){let i=this.element.min??this.element.getAttribute("min")??0,r=this.element.max??this.element.getAttribute("max")??1,s=(i=+i,(r=+r)-i),n=this.element.step??this.element.getAttribute("step")??this.element.getAttribute("mv-editor-step")??(1<s?1:s/100);n=+n,a.bind(this.element,"mousemove.mavo:edit",e=>{var t=this.element.getBoundingClientRect().left,e=Math.max(0,(e.clientX-t)/this.element.offsetWidth),t=i+s*e,e=t%n;t+=e>n/2?n-e:-e,t=Math.max(i,Math.min(t,r)),this.pauseObserver(),this.element.setAttribute("value",t),this.resumeObserver()}),a.bind(this.element,"mouseleave.mavo:edit",e=>{this.pauseObserver(),this.element.setAttribute("value",this.value),this.resumeObserver()}),a.bind(this.element,"click.mavo:edit",e=>{this.value=this.getValue()}),a.bind(this.element,"keydown.mavo:edit",e=>{var t;e.target!=this.element||37!=e.keyCode&&39!=e.keyCode||(t=n*(39==e.keyCode?1:-1)*(e.shiftKey?10:1),t=this.value+t,t=Math.max(i,Math.min(t,r)),this.element.setAttribute("value",t),e.preventDefault())})},observedAttributes:["min","max"]},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, pre",editor:function(){var e=getComputedStyle(this.element),t=0===e.display.indexOf("inline")?"input":"textarea",i=a.create(t);return"textarea"==t&&((t=this.element.offsetWidth)&&(i.width=t),i.style.whiteSpace={normal:"pre-wrap",nowrap:"pre"}[e.whiteSpace]||"inherit"),i},setEditorValue:function(e){this.datatype&&"string"!=this.datatype&&(e+="");var t=getComputedStyle(this.element);return e=e||"",-1<["normal","nowrap"].indexOf(t.whiteSpace)&&(e=e.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(t.whiteSpace)&&(e=e.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=e,!0}},time:{attribute:"datetime",default:!0,init:function(){if(!this.fromTemplate("dateType")){var e=Mavo.DOMExpression.search(this.element,null),t=this.element.getAttribute("datetime")||"YYYY-MM-DD",i=this.element.getAttribute("mv-editor-type");if(i in this.config.dateTypes)this.dateType=i;else for(var r in this.config.dateTypes)if(this.config.dateTypes[r].test(t)){this.dateType=r;break}!e&&(this.element.textContent=this.config.defaultFormats[this.dateType]?.(this.property)??"",this.mavo.expressions.extract(this.element,null),e=Mavo.DOMExpression.search(this.element,null))&&this.mavo.treeBuilt.then(()=>{e.update()})}},dateTypes:{month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[Mi\d]{2}/i,date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i},defaultFormats:{date:e=>`[readable_datetime(${e}, "days")]`,month:e=>`[readable_datetime(${e}, 'months')] `,time:e=>`[hour(${e}, '00')]:[minute(${e}, '00')]`,"datetime-local":function(e){return this.date(e)+" "+this.time(e)}},editor:function(){return{tag:"input",type:this.dateType}}},"circle@r":{default:!0,datatype:"number"},circle:{attribute:["cx","cy"],datatype:"number"},text:{default:!0,editType:"popup"},".mv-toggle":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){Mavo.revocably.setAttribute(this.element,"role","checkbox"),a.bind(this.element,"click.mavo:edit keyup.mavo:edit keydown.mavo:edit",e=>{"click"!=e.type&&" "!=e.key&&"Enter"!=e.key||("keydown"!=e.type&&(this.value=!this.value),e.preventDefault(),e.stopPropagation())})},done:function(){Mavo.revocably.restoreAttribute(this.element,"role"),a.unbind(this.element,".mavo:edit")}}})}(Bliss,Bliss.$),!function(a,i){Mavo.attributes.push("mv-list","mv-list-item","mv-order","mv-accepts","mv-initial-items");var o=Mavo.Collection=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.firstItemElement=this.templateElement=a(Mavo.selectors.multiple,this.element),this.children=[],this.liveData=new Mavo.Data(this,[]),this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),this.templateElement.after(this.marker),this.addButton=this.createAddButton(),this.templateElement.hasAttribute("mv-like")&&Mavo.warn("@mv-like is deprecated and will be removed in the next version of Mavo"),this.fromTemplate("templateElement","accepts","initialItems")||(this.accepts=this.element.getAttribute("mv-accepts"),this.accepts=new Set(this.accepts?.split(/\s+/)),this.initialItems=+(this.element.getAttribute("mv-initial-items")||1),this.templateElement=this.templateElement.cloneNode(!0)),this.initializeData(),this.postInit(),Mavo.hooks.run("collection-init-end",this)}initializeData(){var e=this.add(this.firstItemElement,void 0,{silent:!0});if(0===this.initialItems)e?this.delete(e,{silent:!0}):this.firstItemElement.remove();else if(1<this.initialItems)for(let e=1;e<this.initialItems;e++)this.add()}createAddButton(){var e=`button[class~="mv-add-${this.property}"]`,t=this.parentGroup.element,e=i(e,t).filter(e=>!this.element.contains(e)&&!Mavo.data(e,"collection"))[0];return e?(e.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING&&Mavo.setAttributeShy(this.templateElement,"mv-order","desc"),Mavo.revocably.remove(e)):e=a.create("button",{type:"button",className:"mv-ui",textContent:this.mavo._("add-item",this)}),e.classList.add("mv-add","mv-add-"+this.property),Mavo.data(e,"collection",this),Mavo.setAttributeShy(e,"mv-action",`add(${this.property})`),e}get length(){return this.children.length}getData(e={}){var t={context:this,options:e};return t.data=this.children.map(e=>e.getData(t.options)).filter(e=>null!==Mavo.value(e)),t.data=Mavo.subset(this.data,this.inPath,t.data),Mavo.hooks.run("node-getdata-end",t),t.data}createItem(e){e=e||this.templateElement.cloneNode(!0);var t=this.itemTemplate||this.template?.itemTemplate||null,e=Mavo.Node.create(e,this.mavo,{collection:this,template:t,property:this.property,type:this.type});return this.itemTemplate||(this.itemTemplate=t||e),e}add(e,t,i={}){(e=e instanceof Node?Mavo.Node.get(e)||this.createItem(e):e||this.createItem()).collection!=this&&(e.collection&&(e.collection.splice({remove:e}),e.collection.dataChanged("delete")),r=e.getData(),s=e.editing,e.element.remove(),e.destroy(),e=this.createItem(),s&&this.editItem(e),e.render(r)),void 0===t&&(t=this.bottomUp?0:this.length);var r,s=this.children?.[t]?.element??this.marker,n=(a.before(e.element,s),{context:this,item:e});return n.previousIndex=e.index,n.changed=this.splice({remove:n.item},{index:t,add:n.item}),this.mavo.expressions.active&&!i.silent&&requestAnimationFrame(()=>{n.changed.forEach(e=>{e.dataChanged(e==n.item&&void 0===n.previousIndex?"add":"move"),e.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0,this.mavo.expressions.update(n.item)}),Mavo.hooks.run("collection-add-end",n),n.item}splice(...e){e.forEach(e=>{void 0===e.index&&e.remove&&isNaN(e.remove)&&(e.index=this.children.indexOf(e.remove),e.remove=1)}),e.sort((e,t)=>t.index-e.index);var t=[],i=[];e.forEach(e=>{-1<e.index&&(e.remove||e.add)&&(e.remove=e.remove||0,e.add=Mavo.toArray(e.add),i.push(...this.children.splice(e.index,+e.remove,...e.add)))}),i=new Set(i);for(let e=0;e<this.length;e++){var r=this.children[e];i.delete(r),r&&r.index!==e&&(r.index=e,t.push(r))}return i.forEach(t=>{t.expressions?.forEach(e=>{t.mavo.expressions.unregister(e)})}),this.liveData.update(),t}async delete(e,{silent:t,undoable:i=!t,transition:r=!t,destroy:s=!i}={}){return e.element.classList.remove("mv-highlight"),this.splice({remove:e}),!t&&r&&(await a.transition(e.element,{opacity:0}),e.element.style.opacity=""),a.remove(e.element),t||(this.unsavedChanges=e.unsavedChanges=this.mavo.unsavedChanges=!0,e.collection.dataChanged("delete",{index:e.index})),i?this.mavo.setDeleted(e):s&&e.destroy(),e}move(e,t){t=e.index+t+(0<t),t=Mavo.wrap(t,this.children.length+1);this.add(e,t)}editItem(t,i={}){t.preEdit?.resolve("abort");var e=i.immediately||Mavo.inView.is(t.element);return t.preEdit=Mavo.promise(e?Promise.resolve():Mavo.inView.when(t.element)),t.preEdit.then(e=>{if("abort"!==e)return t.itembar||(t.itembar=new Mavo.UI.Itembar(t)),t.itembar.add(),t.edit(i)})}doneItem(e){e.itembar?.remove(),e.preEdit?.resolve("abort")}edit(t={}){var i;return!1!==super.edit()&&(this.addButton.parentNode||(i=(i=this.bottomUp&&this.children[0]?this.children[0].element:i)||this.marker,Mavo.revocably.add(this.addButton,e=>a[this.bottomUp?"before":"after"](e,i))),o.dragula.then(()=>{this.getDragula()}),Promise.all(this.children.map(e=>this.editItem(e,t))))}done(){if(!1===super.done())return!1;Mavo.revocably.remove(this.addButton),this.propagate(e=>this.doneItem(e))}dataChanged(e,t={}){return t.element=t.element||this.marker,super.dataChanged(e,t)}dataRender(e,t={}){if(void 0!==e){e=null===e?[]:Mavo.toArray(e).filter(e=>null!==e);for(var i=!1,r=0;r<this.children.length;r++){var s=this.children[r];r<e.length?i=s.render(e[r],t)||i:(this.delete(s,{silent:i=!0}),r--)}if(e.length>r){for(var n=document.createDocumentFragment(),a=r;a<e.length;a++){i=(s=this.createItem()).render(e[a],t)||i;this.children.push(s),s.index=a,n.appendChild(s.element),Mavo.hooks.run("collection-add-end",{context:this,item:s})}this.marker.before(n)}if(this.liveData.update(),e.length>r)for(a=r;a<this.children.length;a++)this.children[a].dataChanged("add");return i}}isCompatible(e){return e&&this.itemTemplate.constructor==e.itemTemplate.constructor&&(e===this||e.template==this||this.template==e||this.template&&this.template==e.template||-1<this.accepts.has(e.property))}destroy(){super.destroy(),this.dragula?.destroy(),this.dragula=null,this.propagate("destroy")}getDragula(){if(!this.dragula){var e;if(this.template)return-1===(e=this.template.getDragula().containers).indexOf(this.marker.parentNode)&&e.push(this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this.dragula=dragula({containers:[this.marker.parentNode],isContainer:e=>!!this.accepts.size&&Array.from(e.childNodes).some(e=>{e=o.get(e);return e&&this.accepts.has(e.property)}),moves:(e,t,i)=>i.classList.contains("mv-drag-handle")&&i.closest(Mavo.selectors.multiple)==e,accepts:function(e,t,i,r){return!e.contains(t)&&(t=r?.previousElementSibling??t.lastElementChild,!!(t=o.get(t)||o.get(r)))&&Mavo.Node.get(e)?.collection.isCompatible(t)}}),this.dragula.on("drop",(e,t,i)=>{var r=Mavo.Node.get(e),s=e.nextElementSibling,e=e.previousElementSibling,n=o.get(e)||o.get(s),s=Mavo.Node.get(e)||Mavo.Node.get(s);if(s&&s.collection!=n&&(s=null),!r.collection.isCompatible(n))return this.dragula.cancel(!0);s=s?s.index+(s.element===e):n.length;n.add(r,s)}),o.dragulas.push(this.dragula)}return this.dragula}getClosestCollection(){return this}static get(e){var t=Mavo.data(e,"collection");return t||Mavo.Node.get(e)?.collection||null}static async delete(e,t={}){if(0===(e=e.filter(e=>!!e.collection)).length)return[];if(1===e.length)return[await e[0].collection.delete(e[0],t)];let i=new Mavo.BucketMap({arrays:!0}),r=new Set;e=e.map(async e=>{r.add(e.collection);var t=await e.collection.delete(e,{silent:!0,undoable:!1,destroy:!1});return t.unsavedChanges=!0,i.set(e.mavo,e),t}),e=await Promise.all(e);return!1!==t.silent&&(r.forEach(e=>{e.unsavedChanges=e.mavo.unsavedChanges=!0,e.dataChanged("delete")}),!1!==t.undoable)&&i.forEach((e,t)=>{t.setDeleted(...e)}),e}};a.Class(o,{lazy:{bottomUp:function(){return/^desc\b/i.test(this.element.getAttribute("mv-order"))}},static:{dragulas:[],lazy:{dragula:()=>a.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}})}(Bliss,Bliss.$),Bliss,Bliss.$,Mavo.ImplicitCollection=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.children=[],this.liveData=new Mavo.Data(this,[]),this.add(e),this.postInit(),Mavo.hooks.run("implicit-collection-init-end",this)}get length(){return this.children.length}getData(t={}){var e,i={context:this,options:t,data:[]};return this.children.forEach(e=>{e.isDataNull()||i.data.push(e.getData(t))}),this.data&&(e=Mavo.toArray(Mavo.subset(this.data,this.inPath))).length>i.data.length&&(i.data=i.data.concat(e.slice(i.data.length))),Array.isArray(i.data)&&i.data.length<=1&&(i.data=1===i.data.length?i.data[0]:null),i.data=Mavo.subset(this.data,this.inPath,i.data),Mavo.hooks.run("node-getdata-end",i),i.data}add(e){e=Mavo.Node.create(e,this.mavo,{collection:this,template:this.template?.children?.[this.length]??null,property:this.property,type:this.type});return e.index=this.length,this.children.push(e),this.liveData.update(),e}edit(t={}){return!1!==super.edit()&&Promise.all(this.children.map(e=>e.edit(t)))}dataRender(i,r={}){var s;void 0!==i&&(s=(i=null===i?[]:Mavo.toArray(i).filter(e=>null!==e)).length!==this.liveData.length,this.children.forEach((e,t)=>s=e.render(i?.[t],r)??s)),this.liveData.update()}},!function(r,t){var i=Mavo.UI.Itembar=class{constructor(e){this.item=e,this.element=t(`.mv-item-bar:is(:not([mv-rel]), [mv-rel="${this.item.property}"])`,this.item.element).filter(e=>e.closest(Mavo.selectors.multiple)==this.item.element&&!Mavo.data(e,"item"))[0],!this.element&&this.item.template?.itembar?this.element=this.item.template.itembar.element.cloneNode(!0):(this.element=this.element||r.create({className:"mv-item-bar mv-ui"}),this.template=this.element.getAttribute("mv-item-bar")||this.item.element.getAttribute("mv-item-bar")||this.collection.element.getAttribute("mv-item-bar")||"",(e=Object.assign({},i.controls)).move={...e.move,optional:this.item instanceof Mavo.Primitive},this.controls=Mavo.UI.Bar.getControls(this.template,e),r.set(this.element,{"mv-rel":this.item.property,contents:this.controls.map(e=>{var t=i.controls[e],e=r(".mv-"+e,this.element);return r.create(t.create.call(this,e))})})),this.dragHandle=r(".mv-drag-handle",this.element)||this.item.element,this.element.setAttribute("hidden",""),r.bind([this.item.element,this.element],"focusin mouseover",this),r.bind(this.element,{mouseenter:e=>{this.item.element.classList.add("mv-highlight")},mouseleave:e=>{this.item.element.classList.remove("mv-highlight")}}),this.dragHandle.addEventListener("keydown",e=>{e.target===this.dragHandle&&this.item.editing&&37<=e.keyCode&&e.keyCode<=40&&(this.collection.move(this.item,e.keyCode<=38?-1:1),e.stopPropagation(),e.preventDefault(),e.target.focus())}),this.dragHandle!==this.item.element&&this.dragHandle.addEventListener("click",e=>e.target.focus()),Mavo.data(this.element,"item",this.item)}get collection(){return this.item.collection}get mavo(){return this.item.mavo}destroy(){this.hide()}show(t){i.visible.forEach(e=>{e==this||this.sticky&&!e.sticky||(clearTimeout(e.hideTimeout),e.hide(t,i.DELAY))}),i.visible.add(this),(this.element.hasAttribute("hidden")||t&&!this.sticky)&&(this.element.removeAttribute("hidden"),this.sticky=this.sticky||t,r.bind([this.item.element,this.element],"focusout mouseleave",this))}hide(e,t=0){this.sticky&&!e||(t?this.hideTimeout=setTimeout(()=>this.hide(e),t):(this.element.setAttribute("hidden",""),r.unbind([this.item.element,this.element],"focusout mouseleave",this),this.sticky=!1,i.visible.delete(this)))}handleEvent(e){var t=-1===e.type.indexOf("mouse");this.isWithinItem(e.target)&&(clearTimeout(this.hideTimeout),-1<["mouseleave","focusout","blur"].indexOf(e.type)?this.isWithinItem(e.relatedTarget)||this.hide(t,i.DELAY):(this.show(t),e.stopPropagation()))}isWithinItem(e){var t;return!!e&&((t=e.closest(".mv-item-bar"))?t===this.element:e.closest(Mavo.selectors.item)===this.item.element)}add(){var e,t;this.element.parentNode||Mavo.revocably.add(this.element)||((t=(e=this.item.element.nodeName.toLowerCase())in i.container?r(i.container[e],this.item.element):t)||this.item.element).appendChild(this.element),this.dragHandle==this.item.element&&this.item.element.classList.add("mv-drag-handle")}remove(){Mavo.revocably.remove(this.element),this.dragHandle==this.item.element&&this.item.element.classList.remove("mv-drag-handle")}};r.Class(i,{live:{sticky:function(e){this.element.classList.toggle("mv-sticky",e)}},static:{DELAY:100,visible:new Set,container:{details:"summary"},controls:{delete:{create(e){e=e||r.create("button",{type:"button",title:this.mavo._("delete-item",this.item),className:"mv-delete"});return Mavo.setAttributeShy(e,"mv-action","delete($item)"),e}},add:{create(e){var t=this.collection.bottomUp,i="$item"+(t?", $index + 1":""),e=e||r.create("button",{type:"button",title:this.mavo._("add-item-"+(t?"after":"before"),this.item),className:"mv-add"});return Mavo.setAttributeShy(e,"mv-action",`if($cmd, add($item, ${i}), add(${i}))`),e}},move:{create(e){e=e||r.create("button",{type:"button",title:this.mavo._("drag-to-reorder",this.item),className:"mv-move"});return e.classList.add("mv-drag-handle"),e}}}}})}(Bliss,Bliss.$),!function(){var t=Mavo.Expression=class{constructor(e,t={}){this.options=t,this.expression=e}eval(t=Mavo.Data.stub){if(Mavo.hooks.run("expression-eval-beforeeval",this),this.function instanceof Error)return this.function;try{return this.function(t)}catch(e){return this.error("Something went wrong with the expression "+this.expression,e.message,"Data was: "+JSON.stringify(t)),Mavo.hooks.run("expression-eval-error",{context:this,error:e}),e}}error(e,...t){t=t.join("\n"),console.info(`%cOops! 😳 ${e}:`,"color: #c04; font-weight: bold;",t)}toString(){return this.expression}changedBy(e){return t.changedBy(this.identifiers,e)}};Bliss.Class(t,{live:{expression:function(t){try{this.function=Mavo.Script.compile(t,this.options)}catch(e){return this.error("There is something wrong with the expression "+t,e.message,"Not an expression? See https://mavo.io/docs/expressions/#disabling-expressions for information on how to disable expressions."),Mavo.hooks.run("expression-compile-error",{context:this,error:e}),this.function=e,t}if(this.ast=this.options.ast,delete this.options.ast,this.ast){let r=new Set;Mavo.Script.walk(this.ast,(e,t,i)=>{"Identifier"===e.type&&"callee"!==t?r.add(e.name):"MemberExpression"===e.type&&(e.object.name&&r.add(e.object.name),r.add(e.property.name))}),this.identifiers=[...r]}}}}),t.Syntax=class{constructor(e,t){this.start=e,this.end=t,this.regex=RegExp(Mavo.escapeRegExp(e)+"([\\S\\s]*?)"+Mavo.escapeRegExp(t),"gi")}test(e){return this.regex.lastIndex=0,this.regex.test(e)}tokenize(e){var t,i=[],r=0;for(this.regex.lastIndex=0;null!==(t=this.regex.exec(e));)t.index>r&&i.push(e.substring(r,t.index)),r=this.regex.lastIndex,/\S/.test(t[1])?i.push(new Mavo.Expression(t[1])):i.push(t[0]);return r<e.length&&i.push(e.substring(r)),i}static create(e){if(e){e=e.getAttribute("mv-expressions");if(e)return e=e.trim(),/\s/.test(e)?new t.Syntax(...e.split(/\s+/)):t.Syntax.ESCAPE}}},t.Syntax.ESCAPE=-1,t.Syntax.default=new t.Syntax("[","]")}(),!function(s){var n=Mavo.DOMExpression=s.Class({async constructor(e={}){this.mavo=e.mavo,this.template=e.template?.template||e.template;for(var t of["item","path","syntax","fallback","attribute","originalAttribute","expression","parsed","identifiers"])this[t]=(void 0===e[t]&&this.template?this.template:e)[t];var i;this.node=e.node,this.node||(this.node=Mavo.elementPath(this.item.element,this.path)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),"mv-value"==this.attribute&&(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),i=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(i)],this.expression=i),3===this.node.nodeType&&this.element===this.node&&(this.element=this.node.parentNode,this.node.parentNode.children.length&&!this.attribute||(this.element.normalize(),this.node.parentNode&&!this.attribute)||(this.node=this.element)),"string"!=typeof this.expression&&(this.attribute?(i=Element.prototype.getAttribute.call(this.node,this.attribute),this.expression=(i||"").trim()):(this.node.normalize(),1===this.node.childNodes.length&&3===this.node?.firstChild?.nodeType&&((i=this.node.firstChild.textContent.match(/^\s*|\s*$/g))[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-i[1].length),this.node.after(this.node.lastChild)),i[0])&&(this.node.firstChild.splitText(i[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node)),this.expression=this.node.textContent),this.parsed=this.template?this.template.parsed:this.syntax.tokenize(this.expression)),this.oldValue=this.value=this.parsed.map(e=>e instanceof Mavo.Expression?"":e),this.identifiers=this.identifiers||this.parsed.flatMap(e=>e.identifiers||[]),n.special.add(this),Mavo.hooks.run("domexpression-init-end",this),n.elements.set(this.element,[...n.elements.get(this.element)||[],this]),await this.mavo.treeBuilt,this.template||this.item||(this.item=Mavo.Node.getClosestItem(this.element)),"mv-value"==this.originalAttribute&&this.mavoNode&&this.mavoNode==this.item.collection&&this.item.expressions.delete(this),this.mavo.expressions.register(this),Mavo.hooks.run("domexpression-init-treebuilt",this)},destroy:function(){n.special.delete(this),this.mavo.expressions.unregister(this)},get isDynamicObject(){return"mv-value"==this.originalAttribute&&this.mavoNode&&!(this.mavoNode instanceof Mavo.Primitive)},changedBy:function(e){return this.isDynamicObject?!e||!this.mavoNode.contains(e.node):Mavo.Expression.changedBy(this.identifiers,e)},update:function(e){var t,s,i,n,a;!1!==this.active&&(s=t={context:this},n=this.item?(i=this.isDynamicObject?this.item.parent:this.item,this.data=i.getLiveData()):void 0===this.data?Mavo.Data.stub:this.data,Mavo.hooks.run("domexpression-update-start",t),this.oldValue=this.value,a=!1,t.value=this.value=this.parsed.map((e,t)=>{var i,r;return e instanceof Mavo.Expression?(t=Mavo.value(this.oldValue[t]),i={context:this,expr:e,parentEnv:s,oldValue:t},Mavo.hooks.run("domexpression-update-beforeeval",i),i.value=Mavo.value(i.expr.eval(n)),Mavo.hooks.run("domexpression-update-aftereval",i),i.value instanceof Error&&(i.value=void 0!==this.fallback?this.fallback:this.syntax.start+i.expr.expression+this.syntax.end),void 0!==i.value&&null!==i.value||(i.value=""),r=Mavo.value(i.value),this.evaluated&&"object"!=typeof r&&r===t||(a=!0),this.evaluated=!0,i.value):e}),a||e?.force)&&(1===t.value.length?t.value=t.value[0]:t.value=t.value.map(e=>Mavo.Primitive.format(e,{attribute:this.attribute,element:this.element})).join(""),this.output(t.value),Mavo.hooks.run("domexpression-update-end",t))},output:function(e){this.mavoNode?(Mavo.in(Mavo.isProxy,e)&&(e=Mavo.clone(e)),this.mavoNode.render(e,{live:!0})):(this.node.nodeType!==Node.TEXT_NODE||this.node.parentNode||(this.node=this.element),Mavo.Primitive.setValue(this.node,e,{attribute:this.attribute}))},live:{item:function(e){e&&this._item!=e&&(this._item&&this._item.expressions.delete(this),e.expressions=e.expressions||new Set,e.expressions.add(this))}},static:{elements:new WeakMap,search:function(e,t){if(null===e)return e;t&&!e.ownerDocument.xmlVersion&&(t=t.toLowerCase());var i=n.elements.get(e)||[];return 1<arguments.length?i.length&&i.filter(e=>e.attribute===t)[0]||null:i},special:{add:function(e,t){if(t){var i=this.vars[t],r=-1<e.identifiers.indexOf(t),s=t.startsWith("$")&&-1<e.identifiers.indexOf(t.substr(1));i&&(r||s)&&(i.all=i.all||new Set,i.all.add(e),1===i.all.size?i.observe():i.all.size||i.unobserve())}else for(var t in this.vars)this.add(e,t)},delete:function(e,t){if(t){var i=this.vars[t];i.all=i.all||new Set,i.all.delete(e),i.all.size||i.unobserve()}else for(var t in this.vars)this.delete(e,t)},update:function(){this.update?.(...arguments),this.all.forEach(e=>e.update())},event:function(t,{type:e,update:i,target:r=document}={}){this.vars[t]={observe:function(){this.callback=this.callback||n.special.update.bind(this),s.bind(r,e,this.callback)},unobserve:function(){s.unbind(r,e,this.callback)}},i&&(this.vars[t].update=function(e){Mavo.Functions[t]=i(e)})},vars:{$now:{observe:function(){var e=()=>{n.special.update.call(this),this.timer=requestAnimationFrame(e)};this.timer=requestAnimationFrame(e)},unobserve:function(){cancelAnimationFrame(this.timer)}}}}}});n.special.event("$mouse",{type:"mousemove",update:function(e){return{x:e.clientX,y:e.clientY}}}),n.special.event("$hash",{type:"hashchange",target:window})}(Bliss,Bliss.$),!function(e,o){Mavo.attributes.push("mv-expressions");var s=Mavo.Expressions=e.Class({async constructor(e){this.mavo=e,this.active=!0,this.expressions=new Set,this.identifiers={};e=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,e),this.scheduled={},await this.mavo.treeBuilt,this.expressions=new Set,this.update()},register:function(t){var i=this.identifiers;t.registeredApp=t.registeredApp||new Set,t.identifiers.forEach(e=>{i[e]instanceof Set||(i[e]=new Set),i[e].add(t),Mavo.all[e]instanceof Mavo&&Mavo.all[e]!==this.mavo&&!t.registeredApp.has(e)&&(t.registeredApp.add(e),Mavo.all[e].expressions.register(t))})},unregister:function(t){var i=this.identifiers;t.identifiers.forEach(e=>{i[e]&&i[e].delete(t),e in Mavo.all&&"undefined"!=typeof domexpresssion&&Mavo.all[e].expressions.unregister(domexpresssion)})},updateThrottled:function(e){var t;this.active&&(t=this.scheduled[e.action]=this.scheduled[e.action]||new Set,e.node.template?t.has(e.node.template)||(setTimeout(()=>{t.delete(e.node.template),this.update(e)},s.THROTTLE),t.add(e.node.template)):requestAnimationFrame(()=>this.update(e)))},update:function(i){if(this.active){var e,t,r;if(i instanceof Mavo.Node)e=i;else if(i instanceof Element)t=i.closest(Mavo.selectors.item),e=Mavo.Node.get(t);else{if(i)return t={updated:new Set},this.updateByIdThrottled(i.property,i,t),void("propertychange"==i.action?i.node?.path&&this.updateByIdThrottled(i.node.path,i,t):(this.updateById(Object.keys(Mavo.Data.special),i,t),r=i.node.collection||i.node,this.updateById(r.properties,i,t)));e=this.mavo.root}e.walk((e,t)=>{if(!e.expressionsEnabled)return!1;e.expressions?.forEach(e=>{i&&e.mavoNode===i||e.update()})})}},updateByIdThrottled:function(e,t,i){var r;e&&(e.forEach?e.forEach(e=>this.updateByIdThrottled(e,t,i)):(r=this.scheduledIds=this.scheduledIds||new Set).has(e)||(setTimeout(()=>{r.delete(e),this.updateById(e,t,i)},s.THROTTLE),r.add(e)))},updateById:function(e,t,i){e.forEach?e.forEach(e=>this.updateById(e,t,i)):(e=this.identifiers[e])&&e.forEach(e=>{"mv-value"==e.originalAttribute&&e.mavoNode&&!(e.mavoNode instanceof Mavo.Primitive)&&e.mavoNode.contains(t.node)||i.updated.has(e)||e.update()})},extract:function(e,t,i,r=Mavo.Expression.Syntax.default){t&&-1<s.skip.indexOf(t.name)||(t&&-1<s.directives.indexOf(t.name)||r!==Mavo.Expression.Syntax.ESCAPE&&r.test(t?t.value:e.textContent))&&(void 0===i&&(i=Mavo.elementPath(e.closest(Mavo.selectors.scope),e)),this.expressions.add(new Mavo.DOMExpression({node:e,syntax:r,path:i,attribute:t?.name,mavo:this.mavo})))},traverse:function(t,i=[],r){var s,n,a;8!==t.nodeType&&(3===t.nodeType?this.extract(t,null,i,r):(t.normalize(),r=Mavo.Expression.Syntax.create(t)||r,t.matches(Mavo.selectors.scope)&&(i=[]),t.hasAttribute("mv-expressions-ignore")&&(s=new Set(t.getAttribute("mv-expressions-ignore").trim().split(/\s*,\s*/))),o(t.attributes).forEach(e=>{s&&s.has(e.name)||this.extract(t,e,i,r)}),n=-1,a=0,t.matches("script:not([mv-expressions])")||o(t.childNodes).forEach(e=>{var t;1==e.nodeType?(a=0,n++):a++,1!=e.nodeType&&3!=e.nodeType||(t=0<a?n+"."+a:n,this.traverse(e,[...i||[],t],r))})))},static:{directives:["mv-value"],skip:["mv-expressions","mv-action"],THROTTLE:50,directive:function(e,t){s.directives.push(e),Mavo.attributes.push(e),Mavo.Plugins.register(e,t)}}})}(Bliss,Bliss.$),!function(t){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(e){this._hidden!==e&&(this._hidden=e,this.liveData.update(),this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var e=t(Mavo.selectors.property,this.element).filter(e=>e.closest("[mv-if]")==this.element).map(e=>Mavo.Node.get(e));return this.element.addEventListener("mv-change",e=>{requestAnimationFrame(()=>{this.element.parentNode||this.item.element.dispatchEvent(e)})}),e}}}},hooks:{"domexpression-init-start":function(){"mv-if"==this.attribute&&(Mavo.Node.prototype.fromTemplate.call(this,"parsed","expression")||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end),this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf)&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this))},"domexpression-update-end":async function(){var t,e,i;"mv-if"===this.attribute&&(t=this.value[0],e=this.oldValue[0],await this.item.mavo.treeBuilt,this.parentIf&&(i=this.parentIf.value[0],this.value[0]=t=t&&i),!1!==i&&(t?Mavo.revocably.add(this.element):this.element.parentNode&&Mavo.revocably.remove(this.element,"mv-if")),t!==e)&&(this.childProperties?.forEach(e=>e.hidden=!t),this.childIfs?.forEach(e=>e.update()))},"node-isdatanull":function(e){e.result=e.result||this.hidden&&e.options.live}}})}((Bliss,Bliss.$)),!function(a,n){var l=Mavo.Functions={operators:{"=":"eq"},get:function(e,t,...i){if(arguments.length<=1)return e;let r;t=n(t);var s=Mavo.getCanonicalProperty(e,t);if(void 0!==s)r=e[s];else{if(!(Array.isArray(e)&&t&&isNaN(t)))return null;r=e.map(e=>l.get(e,t))}return 0<i.length?l.get(r,...i):r},map:function(e,t){return Array.isArray(e)?e.map(e=>l.get(e,t)):e?l.get(e,t):void 0},url:(e,t=location)=>{var i;return void 0===e?location.href:(e&&(e=o(e).replace(/[^\w-:]/g),i=t.search.match(RegExp(`[?&]${e}(?:=(.+?))?(?=$|&)`))||t.pathname.match(RegExp(`(?:^|\\/)${e}\\/([^\\/]*)`))),null!==i&&e?decodeURIComponent(i[1]||""):null)},first:(e,t)=>{if(void 0===t&&(t=e,e=void 0),void 0===t)return null;if(!Array.isArray(t))return void 0!==e?[t]:t;if(e<0)return l.last(Math.abs(e),t);for(var i=[],r=void 0===e?1:Math.floor(e),s=0;s<t.length&&i.length<r;s++){var n=Mavo.value(t[s]);null!==n&&""!==n&&i.push(t[s])}return void 0===e?void 0!==i[0]?i[0]:null:i},last:(e,t)=>{if(void 0===t&&(t=e,e=void 0),void 0===t)return null;if(!Array.isArray(t))return void 0!==e?[t]:t;if(e<0)return l.first(Math.abs(e),t);for(var i=[],r=void 0===e?1:Math.floor(e),s=t.length-1;0<=s&&i.length<r;s--){var n=Mavo.value(t[s]);null!==n&&""!==n&&i.push(t[s])}return void 0===e?void 0!==i[0]?i[0]:null:i},condense:e=>l.first(e.length,e),unique:function(e){return Array.isArray(e)?[...new Set(e.map(n))]:e},intersects:function(e,t){var i;if(e&&t)return i=new Set(Mavo.toArray(t).map(n)),!(e=Mavo.toArray(e).map(n)).every(e=>!i.has(e))},intersection:function(e,t){if(!e||!t)return null;e=Mavo.toArray(e),t=Mavo.toArray(t);let i=new Set(t.map(n));return e.filter(e=>i.has(Mavo.value(e)))},sum:a.extend(function(e){return i.numbers(e,arguments).reduce((e,t)=>+e+(+t||0),0)},{isAggregate:!0}),average:a.extend(function(e){return(e=i.numbers(e,arguments)).length&&l.sum(e)/e.length},{isAggregate:!0,alias:"avg"}),median:a.extend(function(e){var t=((e=i.numbers(e,arguments).sort((e,t)=>e-t)).length-1)/2;return[m1,m2]=[e[Math.floor(t)],e[Math.ceil(t)]],(m1+m2)/2||0},{isAggregate:!0}),min:a.extend(function(e){return Math.min(...i.numbers(e,arguments))},{isAggregate:!0}),max:a.extend(function(e){return Math.max(...i.numbers(e,arguments))},{isAggregate:!0}),atan2:a.extend((e,t)=>Math.atan2(e,t),{multiValued:!0,rightUnary:e=>e,default:1}),pow:a.extend((e,t)=>Math.pow(e,t),{multiValued:!0,default:1}),imul:a.extend((e,t)=>Math.imul(e,t),{multiValued:!0,default:1}),count:a.extend(function(e){return Mavo.toArray(e).filter(e=>!r(e)).length},{isAggregate:!0}),reverse:function(e){return Mavo.toArray(e).slice().reverse()},round:a.extend((e,t)=>s(e)||s(t)||!isFinite(e)?Math.round(e):+(+e).toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t}),{multiValued:!0,rightUnary:e=>e,default:0}),ordinal:a.extend(e=>{var t;return r(e)?"":(t=e<10||20<e?["th","st","nd","rd","th"][e%10]:t)||"th"},{multiValued:!0,alias:"th"}),pluralize:a.extend(function(e,...t){var i;return r(e)?"":0===t.length?e:(i=(t=t.reduce((e,t)=>(t=Mavo.value(t),"object"!==a.type(t)&&(t=e.one?Object.fromEntries(["zero","two","few","many","other"].map(e=>[e,t])):{one:t}),Object.assign(e,t)),{})).lang||Mavo.locale,i=t[new Intl.PluralRules(i,{type:t.type||"cardinal"}).select(e)]||t.other||t.two||t.zero||t.few||t.many||t.one,t.text_only?i:"ordinal"===t.type?""+e+i:e+" "+i)},{multiValued:!0,needsContext:!0}),digits:a.extend((e,t,i)=>{var r;return void 0===i&&(i=t,t=void 0),isNaN(i)?null:((r=(i+"").split("."))[0]=r[0].slice(-e),void 0!==t&&r[1]&&(r[1]=r[1].slice(0,t)),(i=+r.join(".")).toLocaleString("en",{useGrouping:!1,minimumIntegerDigits:e,minimumFractionDigits:t,maximumFractionDigits:t||20}))},{multiValued:!0}),iff:function(e,i=e,r=null){return Array.isArray(e)?e.map((e,t)=>{e=n(e)?i:r;return Array.isArray(e)?e[Math.min(t,e.length-1)]:e}):n(e)?i:r},group:(...e)=>Object.assign({},...e),list:(...e)=>e.flat(),random:a.extend((e=0,t=100,i=1)=>{1==arguments.length&&(t=e,e=0);var r=Math.random();return Math.floor(r*(1+(t-e)/i))*i+e},{multiValued:!0}),range:(i,e,r)=>{void 0===r&&(void 0===e&&([i,e]=[0<=i?1:-1,i]),r=i<=e?1:-1);var s=Math.floor((e-i)/r+1);if(s<=0||!isFinite(s))return[i];var n=[];for(let e=0,t=i;e++<s;t+=r)n.push(t);return n},shuffle:e=>{if(Array.isArray(e)){for(var t=e.slice(),i=t.length-1;0<i;i--){var r=Math.floor(Math.random()*(i+1));[t[i],t[r]]=[t[r],t[i]]}return t}return e},sort(e,i=e,...t){t=Object.assign({},...t);var r=Object.assign({numeric:!0},t);let s=new Intl.Collator(t.lang||Mavo.locale,r),n=(Array.isArray(i)||(i=l.get(e,i)),t.order?.startsWith("desc")),a=e.map((e,t)=>[e,i[t]]);return(a=a.sort((e,t)=>{e=e[1],t=t[1];return s.compare(e,t)*(n?-1:1)})).map(e=>e[0])},replace:a.extend((e,t,i="",r=1)=>{if(!Mavo.value(e))return e;if(Array.isArray(e))return e.map(e=>l.replace(e,t,i));for(var s,n=RegExp(Mavo.escapeRegExp(t),"g"),a=e,o=0;a!=s&&o++<r;)a=(s=a).replace(n,i);return a},{multiValued:!0}),len:a.extend(e=>o(e).length,{multiValued:!0}),contains:a.extend((e,t)=>{let i;var r,s=a.type(e);if("object"===a.type(t))return 0<=JSON.stringify(e).indexOf(JSON.stringify(t));if("object"!==s&&"array"!==s)return 0<=l.search(e,t);for(r in e)if(i=l.contains(e[r],t),i=Array.isArray(i)?Mavo.Functions.or(i):i)return!0;return i},{multiValued:!0}),search:a.extend((e,t)=>(e=o(e),t=o(t),e&&t?e.toLowerCase().indexOf(t.toLowerCase()):-1),{multiValued:!0}),starts:a.extend((e,t)=>0===l.search(o(e),o(t)),{multiValued:!0}),ends:a.extend((e,t)=>{[e,t]=[o(e),o(t)];var i=l.search(e,t);return-1<i&&i===e.length-t.length},{multiValued:!0}),join:function(e,t){return Mavo.toArray(e).filter(e=>!r(e)).join(o(t))},idify:a.extend(e=>o(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").toLowerCase(),{multiValued:!0}),readable:a.extend(e=>o(e).replace(/([a-z])([A-Z])(?=[a-z])/g,(e,t,i)=>t+" "+i.toLowerCase()).replace(/([a-z0-9])[_\/-](?=[a-z0-9])/g,"$1 ").replace(/^[a-z]/,e=>e.toUpperCase()),{multiValued:!0}),uppercase:a.extend(e=>o(e).toUpperCase(),{multiValued:!0}),lowercase:a.extend(e=>o(e).toLowerCase(),{multiValued:!0}),from:a.extend((e,t)=>l.between(e,t),{multiValued:!0}),fromlast:a.extend((e,t)=>l.between(e,t,"",!0),{multiValued:!0}),to:a.extend((e,t)=>l.between(e,"",t),{multiValued:!0}),tofirst:a.extend((e,t)=>l.between(e,"",t,!0),{multiValued:!0}),between:a.extend((e,t,i,r)=>{[e,t,i]=[o(e),o(t),o(i)];var s=t?e[r?"lastIndexOf":"indexOf"](t):0,n=i?e[r?"indexOf":"lastIndexOf"](i):e.length;return-1===s||-1===n?"":r&&n<=s?e.slice(n+i.length,s):e.slice(s+t.length,n)},{multiValued:!0}),phrase:a.extend(function(e,t,i){return 2===arguments.length&&"string"===a.type(t)&&([i,t]=[t]),(i?Mavo.Locale.get(i):this?.[Mavo.mavo]?.locale??Mavo.Locale.default).phrase(e,t)},{needsContext:!0}),filename:a.extend(e=>new URL(o(e),Mavo.base).pathname.match(/[^/]+?$/)?.[0],{multiValued:!0}),json:e=>Mavo.safeToJSON(e),split:a.extend((e,t=/\s+/)=>e?(e=o(e)).split(t):[],{multiValued:!0}),log:(...e)=>(console.log(...e.map(n)),e[0]),$mouse:{x:0,y:0},get $hash(){return location.hash.slice(1)},get $alt(){return!!l.$evt&&l.$evt.altKey},get $ctrl(){return!!l.$evt&&l.$evt.ctrlKey},get $shift(){return!!l.$evt&&l.$evt.shiftKey},get $cmd(){return!!l.$evt&&l.$evt[Mavo.superKey]},util:{numbers:function(e,t){return(e=Array.isArray(e)?e:t?$$(t):[e]).filter(e=>!isNaN(e)&&""!==n(e)&&null!==n(e)).map(e=>+e)},postProcess:function(n){var i,e=n.multiValued;if(!0===e||2===e?.length?i=(...i)=>{var r=e[0]||0,s=e[1]||1;return Mavo.Script.binaryOperation(i[r],i[s],{scalar:(e,t)=>(r in i&&(i[r]=e),s in i&&(i[s]=t),n(...i)),...n})}:n.isAggregate&&(i=function(e){var t;return Mavo.in(Mavo.groupedBy,e)?e.map(e=>i(e.$items)):void 0===(t=n.call(this,...arguments))?e:t}),i&&(a.extend(i,n),i.original=n),n.alias)for(var t of Mavo.toArray(n.alias))Mavo.Functions[t]=i||n;return i}}},i=l.util;function o(e=""){return(e=n(e))||0===e?e+"":""}function r(e){return null===(e=Mavo.value(e))||!1===e||""===e}function s(e){return!n(e)}Mavo.ready.then(()=>{Object.getOwnPropertyNames(Mavo.Functions).forEach(e=>{var t=i.postProcess(Mavo.Functions[e]);t&&(Mavo.Functions[e]=t)}),Object.getOwnPropertyNames(Math).forEach(t=>{1!==Math[t].length||Mavo.Functions.hasOwnProperty(t)||(Mavo.Functions[t]=e=>Mavo.Script.unaryOperation(e,e=>Math[t](e)))})})}(Bliss,Mavo.value),!function(i,r,c,o=c.util){var d={seconds:1,minutes:60},a=(d.hours=60*d.minutes,d.days=24*d.hours,d.weeks=7*d.days,d.months=30.4368*d.days,d.years=52*d.weeks,{year:e=>e.getFullYear(),month:e=>e.getMonth()+1,day:e=>e.getDate(),weekday:e=>e.getDay()||7,hour:e=>e.getHours(),minute:e=>e.getMinutes(),second:e=>e.getSeconds(),ms:e=>e.getMilliseconds()});function l(e){e=e?.trim()||"";for(var t=Object.keys(d).reverse(),i={};i[p=t.shift()]=!0,!RegExp(p+"?").test(e)&&0<t.length;);return"ms"==e&&(i.ms=!0),i}i.extend(c,{get $now(){return new Date},$startup:new Date,get $today(){return c.date(new Date)},year:i.extend(function(){return o.dateComponent("year",...arguments)},{multiValued:!0}),month:i.extend(function(){return o.dateComponent("month",...arguments)},{multiValued:!0}),week:()=>1e3*d.weeks,day:i.extend(function(){return o.dateComponent("day",...arguments)},{multiValued:!0}),weekday:i.extend(function(){return o.dateComponent("weekday",...arguments)},{multiValued:!0}),hour:i.extend(function(){return o.dateComponent("hour",...arguments)},{multiValued:!0}),minute:i.extend(function(){return o.dateComponent("minute",...arguments)},{multiValued:!0}),second:i.extend(function(){return o.dateComponent("second",...arguments)},{multiValued:!0}),ms:i.extend(function(){return o.dateComponent("ms",...arguments)},{multiValued:!0}),datetime:i.extend((e,t,i)=>{if(!(e=o.date(e)))return"";let r;void 0!==t&&((s=t)&&("ms"==s||(n=s.replace(/s$/,""),s=s.replace(/s?$/,"s"),n in d)||s in d)?[t,i]=[,t]:r=!0);var s,n=l(i??="minutes");let a=c.date(e,i);return n.hours&&(r?a+=Mavo.value(t)?"T"+c.time(t,i):"":a+="T"+c.time(e,i)),a},{multiValued:!0}),date:i.extend((e,t="days")=>{var i;return(e=o.date(e))?(i=[],(t=l(t)).years&&i.push(c.year(e)),t.months&&i.push(c.month(e,"00")),t.days&&i.push(c.day(e,"00")),i.join("-")):""},{multiValued:!0}),time:i.extend((e,t="minutes")=>{if(!(e=o.date(e)))return"";t=l(t);let i="";return t.hours&&(i+=c.hour(e,"00")+":"+(t.minutes?c.minute(e,"00"):"00"),t.seconds)&&(i+=":"+c.second(e,"00"),t.ms)&&(i+="."+c.ms(e,"000")),i},{multiValued:!0}),readable_datetime:i.extend((e,...t)=>{t=t.map(e=>"string"==typeof e||e instanceof String?{precision:e}:e);var i=l((t=Object.assign({},...t)).precision),r=t.month||i.days?"shortname":"long",s=[];return i.days&&s.push(c.day(e)),i.months&&s.push(c.month(e,r)),i.years&&s.push(c.year(e)),i.hours&&s.push(c.time(e,t.precision)),s.join(" ")},{multiValued:!0}),localTimezone:-(new Date).getTimezoneOffset()}),c.msTo=(e,t)=>Math.floor(Math.abs(t)/(1e3*d[e]))||0;for(let t in d)c[t]=i.extend(function(e){return 0===arguments.length?1e3*d[t]:c.msTo(t,e)},{multiValued:!0});c.duration=i.extend(function(e,i){var r=e<0?-1:1;if(e=Math.abs(e),i&&isNaN(i)){var t,s="ms"!=i?i.replace(/s?$/,""):i,n=i.replace(/s?$/,"s");if(n in d)return r*(t=Math.floor(e/d[n]/1e3))+" "+c.phrase.call(this,1===t&&"ms"!==n?s:n);throw new TypeError(`Unknown duration unit ${i}. Please use one of `+Object.keys(d).join(", "))}0!=e&&void 0!==i||(i=1);let a=e,o=[];if(0==e)o=["0 ms"];else{var l=[...Object.keys(d).reverse(),"ms"];for(let e=0,t;t=l[e];e++){var u=t in d?1e3*d[t]:1,h=Math.floor(a/u);if(a%=u,0<h&&o.length<i){u=1===h&&"ms"!==t?t.slice(0,-1):t;o.push(r*h+" "+c.phrase.call(this,u))}else if(0<o.length)break}}return 1===arguments.length?o[0]:o},{needsContext:!0,multiValued:!0}),i.extend(c.util,{fixDateString:function(e){e=e.trim();var t=/^\d{4}-\d{2}(-\d{2})?/.test(e),i=-1<e.indexOf(":");return t||i?(e=t?e.replace(/^(\d{4}-\d{2})(?!-\d{2})/,"$1-01"):c.$today+" "+e,i?e=e.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"):e+="T00:00:00",e.replace(/\s+/g,"")):null},dateComponent:function(e,t,i,r=Mavo.locale){var s,n;return 1===arguments.length&&e+"s"in d?c[e+"s"]():(s=o.date(t),"year"===e&&(t=t&&t.match?t:t+"",n=s?s.getFullYear()+"":(t.match(/\b[1-9]\d\d\b|\d+/)||[])[0]),n||s?(n=n||a[e](s),i?/^0+$/.test(i)?(n+"").padStart(i.length,"0").slice(-i.length):(i={name:"long",shortname:"short"}[i]||i,(n=s.toLocaleString(r,{[e]:i})).replace(/\u200e/g,"")):"year"===e?n:+n):"")},date:function(e){var t;return(e=r(e))?(t=new Date(e),"string"!==i.type(e)||!isNaN(t)&&t+""==e?t:null===(e=o.fixDateString(e))||(e=e.match(/[+-]\d{2}:?\d{2}|Z$/)?.[0]?new Date(e):(t=e.match(/\d+/g),new Date(t[0],(t[1]||1)-1,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),isNaN(e))?null:e):null}})}(Bliss,Mavo.value,Mavo.Functions),!function(o,a,l){var e,u=Mavo.Script={$fn:self.Proxy?new Proxy({[Symbol.unscopables]:{undefined:!0}},{get:(e,t)=>{var i,r=t?.toLowerCase?.()??t;return i=void 0===(i=r in Mavo.Actions.Functions?Mavo.Actions.running?Mavo.Actions.Functions[r]:Mavo.Actions.nope:i)?r in Mavo.Functions?Mavo.Functions[r]:Math[t]||Math[r]:i},has:(e,t)=>{var i=t.toLowerCase();return i in Mavo.Functions||i in Mavo.Actions.Functions||t in Math||i in Math}}):Mavo.Functions,addUnaryOperator:function(t,i){return i.symbol&&Mavo.toArray(i.symbol).forEach(e=>{u.unarySymbols[e]=t,jsep.addUnaryOp(e)}),e=>u.unaryOperation(e,e=>i.scalar(a(e)))},unaryOperation:function(e,t){return Array.isArray(e)?e.map(t):t(e)},binaryOperation:function(t,i,r={}){if(r.scalar="function"==typeof r?r:r.scalar,Array.isArray(i))if(Array.isArray(t)){var s=[],n=Math.max(t.length,i.length),a=r.leftUnary||r.unary,o=r.rightUnary||r.unary,l=void 0===r.leftDefault?r.default:r.leftDefault,u=void 0===r.rightDefault?r.default:r.rightDefault;for(let e=0;e<n;e++)!r.comparison||void 0!==t[e]&&void 0!==i[e]?void 0===t[e]?s[e]=o?o(i[e]):r.scalar(l,i[e]):void 0===i[e]?s[e]=a?a(t[e]):r.scalar(t[e],u):s[e]=r.scalar(t[e],i[e]):s[e]=r.default}else s=i.map(e=>r.scalar(t,e));else s=Array.isArray(t)?t.map(e=>r.scalar(e,i)):r.scalar(t,i);return s},addBinaryOperator:function(t,n){return n.symbol&&Mavo.toArray(n.symbol).forEach(e=>{u.symbols[e]=t,n.precedence&&jsep.addBinaryOp(e,n.precedence)}),n.default=void 0===n.default?0:n.default,n.code||function(...i){1===i.length&&Array.isArray(i[0])&&(i=[...i[0]]),n.raw||(i=i.map(a));var r=!!n.comparison||i[0];for(let t=1;t<i.length;t++){var s=n.comparison?i[t-1]:r;let e=i[t];Array.isArray(e)&&"number"==typeof n.default&&(e=l.numbers(e));s=u.binaryOperation(s,e,n),r=n.comparison?u.binaryOperation(r,s,u.operators.and):s}return r}},symbols:{},unarySymbols:{},getOperatorName:(e,t)=>u[t?"unarySymbols":"symbols"][e]||e,isComparisonOperator:e=>{if(e)return(e=u.operators[u.symbols[e]])&&e.comparison},isStatic:e=>{if("Identifier"===e.type)return!1;for(var t of u.childProperties)if(e[t]&&"callee"!==t&&!u.isStatic(e[t]))return!1;return!0},operators:{not:{symbol:"!",scalar:e=>!a(e)},multiply:{scalar:(e,t)=>e*t,default:1,symbol:"*"},divide:{scalar:(e,t)=>e/t,rightUnary:e=>e,default:1,symbol:"/"},addition:{scalar:(e,t)=>{if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i||r)return+i+ +r}return+e+ +t},symbol:"+"},plus:{scalar:e=>+e,symbol:"+"},subtract:{scalar:(e,t)=>{if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i&&r)return i-r}return e-t},symbol:"-"},minus:{scalar:e=>-e,symbol:"-"},mod:{scalar:(e,t)=>{e%=t;return e+=e<0?t:0},symbol:"mod",precedence:10},lte:{comparison:!0,scalar:(e,t)=>([e,t]=u.getNumericalOperands(e,t),e<=t),default:!1,symbol:"<="},lt:{comparison:!0,scalar:(e,t)=>([e,t]=u.getNumericalOperands(e,t),e<t),default:!1,symbol:"<"},gte:{comparison:!0,scalar:(e,t)=>([e,t]=u.getNumericalOperands(e,t),t<=e),default:!1,symbol:">="},gt:{comparison:!0,scalar:(e,t)=>([e,t]=u.getNumericalOperands(e,t),t<e),default:!1,symbol:">"},eq:{comparison:!0,scalar:(e,t)=>e==t||Mavo.safeToJSON(e)===Mavo.safeToJSON(t),symbol:["=","=="],default:!1,precedence:7},neq:{comparison:!0,scalar:(e,t)=>e!=t&&Mavo.safeToJSON(e)!==Mavo.safeToJSON(t),symbol:["!="],default:!0,precedence:7},and:{scalar:(e,t)=>e&&t,default:!1,symbol:["&&","and"],precedence:2},or:{scalar:(e,t)=>e||t,default:!1,symbol:["||","or"],precedence:2},concatenate:{symbol:"&",default:"",scalar:(e,t)=>""+(e=Mavo.value(e)??"")+(t=Mavo.value(t)??""),precedence:10},keyvalue:{symbol:":",code:(...e)=>{for(var t=e.length-1,i=e[t];t--;)i={[e[t]]:i};return i},transformation:e=>{"Identifier"==e.left.type&&(e.left={type:"Literal",value:e.left.name,raw:JSON.stringify(e.left.name)})},precedence:4},filter:{symbol:"where",code:(e,...t)=>{for(let i of t)e=Array.isArray(e)?Array.isArray(i)?e.map((e,t)=>a(i[t])?e:null):"boolean"==typeof(i=a(i))?i?e:e.map(e=>null):e.map(e=>e==i?e:null):a(i)?e:null;return e},precedence:1,postFlattenTransformation:t=>{var i=t.arguments[0];for(let e=1;e<t.arguments.length;e++)u.isStatic(t.arguments[e])||(t.arguments[e]=Object.assign(u.parse("scope()"),{arguments:[i,t.arguments[e]]}))}},range:{symbol:"..",scalar:(e,t)=>Mavo.Functions.range(e,t),precedence:2,export:!1},has:{symbol:"in",code:function(t,...e){var r;return e.map(i=>{e=Array.isArray(i)?e=>{var t="object"===o.type(a(e))?Mavo.safeToJSON:a;return-1<i.map(t).indexOf(t(e))}:"object"===o.type(i)?e=>Mavo.in(a(e),i):e=>Mavo.Functions.eq(e,i);var e=Mavo.Script.unaryOperation(t,e);r=void 0===r?e:Mavo.Functions.and(e,r)}),r},precedence:3},groupby:{symbol:"by",code:(i,r)=>{i=Mavo.toArray(i);var s=(r=Mavo.toArray(r))[Mavo.as]||r[0]?.[Mavo.toNode]?.property,n=new Mavo.BucketMap({arrays:!0}),a=[];return a[Mavo.groupedBy]=!0,i.forEach((e,t)=>{t=t<r.length?Mavo.value(r[t]):null;n.set(t,e)}),Mavo.in(Mavo.route,i)&&(a[Mavo.route]=Object.assign({},i[Mavo.route])),n.forEach((e,t)=>{t={$value:t,[s||"$value"]:t,$items:e};Mavo.in(Mavo.route,i)&&(e[Mavo.route]=t[Mavo.route]=Object.assign({},i[Mavo.route]),t[Mavo.route]=o.each(e[Mavo.route],(e,t)=>new Set(["$items"]))),a.push(t)}),Mavo.Data.proxify(a)},precedence:2},as:{symbol:"as",code:(e,t)=>{var i;return void 0!==e&&"array"===o.type(e)&&void 0!==t?(i=e.slice(),Array.isArray(t)||void 0===t?.[Mavo.toNode]?.property?"string"===o.type(t)?(i[Mavo.as]=t,i):void 0!==t[0]?.[Mavo.toNode]?.property?(i[Mavo.as]=t[0]?.[Mavo.toNode]?.property,i):e:(i[Mavo.as]=t?.[Mavo.toNode]?.property,i)):e},precedence:3}},getNumericalOperands:function(e,t){if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i&&r)return[i,r]}return[e,t]},childProperties:["arguments","callee","left","right","argument","elements","test","consequent","alternate","object","property","body"],walk:function(t,i,r={},e,s){var n;if(r.type&&t.type!==r.type||(n=i(t,e,s)),!r.ignore||-1===r.ignore.indexOf(t.type))if(Array.isArray(t))for(var a of t)u.walk(a,i,r,e,t);else u.childProperties.forEach(e=>{t[e]&&u.walk(t[e],i,r,e,t)});return void 0!==n&&s&&(s[e]=n),n},serializers:{BinaryExpression:e=>`${u.serialize(e.left,e)} ${e.operator} `+u.serialize(e.right,e),UnaryExpression:e=>""+e.operator+u.serialize(e.argument,e),CallExpression:t=>{t.callee;let e=t.callee,i=t,r="callee";for(;"MemberExpression"===e.type;)e=(i=e).object,r="object";if("MemberExpression"===t.callee.type&&"Identifier"===t.callee.property.type&&"call"===t.callee.property.name&&t.callee.object,"Identifier"===e.type){var s=e.name;if("scope"===s)return u.serializeScopeCall(t.arguments);s in Mavo.Script.$fn&&(i[r]={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$fn"},property:e})}return`${u.serialize(t.callee,t)}(${t.arguments.map(e=>u.serialize(e,t)).join(", ")})`},ConditionalExpression:e=>`${u.serialize(e.test,e)}? ${u.serialize(e.consequent,e)} : `+u.serialize(e.alternate,e),MemberExpression:(e,t)=>{let i=e,r;for(;("CallExpression"!==i.type||i.callee!==r)&&(i=(r=i).parent););var s;if(i)return s=e.computed?`[${u.serialize(e.property,e)}]`:"."+e.property.name,u.serialize(e.object,e)+s;i=e;let n=[],a,o;for(;"MemberExpression"===i.type;){var l=i.computed?u.serialize(i.property,i):`"${i.property.name}"`;n.push(l),o=i,a=i=i.object}return`$fn.get(${u.serialize(a,o)}, ${n.reverse().join(", ")})`},ArrayExpression:t=>`[${t.elements.map(e=>u.serialize(e,t)).join(", ")}]`,Literal:t=>{var i=t.raw[0];if("'"!==i&&'"'!==i)return t.raw;{let e=t.raw.slice(1,-1);return i+(e=(e=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n")).replaceAll(i,"\\"+i))+i}},Identifier:e=>e.name,ThisExpression:e=>"this",Compound:t=>t.body.map(e=>u.serialize(e,t)).join(", ")},transformations:{BinaryExpression:e=>{var t=u.getOperatorName(e.operator),i=u.operators[t],r=(i.transformation?.(e),e),s={type:"CallExpression",arguments:[],callee:{type:"Identifier",name:t}};if(i.comparison){var n=[];do{var a=u.getOperatorName(r.operator);n.unshift({comparison:a,operand:r.right}),r=r.left}while(!1!==i.flatten&&u.isComparisonOperator(r.operator));let t=!1;for(let e=0;e<n.length-1;e++)if(n[e].comparison!=n[e+1].comparison){t=!0;break}s.arguments.push(r),t?(s.callee.name="compare",n.forEach(e=>{s.arguments.push({type:"Literal",value:e.comparison,raw:`"${e.comparison}"`}),s.arguments.push(e.operand)})):n.forEach(e=>{s.arguments.push(e.operand)})}else{for(;s.arguments.unshift(r.right),r=r.left,!1!==i.flatten&&r.right&&u.getOperatorName(r.operator)===t;);s.arguments.unshift(r)}return i.postFlattenTransformation?.(s),s},UnaryExpression:e=>{var t=u.getOperatorName(e.operator,!0);if(t)return{type:"CallExpression",arguments:[e.argument],callee:{type:"Identifier",name:t}}},CallExpression:t=>{if("Identifier"==t.callee.type)if("if"==t.callee.name){t.callee.name="iff";var i=t.arguments[0];for(let e=1;e<t.arguments.length;e++)2==e&&(i=u.parse("not()")).arguments.push(t.arguments[0]),u.walk(t.arguments[e],e=>{var t=e.callee.name;Mavo.Actions.Functions.hasOwnProperty(t)&&!/if$/.test(t)&&(e.callee.name+="if",e.arguments.unshift(i))},{type:"CallExpression"})}else{var e;"delete"==t.callee.name?t.callee.name="clear":(e=Mavo.Functions[t.callee.name])&&e.needsContext&&(t.callee={type:"MemberExpression",computed:!1,object:t.callee,property:{type:"Identifier",name:"call"}},t.arguments.unshift({type:"Identifier",name:"$this"}))}},ThisExpression:e=>({type:"Identifier",name:"$this"})},closest(e,t){let i=e;do{if(i.type===t)return i}while(i=i.parent);return null},serialize:(e,t)=>{if("string"==typeof e)return e;t&&(e.parent=t);var i=u.transformations[e.type]?.(e,t);if("object"==typeof i&&i?.type)e=i;else if(void 0!==i)return i;if(e.type&&u.serializers[e.type])return u.serializers[e.type](e,t);throw new TypeError("Cannot understand this expression at all 😔")},rewrite:function(e,t){e=u.parse(e);return t&&(t.ast=e),u.serialize(e)},compile:function(e,t){return/\S/.test(e)?(e=`with (Mavo.Data.stub)
	with (data || {}) {
		let $fn = Mavo.Script.$fn;
		return (${e=u.rewrite(e,t)});
	}`,t?.actions&&(e=`
Mavo.Actions._running = Mavo.Actions.running;
Mavo.Actions.running = true;
${e}
Mavo.Actions.running = Mavo.Actions._running;`),new Function("data",e)):()=>""},parse:self.jsep,serializeScopeCall:e=>{var t=`with (Mavo.Script.subScope(scope, $this) || {}) { return (${u.serialize(e[1])}); }`;return`(function() {
	var scope = ${u.serialize(e[0])};
	if (Array.isArray(scope)) {
		return scope.map(function(scope) {
			${t}
		});
	}

	${t}
})()`},subScope:(e,t)=>{var r=Object.keys(t).reduce((e,t)=>(e[t]=!0,e),{$this:!0});return e&&"object"==typeof e?new Proxy(e,{get:(e,t,i)=>t===Symbol.unscopables?r:Reflect.get(e,t,i)}):e}};for(e in u.serializers.LogicalExpression=u.serializers.BinaryExpression,u.transformations.LogicalExpression=u.transformations.BinaryExpression,u.operators){var t,i=u.operators[e];t=i.scalar?.length<2?u.addUnaryOperator(e,i):u.addBinaryOperator(e,i),i.code=i.code||t,t&&!1!==i.export&&(Mavo.Functions[e]=t)}Mavo.Functions.compare=function(...t){let i=!0;for(let e=2;e<t.length;e+=2){var r=t[e-2],s=t[e-1],n=t[e],r=u.binaryOperation(r,n,Mavo.Script.operators[s]);i=u.binaryOperation(i,r,Mavo.Script.operators.and)}return i}}(Bliss,Mavo.value,Mavo.Functions.util),!function(a){Mavo.attributes.push("mv-action");let o=Mavo.Actions={listener:e=>{var t,i="submit"===e.type?"form":":not(form)",i=e.target.closest(i+"[mv-action]");!i||(t=Mavo.Node.get(i))&&t.editing&&"edit"!==t.modes||("submit"===e.type&&e.preventDefault(),i&&o.run(i.getAttribute("mv-action"),i,e))},run:(e,t,i)=>{if(e){var r,t=Mavo.Node.getClosest(t);if(t)return e=new Mavo.Expression(e,{actions:!0}),r=Mavo.Functions.$evt,Mavo.Functions.$evt=i,i=e.eval(t.getLiveData()),Mavo.Functions.$evt=r,i}},getNodes:e=>{var t=o.getNode(e);return t?[t]:Mavo.toArray(e).map(e=>o.getNode(e)).filter(e=>void 0!==e)},getNode:e=>e instanceof Mavo.Node?e:e?.[Mavo.toNode]?e[Mavo.toNode]:void 0,getCollection:e=>{e=o.getNode(e);return e instanceof Mavo.Collection?e:e?.collection??null},nope:()=>{var e=Object.keys(o.Functions).map(e=>e+"()");Mavo.warn(`Mavo actions (${e}) can only be used in the mv-action attribute.`)},Functions:{add:Object.assign(function(e,t,i){let r=[...arguments],s;var n;if(arguments.length<3&&(arguments.length<=1?[e,t]=[void 0,e]:2!==arguments.length||(s=o.getCollection(t))||(s=o.getCollection(e))&&([e,t,i]=[void 0,e,t])),t)return(s=s||o.getCollection(t))||(s=o.getCollection(this))&&([e,i]=r),s?(void 0===i&&(n=o.getNode(t))&&n.collection===s&&(i=n.index),(Array.isArray(e)?e:[e]).map(e=>{var t=s.add(void 0,i);return void 0!==e&&t.render(e),s.editing&&s.editItem(t),t.getLiveData()})):(Mavo.warn("No collection or collection item provided to add().",{once:!1}),e)},{needsContext:!0}),move:(t,i,r)=>{if(t&&void 0!==i){let e=o.getNode(i);"number"!=a.type(i)||e?.collection||([r,i]=[i],e=void 0);var s,i=Mavo.toArray(t).map(o.getNode).filter(e=>e?.closestCollection),n=(e||i[0]).closestCollection;return i.length?(s=o.Functions.add(t,n,r),Mavo.Collection.delete(i,{silent:!0}),s):n?(Mavo.warn("First parameter of move() was not a collection or collection item, using add() instead.",{once:!1}),o.Functions.add(t,n,r)):(Mavo.warn("You need to provide at least one collection or collection item for move() to have something to do.",{once:!1}),t)}},clear:(...t)=>{if(t.length&&t[0]){t=o.getNodes(t.flat());let e=[];return t.forEach(t=>{t&&(t instanceof Mavo.Collection?e.push(...t.children):t.collection?e.push(t):t.walk(e=>{e instanceof Mavo.Primitive?e.value=null:e!==t&&o.Functions.clear(e)}))}),Mavo.Collection.delete(e),t.map(e=>e.getLiveData())}},clearif:(t,...e)=>(e=e.map(e=>Mavo.Functions.iff(t,e)),o.Functions.clear(...e)),set:(e,t)=>{var i,r;if(e)return(i=o.getNode(e))?i.render(t):(i=Array.isArray(e),(r=o.getNodes(e)).length?Mavo.Script.binaryOperation(i?r:r[0],t,{scalar:(e,t)=>e?e.render(t):null}):Mavo.warn(`The first parameter of set() needs to be one or more existing properties, ${Mavo.safeToJSON(e)} is not.`)),t}}};for(let r in o.Functions){var e=r+"if";e in o.Functions||(o.Functions[e]=(e,t,...i)=>(t=Mavo.Functions.iff(e,t),Mavo.value(e)?o.Functions[r](t,...i):null))}o.Functions.deleteif=o.Functions.clearif}(Bliss,Bliss.$),!function(n){var l=Mavo.Data=n.Class(class{constructor(e,t){this.node=e,void 0!==t&&(this.data=t)}get parent(){return this.node.parent?.liveData??null}get collection(){return this.node.collection}get key(){return this._key=this.collection?this.node.index:this.node.property}proxify(){return l.proxify(this.data)}update(){if(this.node instanceof Mavo.Collection||this.node instanceof Mavo.ImplicitCollection){for(var e=this.data.length=0;e<this.node.children.length;e++)this.data[e]=this.node.children[e].liveData.data;if(this.node instanceof Mavo.ImplicitCollection){for(e=0;e<this.data.length;e++)null===Mavo.value(this.data[e])&&(this.data.splice(e,1),e--);this.updateParent()}}else{var t;this.node instanceof Mavo.Primitive&&(t=this.node.value,this.node.isDataNull({live:!0})&&(t=null),this.data=Mavo.objectify(t),(Mavo.isPlainObject(t)||Array.isArray(t))&&l.computeRoutes(this.data),this.updateParent())}}updateParent(){var e,t;this.parent&&(this.node instanceof Mavo.ImplicitCollection?(e=1===this.data.length?this.data[0]:this.data,this.parent.set(this.node.property,e,!0)):this.collection instanceof Mavo.ImplicitCollection?this.parent.update():(e=this.key,t=!1,this.collection instanceof Mavo.Collection&&(t=this.collection.children[this.node.index]!==this.node),void 0===e||t||this.parent.set(e,this.data,!0)))}set(e,t,i){this.data[e]=t,l["computeRoute"+(i?"":"s")](t,e,this.data)}updateKey(){var e=this._key;this.parent[e]===this.data&&delete this.parent[e],this.updateParent()}resolve(e){return l.resolve(e,this.data)}},{live:{data:function(e){if(e!==this._data)return this.isArray=Array.isArray(e),(this._data=e)[Mavo.toNode]=this.node,e[Mavo.parent]=this.parent?.data,e[Mavo.mavo]=this.node.mavo,this.proxy=this.proxify(),this.updateParent(),this._data}},static:{stub:self.Proxy?new Proxy({[Symbol.unscopables]:{data:!0,undefined:!0}},{get:(e,t)=>{e=Reflect.get(e,t);if(void 0!==e||"string"!=typeof t)return e;e=t.toLowerCase();if("$"===e[0]&&e in Mavo.Functions)return Mavo.Functions[e];e=t.toUpperCase();if(e in Math)return Math[e];if("undefined"!=typeof window&&window.hasOwnProperty(t))return window[t];if("$"!==t[0]){e="$"+t.toLowerCase();if(e in Mavo.Functions)return Mavo.Functions[e]}return t},has:(e,t)=>Reflect.has(e,t)||"string"==typeof t}):Mavo.Functions,isItem(e){return Array.isArray(e?.[Mavo.parent])},isCollection(e){return Array.isArray(e)&&e?.[Mavo.toNode]instanceof Mavo.Collection},closest(e,t){var i=[];do{if(t(e))return{value:e,path:i}}while(i.push(e[Mavo.property]),e=e[Mavo.parent]);return{value:null,path:i}},root(e){return l.closest(e,e=>!e[Mavo.parent])},closestItem(e){return l.closest(e,l.isItem)},closestArray(e){return l.closest(e,Array.isArray)},getProperty(e){return(l.isItem(e)?e[Mavo.parent]:e)[Mavo.property]},find(i,r,s={}){if(r&&s.exclude!==r){if(Mavo.in(i,r)&&s.exclude!==r[i])return r[i];if(r[Mavo.route]&&Mavo.in(i,r[Mavo.route])){var e,n=[],a=Array.isArray(r),t=(n[Mavo.route]={},n[Mavo.mavo]=r[Mavo.mavo],e=>{e=l.find(i,r[e],s);if(void 0!==e){if(Mavo.in(Mavo.route,e))for(var t in e[Mavo.route])n[Mavo.route][t]=!0;Array.isArray(e)?(n.push(...e),a=!0):n.push(e)}});if(Array.isArray(r)||!0===r[Mavo.route][i])for(var o in r)t(o);else r[Mavo.route][i].forEach(t);return a||1<n.length?n:n[0]}return r[Mavo.property]===i||l.isItem(r)&&l.getProperty(r)===i?r:Array.isArray(r)&&(e=r.map(e=>l.find(i,e)).filter(e=>void 0!==e)).length?e.flat():void 0}},findUp(e,t){let i=t,r;var s=l.isCollection(t);do{if(!l.isCollection(i)||s){var n=l.find(e,i,{exclude:r});if(void 0!==n)return n;if(l.getProperty(i)===e)return i}}while(i=(r=i)[Mavo.parent])},resolve(e,t){if(e===Mavo.isProxy)return!0;if("symbol"==typeof e)return t[e];var i,r,s=!isNaN(e);if(e in t)i=t[e];else{if(l.isCollection(t)&&t[Mavo.property]===e)return t;s||(e in l.special?i=l.special[e](t):t[Mavo.mavo]?(n=t[Mavo.mavo].root.liveData.data[Mavo.route],Mavo.in(e,n)&&(i=l.findUp(e,t))):Mavo.in(Mavo.route,t)&&Mavo.in(e,t[Mavo.route])&&(i=l.find(e,t)))}if(s||(r=e.toLowerCase()),void 0!==i)return null!==i&&"object"==typeof i&&(Mavo.route in i||Mavo.toNode in i)?l.proxify(i):i;if(!s){if(isNaN(e)&&Mavo.all?.[e]?.root)return Mavo.all[e].root.getLiveData();if("$"!==e[0]){var n="$"+r;if(n in l.special)return l.resolve(n,t)}}},has(t,e){if(t===Mavo.isProxy)return!0;if("string"!=typeof t)return Reflect.has(e,t);if(l.getProperty(e)===t)return!0;var i=[e,Mavo.all,l.special];if(i.some(e=>t in e))return!0;if("string"==typeof t){var r=t.toLowerCase();if(r!==t&&i.some(e=>r in e))return!0;if("$"!==r[0]&&"$"+r in l.special)return!0}return e[Mavo.mavo]?Mavo.in(t,e[Mavo.mavo].root.liveData.data[Mavo.route]):void 0},proxify(e){return e&&"object"==typeof e&&self.Proxy&&!e[Mavo.isProxy]?new Proxy(e,{get:(e,t,i)=>l.resolve(t,e),has:(e,t)=>l.has(t,e),set:function(e,t="",i){return"symbol"!=typeof t?(Mavo.warn(`You cannot set data via expressions. Attempt to set ${t.toString()} to ${i} ignored.`),i):Reflect.set(e,t,i)}}):e},computeMetadata(e,t,i){e&&"object"==typeof e&&(void 0!==t&&(e[Mavo.property]=t),i)&&!e[Mavo.parent]&&(e[Mavo.parent]=i)},computeRoute(e,t,i){if("function"!=typeof e&&(l.computeMetadata(e,t,i),!Mavo.isPlainObject(e)&&!Array.isArray(e)||e[Mavo.route]||(e[Mavo.route]={}),"number"!==n.type(t)))for(var r=e;i;){i[Mavo.route]||(i[Mavo.route]={});var s=r?.[Mavo.property];if(s&&!0!==i[Mavo.route][t]){if(i[Mavo.route][t]||(i[Mavo.route][t]=new Set),i[Mavo.route][t].has(s))break;i[Mavo.route][t].add(s)}else i[Mavo.route][t]=!0;i=(r=i)[Mavo.parent]}},computeRoutes(e,t,i){l.traverse(l.computeRoute,e,t,i)},traverseDown(i,r,e,t){if(Array.isArray(r))r.forEach((e,t)=>l.traverse(i,e,t,r));else if(Mavo.isPlainObject(r))for(var s in r)l.traverse(i,r[s],s,r)},traverse(e,t,i,r){e(t,i,r),l.traverseDown(e,t,i,r)},special:{$index:function(e){var t,e=l.closestItem(e).value;return e?(t=e[Mavo.property],isNaN(t)?e[Mavo.parent].indexOf(e):t):-1},$item:function(e){return l.closestItem(e).value},$all:function(e){e=l.closestArray(e);let t=e.path.reverse(),i;[i,...t]=t;var r=e.value.map(e=>n.value(e,...t));return 0<r.length&&r?.[0]?.[Mavo.route]&&(r[Mavo.route]=n.each(r[0][Mavo.route],(e,t)=>!0),r[Mavo.mavo]=r[0][Mavo.mavo]),n.lazy(r,{$previous:function(){return r.slice(0,i)},$next:function(){return r.slice(i)}}),r},$next:function(e){var e=l.closestArray(e),t=e.path.reverse(),i=e.path[0],t=t.slice(1),e=e.value?.[i+1];return e?n.value(e,...t):null},$previous:function(e){var e=l.closestArray(e),t=e.path.reverse(),i=e.path[0],t=t.slice(1),e=e.value?.[i-1];return e?n.value(e,...t):null},$this:function(e){return e}}}})}(Bliss,Bliss.$),!function(r){function u(t){return new Promise(e=>setTimeout(e,t))}let h=Mavo.Backend.register(class extends Mavo.Backend{id="Github";devMode=!1;constructor(e,t){super(e,t),this.permissions.on(["login","read"]),this.login(!0)}update(e,t){super.update(e,t);e=this.format.constructor.extensions[0]||".json";this.defaults={repo:"mv-data",filename:""+this.mavo.id+e},this.info=h.parseURL(this.source,this.defaults);for(const i in t)["format","mavo"].includes(i)||("graphql"===this.info.apiCall&&"query"===i?this.info.apiData={query:t.query}:this.info[i]=t[i]);r.extend(this,this.info)}async get(i){if(!this.devMode){if(this.isAuthenticated()||!this.path||i){var r=i?h.parseURL(i):this.info;if(r.apiData)return this.request(r.apiCall,r.apiData,"POST").then(e=>e.errors?.length?Promise.reject(e.errors.map(e=>e.message).join("\n")):e.data);var s=void 0!==r.apiParams,n={responseType:s?"response":"json",headers:{Accept:"application/vnd.github.squirrel-girl-preview"}};let t=await this.request(r.apiCall,{ref:this.branch},"GET",n);if(s){var a=await t.json(),s=new URL(r.apiCall,this.constructor.apiDomain).searchParams;let e=s.get("max_pages")-1;if(0<e&&null===s.get("page")&&Array.isArray(a))do{if(!(o=t.headers.get("Link")?.match(/<(.+?)>; rel="next"/)?.[1]))break;if(!(t=await this.request(o,{ref:this.branch},"GET",n)).ok)break;var o=await t.json();if(!Array.isArray(o))break;a.push(...o)}while(0<--e);return a}return r.repo&&t.content?h.atob(t.content):t}{(i=new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch||"main"}/`+this.path)).searchParams.set("timestamp",Date.now());let e=await fetch(i.href);return e.ok?(this.branch=this.branch||"main",e.text()):404===e.status&&!this.branch&&(i.pathname=`/${this.username}/${this.repo}/master/`+this.path,(e=await fetch(i.href)).ok)?(this.branch="master",e.text()):null}}s=i?h.parseURL(i):this.info;fetch("/"+s.apiCall.split("/").slice(5).join("/")).then(function(e){if(e.ok)return e.text();throw new Error("Error: "+e.status)}).then(function(e){return e})}upload(e,r=this.path){return Mavo.readFile(e).then(e=>{let t=e.slice(5),i=t.match(/^\w+\/[\w+]+/)[0];return i=i.replace("+","\\+"),t=t.replace(RegExp(`^${i}(;base64)?,`),""),r=this.path.replace(/[^/]+$/,"")+r,this.put(t,r,{isEncoded:!0})}).then(e=>this.getURL(r,e.commit.sha))}async put(s,n=this.path,a={}){if(n){var o=`repos/${this.username}/`+this.repo;let i=o+"/contents/"+n;var l=this.mavo.element.getAttribute("mv-github-commit-prefix")||"";s=a.isEncoded?s:h.btoa(s);let r=await this.repoInfo;if(!r||r.owner.login!==this.username||r.name!==this.repo)try{r=await this.request(o),this.branch??=r.default_branch}catch(e){404===e.status&&(r=this.repoInfo=await this.request("user/repos",{name:this.repo,private:!!(this.options.private??a.private)},"POST"))}if(!this.canPush()){let e=await this.request(o+"/forks",{name:this.repo},"POST");i=`repos/${e.full_name}/contents/`+n,this.forkInfo=e;let t;for(;await u(1e3),!(t=await this.request(`repos/${e.full_name}/commits`,{until:"1970-01-01T00:00:00Z"},"HEAD")););r=e=t}let t;try{t=await this.request(i,{ref:this.branch}),t=await this.request(i,{message:l+this.mavo._("gh-updated-file",{name:t.name||"file"}),content:s,branch:this.branch,sha:t.sha},"PUT")}catch(e){404==e.status&&(t=await this.request(i,{message:l+"Created file",content:s,branch:this.branch},"PUT"))}a={context:this,fileInfo:t};return Mavo.hooks.run("gh-after-commit",a),a.fileInfo}}login(e){return this.oAuthenticate(e).then(()=>this.getUser()).catch(e=>{401==e.status&&this.logout()}).then(e=>{if(this.user&&(this.permissions.on("logout"),this.info.path&&this.permissions.on(["edit","save"]),this.repo))return this.request(`repos/${this.username}/`+this.repo).then(r=>{if((this.branch??=r.default_branch,this.repoInfo=r,!this.mavo.source)&&!this.canPush())return this.user.info.public_repos<r.forks?this.request("https://api.github.com/graphql",{query:`query {
													  viewer {
													    name
													      repositories(last: 100, isFork: true) {
													      nodes {
													        url
													        parent {
													          nameWithOwner
													        }
													      }
													    }
													  }
													}`},"POST").then(e=>{var t,i=e.data.viewer.repositories.nodes;for(t in i)if(i[t].parent.nameWithOwner===r.full_name)return this.switchToMyForkDialog(i[t].url),r;return r}):this.request(r.forks_url).then(e=>{for(var t in e)if(e[t].owner.login===this.user.username)return this.switchToMyForkDialog(e[t].html_url),r;return r});return r}).then(e=>{e={context:this,repoInfo:e};return Mavo.hooks.run("gh-after-login",e),e.repoInfo})})}canPush(){return this.repoInfo?this.repoInfo.permissions.push:this.user?.username?.toLowerCase()==this.username.toLowerCase()}oAuthParams=()=>"&scope=repo";logout(){return this.oAuthLogout().then(()=>{this.user=null})}getUser(){return this.user?Promise.resolve(this.user):this.request("user").then(e=>{this.user={username:e.login,name:e.name||e.login,avatar:e.avatar_url,url:"https://github.com/"+e.login,info:e},r.fire(this,"mv-login")})}getURL(t=this.path,i){var e=this.forkInfo||this.repoInfo;let r=e.full_name;return t=t.replace(/ /g,"%20"),e.pagesInfo=e.pagesInfo||this.request(`repos/${r}/pages`,{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}),e.pagesInfo.then(e=>e.html_url+t).catch(e=>`https://cdn.jsdelivr.net/gh/${r}@${i||this.branch||"latest"}/`+t)}switchToMyForkDialog(e){let t=new URL(location).searchParams;t.append(this.mavo.id+"-storage",e+"/"+this.path),this.notice=this.mavo.message(`
			${this.mavo._("gh-login-fork-options")}
			<form onsubmit="return false">
				<a href="${location.pathname}?${t}"><button>${this.mavo._("gh-use-my-fork")}</button></a>
			</form>`,{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(e=>{e&&(history.pushState({},"",location.pathname+"?"+t),location.replace(location.pathname+"?"+t))})}static apiDomain="https://api.github.com/";static oAuth="https://github.com/login/oauth/authorize";static key="7e08e016048000bc594e";static test(e){return e=new URL(e,Mavo.base),/^((api\.)?github\.com|raw\.githubusercontent\.com)/.test(e.host)}static parseURL(e,t={}){var i={},r=(Object.defineProperties(i,{apiCall:{get(){let e=`repos/${this.username}/${this.repo}/`+(this.resources??"contents");var t=this.path;return t&&(e+="/"+t),e+(this.apiParams??"")},set(e){delete this.apiCall,this.apiCall=e},configurable:!0,enumerable:!0},path:{get(){return this.filename?(this.filepath?this.filepath+"/":"")+this.filename:this.filepath},set(e){delete this.path,this.path=e},configurable:!0,enumerable:!0}}),new URL(e,Mavo.base));let s=r.pathname.slice(1).split("/");if(i.username=s.shift(),i.repo=s.shift()||t.repo,/raw.githubusercontent.com$/.test(r.host))i.branch=s.shift();else if(/api.github.com$/.test(r.host)){delete i.username,delete i.repo,i.apiParams=r.search,i.apiData=Mavo.Functions.from(e,"#");e=r.pathname.slice(1)+i.apiParams;if("graphql"==e)return i.apiCall=e,i.apiData={query:i.apiData},i;if("repos"!=(s=r.pathname.slice(1).split("/")).shift())return i.apiCall=e,i;i.username=s.shift(),i.repo=s.shift(),i.resources=s.shift()}else"blob"==s[0]&&(s.shift(),i.branch=s.shift());r=s[s.length-1];return/\.\w+$/.test(r)?(i.filename=r,s.splice(s.length-1,1)):i.filename=i.hasOwnProperty("apiParams")?"":t.filename,i.filepath=s.join("/")||t.filepath||"",i}static btoa=e=>btoa(unescape(encodeURIComponent(e)));static atob=e=>decodeURIComponent(escape(window.atob(e)))})}(Bliss,Bliss.$),!function(e){const r={newdocument:"core",bold:"core",italic:"core",underline:"core",strikethrough:"core",alignleft:"core",aligncenter:"core",alignright:"core",alignjustify:"core",alignnone:"core",styleselect:"core",formatselect:"core",fontselect:"core",fontsizeselect:"core",cut:"core",copy:"core",paste:"core",outdent:"core",indent:"core",blockquote:"core",undo:"core",redo:"core",removeformat:"core",subscript:"core",superscript:"core",visualaid:"core",insert:"core",hr:"hr",bullist:"lists",numlist:"lists",link:"link",unlink:"link",openlink:"link",image:"image",charmap:"charmap",pastetext:"paste",print:"print",preview:"preview",anchor:"anchor",pagebreak:"pagebreak",spellchecker:"spellchecker",searchreplace:"searchreplace",visualblocks:"visualblocks",visualchars:"visualchars",code:"code",help:"help",fullscreen:"fullscreen",insertdatetime:"insertdatetime",media:"media",nonbreaking:"nonbreaking",save:"save",cancel:"save",table:"table",tabledelete:"table",tablecellprops:"table",tablemergecells:"table",tablesplitcells:"table",tableinsertrowbefore:"table",tableinsertrowafter:"table",tabledeleterow:"table",tablerowprops:"table",tablecutrow:"table",tablecopyrow:"table",tablepasterowbefore:"table",tablepasterowafter:"table",tableinsertcolbefore:"table",tableinsertcolafter:"table",tabledeletecol:"table",rotateleft:"imagetools",rotateright:"imagetools",flipv:"imagetools",fliph:"imagetools",editimage:"imagetools",imageoptions:"imagetools",fullpage:"fullpage",ltr:"directionality",rtl:"directionality",emoticons:"emoticons",template:"template",forecolor:"textcolor",backcolor:"textcolor",toc:"toc"};let i,s;Mavo.Plugins.register("tinymce",{ready:e.include(self.tinymce,"/res/js/lib/tinymce-4.9.11.min.js").then(()=>{i=new tinymce.html.DomParser,s=new tinymce.html.Serializer})}),Mavo.Elements.register(".tinymce",{hasChildren:!0,default:!0,edit:function(){(this.preEdit||Promise.resolve()).then(e=>{if("abort"!==e)if(this.element.tinymce)tinymce.EditorManager.execCommand("mceAddEditor",!0,this.element.tinymce.id);else{var e=this.element.getAttribute("mv-tinymce-toolbar")?.trim()||"styleselect | bold italic | image link | table | bullist numlist",t=e.split("|").filter(e=>e.length).join(" ").split(/\s+/);const i=new Set;i.add("tabfocus"),t.forEach(e=>{var t=r[e];t?i.add(t):Mavo.warn(`Button with the name "${e}" can't be added to the toolbar since it is not supported by the TinyMCE plugin.`)}),i.delete("core"),tinymce.init({target:this.element,inline:!0,menubar:!1,toolbar:e,plugins:Array.from(i).join(" ")}).then(e=>{this.element.tinymce=e[0],this.element.tinymce.on("change keyup paste cut",e=>{this.value=this.getValue()})})}})},done:function(){this.element.tinymce&&tinymce.EditorManager.execCommand("mceRemoveEditor",!0,this.element.tinymce.id)},getValue:e=>e.tinymce?e.tinymce.getContent():e.innerHTML,setValue:(e,t)=>{t=s.serialize(i.parse(t));e.tinymce?e.tinymce.isHidden()&&e.tinymce.setContent(t):e.innerHTML=t}})}(Bliss),Mavo.Locale.register("fr",{second:"seconde",seconds:"secondes",minute:"minute",minutes:"minutes",hour:"heure",hours:"heures",day:"jour",days:"jours",week:"semaine",weeks:"semaines",month:"mois",months:"mois",year:"année",years:"années",edit:"Modifier",editing:"Modification",save:"Enregistrer",import:"Import",export:"Export",clear:"Vider",logout:"Déconnexion",login:"Connexion",loading:"Chargement",uploading:"Téléchargement",saving:"Enregistrement",dismiss:"Abandonner","logged-in-as":"Connecté à {id} en tant que ","login-to":"Se connecter à {id}","error-uploading":"Erreur lors de l’envoi du fichier","cannot-load-uploaded-file":"Erreur lors du chargement du fichier envoyé",filename:"Nom du fichier ?","problem-saving":"Erreur lors de l’enregistrement des données","problem-loading":"Erreur lors du chargement des données","cannot-parse":"Ce fichier ne peut pas être lu correctement","http-error":"Erreur HTTP {status} : {statusText}","cant-connect":"Connexion à Internet impossible","add-item":"Ajouter {name}","add-item-before":"Ajouter un nouvel élément {name} avant","add-item-after":"Ajouter un nouvel élément {name} après","drag-to-reorder":"Faire glisser pour réordonner les {name}","delete-item":"Supprimer ce {name}","item-deleted":"{name} supprimé","n-items":"{n} éléments {name}",undo:"Défaire","delete-confirmation":"Toutes vos données vont être supprimées. Êtes-vous sûr ?","gh-updated-file":"{name} mis à jour","gh-edit-suggestion-saved-in-profile":'Vos modifications vont être enregistrées sur <a href="{previewURL}" target="_blank">votre profil</a>, car vous n’avez pas le droit de modifier cette page.',"gh-edit-suggestion-instructions":"Écrivez une description courte de vos modifications ci-dessous pour les suggérer aux administrateurs","gh-edit-suggestion-notreviewed":"Vous aviez choisi de suggérer les modifications aux administrateurs. Celles-ci n'ont pas encore été vérifiées.","gh-edit-suggestion-send":"Envoyer une suggestion de modification","gh-edit-suggestion-revoke":"Annuler votre suggestion de modification","gh-edit-suggestion-reason-placeholder":"J’ai ajouté / corrigé / supprimé ...","gh-edit-suggestion-cancelled":"Suggestion de modification correctement annulée !","gh-edit-suggestion-title":"Suggérer des modifications aux données","gh-edit-suggestion-body":`Bonjour ! J'ai utilisé Mavo pour vous suggérer les modifications suivantes :
{description}
Prévisualisez mes changements ici : {previewURL}`,"gh-edit-suggestion-sent":"Suggestion de modification correctement envoyée !","gh-login-fork-options":"Vous avez une version de cette page, voulez-vous l’utiliser ?","gh-use-my-fork":"Oui, utilise mes données."}),!function(r){Mavo.Plugins.register("cropper",{dependencies:["https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js","https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css","https://cdn.jsdelivr.net/gh/DmitrySharabin/mavo-cropper/mavo-cropper.css"],hooks:{"primitive-createuploadpopup-beforereturn":function(e){if("image"===e.kind){const t={viewMode:2,autoCrop:!1},i=this;this.options=this.element.getAttribute("mv-cropper-options"),this.options?this.options=r.extend(t,Mavo.options(this.options)):this.options=t,void 0===this.data&&e.popup.classList.add("cropper-no-image"),r.create("div",{className:"cropper-wrapper",contents:[{tag:"img",src:this.data||"",alt:this.mavo._("cropper-image-preview"),className:"cropper-preview",style:{maxWidth:this.element.offsetWidth+"px",maxHeight:this.element.offsetHeight+"px"}}],inside:e.popup}),this.cropper=new Cropper(r(".cropper-preview",e.popup),this.options),r.create("div",{className:"cropper-bar",inside:e.popup}),this.cropper.options.rotatable&&(r.create("button",{type:"button",className:"cropper-rotate-left",title:this.mavo._("cropper-rotate-left"),events:{click:()=>{this.cropper.rotate(-90)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-rotate-right",title:this.mavo._("cropper-rotate-right"),events:{click:()=>{this.cropper.rotate(90)}},inside:r(".cropper-bar",e.popup)})),this.cropper.options.scalable&&(r.create("button",{type:"button",className:"cropper-flip-horizontal",title:this.mavo._("cropper-flip-horizontal"),events:{click:()=>{this.cropper.scaleX(-this.cropper.getData().scaleX||-1)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-flip-vertical",title:this.mavo._("cropper-flip-vertical"),events:{click:()=>{this.cropper.scaleY(-this.cropper.getData().scaleY||-1)}},inside:r(".cropper-bar",e.popup)})),r.create("button",{type:"button",className:"cropper-crop",events:{click:function(){this.classList.toggle("cropper-crop-hidden"),this.classList.contains("cropper-crop-hidden")?(this.setAttribute("title",i.mavo._("cropper-show")),r(".cropper-aspect-ratio",e.popup).disabled=!0,i.cropper.setDragMode(),i.cropper.clear()):(this.setAttribute("title",i.mavo._("cropper-hide")),r(".cropper-aspect-ratio",e.popup).disabled=!1,i.cropper.setDragMode("crop"),i.cropper.crop())}},inside:r(".cropper-bar",e.popup)}),r.create("select",{className:"cropper-aspect-ratio",title:this.mavo._("cropper-aspect-ratio"),contents:[{tag:"option",value:NaN,textContent:this.mavo._("cropper-aspect-ratio-free")},{tag:"option",value:1,textContent:"1:1"},{tag:"option",value:4/3,textContent:"4:3"},{tag:"option",value:16/9,textContent:"16:9"},{tag:"option",value:2/3,textContent:"2:3"}],events:{change:e=>{"custom"===e.target.value?this.cropper.setAspectRatio(this.options.aspectRatio):this.cropper.setAspectRatio(e.target.value)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-upload",title:this.mavo._("cropper-upload"),events:{click:()=>{this.fileName=this.element.src.split("/").pop(),this.fileType="image/"+("png"===this.fileName.split(".")[1]?"png":"jpeg"),this.cropper.getCroppedCanvas("image/png"===this.fileType?{}:{fillColor:"#fff"}).toBlob(e=>{this.upload(e,this.fileName),this.updatePreview()},this.fileType)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-update",title:this.mavo._("cropper-update"),events:{click:()=>{this.updatePreview()}},inside:r(".cropper-bar",e.popup)}),this.cropper.options.autoCrop?(r.set(r(".cropper-crop",e.popup),{className:"cropper-crop",title:this.mavo._("cropper-hide")}),r.set(r(".cropper-aspect-ratio",e.popup),{disabled:!1}),this.cropper.options.aspectRatio&&r.set(document.createElement("option"),{value:"custom",textContent:this.mavo._("cropper-aspect-ratio-custom"),selected:!0,start:r(".cropper-aspect-ratio",e.popup)}),this.cropper.setDragMode(this.cropper.options.dragMode)):(r.set(r(".cropper-crop",e.popup),{className:"cropper-crop cropper-crop-hidden",title:this.mavo._("cropper-show")}),r(".cropper-aspect-ratio",e.popup).disabled=!0,this.cropper.options.dragMode="none"),r.bind(e.popup,"paste drop",()=>{this.updatePreview()}),r.bind(this.element,"paste drop",()=>{this.updatePreview()}),r.bind(r("input[type=url]",e.popup),"input",()=>{this.updatePreview()}),r.bind(r("input[type=file]",e.popup),"change",()=>{this.updatePreview()}),this.updatePreview=()=>{this.element.src?(r(".cropper-preview",e.popup).style.maxWidth=this.element.offsetWidth+"px",r(".cropper-preview",e.popup).style.maxHeight=this.element.offsetHeight+"px",this.cropper.replace(this.element.src),this.cropper.options.autoCrop?r("button.cropper-crop",r(".cropper-bar",e.popup)).classList.contains("cropper-crop-hidden")&&(this.cropper.options.dragMode="crop",r.fire(r("button.cropper-crop",r(".cropper-bar",e.popup)),"click")):r("button.cropper-crop",r(".cropper-bar",e.popup)).classList.contains("cropper-crop-hidden")||(this.cropper.options.dragMode="none",r.fire(r("button.cropper-crop",r(".cropper-bar",e.popup)),"click")),e.popup.classList.remove("cropper-no-image")):e.popup.classList.add("cropper-no-image")}}}}}),Mavo.Locale.register("en",{"cropper-image-preview":"Image preview","cropper-upload":"Upload Image","cropper-show":"Show Crop Box","cropper-hide":"Hide Crop Box","cropper-rotate-left":"Rotate Left","cropper-rotate-right":"Rotate Right","cropper-flip-horizontal":"Flip Horizontal","cropper-flip-vertical":"Flip Vertical","cropper-aspect-ratio":"Crop Box Aspect Ratio","cropper-aspect-ratio-free":"Free","cropper-aspect-ratio-custom":"Custom","cropper-update":"Update Preview"})}(Bliss),!function(){function F(e){var t=new F.Builder;return t.pipeline.add(F.trimmer,F.stopWordFilter,F.stemmer),t.searchPipeline.add(F.stemmer),e.call(t,t),t.build()}var t,u,h,c,d,p,m,v,f,g,y,b,x,M,w,E,A,k,C,S,L,O,P,e,i;function r(e){var t,i,r,s,n,a,o,l;return e.length<3||("y"==(l=e.substr(0,1))&&(e=l.toUpperCase()+e.substr(1)),a=f,(s=v).test(e)?e=e.replace(s,"$1$2"):a.test(e)&&(e=e.replace(a,"$1$2")),a=y,(s=g).test(e)?(o=s.exec(e),(s=c).test(o[1])&&(e=e.replace(s=b,""))):a.test(e)&&(n=(o=a.exec(e))[1],(a=m).test(n))&&(e=n,i=M,r=w,(a=x).test(e)?e+="e":i.test(e)?e=e.replace(s=b,""):r.test(e)&&(e+="e")),(s=E).test(e)&&(e=(n=(o=s.exec(e))[1])+"i"),(s=A).test(e)&&(n=(o=s.exec(e))[1],t=o[2],(s=c).test(n))&&(e=n+u[t]),(s=k).test(e)&&(n=(o=s.exec(e))[1],t=o[2],(s=c).test(n))&&(e=n+h[t]),a=S,(s=C).test(e)?(n=(o=s.exec(e))[1],(s=d).test(n)&&(e=n)):a.test(e)&&(n=(o=a.exec(e))[1]+o[2],(a=d).test(n))&&(e=n),(s=L).test(e)&&(n=(o=s.exec(e))[1],a=p,i=P,(s=d).test(n)||a.test(n)&&!i.test(n))&&(e=n),a=d,(s=O).test(e)&&a.test(e)&&(e=e.replace(s=b,"")),"y"==l&&(e=l.toLowerCase()+e.substr(1))),e}F.version="2.3.9",(F.utils={}).warn=(t=this,function(e){t.console&&console.warn&&console.warn(e)}),F.utils.asString=function(e){return null==e?"":e.toString()},F.utils.clone=function(e){if(null==e)return e;for(var t=Object.create(null),i=Object.keys(e),r=0;r<i.length;r++){var s=i[r],n=e[s];if(Array.isArray(n))t[s]=n.slice();else{if("string"!=typeof n&&"number"!=typeof n&&"boolean"!=typeof n)throw new TypeError("clone is not deep and does not support nested objects");t[s]=n}}return t},(F.FieldRef=function(e,t,i){this.docRef=e,this.fieldName=t,this._stringValue=i}).joiner="/",F.FieldRef.fromString=function(e){var t=e.indexOf(F.FieldRef.joiner);if(-1===t)throw"malformed field ref string";var i=e.slice(0,t),t=e.slice(t+1);return new F.FieldRef(t,i,e)},F.FieldRef.prototype.toString=function(){return null==this._stringValue&&(this._stringValue=this.fieldName+F.FieldRef.joiner+this.docRef),this._stringValue},(F.Set=function(e){if(this.elements=Object.create(null),e){this.length=e.length;for(var t=0;t<this.length;t++)this.elements[e[t]]=!0}else this.length=0}).complete={intersect:function(e){return e},union:function(){return this},contains:function(){return!0}},F.Set.empty={intersect:function(){return this},union:function(e){return e},contains:function(){return!1}},F.Set.prototype.contains=function(e){return!!this.elements[e]},F.Set.prototype.intersect=function(e){var t,i=[];if(e===F.Set.complete)return this;if(e===F.Set.empty)return e;for(var r=this.length<e.length?(t=this,e):(t=e,this),s=Object.keys(t.elements),n=0;n<s.length;n++){var a=s[n];a in r.elements&&i.push(a)}return new F.Set(i)},F.Set.prototype.union=function(e){return e===F.Set.complete?F.Set.complete:e===F.Set.empty?this:new F.Set(Object.keys(this.elements).concat(Object.keys(e.elements)))},F.idf=function(e,t){var i,r=0;for(i in e)"_index"!=i&&(r+=Object.keys(e[i]).length);return Math.log(1+Math.abs((t-r+.5)/(r+.5)))},(F.Token=function(e,t){this.str=e||"",this.metadata=t||{}}).prototype.toString=function(){return this.str},F.Token.prototype.update=function(e){return this.str=e(this.str,this.metadata),this},F.Token.prototype.clone=function(e){return new F.Token((e=e||function(e){return e})(this.str,this.metadata),this.metadata)},(F.tokenizer=function(e,t){if(null==e)return[];if(Array.isArray(e))return e.map(function(e){return new F.Token(F.utils.asString(e).toLowerCase(),F.utils.clone(t))});for(var i=e.toString().toLowerCase(),r=i.length,s=[],n=0,a=0;n<=r;n++){var o,l=n-a;!i.charAt(n).match(F.tokenizer.separator)&&n!=r||(0<l&&((o=F.utils.clone(t)||{}).position=[a,l],o.index=s.length,s.push(new F.Token(i.slice(a,n),o))),a=n+1)}return s}).separator=/[\s\-]+/,(F.Pipeline=function(){this._stack=[]}).registeredFunctions=Object.create(null),F.Pipeline.registerFunction=function(e,t){t in this.registeredFunctions&&F.utils.warn("Overwriting existing registered function: "+t),e.label=t,F.Pipeline.registeredFunctions[e.label]=e},F.Pipeline.warnIfFunctionNotRegistered=function(e){e.label&&e.label in this.registeredFunctions||F.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},F.Pipeline.load=function(e){var i=new F.Pipeline;return e.forEach(function(e){var t=F.Pipeline.registeredFunctions[e];if(!t)throw new Error("Cannot load unregistered function: "+e);i.add(t)}),i},F.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach(function(e){F.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)},this)},F.Pipeline.prototype.after=function(e,t){F.Pipeline.warnIfFunctionNotRegistered(t);e=this._stack.indexOf(e);if(-1==e)throw new Error("Cannot find existingFn");this._stack.splice(e+=1,0,t)},F.Pipeline.prototype.before=function(e,t){F.Pipeline.warnIfFunctionNotRegistered(t);e=this._stack.indexOf(e);if(-1==e)throw new Error("Cannot find existingFn");this._stack.splice(e,0,t)},F.Pipeline.prototype.remove=function(e){e=this._stack.indexOf(e);-1!=e&&this._stack.splice(e,1)},F.Pipeline.prototype.run=function(e){for(var t=this._stack.length,i=0;i<t;i++){for(var r=this._stack[i],s=[],n=0;n<e.length;n++){var a=r(e[n],n,e);if(null!=a&&""!==a)if(Array.isArray(a))for(var o=0;o<a.length;o++)s.push(a[o]);else s.push(a)}e=s}return e},F.Pipeline.prototype.runString=function(e,t){e=new F.Token(e,t);return this.run([e]).map(function(e){return e.toString()})},F.Pipeline.prototype.reset=function(){this._stack=[]},F.Pipeline.prototype.toJSON=function(){return this._stack.map(function(e){return F.Pipeline.warnIfFunctionNotRegistered(e),e.label})},(F.Vector=function(e){this._magnitude=0,this.elements=e||[]}).prototype.positionForIndex=function(e){if(0==this.elements.length)return 0;for(var t=0,i=this.elements.length/2,r=i-t,s=Math.floor(r/2),n=this.elements[2*s];1<r&&(n<e&&(t=s),e<n&&(i=s),n!=e);)r=i-t,s=t+Math.floor(r/2),n=this.elements[2*s];return n==e||e<n?2*s:n<e?2*(s+1):void 0},F.Vector.prototype.insert=function(e,t){this.upsert(e,t,function(){throw"duplicate index"})},F.Vector.prototype.upsert=function(e,t,i){this._magnitude=0;var r=this.positionForIndex(e);this.elements[r]==e?this.elements[r+1]=i(this.elements[r+1],t):this.elements.splice(r,0,e,t)},F.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e=0,t=this.elements.length,i=1;i<t;i+=2){var r=this.elements[i];e+=r*r}return this._magnitude=Math.sqrt(e)},F.Vector.prototype.dot=function(e){for(var t,i,r=0,s=this.elements,n=e.elements,a=s.length,o=n.length,l=0,u=0;l<a&&u<o;)(t=s[l])<(i=n[u])?l+=2:i<t?u+=2:t==i&&(r+=s[l+1]*n[u+1],l+=2,u+=2);return r},F.Vector.prototype.similarity=function(e){return this.dot(e)/this.magnitude()||0},F.Vector.prototype.toArray=function(){for(var e=new Array(this.elements.length/2),t=1,i=0;t<this.elements.length;t+=2,i++)e[i]=this.elements[t];return e},F.Vector.prototype.toJSON=function(){return this.elements},u={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},h={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},i="[aeiouy]",e="[^aeiou][^aeiouy]*",c=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),d=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*[aeiouy][aeiou]*[^aeiou][^aeiouy]*"),p=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy][aeiou]*[^aeiou][^aeiouy]*([aeiouy][aeiou]*)?$"),m=new RegExp("^([^aeiou][^aeiouy]*)?[aeiouy]"),v=/^(.+?)(ss|i)es$/,f=/^(.+?)([^s])s$/,g=/^(.+?)eed$/,y=/^(.+?)(ed|ing)$/,b=/.$/,x=/(at|bl|iz)$/,M=new RegExp("([^aeiouylsz])\\1$"),w=new RegExp("^"+e+i+"[^aeiouwxy]$"),E=/^(.+?[^aeiou])y$/,A=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,k=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,C=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,S=/^(.+?)(s|t)(ion)$/,L=/^(.+?)e$/,O=/ll$/,P=new RegExp("^"+e+i+"[^aeiouwxy]$"),F.Pipeline.registerFunction(F.stemmer=function(e){return e.update(r)},"stemmer"),F.stopWordFilter=(F.generateStopWordFilter=function(e){var t=e.reduce(function(e,t){return e[t]=t,e},{});return function(e){if(e&&t[e.toString()]!==e.toString())return e}})(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),F.Pipeline.registerFunction(F.stopWordFilter,"stopWordFilter"),F.Pipeline.registerFunction(F.trimmer=function(e){return e.update(function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"")})},"trimmer"),(F.TokenSet=function(){this.final=!1,this.edges={},this.id=F.TokenSet._nextId,F.TokenSet._nextId+=1})._nextId=1,F.TokenSet.fromArray=function(e){for(var t=new F.TokenSet.Builder,i=0,r=e.length;i<r;i++)t.insert(e[i]);return t.finish(),t.root},F.TokenSet.fromClause=function(e){return"editDistance"in e?F.TokenSet.fromFuzzyString(e.term,e.editDistance):F.TokenSet.fromString(e.term)},F.TokenSet.fromFuzzyString=function(e,t){for(var i=new F.TokenSet,r=[{node:i,editsRemaining:t,str:e}];r.length;){var s,n,a,o,l,u,h=r.pop();0<h.str.length&&((o=h.str.charAt(0))in h.node.edges?s=h.node.edges[o]:(s=new F.TokenSet,h.node.edges[o]=s),1==h.str.length&&(s.final=!0),r.push({node:s,editsRemaining:h.editsRemaining,str:h.str.slice(1)})),0!=h.editsRemaining&&("*"in h.node.edges?n=h.node.edges["*"]:(n=new F.TokenSet,h.node.edges["*"]=n),0==h.str.length&&(n.final=!0),r.push({node:n,editsRemaining:h.editsRemaining-1,str:h.str}),1<h.str.length&&r.push({node:h.node,editsRemaining:h.editsRemaining-1,str:h.str.slice(1)}),1==h.str.length&&(h.node.final=!0),1<=h.str.length&&("*"in h.node.edges?a=h.node.edges["*"]:(a=new F.TokenSet,h.node.edges["*"]=a),1==h.str.length&&(a.final=!0),r.push({node:a,editsRemaining:h.editsRemaining-1,str:h.str.slice(1)})),1<h.str.length)&&(o=h.str.charAt(0),(l=h.str.charAt(1))in h.node.edges?u=h.node.edges[l]:(u=new F.TokenSet,h.node.edges[l]=u),1==h.str.length&&(u.final=!0),r.push({node:u,editsRemaining:h.editsRemaining-1,str:o+h.str.slice(2)}))}return i},F.TokenSet.fromString=function(e){for(var t=new F.TokenSet,i=t,r=0,s=e.length;r<s;r++){var n,a=e[r],o=r==s-1;"*"==a?(t.edges[a]=t).final=o:((n=new F.TokenSet).final=o,t.edges[a]=n,t=n)}return i},F.TokenSet.prototype.toArray=function(){for(var e=[],t=[{prefix:"",node:this}];t.length;){var i=t.pop(),r=Object.keys(i.node.edges),s=r.length;i.node.final&&(i.prefix.charAt(0),e.push(i.prefix));for(var n=0;n<s;n++){var a=r[n];t.push({prefix:i.prefix.concat(a),node:i.node.edges[a]})}}return e},F.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var e=this.final?"1":"0",t=Object.keys(this.edges).sort(),i=t.length,r=0;r<i;r++)var s=t[r],e=e+s+this.edges[s].id;return e},F.TokenSet.prototype.intersect=function(e){for(var t=new F.TokenSet,i=void 0,r=[{qNode:e,output:t,node:this}];r.length;)for(var i=r.pop(),s=Object.keys(i.qNode.edges),n=s.length,a=Object.keys(i.node.edges),o=a.length,l=0;l<n;l++)for(var u=s[l],h=0;h<o;h++){var c,d,p,m,v=a[h];v!=u&&"*"!=u||(c=i.node.edges[v],d=i.qNode.edges[u],p=c.final&&d.final,m=void 0,v in i.output.edges?(m=i.output.edges[v]).final=m.final||p:((m=new F.TokenSet).final=p,i.output.edges[v]=m),r.push({qNode:d,output:m,node:c}))}return t},F.TokenSet.Builder=function(){this.previousWord="",this.root=new F.TokenSet,this.uncheckedNodes=[],this.minimizedNodes={}},F.TokenSet.Builder.prototype.insert=function(e){var t=0;if(e<this.previousWord)throw new Error("Out of order word insertion");for(var i=0;i<e.length&&i<this.previousWord.length&&e[i]==this.previousWord[i];i++)t++;this.minimize(t);for(var r=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-1].child,i=t;i<e.length;i++){var s=new F.TokenSet,n=e[i];r.edges[n]=s,this.uncheckedNodes.push({parent:r,char:n,child:s}),r=s}r.final=!0,this.previousWord=e},F.TokenSet.Builder.prototype.finish=function(){this.minimize(0)},F.TokenSet.Builder.prototype.minimize=function(e){for(var t=this.uncheckedNodes.length-1;e<=t;t--){var i=this.uncheckedNodes[t],r=i.child.toString();r in this.minimizedNodes?i.parent.edges[i.char]=this.minimizedNodes[r]:(i.child._str=r,this.minimizedNodes[r]=i.child),this.uncheckedNodes.pop()}},(F.Index=function(e){this.invertedIndex=e.invertedIndex,this.fieldVectors=e.fieldVectors,this.tokenSet=e.tokenSet,this.fields=e.fields,this.pipeline=e.pipeline}).prototype.search=function(t){return this.query(function(e){new F.QueryParser(t,e).parse()})},F.Index.prototype.query=function(e){for(var t=new F.Query(this.fields),i=Object.create(null),r=Object.create(null),s=Object.create(null),n=Object.create(null),a=Object.create(null),o=0;o<this.fields.length;o++)r[this.fields[o]]=new F.Vector;e.call(t,t);for(o=0;o<t.clauses.length;o++){for(var l=t.clauses[o],u=null,h=F.Set.empty,u=l.usePipeline?this.pipeline.runString(l.term,{fields:l.fields}):[l.term],c=0;c<u.length;c++){var d=u[c],d=(l.term=d,F.TokenSet.fromClause(l)),p=this.tokenSet.intersect(d).toArray();if(0===p.length&&l.presence===F.Query.presence.REQUIRED){for(var m=0;m<l.fields.length;m++)n[C=l.fields[m]]=F.Set.empty;break}for(var v=0;v<p.length;v++)for(var f=p[v],g=this.invertedIndex[f],$=g._index,m=0;m<l.fields.length;m++){var y=g[C=l.fields[m]],b=Object.keys(y),x=f+"/"+C,M=new F.Set(b);if(l.presence==F.Query.presence.REQUIRED&&(h=h.union(M),void 0===n[C])&&(n[C]=F.Set.complete),l.presence==F.Query.presence.PROHIBITED)void 0===a[C]&&(a[C]=F.Set.empty),a[C]=a[C].union(M);else if(r[C].upsert($,l.boost,function(e,t){return e+t}),!s[x]){for(var w=0;w<b.length;w++){var E,A=b[w],k=new F.FieldRef(A,C),A=y[A];void 0===(E=i[k])?i[k]=new F.MatchData(f,C,A):E.add(f,C,A)}s[x]=!0}}}if(l.presence===F.Query.presence.REQUIRED)for(m=0;m<l.fields.length;m++)n[C=l.fields[m]]=n[C].intersect(h)}for(var C,S=F.Set.complete,L=F.Set.empty,o=0;o<this.fields.length;o++)n[C=this.fields[o]]&&(S=S.intersect(n[C])),a[C]&&(L=L.union(a[C]));var O=Object.keys(i),P=[],T=Object.create(null);if(t.isNegated())for(O=Object.keys(this.fieldVectors),o=0;o<O.length;o++){var k=O[o],N=F.FieldRef.fromString(k);i[k]=new F.MatchData}for(o=0;o<O.length;o++){var D,I,j=(N=F.FieldRef.fromString(O[o])).docRef;!S.contains(j)||L.contains(j)||(D=this.fieldVectors[N],D=r[N.fieldName].similarity(D),void 0!==(I=T[j])?(I.score+=D,I.matchData.combine(i[N])):(I={ref:j,score:D,matchData:i[N]},T[j]=I,P.push(I)))}return P.sort(function(e,t){return t.score-e.score})},F.Index.prototype.toJSON=function(){var e=Object.keys(this.invertedIndex).sort().map(function(e){return[e,this.invertedIndex[e]]},this),t=Object.keys(this.fieldVectors).map(function(e){return[e,this.fieldVectors[e].toJSON()]},this);return{version:F.version,fields:this.fields,fieldVectors:t,invertedIndex:e,pipeline:this.pipeline.toJSON()}},F.Index.load=function(e){var t={},i={},r=e.fieldVectors,s=Object.create(null),n=e.invertedIndex,a=new F.TokenSet.Builder,o=F.Pipeline.load(e.pipeline);e.version!=F.version&&F.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+F.version+"' does not match serialized index '"+e.version+"'");for(var l=0;l<r.length;l++){var u=(c=r[l])[0],h=c[1];i[u]=new F.Vector(h)}for(l=0;l<n.length;l++){var c,d=(c=n[l])[0],p=c[1];a.insert(d),s[d]=p}return a.finish(),t.fields=e.fields,t.fieldVectors=i,t.invertedIndex=s,t.tokenSet=a.root,t.pipeline=o,new F.Index(t)},(F.Builder=function(){this._ref="id",this._fields=Object.create(null),this._documents=Object.create(null),this.invertedIndex=Object.create(null),this.fieldTermFrequencies={},this.fieldLengths={},this.tokenizer=F.tokenizer,this.pipeline=new F.Pipeline,this.searchPipeline=new F.Pipeline,this.documentCount=0,this._b=.75,this._k1=1.2,this.termIndex=0,this.metadataWhitelist=[]}).prototype.ref=function(e){this._ref=e},F.Builder.prototype.field=function(e,t){if(/\//.test(e))throw new RangeError("Field '"+e+"' contains illegal character '/'");this._fields[e]=t||{}},F.Builder.prototype.b=function(e){this._b=e<0?0:1<e?1:e},F.Builder.prototype.k1=function(e){this._k1=e},F.Builder.prototype.add=function(e,t){var i=e[this._ref],r=Object.keys(this._fields);this._documents[i]=t||{},this.documentCount+=1;for(var s=0;s<r.length;s++){var n=r[s],a=this._fields[n].extractor,a=a?a(e):e[n],a=this.tokenizer(a,{fields:[n]}),o=this.pipeline.run(a),a=new F.FieldRef(i,n),l=Object.create(null);this.fieldTermFrequencies[a]=l,this.fieldLengths[a]=0,this.fieldLengths[a]+=o.length;for(var u=0;u<o.length;u++){var h=o[u];if(null==l[h]&&(l[h]=0),l[h]+=1,null==this.invertedIndex[h]){var c=Object.create(null);c._index=this.termIndex,this.termIndex+=1;for(var d=0;d<r.length;d++)c[r[d]]=Object.create(null);this.invertedIndex[h]=c}null==this.invertedIndex[h][n][i]&&(this.invertedIndex[h][n][i]=Object.create(null));for(var p=0;p<this.metadataWhitelist.length;p++){var m=this.metadataWhitelist[p],v=h.metadata[m];null==this.invertedIndex[h][n][i][m]&&(this.invertedIndex[h][n][i][m]=[]),this.invertedIndex[h][n][i][m].push(v)}}}},F.Builder.prototype.calculateAverageFieldLengths=function(){for(var e=Object.keys(this.fieldLengths),t=e.length,i={},r={},s=0;s<t;s++){var n=F.FieldRef.fromString(e[s]),a=n.fieldName;r[a]||(r[a]=0),r[a]+=1,i[a]||(i[a]=0),i[a]+=this.fieldLengths[n]}for(var o=Object.keys(this._fields),s=0;s<o.length;s++){var l=o[s];i[l]=i[l]/r[l]}this.averageFieldLength=i},F.Builder.prototype.createFieldVectors=function(){for(var e={},t=Object.keys(this.fieldTermFrequencies),i=t.length,r=Object.create(null),s=0;s<i;s++){for(var n=F.FieldRef.fromString(t[s]),a=n.fieldName,o=this.fieldLengths[n],l=new F.Vector,u=this.fieldTermFrequencies[n],h=Object.keys(u),c=h.length,d=this._fields[a].boost||1,p=this._documents[n.docRef].boost||1,m=0;m<c;m++){var v,f=h[m],g=u[f],y=this.invertedIndex[f]._index;void 0===r[f]?(v=F.idf(this.invertedIndex[f],this.documentCount),r[f]=v):v=r[f],f=(f=v*((this._k1+1)*g)/(this._k1*(1-this._b+this._b*(o/this.averageFieldLength[a]))+g))*d*p,g=Math.round(1e3*f)/1e3,l.insert(y,g)}e[n]=l}this.fieldVectors=e},F.Builder.prototype.createTokenSet=function(){this.tokenSet=F.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())},F.Builder.prototype.build=function(){return this.calculateAverageFieldLengths(),this.createFieldVectors(),this.createTokenSet(),new F.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:Object.keys(this._fields),pipeline:this.searchPipeline})},F.Builder.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},(F.MatchData=function(e,t,i){for(var r=Object.create(null),s=Object.keys(i||{}),n=0;n<s.length;n++){var a=s[n];r[a]=i[a].slice()}this.metadata=Object.create(null),void 0!==e&&(this.metadata[e]=Object.create(null),this.metadata[e][t]=r)}).prototype.combine=function(e){for(var t=Object.keys(e.metadata),i=0;i<t.length;i++){var r=t[i],s=Object.keys(e.metadata[r]);null==this.metadata[r]&&(this.metadata[r]=Object.create(null));for(var n=0;n<s.length;n++){var a=s[n],o=Object.keys(e.metadata[r][a]);null==this.metadata[r][a]&&(this.metadata[r][a]=Object.create(null));for(var l=0;l<o.length;l++){var u=o[l];null==this.metadata[r][a][u]?this.metadata[r][a][u]=e.metadata[r][a][u]:this.metadata[r][a][u]=this.metadata[r][a][u].concat(e.metadata[r][a][u])}}}},F.MatchData.prototype.add=function(e,t,i){if(e in this.metadata)if(t in this.metadata[e])for(var r=Object.keys(i),s=0;s<r.length;s++){var n=r[s];n in this.metadata[e][t]?this.metadata[e][t][n]=this.metadata[e][t][n].concat(i[n]):this.metadata[e][t][n]=i[n]}else this.metadata[e][t]=i;else this.metadata[e]=Object.create(null),this.metadata[e][t]=i},(F.Query=function(e){this.clauses=[],this.allFields=e}).wildcard=new String("*"),F.Query.wildcard.NONE=0,F.Query.wildcard.LEADING=1,F.Query.wildcard.TRAILING=2,F.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3},F.Query.prototype.clause=function(e){return"fields"in e||(e.fields=this.allFields),"boost"in e||(e.boost=1),"usePipeline"in e||(e.usePipeline=!0),"wildcard"in e||(e.wildcard=F.Query.wildcard.NONE),e.wildcard&F.Query.wildcard.LEADING&&e.term.charAt(0)!=F.Query.wildcard&&(e.term="*"+e.term),e.wildcard&F.Query.wildcard.TRAILING&&e.term.slice(-1)!=F.Query.wildcard&&(e.term=e.term+"*"),"presence"in e||(e.presence=F.Query.presence.OPTIONAL),this.clauses.push(e),this},F.Query.prototype.isNegated=function(){for(var e=0;e<this.clauses.length;e++)if(this.clauses[e].presence!=F.Query.presence.PROHIBITED)return!1;return!0},F.Query.prototype.term=function(e,t){var i;return Array.isArray(e)?e.forEach(function(e){this.term(e,F.utils.clone(t))},this):((i=t||{}).term=e.toString(),this.clause(i)),this},(F.QueryParseError=function(e,t,i){this.name="QueryParseError",this.message=e,this.start=t,this.end=i}).prototype=new Error,(F.QueryLexer=function(e){this.lexemes=[],this.str=e,this.length=e.length,this.pos=0,this.start=0,this.escapeCharPositions=[]}).prototype.run=function(){for(var e=F.QueryLexer.lexText;e;)e=e(this)},F.QueryLexer.prototype.sliceString=function(){for(var e,t=[],i=this.start,r=(this.pos,0);r<this.escapeCharPositions.length;r++)e=this.escapeCharPositions[r],t.push(this.str.slice(i,e)),i=e+1;return t.push(this.str.slice(i,this.pos)),this.escapeCharPositions.length=0,t.join("")},F.QueryLexer.prototype.emit=function(e){this.lexemes.push({type:e,str:this.sliceString(),start:this.start,end:this.pos}),this.start=this.pos},F.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1),this.pos+=1},F.QueryLexer.prototype.next=function(){var e;return this.pos>=this.length?F.QueryLexer.EOS:(e=this.str.charAt(this.pos),this.pos+=1,e)},F.QueryLexer.prototype.width=function(){return this.pos-this.start},F.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1),this.start=this.pos},F.QueryLexer.prototype.backup=function(){--this.pos},F.QueryLexer.prototype.acceptDigitRun=function(){for(var e,t;47<(t=(e=this.next()).charCodeAt(0))&&t<58;);e!=F.QueryLexer.EOS&&this.backup()},F.QueryLexer.prototype.more=function(){return this.pos<this.length},F.QueryLexer.EOS="EOS",F.QueryLexer.FIELD="FIELD",F.QueryLexer.TERM="TERM",F.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE",F.QueryLexer.BOOST="BOOST",F.QueryLexer.PRESENCE="PRESENCE",F.QueryLexer.lexField=function(e){return e.backup(),e.emit(F.QueryLexer.FIELD),e.ignore(),F.QueryLexer.lexText},F.QueryLexer.lexTerm=function(e){if(1<e.width()&&(e.backup(),e.emit(F.QueryLexer.TERM)),e.ignore(),e.more())return F.QueryLexer.lexText},F.QueryLexer.lexEditDistance=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(F.QueryLexer.EDIT_DISTANCE),F.QueryLexer.lexText},F.QueryLexer.lexBoost=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(F.QueryLexer.BOOST),F.QueryLexer.lexText},F.QueryLexer.lexEOS=function(e){0<e.width()&&e.emit(F.QueryLexer.TERM)},F.QueryLexer.termSeparator=F.tokenizer.separator,F.QueryLexer.lexText=function(e){for(;;){var t=e.next();if(t==F.QueryLexer.EOS)return F.QueryLexer.lexEOS;if(92==t.charCodeAt(0))e.escapeCharacter();else{if(":"==t)return F.QueryLexer.lexField;if("~"==t)return e.backup(),0<e.width()&&e.emit(F.QueryLexer.TERM),F.QueryLexer.lexEditDistance;if("^"==t)return e.backup(),0<e.width()&&e.emit(F.QueryLexer.TERM),F.QueryLexer.lexBoost;if("+"==t&&1===e.width())return e.emit(F.QueryLexer.PRESENCE),F.QueryLexer.lexText;if("-"==t&&1===e.width())return e.emit(F.QueryLexer.PRESENCE),F.QueryLexer.lexText;if(t.match(F.QueryLexer.termSeparator))return F.QueryLexer.lexTerm}}},(F.QueryParser=function(e,t){this.lexer=new F.QueryLexer(e),this.query=t,this.currentClause={},this.lexemeIdx=0}).prototype.parse=function(){this.lexer.run(),this.lexemes=this.lexer.lexemes;for(var e=F.QueryParser.parseClause;e;)e=e(this);return this.query},F.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]},F.QueryParser.prototype.consumeLexeme=function(){var e=this.peekLexeme();return this.lexemeIdx+=1,e},F.QueryParser.prototype.nextClause=function(){var e=this.currentClause;this.query.clause(e),this.currentClause={}},F.QueryParser.parseClause=function(e){var t=e.peekLexeme();if(null!=t)switch(t.type){case F.QueryLexer.PRESENCE:return F.QueryParser.parsePresence;case F.QueryLexer.FIELD:return F.QueryParser.parseField;case F.QueryLexer.TERM:return F.QueryParser.parseTerm;default:var i="expected either a field or a term, found "+t.type;throw 1<=t.str.length&&(i+=" with value '"+t.str+"'"),new F.QueryParseError(i,t.start,t.end)}},F.QueryParser.parsePresence=function(e){var t=e.consumeLexeme();if(null!=t){switch(t.str){case"-":e.currentClause.presence=F.Query.presence.PROHIBITED;break;case"+":e.currentClause.presence=F.Query.presence.REQUIRED;break;default:var i="unrecognised presence operator'"+t.str+"'";throw new F.QueryParseError(i,t.start,t.end)}var r=e.peekLexeme();if(null==r)throw new F.QueryParseError(i="expecting term or field, found nothing",t.start,t.end);switch(r.type){case F.QueryLexer.FIELD:return F.QueryParser.parseField;case F.QueryLexer.TERM:return F.QueryParser.parseTerm;default:i="expecting term or field, found '"+r.type+"'";throw new F.QueryParseError(i,r.start,r.end)}}},F.QueryParser.parseField=function(e){var t=e.consumeLexeme();if(null!=t){if(-1==e.query.allFields.indexOf(t.str))throw i=e.query.allFields.map(function(e){return"'"+e+"'"}).join(", "),i="unrecognised field '"+t.str+"', possible fields: "+i,new F.QueryParseError(i,t.start,t.end);e.currentClause.fields=[t.str];e=e.peekLexeme();if(null==e)throw new F.QueryParseError(i="expecting term, found nothing",t.start,t.end);if(e.type===F.QueryLexer.TERM)return F.QueryParser.parseTerm;var i="expecting term, found '"+e.type+"'";throw new F.QueryParseError(i,e.start,e.end)}},F.QueryParser.parseTerm=function(e){var t=e.consumeLexeme();if(null!=t){e.currentClause.term=t.str.toLowerCase(),-1!=t.str.indexOf("*")&&(e.currentClause.usePipeline=!1);var i=e.peekLexeme();if(null==i)e.nextClause();else switch(i.type){case F.QueryLexer.TERM:return e.nextClause(),F.QueryParser.parseTerm;case F.QueryLexer.FIELD:return e.nextClause(),F.QueryParser.parseField;case F.QueryLexer.EDIT_DISTANCE:return F.QueryParser.parseEditDistance;case F.QueryLexer.BOOST:return F.QueryParser.parseBoost;case F.QueryLexer.PRESENCE:return e.nextClause(),F.QueryParser.parsePresence;default:var r="Unexpected lexeme type '"+i.type+"'";throw new F.QueryParseError(r,i.start,i.end)}}},F.QueryParser.parseEditDistance=function(e){var t=e.consumeLexeme();if(null!=t){var i=parseInt(t.str,10);if(isNaN(i))throw new F.QueryParseError(s="edit distance must be numeric",t.start,t.end);e.currentClause.editDistance=i;var r=e.peekLexeme();if(null==r)e.nextClause();else switch(r.type){case F.QueryLexer.TERM:return e.nextClause(),F.QueryParser.parseTerm;case F.QueryLexer.FIELD:return e.nextClause(),F.QueryParser.parseField;case F.QueryLexer.EDIT_DISTANCE:return F.QueryParser.parseEditDistance;case F.QueryLexer.BOOST:return F.QueryParser.parseBoost;case F.QueryLexer.PRESENCE:return e.nextClause(),F.QueryParser.parsePresence;default:var s="Unexpected lexeme type '"+r.type+"'";throw new F.QueryParseError(s,r.start,r.end)}}},F.QueryParser.parseBoost=function(e){var t=e.consumeLexeme();if(null!=t){var i=parseInt(t.str,10);if(isNaN(i))throw new F.QueryParseError(s="boost must be numeric",t.start,t.end);e.currentClause.boost=i;var r=e.peekLexeme();if(null==r)e.nextClause();else switch(r.type){case F.QueryLexer.TERM:return e.nextClause(),F.QueryParser.parseTerm;case F.QueryLexer.FIELD:return e.nextClause(),F.QueryParser.parseField;case F.QueryLexer.EDIT_DISTANCE:return F.QueryParser.parseEditDistance;case F.QueryLexer.BOOST:return F.QueryParser.parseBoost;case F.QueryLexer.PRESENCE:return e.nextClause(),F.QueryParser.parsePresence;default:var s="Unexpected lexeme type '"+r.type+"'";throw new F.QueryParseError(s,r.start,r.end)}}},e=this,i=function(){return F},"function"==typeof define&&define.amd?define(i):"object"==typeof exports?module.exports=F:e.lunr=F}(),Mavo.Functions.telify=$.extend(e=>(e+"").normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"").replace("0","+33").toLowerCase(),{multiValued:!0}),!1);function loadContacts(){if(!contactLoaded){let t=document.getElementById("contacts");t&&fetch("/contents/annuaire.json").then(e=>e.json()).then(e=>{let r={};e.contact.forEach(e=>{t.innerHTML+="<option>"+e.id+"</option>",r[e.id]=e}),Array.from(document.querySelectorAll('span[mv-editor-list="contacts"]:not(:empty)')).forEach(e=>{var t,i=r[e.innerText];i&&i.id&&(e.setAttribute("for",i.id),(t=document.createElement("div")).setAttribute("id",i.id),t.setAttribute("class","contact"),t.innerHTML+='<h5 class="nom">'+i.nom+"</h5>",i.email&&(t.innerHTML+='<a href="mailto:'+i.email+'"><span class="fa-solid fa-envelope">'+i.email+"</span></a>"),i.telephone&&(t.innerHTML+='<a href="tel:'+Mavo.Functions.telify(i.telephone)+'"><span class="fa-solid fa-phone">'+i.telephone+"</span></a>"),e.parentNode.append(t))}),contactLoaded=!0}).catch(e=>{console.error("Error:",e)})}}function addContactsSearch(){let i=document.getElementById("fonction");if(i){let t=[],e=(Array.from(document.querySelectorAll('div[property="contact"] div[property="fonction"]:not(:empty)')).forEach(e=>{e=e.innerText.split(/[, ]/)[0];t.includes(e)||t.push(e)}),t.sort().forEach(e=>{i.innerHTML+='<option value="'+e+'">'+e+"</option>"}),i.addEventListener("change",()=>{e.value="";let i=document.getElementById("fonction").value;Array.from(document.querySelectorAll("div.contact")).forEach(e=>{var t=e.getAttribute("data-fonction").split(/[, ]/)[0];i&&t!=i?e.setAttribute("hidden","hidden"):e.removeAttribute("hidden")})}),document.getElementById("fulltext"));e.addEventListener("input",()=>{i.value="";let t=e.value.toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"");Array.from(document.querySelectorAll("div.contact")).forEach(e=>{-1<e.getAttribute("data-fulltext").indexOf(t)?e.removeAttribute("hidden"):e.setAttribute("hidden","hidden")})})}}function fullSearch(s){s&&(s=decodeURIComponent(s),Array.from(document.querySelectorAll("input[type=text][name=texte]")).forEach(e=>{e.value=s}),fetch("/index/full-search.json").then(e=>e.json()).then(e=>{fullSearchData=e,fullSearchIndex=lunr(function(){this.ref("i"),this.field("i",{boost:10}),this.field("t",{boost:10}),this.field("c",{boost:5}),idx=this,e.forEach(function(e,t,i){idx.add(e)})});var r=document.createElement("ol"),t=fullSearchIndex.search("*"+s+"*").map(t=>fullSearchData.find(e=>t.ref===e.i)),i=document.getElementById("results");t.length?(t.forEach(e=>{var t=document.createElement("li"),i=(i=JSON.parse(e.c).description||"").replaceAll("<img [^>]+>","");t.innerHTML='<article class="result"><h3><a href="'+e.i+'">'+e.t+"</a></h3><span>"+i+"</span></article>",r.append(t)}),(i=document.getElementById("results")).innerHTML='<h2 property="resultats">Résultats:</h2>',i.append(r)):i.innerHTML='<h2 property="pasderesultats" class="center">Pas de résultat</h2>'}))}function calculer1erDimancheAvent(e){var t=new Date(e,11,25);for(t.setDate(t.getDate()-22);0!==t.getDay();)t.setDate(t.getDate()-1);return t}String.prototype.replaceAll=function(e,t){return this.replace(new RegExp(e,"gm"),t)};const frenchDays=["Dimanche","Lundi","Mardi","Mercredi","Jeudi","Vendredi","Samedi"];function calculerDatePaques(e){var t=e%19,i=Math.floor(e/100),r=e%100,s=Math.floor(i/4),n=i%4,a=Math.floor((i+8)/25),s=(19*t+i-s-Math.floor((i-a+1)/3)+15)%30,i=(32+2*n+2*Math.floor(r/4)-s-r%4)%7,a=Math.floor((t+11*s+22*i)/451),n=Math.floor((s+i-7*a+114)/31);return new Date(e,n-1,(s+i-7*a+114)%31+1)}function nbJours(e,t){return Math.floor(Math.abs(e-t)/864e5)}function determinerTempsLiturgique(e){e.setHours(0);for(var t=e.getFullYear(),i=(e.getDay()+6)%7,r=calculer1erDimancheAvent(t),s=new Date(t,11,25),n=t,a=(e>=calculer1erDimancheAvent(t)?n++:(r=calculer1erDimancheAvent(t-1),s=new Date(t-1,11,25)),n=n%3==0?"C":n%3==1?"A":"B",new Date(s.getFullYear(),s.getMonth(),s.getDate()+12));a.setDate(a.getDate()+1),0!==a.getDay(););var o,l=calculerDatePaques(t),u=new Date(l),h=(u.setDate(l.getDate()-46),new Date(l)),c=(h.setDate(l.getDate()+49),"");return{jourSemaine:i,numeroSemaine:e>=calculer1erDimancheAvent(t)&&e<s?(c="Avent",o=nbJours(r,e),Math.floor(o/7)+1):s<=e&&e<=a?(c="Noël",e.getTime()==new Date(e.getFullYear(),11,25).getTime()?"Nativité du Seigneur":e.getTime()==new Date(e.getFullYear(),11,31).getTime()?"La Sainte Famille":e.getTime()==new Date(e.getFullYear(),0,1).getTime()?"Sainte Marie, Mère de Dieu":e.getTime()==a.getTime()?"L'Epiphanie du Seigneur":e.getTime()==new Date(a.getFullYear(),a.getMonth(),a.getDate()+1).getTime()?"Le Baptême du Seigneur":(o=nbJours(s,e),Math.floor(o/7)+1)):a<e&&e<u?(c="Ordinaire",o=nbJours(new Date(a.getFullYear(),a.getMonth(),a.getDate()+1),e),Math.floor(o/7)+1):u<=e&&e<l?(c="Carême",e.getTime()==new Date(l.getFullYear(),l.getMonth(),l.getDate()-1).getTime()?"Veillée pascale":e.getTime()==new Date(l.getFullYear(),l.getMonth(),l.getDate()-2).getTime()?"Vendredi saint":e.getTime()==new Date(l.getFullYear(),l.getMonth(),l.getDate()-3).getTime()?"Jeudi saint":e.getTime()==new Date(l.getFullYear(),l.getMonth(),l.getDate()-7).getTime()?"Dimanche des Rameaux et de la Passion":e.getTime()==u.getTime()?"Mercredi des Cendres":(o=nbJours(new Date(u.getFullYear(),u.getMonth(),u.getDate()+5),e),Math.floor(o/7)+1)):l<=e&&e<=h?(c="Pascal",e.getTime()==l.getTime()?"Dimanche de la Résurrection":e.getTime()==new Date(l.getFullYear(),l.getMonth(),l.getDate()+39).getTime()?"Ascension du Seigneur":e.getTime()==h.getTime()?"Pentecôte":(o=nbJours(l,e),Math.floor(o/7)+1)):(c="Ordinaire",e.getTime()==new Date(h.getFullYear(),h.getMonth(),h.getDate()+7).getTime()?"Sainte Trinité":e.getTime()==new Date(h.getFullYear(),h.getMonth(),h.getDate()+14).getTime()?"Saint Sacrement":e.getTime()==new Date(h.getFullYear(),h.getMonth(),h.getDate()+19).getTime()?"Sacré-Cœur de Jésus":(o=nbJours(calculer1erDimancheAvent(r.getFullYear()+1),e),36-Math.ceil(o/7+1))),tempsLiturgique:c,anneeLiturgique:n}}function idifyPsaume(e,t,i){return(i=(i+"").replaceAll(" ",""))+`(${e})`+t}function renderDateLiturgique(e){var t=e.anneeLiturgique,i=e.tempsLiturgique,r=e.numeroSemaine,e=e.jourSemaine;return"1"==r?r+="ère semaine":/\d+/.test(r)&&(r+="e semaine"),"Avent"==(i="Noël"==(i="Carême"==i?"du "+i:i)?"de "+i:i)&&(i="de l'"+i),frenchDays[(e+1)%7]+", "+r+" du temps "+i+" année "+t}function renderPsaumes(e,t){console.log(e);var i=(i=(i=(i=(i='<table cellpadding="0" cellspacing="0">')+("<caption>"+t+"</caption>")+"<thead><tr>")+"<th>Année</th>"+"<th>Nom</th>")+"<th>Titre</th>"+"<th>Partition</th>")+"<th>Musique</th></thead>"+"<tbody>";return e.forEach(e=>{i=(i=(i=(i=(i+="<tr>")+`<td>${e.annee}</td>`)+`<td>${e.nom}</td>`)+`<td>${e.titre}</td>`)+`<td><a href="${e.pdf}" target="_blank">PDF</a></td>`+"<td>",e.mp3.forEach(e=>{i+=`<a href="${e.file}" target="_blank">${e.nom}</a><br/>`}),i+="</td></tr>"}),i=i+"</tbody>"+"</table>"}function initPsaumes(){fetch("/index/psaumes.json").then(e=>e.json()).then(function(e){psaumeData=e,psaumeIndex=lunr(function(){this.ref("ref"),this.field("ref",{boost:1}),this.field("id",{boost:10}),this.field("type",{boost:10}),this.field("temps",{boost:5}),this.field("annee",{boost:1}),this.field("date",{boost:2}),this.field("nom",{boost:8}),this.field("titre",{boost:10}),this.field("text",{boost:1}),this.field("pdf",{boost:1}),this.metadataWhitelist=["position","type","temps","annee"],idx=this,psaumeData.forEach(function(e,t,i){e.ref=idifyPsaume(e.annee,e.temps,e.id),idx.add(e)})})}),document.querySelector('#psaumes input[name="date"]').addEventListener("change",e=>{var e=new Date(e.target.value),t=determinerTempsLiturgique(e),e=renderPsaumes([searchPsaume("",t.anneeLiturgique,t.tempsLiturgique,t.numeroSemaine)[0]],e.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+" : "+renderDateLiturgique(t));document.getElementById("psaumesResults").innerHTML=e}),document.querySelector('#psaumes input[name="texte"]').addEventListener("input",e=>{var t=searchPsaume(e.target.value),t=renderPsaumes(t,`<em>${t.length}</em> résultats pour <em>${e.target.value}</em>`);document.getElementById("psaumesResults").innerHTML=t})}function searchPsaume(e,t,i,r){var s="";return r&&i&&t?s="+ref:"+idifyPsaume(t,i,r):(r&&(s+=`+id:${r} `),i&&(s+=`+temps:${i} `),t&&(s+=`+annee:${t} `),e&&(s+="+"+e)),console.log(s),psaumeIndex.search(s).map(t=>psaumeData.find(e=>t.ref==idifyPsaume(e.annee,e.temps,e.id)))}function getLabelForTag(t){try{return document.querySelector('#autres select option[value="'+t.trim()+'"]').innerText}catch(e){return console.error("Cannot find "+t),""}}function renderAutresChants(e,t){console.log(e);var i=(i=(i=(i='<table cellpadding="0" cellspacing="0">')+("<caption>"+t+"</caption>")+"<thead><tr>")+"<th>Titre</th>"+"<th>Partition</th>")+"<th>Catégories</th></thead>"+"<tbody>";return e.forEach(e=>{i=(i=(i+="<tr>")+`<td>${e.titre}</td>`)+`<td><a href="${e.pdf}" target="_blank">PDF</a></td>`+"<td>",labels="",e.tag.forEach(e=>{labels+=getLabelForTag(e)+" - "}),i=i+labels.replaceAll("^(.*) - $","$1")+"</td></tr>"}),i=i+"</tbody>"+"</table>"}function initAutresChants(){fetch("/index/chants.json").then(e=>e.json()).then(function(e){autresChantsData=e,autresChantsIndex=lunr(function(){this.ref("ref"),this.field("ref",{boost:1}),this.field("id",{boost:10}),this.field("tag",{boost:10}),this.field("titre",{boost:10}),this.field("text",{boost:1}),this.field("pdf",{boost:1}),idx=this,autresChantsData.forEach(function(e,t,i){e.ref=e.id,idx.add(e)})})}),document.querySelector('#autres input[name="texte"]').addEventListener("input",e=>{var t=searchAutresChants(e.target.value),t=renderAutresChants(t,`<em>${t.length}</em> résultats pour <em>${e.target.value}</em>`);document.getElementById("chantsResults").innerHTML=t}),Array.from(document.querySelectorAll("#autres select")).forEach(e=>{e.addEventListener("change",e=>{var t=document.querySelector('#autres select[name="temps"]').value,i=document.querySelector('#autres select[name="etape"]').value,r="_"==t?[i]:"_"==i?[t]:[t,i],s="_"==t?getLabelForTag(i):"_"==i?getLabelForTag(t):getLabelForTag(t)+" - "+getLabelForTag(i),t=(console.log(t,i),searchAutresChants("",r)),i=renderAutresChants(t,`<em>${t.length}</em> résultats pour <em>${s}</em>`);document.getElementById("chantsResults").innerHTML=i})})}function searchAutresChants(e,t){var i="";return t&&t.forEach(e=>{i+=`+tag:${e} `}),e&&(i+="+"+e),console.log(i),autresChantsIndex.search(i).map(t=>autresChantsData.find(e=>t.ref==e.id))}function initChants(){initPsaumes(),initAutresChants(),Array.from(document.querySelectorAll("form")).forEach(e=>{e.classList.add("hide")}),Array.from(document.querySelectorAll("form.active")).forEach(e=>{e.classList.remove("hide")}),Array.from(document.querySelectorAll(".tabs>li")).forEach(e=>{e.addEventListener("click",function(){Array.from(e.parentElement.parentElement.querySelectorAll("form")).forEach(e=>{e.classList.add("hide")}),Array.from(e.parentElement.querySelectorAll("li")).forEach(e=>{e.classList.remove("active")}),(f=document.getElementById(e.attributes["data-tab"].value)).classList.remove("hide"),e.classList.add("active")})})}function idifyLecture(e,t,i,r){return r+`,${i}(${e})`+t}function renderLectures(e,t){console.log(e);var i=(i=(i=(i='<table cellpadding="0" cellspacing="0">')+("<caption>"+t+"</caption>")+"<thead><tr>")+"<th>Lecture de la messe</th>"+"<th>Titre</th>")+"<th>Identifiant</th>"+"<tbody>";return e.forEach(e=>{i=(i=(i=(i+="<tr>")+`<td>${e.type}</td>`)+`<td>${e.titre}</td>`)+`<td>${e.id}</td>`+"</tr>"}),i=i+"</tbody>"+"</table>"}function initBibleIndex(){fetch("/index/bible/livres.json").then(e=>e.json()).then(function(e){bibleData=e,bibleIndex=lunr(function(){this.ref("ref"),this.field("ref",{boost:1}),this.field("id",{boost:10}),this.field("type",{boost:10}),this.field("temps",{boost:5}),this.field("annee",{boost:1}),this.field("date",{boost:2}),this.field("nom",{boost:8}),this.field("titre",{boost:10}),this.field("text",{boost:1}),this.field("pdf",{boost:1}),idx=this,bibleData.forEach(function(e,t,i){e.ref=idifyLecture(e.annee,e.temps,e.semaine,e.jour),idx.add(e)})})}),fetch("/index/lectures.json").then(e=>e.json()).then(function(e){lecturesData=e,lecturesIndex=lunr(function(){this.ref("ref"),this.field("ref",{boost:1}),this.field("id",{boost:10}),this.field("annee",{boost:10}),this.field("temps",{boost:5}),this.field("semaine",{boost:1}),this.field("jour",{boost:2}),this.field("date",{boost:8}),this.field("originalDate",{boost:10}),this.field("lectures",{boost:1}),idx=this,lecturesData.forEach(function(e,t,i){e.ref=idifyLecture(e.annee,e.temps,e.semaine,e.jour),idx.add(e)})})}),document.querySelector('#filters input[name="date"]').addEventListener("change",e=>{var e=new Date(e.target.value),t=determinerTempsLiturgique(e),i=searchLecturesByTempsLiturgique(t)[0],i=(console.log("result",i),renderLectures(i.lectures,e.toLocaleDateString("fr-FR",{weekday:"long",year:"numeric",month:"long",day:"numeric"})+" : "+renderDateLiturgique(t)));document.getElementById("results").innerHTML=i}),document.querySelector('#filters input[name="id"]').addEventListener("input",e=>{var t=searchLecturesById(e.target.value),t=(console.log("result",t),renderLectures(t.lectures,`Lectures pour <em>${e.target.value}</em>`));document.getElementById("results").innerHTML=t}),document.querySelector('#filters select[name="type"]').addEventListener("input",e=>{var t=searchLecturesByText(e.target.value),t=(console.log("result",t),renderLectures(t.lectures,`Lectures pour <em>${e.target.value}</em>`));document.getElementById("results").innerHTML=t})}function searchLecturesByTempsLiturgique(e){return searchLectures("+ref:"+idifyLecture(e.anneeLiturgique,e.tempsLiturgique,e.numeroSemaine,e.jourSemaine))}function searchLecturesById(e){return searchLectures("+id="+e)}function searchLectures(e){return console.log(e),lecturesIndex.search(e).map(t=>lecturesData.find(e=>t.ref==idifyLecture(e.annee,e.temps,e.semaine,e.jour)))}function initBible(){initBibleIndex(),Array.from(document.querySelectorAll("form")).forEach(e=>{e.classList.add("hide")}),Array.from(document.querySelectorAll("form.active")).forEach(e=>{e.classList.remove("hide")}),Array.from(document.querySelectorAll(".tabs>li")).forEach(e=>{e.addEventListener("click",function(){Array.from(e.parentElement.parentElement.querySelectorAll("form")).forEach(e=>{e.classList.add("hide")}),Array.from(e.parentElement.querySelectorAll("li")).forEach(e=>{e.classList.remove("active")}),(f=document.getElementById(e.attributes["data-tab"].value)).classList.remove("hide"),e.classList.add("active")})})}document.addEventListener("DOMContentLoaded",()=>{document.querySelector("main[mv-app=chants]")&&initChants(),document.querySelector("main[mv-app=bible]")&&initBible(),document.querySelector("main[mv-app=recherche]")&&fullSearch(document.location.href.split("texte=")[1]),Mavo.inited.then(()=>(setTimeout(()=>{loadContacts()},500),Mavo.all[0].dataLoaded)).then(()=>{setTimeout(()=>{loadContacts(),addContactsSearch()},1e3)})});