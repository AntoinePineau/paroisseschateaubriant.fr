!function(){"use strict";function t(s,a,e){return a=void 0===a?1:a,(e=e||a+1)-a<=1?function(){if(arguments.length<=a||"string"===l.type(arguments[a]))return s.apply(this,arguments);var e,t,i=arguments[a];for(t in i){var r=Array.prototype.slice.call(arguments);r.splice(a,1,t,i[t]),e=s.apply(this,r)}return e}:t(t(s,a+1,e),a,e-1)}function o(t,i,e){var r=n(e);if("string"===r){var s=Object.getOwnPropertyDescriptor(i,e);!s||s.writable&&s.configurable&&s.enumerable&&!s.get&&!s.set?t[e]=i[e]:(delete t[e],Object.defineProperty(t,e,s))}else if("array"===r)e.forEach(function(e){e in i&&o(t,i,e)});else for(var a in i)e&&("regexp"===r&&!e.test(a)||"function"===r&&!e.call(i,a))||o(t,i,a);return t}function n(e){var t;return null===e?"null":void 0===e?"undefined":"number"==(t=(Object.prototype.toString.call(e).match(/^\[object\s+(.*?)\]$/)[1]||"").toLowerCase())&&isNaN(e)?"nan":t}var l=self.Bliss=o(function(e,t){return 2==arguments.length&&!t||!e?null:"string"===l.type(e)?(t||document).querySelector(e):e||null},self.Bliss),i=(o(l,{extend:o,overload:t,type:n,property:l.property||"_",listeners:new(self.WeakMap?WeakMap:Map),original:{addEventListener:(self.EventTarget||Node).prototype.addEventListener,removeEventListener:(self.EventTarget||Node).prototype.removeEventListener},sources:{},noop:function(){},$:function(e,t){return e instanceof Node||e instanceof Window?[e]:2!=arguments.length||t?Array.prototype.slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[]):[]},defined:function(){for(var e=0;e<arguments.length;e++)if(void 0!==arguments[e])return arguments[e]},create:function(e,t){return e instanceof Node?l.set(e,t):(1===arguments.length&&(t="string"===l.type(e)?{}:(e=(t=e).tag,l.extend({},t,function(e){return"tag"!==e}))),l.set(document.createElement(e||"div"),t))},each:function(e,t,i){for(var r in i=i||{},e)i[r]=t.call(e,r,e[r]);return i},ready:function(t,e,i){if("function"!=typeof t||e||(e=t,t=void 0),t=t||document,e&&("loading"!==t.readyState?e():l.once(t,"DOMContentLoaded",function(){e()})),!i)return new Promise(function(e){l.ready(t,e,!0)})},Class:function(e){var t,i,r=["constructor","extends","abstract","static"].concat(Object.keys(l.classProps)),s=e.hasOwnProperty("constructor")?e.constructor:l.noop;function a(e){return this.hasOwnProperty(e)&&-1===r.indexOf(e)}if(2==arguments.length?(i=arguments[0],e=arguments[1]):((i=function(){if(this.constructor.__abstract&&this.constructor===i)throw new Error("Abstract classes cannot be directly instantiated.");i.super&&!t&&i.super.apply(this,arguments),s.apply(this,arguments)}).super=e.extends||null,i.super&&(t=0===(i.super+"").indexOf("class "))&&console.error(`You are using $.Class() to create a fake function-based class that extends a native JS class. This will not work.
You should convert your code to use native JS classes too. You can still pass a class into $.Class() to use its conveniences.`),i.prototype=l.extend(Object.create(i.super?i.super.prototype:Object),{constructor:i}),i.prototype.super=i.super?i.super.prototype:null,i.__abstract=!!e.abstract),e.static)for(var o in l.extend(i,e.static,a),l.classProps)o in e.static&&l.classProps[o](i,e.static[o]);for(o in l.extend(i.prototype,e,a),l.classProps)o in e&&l.classProps[o](i.prototype,e[o]);return i},classProps:{lazy:t(function(e,t,i){return Object.defineProperty(e,t,{get:function(){var e=i.call(this);return Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0}),e},set:function(e){Object.defineProperty(this,t,{value:e,configurable:!0,enumerable:!0,writable:!0})},configurable:!0,enumerable:!0}),e}),live:t(function(e,i,r){return"function"===l.type(r)&&(r={set:r}),Object.defineProperty(e,i,{get:function(){var e=this["_"+i],t=r.get&&r.get.call(this,e);return void 0!==t?t:e},set:function(e){var t=this["_"+i],t=r.set&&r.set.call(this,e,t);this["_"+i]=void 0!==t?t:e},configurable:r.configurable,enumerable:r.enumerable}),e})},include:function(){var i=arguments[arguments.length-1],e=2===arguments.length&&arguments[0],r=document.createElement("script");return e?Promise.resolve():new Promise(function(e,t){l.set(r,{async:!0,onload:function(){e(r),r.parentNode&&r.parentNode.removeChild(r)},onerror:function(){t(r)},src:i,inside:document.head})})},load:function e(r,t){return t=t?new URL(t,location.href):location.href,r=new URL(r,t),(t=e.loading=e.loading||{})[r+""]||(/\.css$/.test(r.pathname)?t[r+""]=new Promise(function(e,t){var i=l.create("link",{href:r,rel:"stylesheet",inside:document.head,onload:function(){e(i)},onerror:function(){t(i)}})}):t[r+""]=l.include(r))},fetch:function(e,t){if(!e)throw new TypeError("URL parameter is mandatory and cannot be "+e);var i,r=o({url:new URL(e,location),data:"",method:"GET",headers:{},xhr:new XMLHttpRequest},t);for(i in r.method=r.method.toUpperCase(),l.hooks.run("fetch-args",r),"GET"===r.method&&r.data&&(r.url.search+=r.data),document.body.setAttribute("data-loading",r.url),r.xhr.open(r.method,r.url.href,!1!==r.async,r.user,r.password),t)if("upload"===i)r.xhr.upload&&"object"==typeof t[i]&&l.extend(r.xhr.upload,t[i]);else if(i in r.xhr)try{r.xhr[i]=t[i]}catch(e){self.console&&console.error(e)}var s,e=Object.keys(r.headers).map(function(e){return e.toLowerCase()});for(s in"GET"!==r.method&&-1===e.indexOf("content-type")&&r.xhr.setRequestHeader("Content-type","application/x-www-form-urlencoded"),r.headers)void 0!==r.headers[s]&&r.xhr.setRequestHeader(s,r.headers[s]);return(e=new Promise(function(e,t){r.xhr.onload=function(){document.body.removeAttribute("data-loading"),0===r.xhr.status||200<=r.xhr.status&&r.xhr.status<300||304===r.xhr.status?e(r.xhr):t(l.extend(Error(r.xhr.statusText),{xhr:r.xhr,get status(){return this.xhr.status}}))},r.xhr.onerror=function(){document.body.removeAttribute("data-loading"),t(l.extend(Error("Network Error"),{xhr:r.xhr}))},r.xhr.ontimeout=function(){document.body.removeAttribute("data-loading"),t(l.extend(Error("Network Timeout"),{xhr:r.xhr}))},r.xhr.send("GET"===r.method?null:r.data)})).xhr=r.xhr,e},value:function(e){var t="string"!=typeof e;return l.$(arguments).slice(+t).reduce(function(e,t){return e&&e[t]},t?e:self)}}),l.Hooks=new l.Class({add:function(e,t,i){if("string"==typeof arguments[0])(Array.isArray(e)?e:[e]).forEach(function(e){this[e]=this[e]||[],t&&this[e][i?"unshift":"push"](t)},this);else for(var e in arguments[0])this.add(e,arguments[0][e],t)},run:function(e,t){this[e]=this[e]||[],this[e].forEach(function(e){e.call(t&&t.context?t.context:t,t)})}}),l.hooks=new l.Hooks,l.property,l.Element=function(e){this.subject=e,this.data={},this.bliss={}},l.Element.prototype={set:t(function(e,t){e in l.setProps?l.setProps[e].call(this,t):e in this?this[e]=t:this.setAttribute(e,t)},0),transition:function(s,a){return new Promise(function(e,t){var i,r;"transition"in this.style&&0!==a?(i=l.extend({},this.style,/^transition(Duration|Property)$/),l.style(this,{transitionDuration:(a||400)+"ms",transitionProperty:Object.keys(s).join(", ")}),l.once(this,"transitionend",function(){clearTimeout(r),l.style(this,i),e(this)}),r=setTimeout(e,a+50,this),l.style(this,s)):(l.style(this,s),e(this))}.bind(this))},fire:function(e,t){var i=document.createEvent("HTMLEvents");return i.initEvent(e,!0,!0),this.dispatchEvent(l.extend(i,t))},bind:t(function(e,i){1<arguments.length&&("function"===l.type(i)||i.handleEvent)&&(t=i,(i="object"===l.type(arguments[2])?arguments[2]:{capture:!!arguments[2]}).callback=t);var t,r=l.listeners.get(this)||{};e.trim().split(/\s+/).forEach(function(e){var t;-1<e.indexOf(".")&&(t=(e=e.split("."))[1],e=e[0]),r[e]=r[e]||[],0===r[e].filter(function(e){return e.callback===i.callback&&e.capture==i.capture}).length&&r[e].push(l.extend({className:t},i)),l.original.addEventListener.call(this,e,i.callback,i)},this),l.listeners.set(this,r)},0),unbind:t(function(e,a){a&&("function"===l.type(a)||a.handleEvent)&&(t=a,a=arguments[2]),(a=("boolean"==l.type(a)?{capture:a}:a)||{}).callback=a.callback||t;var t,o=l.listeners.get(this);(e||"").trim().split(/\s+/).forEach(function(e){var t,i;if(-1<e.indexOf(".")&&(t=(e=e.split("."))[1],e=e[0]),!o)return e&&a.callback?l.original.removeEventListener.call(this,e,a.callback,a.capture):void 0;for(i in o)if(!e||i===e)for(var r,s=0;r=o[i][s];s++)t&&t!==r.className||a.callback&&a.callback!==r.callback||!!a.capture!=!!r.capture&&(e||a.callback||void 0!==a.capture)||(o[i].splice(s,1),l.original.removeEventListener.call(this,i,r.callback,r.capture),s--)},this)},0),when:function(r,s){var e=this;return new Promise(function(i){e.addEventListener(r,function e(t){s&&!s.call(this,t)||(this.removeEventListener(r,e),i(t))})})},toggleAttribute:function(e,t,i){(i=arguments.length<3?null!==t:i)?this.setAttribute(e,t):this.removeAttribute(e)}},l.setProps={style:function(e){for(var t in e)t in this.style?this.style[t]=e[t]:this.style.setProperty(t,e[t])},attributes:function(e){for(var t in e)this.setAttribute(t,e[t])},properties:function(e){l.extend(this,e)},events:function(e){if(1!=arguments.length||!e||!e.addEventListener)return l.bind.apply(this,[this].concat(l.$(arguments)));var t,i=this;if(l.listeners){var r,s=l.listeners.get(e);for(r in s)s[r].forEach(function(e){l.bind(i,r,e.callback,e.capture)})}for(t in e)0===t.indexOf("on")&&(this[t]=e[t])},once:t(function(t,i){var r=this;l.bind(this,t,function e(){return l.unbind(r,t,e),i.apply(r,arguments)},{once:!0})},0),delegate:t(function(e,t,i){l.bind(this,e,function(e){e.target.closest(t)&&i.call(this,e)})},0,2),contents:function(e){!e&&0!==e||(Array.isArray(e)?e:[e]).forEach(function(e){var t=l.type(e);/^(string|number)$/.test(t)?e=document.createTextNode(e+""):"object"===t&&(e=l.create(e)),e instanceof Node&&this.appendChild(e)},this)},inside:function(e){e&&e.appendChild(this)},before:function(e){e&&e.parentNode.insertBefore(this,e)},after:function(e){e&&e.parentNode.insertBefore(this,e.nextSibling)},start:function(e){e&&e.insertBefore(this,e.firstChild)},around:function(e){e&&e.parentNode&&l.before(this,e),this.appendChild(e)}},l.Array=function(e){this.subject=e},l.Array.prototype={all:function(e){var t=l.$(arguments).slice(1);return this[e].apply(this,t)}},l.add=t(function(r,i,s,e){s=l.extend({$:!0,element:!0,array:!0},s),"function"==l.type(i)&&(!s.element||r in l.Element.prototype&&e||(l.Element.prototype[r]=function(){return this.subject&&l.defined(i.apply(this.subject,arguments),this.subject)}),!s.array||r in l.Array.prototype&&e||(l.Array.prototype[r]=function(){var t=arguments;return this.subject.map(function(e){return e&&l.defined(i.apply(e,t),e)})}),s.$)&&(l.sources[r]=l[r]=i,s.array||s.element)&&(l[r]=function(){var e=[].slice.apply(arguments),t=e.shift(),i=s.array&&Array.isArray(t)?"Array":"Element";return l[i].prototype[r].apply({subject:t},e)})},0),l.add(l.Array.prototype,{element:!1}),l.add(l.Element.prototype),l.add(l.setProps),l.add(l.classProps,{element:!1,array:!1}),document.createElement("_"));l.add(l.extend({},HTMLElement.prototype,function(e){return"function"===l.type(i[e])}),null,!0)}();var jsep=function(e){"use strict";const f="Compound",g="MemberExpression",y="Literal";function b(e,t){var i=new Error(e+" at character "+t);throw i.index=t,i.description=e,i}function t(e){return Math.max(0,...Object.keys(e).map(e=>e.length))}function x(e){return E[e]||0}function M(e,t,i){return{type:"BinaryExpression",operator:e,left:t,right:i}}function w(e){return P(e)||O(e)}function i(s){function a(){var e=n(h),t=h;for(P(e)?h++:b("Unexpected "+o(h),h);h<l&&(e=n(h),w(e));)h++;return t=s.slice(t,h),N.hasOwnProperty(t)?{type:y,value:N[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}}let e,t,h=0,i=s.charAt,r=s.charCodeAt,o=function(e){return i.call(s,e)},n=function(e){return r.call(s,e)},l=s.length,u=function(){let e=n(h);for(;32===e||9===e||10===e||13===e;)e=n(++h)},d=function(){var e,t,i=function(){let e,t,i,r,s,a,o,n,l;if(a=p(),!(t=c()))return a;for(s={value:t,prec:x(t)},(o=p())||b("Expected expression after "+t,h),r=[a,s,o];(t=c())&&0!==(i=x(t));){for(s={value:t,prec:i},l=t;r.length>2&&i<=r[r.length-2].prec;)o=r.pop(),t=r.pop().value,a=r.pop(),e=M(t,a,o),r.push(e);e=p(),e||b("Expected expression after "+l,h),r.push(s,e)}for(n=r.length-1,e=r[n];n>1;)e=M(r[n-1].value,r[n-2],e),n-=2;return e}();return u(),63!==n(h)?i:(h++,(e=d())||b("Expected expression",h),u(),58===n(h)?(h++,(t=d())||b("Expected expression",h),{type:"ConditionalExpression",test:i,consequent:e,alternate:t}):void b("Expected :",h))},c=function(){u();let e=s.substr(h,k),t=e.length;for(;0<t;){if(E.hasOwnProperty(e)&&(!P(n(h))||h+e.length<s.length&&!w(n(h+e.length))))return h+=t,e;e=e.substr(0,--t)}return!1},p=function(){let e,t,i,r;if(u(),e=n(h),O(e)||46===e){let e,t,i="";for(;O(n(h));)i+=o(h++);if(46===n(h))for(i+=o(h++);O(n(h));)i+=o(h++);if("e"===(e=o(h))||"E"===e){for(i+=o(h++),"+"!==(e=o(h))&&"-"!==e||(i+=o(h++));O(n(h));)i+=o(h++);O(n(h-1))||b("Expected exponent ("+i+o(h)+")",h)}return t=n(h),P(t)?b("Variable names cannot start with a number ("+i+o(h)+")",h):46===t&&b("Unexpected period",h),{type:y,value:parseFloat(i),raw:i}}if(39===e||34===e)r=function(){let t="",i=o(h++),r=!1;for(;h<l;){let e=o(h++);if(e===i){r=!0;break}if("\\"===e)switch(e=o(h++),e){case"n":t+="\n";break;case"r":t+="\r";break;case"t":t+="\t";break;case"b":t+="\b";break;case"f":t+="\f";break;case"v":t+="\v";break;default:t+=e}else t+=e}return r||b('Unclosed quote after "'+t+'"',h),{type:y,value:t,raw:i+t+i}}();else if(91===e)r=(h++,{type:"ArrayExpression",elements:m(93)});else{for(t=s.substr(h,C),i=t.length;0<i;){if(A.hasOwnProperty(t)&&(!P(n(h))||h+t.length<s.length&&!w(n(h+t.length))))return h+=i,{type:"UnaryExpression",operator:t,argument:p(),prefix:!0};t=t.substr(0,--i)}P(e)?r=a():40===e&&(r=function(){h++;let e=d();if(u(),41===n(h))return h++,e;b("Unclosed (",h)}())}if(!r)return!1;for(u(),e=n(h);46===e||91===e||40===e;)h++,46===e?(u(),r={type:g,computed:!1,object:r,property:a()}):91===e?(r={type:g,computed:!0,object:r,property:d()},u(),93!==(e=n(h))&&b("Unclosed [",h),h++):40===e&&(r={type:"CallExpression",arguments:m(41),callee:r}),u(),e=n(h);return r},m=function(e){let t=[],i=!1,r=0;for(;h<l;){u();var s=n(h);if(s===e){i=!0,h++,41===e&&r&&r>=t.length&&b("Unexpected token "+String.fromCharCode(e),h);break}if(44===s){if(h++,++r!==t.length)if(41===e)b("Unexpected token ,",h);else if(93===e)for(let e=t.length;e<r;e++)t.push(null)}else{s=d();s&&s.type!==f||b("Expected comma",h),t.push(s)}}return i||b("Expected "+String.fromCharCode(e),h),t},v=[];for(;h<l;)59===(e=n(h))||44===e?h++:(t=d())?v.push(t):h<l&&b('Unexpected "'+o(h)+'"',h);return 1===v.length?v[0]:{type:f,body:v}}let A={"-":1,"!":1,"~":1,"+":1},E={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},r={$:1,_:1},C=t(A),k=t(E),N={true:!0,false:!1,null:null},O=function(e){return 48<=e&&e<=57},P=function(e){return 65<=e&&e<=90||97<=e&&e<=122||128<=e&&!E[String.fromCharCode(e)]||r.hasOwnProperty(String.fromCharCode(e))};return i.version="0.4.0",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(e){return C=Math.max(e.length,C),A[e]=1,this},i.addBinaryOp=function(e,t){return k=Math.max(e.length,k),E[e]=t,this},i.addIdentifierChar=function(e){return r[e]=1,this},i.addLiteral=function(e,t){return N[e]=t,this},i.removeUnaryOp=function(e){return delete A[e],e.length===C&&(C=t(A)),this},i.removeAllUnaryOps=function(){return A={},C=0,this},i.removeIdentifierChar=function(e){return delete r[e],this},i.removeBinaryOp=function(e){return delete E[e],e.length===k&&(k=t(E)),this},i.removeAllBinaryOps=function(){return E={},k=0,this},i.removeLiteral=function(e){return delete N[e],this},i.removeAllLiterals=function(){return N={},this},e.default=i,Object.defineProperty(e,"__esModule",{value:!0}),e}({});function addMenuInteraction(){var t=document.querySelector("nav button");t.addEventListener("click",function(){var e="true"===this.getAttribute("aria-expanded")||!1;this.setAttribute("aria-expanded",!e),this.nextElementSibling;t.querySelector("span").innerText=e?"☰":"✕"})}!function(e){"use strict";function M(e,t){var i=new Error(e+" at character "+t);throw i.index=t,i.description=e,i}function t(e){var t,i,r=0;for(i in e)(t=i.length)>r&&e.hasOwnProperty(i)&&(r=t);return r}function w(e){return s[e]||0}function A(e,t,i){return{type:"||"===e||"&&"===e?"LogicalExpression":"BinaryExpression",operator:e,left:t,right:i}}function E(e){return 48<=e&&e<=57}function C(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||128<=e&&!s[String.fromCharCode(e)]}function k(e){return 36===e||95===e||65<=e&&e<=90||97<=e&&e<=122||48<=e&&e<=57||128<=e&&!s[String.fromCharCode(e)]}function i(h){for(var e,u=0,t=h.charAt,i=h.charCodeAt,d=function(e){return t.call(h,e)},c=function(e){return i.call(h,e)},p=h.length,m=function(){for(var e=c(u);32===e||9===e||10===e||13===e;)e=c(++u)},v=function(){var e,t,i=function(){var e,t,i,r,s,a,o,n,l,a=g();if(!(t=f()))return a;for(s={value:t,prec:w(t)},(o=g())||M("Expected expression after "+t,u),r=[a,s,o];(t=f())&&0!==(i=w(t));){for(s={value:t,prec:i},l=t;2<r.length&&i<=r[r.length-2].prec;)o=r.pop(),t=r.pop().value,a=r.pop(),e=A(t,a,o),r.push(e);(e=g())||M("Expected expression after "+l,u),r.push(s,e)}for(e=r[n=r.length-1];1<n;)e=A(r[n-1].value,r[n-2],e),n-=2;return e}();return m(),63!==c(u)?i:(u++,(e=v())||M("Expected expression",u),m(),58===c(u)?(u++,(t=v())||M("Expected expression",u),{type:"ConditionalExpression",test:i,consequent:e,alternate:t}):void M("Expected :",u))},f=function(){m();for(var e=h.substr(u,a),t=e.length;0<t;){if(s.hasOwnProperty(e)&&(!C(c(u))||u+e.length<h.length&&!k(c(u+e.length))))return u+=t,e;e=e.substr(0,--t)}return!1},g=function(){var e,t,i;if(m(),e=c(u),E(e)||46===e){for(var r,s="";E(c(u));)s+=d(u++);if(46===c(u))for(s+=d(u++);E(c(u));)s+=d(u++);if("e"===(r=d(u))||"E"===r){for(s+=d(u++),"+"!==(r=d(u))&&"-"!==r||(s+=d(u++));E(c(u));)s+=d(u++);E(c(u-1))||M("Expected exponent ("+s+d(u)+")",u)}return r=c(u),C(r)?M("Variable names cannot start with a number ("+s+d(u)+")",u):46===r&&M("Unexpected period",u),{type:O,value:parseFloat(s),raw:s}}if(39===e||34===e){for(var a,o="",n=d(u++),l=!1;u<p;){if((a=d(u++))===n){l=!0;break}if("\\"===a)switch(a=d(u++)){case"n":o+="\n";break;case"r":o+="\r";break;case"t":o+="\t";break;case"b":o+="\b";break;case"f":o+="\f";break;case"v":o+="\v";break;default:o+=a}else o+=a}return l||M('Unclosed quote after "'+o+'"',u),{type:O,value:o,raw:n+o+n}}if(91===e)return u++,{type:"ArrayExpression",elements:b(93)};for(i=(t=h.substr(u,S)).length;0<i;){if(P.hasOwnProperty(t)&&(!C(c(u))||u+t.length<h.length&&!k(c(u+t.length))))return u+=i,{type:"UnaryExpression",operator:t,argument:g(),prefix:!0};t=t.substr(0,--i)}return!(!C(e)&&40!==e)&&function(){var e,t,t=40===(e=c(u))?x():y();for(m(),e=c(u);46===e||91===e||40===e;)u++,46===e?(m(),t={type:N,computed:!1,object:t,property:y()}):91===e?(t={type:N,computed:!0,object:t,property:v()},m(),93!==(e=c(u))&&M("Unclosed [",u),u++):40===e&&(t={type:"CallExpression",arguments:b(41),callee:t}),m(),e=c(u);return t}()},y=function(){var e=c(u),t=u;for(C(e)?u++:M("Unexpected "+d(u),u);u<p&&(e=c(u),k(e));)u++;return t=h.slice(t,u),n.hasOwnProperty(t)?{type:O,value:n[t],raw:t}:"this"===t?{type:"ThisExpression"}:{type:"Identifier",name:t}},b=function(e){for(var t,i=[],r=!1,s=0;u<p;){if(m(),(t=c(u))===e){r=!0,u++,41===e&&s&&i.length<=s&&M("Unexpected token "+String.fromCharCode(e),u);break}if(44===t){if(u++,++s!==i.length)if(41===e)M("Unexpected token ,",u);else if(93===e)for(var a=i.length;a<s;a++)i.push(null)}else(t=v())&&t.type!==o||M("Expected comma",u),i.push(t)}return r||M("Expected "+String.fromCharCode(e),u),i},x=function(){u++;var e=v();if(m(),41===c(u))return u++,e;M("Unclosed (",u)},r=[];u<p;)59===(e=c(u))||44===e?u++:(e=v())?r.push(e):u<p&&M('Unexpected "'+d(u)+'"',u);return 1===r.length?r[0]:{type:o,body:r}}var r,o="Compound",N="MemberExpression",O="Literal",P={"-":!0,"!":!0,"~":!0,"+":!0},s={"||":1,"&&":2,"|":3,"^":4,"&":5,"==":6,"!=":6,"===":6,"!==":6,"<":7,">":7,"<=":7,">=":7,"<<":8,">>":8,">>>":8,"+":9,"-":9,"*":10,"/":10,"%":10},S=t(P),a=t(s),n={true:!0,false:!1,null:null};i.version="0.3.4",i.toString=function(){return"JavaScript Expression Parser (JSEP) v"+i.version},i.addUnaryOp=function(e){return S=Math.max(e.length,S),P[e]=!0,this},i.addBinaryOp=function(e,t){return a=Math.max(e.length,a),s[e]=t,this},i.addLiteral=function(e,t){return n[e]=t,this},i.removeUnaryOp=function(e){return delete P[e],e.length===S&&(S=t(P)),this},i.removeAllUnaryOps=function(){return P={},S=0,this},i.removeBinaryOp=function(e){return delete s[e],e.length===a&&(a=t(s)),this},i.removeAllBinaryOps=function(){return s={},a=0,this},i.removeLiteral=function(e){return delete n[e],this},i.removeAllLiterals=function(){return n={},this},"undefined"==typeof exports?(r=e.jsep,(e.jsep=i).noConflict=function(){return e.jsep===i&&(e.jsep=r),i}):"undefined"!=typeof module&&module.exports?exports=module.exports=i:exports.parse=i}(this),function(){var d,e;function t(e,t){return e instanceof Node||e instanceof Window?[e]:[].slice.call("string"==typeof e?(t||document).querySelectorAll(e):e||[])}self.Element&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.webkitMatchesSelector||Element.prototype.mozMatchesSelector||Element.prototype.msMatchesSelector||Element.prototype.oMatchesSelector||null),Element.prototype.matches)&&(d=self.Stretchy={selectors:{base:'textarea, select:not([size]), input:not([type]), input[type="'+"text number url email tel".split(" ").join('"], input[type="')+'"]',filter:"*"},script:document.currentScript||t("script").pop(),resize:function(e){if(d.resizes(e)){var t,i=getComputedStyle(e),r=0,s=(!e.value&&e.placeholder&&(t=!0,e.value=e.placeholder),e.nodeName.toLowerCase());if("textarea"==s)e.style.height="0","border-box"==i.boxSizing?r=e.offsetHeight:"content-box"==i.boxSizing&&(r=-e.clientHeight+parseFloat(i.minHeight)),e.style.height=e.scrollHeight+r+"px";else if("input"==s)if(e.style.width="1000px",e.offsetWidth){e.style.width="0","border-box"==i.boxSizing?r=e.offsetWidth:"padding-box"==i.boxSizing?r=e.clientWidth:"content-box"==i.boxSizing&&(r=parseFloat(i.minWidth));var a=Math.max(r,e.scrollWidth-e.clientWidth);e.style.width=a+"px";for(var o=0;o<10&&(e.scrollLeft=1e10,0!=e.scrollLeft);o++)a+=e.scrollLeft,e.style.width=a+"px"}else e.style.width=e.value.length+1+"ch";else if("select"==s){if(-1==e.selectedIndex)return;var n,l,r=0<e.selectedIndex?e.selectedIndex:0,h=document.createElement("_");for(l in h.textContent=e.options[r].textContent,e.parentNode.insertBefore(h,e.nextSibling),i){var u=i[l];/^(width|webkitLogicalWidth|length)$/.test(l)||"string"!=typeof u||(h.style[l]=u,/appearance$/i.test(l)&&(n=l))}h.style.width="",0<h.offsetWidth&&(e.style.width=h.offsetWidth+"px",i[n]&&"none"===i[n]||(e.style.width="calc("+e.style.width+" + 2em)")),h.parentNode.removeChild(h),h=null}t&&(e.value="")}},resizeAll:function(e){t(e||d.selectors.base).forEach(function(e){d.resize(e)})},active:!0,resizes:function(e){return e&&e.parentNode&&e.matches&&e.matches(d.selectors.base)&&e.matches(d.selectors.filter)},init:function(){d.selectors.filter=d.script.getAttribute("data-filter")||(t("[data-stretchy-filter]").pop()||document.body).getAttribute("data-stretchy-filter")||d.selectors.filter,d.resizeAll(),self.MutationObserver&&!d.observer&&(d.observer=new MutationObserver(function(e){d.active&&e.forEach(function(e){"childList"==e.type&&d.resizeAll(e.addedNodes)})}),d.observer.observe(document.documentElement,{childList:!0,subtree:!0}))},$$:t},"loading"!==document.readyState?requestAnimationFrame(d.init):document.addEventListener("DOMContentLoaded",d.init),window.addEventListener("load",function(){d.resizeAll()}),e=function(e){d.active&&d.resize(e.target)},document.documentElement.addEventListener("input",e),document.documentElement.addEventListener("change",e))}(),Stretchy.selectors.filter=".mv-editor:not([property]), .mv-autosize",async function(o,r){self.$=self.$||o,self.$$=self.$$||r;let n=self.Mavo=o.Class(class Mavo{constructor(e){if(this.treeBuilt=Mavo.promise(),this.dataLoaded=Mavo.promise(),this.deleted=[],this.element=e,this.inProgress=!1,this.index=Object.keys(n.all).length+1,Object.defineProperty(n.all,this.index-1,{value:this,configurable:!0}),this.id=Mavo.getAttribute(this.element,"mv-app","id")||"mavo"+this.index,this.id in n.all){for(var t=2;this.id+t in n.all;t++);this.id=this.id+t}(n.all[this.id]=this).element.setAttribute("mv-app",this.id),this.observe({attribute:"lang",deep:!1},()=>{var e=Mavo.getClosestAttribute(this.element,"lang")||Mavo.locale;this.locale=Mavo.Locale.get(e)})(),this.autoEdit=this.element.classList.contains("mv-autoedit"),this.autoSave=this.element.hasAttribute("mv-autosave"),this.autoSaveDelay=1e3*(this.element.getAttribute("mv-autosave")||0),Mavo.setAttributeShy(this.element,"typeof",""),Mavo.hooks.run("init-start",this),r(n.selectors.primitive,this.element).forEach(e=>{var t;o(n.selectors.property,e)&&(!(t=Mavo.Primitive.getConfig(e)).attribute&&!t.hasChildren||e.hasAttribute("mv-list-item"))&&e.setAttribute("mv-group","")}),this.expressions=new Mavo.Expressions(this),n.observers=n.observers||new Mavo.Observers,n.observers.observer.observe(this.element,{characterData:!0,childList:!0,subtree:!0,attributes:!0}),Mavo.hooks.run("init-tree-before",this),this.root=new Mavo.Group(this.element,this),this.treeBuilt.resolve(),Mavo.hooks.run("init-tree-after",this),this.permissions=new Mavo.Permissions;var i=["source","storage","init","uploads"];i.forEach(e=>this.updateBackend(e)),this.observe({deep:!1,attribute:!0},({attribute:e})=>{0===e.indexOf("mv-")&&(e=e?.replace(/^mv-/,"")?.split("-")?.[0],i.includes(e))&&(this.updateBackend(e),"source"!==e&&(this.source||"storage"!==e&&("init"!==e||this.root.data))||this.load())}),this.permissions.can("login",()=>{let e;var t;null!==Mavo.Functions.url("login")&&1===this.index?e="login":null!==Mavo.Functions.url(this.id+"-login")&&(e=this.id+"-login"),void 0!==e&&((t=new URL(location.href)).searchParams.delete(e),history.replaceState(null,"",t),this.primaryBackend.login())}),o.bind(this.element,"mv-login.mavo",e=>{e.backend!=(this.source||this.storage)||this.root.data||this.unsavedChanges||this.load()}),this.bar=new Mavo.UI.Bar(this),this.needsEdit=this.calculateNeedsEdit(),this.setUnsavedChanges(!1),this.permissions.onchange(({action:t,value:e})=>{var i=(i=this.element.getAttribute("mv-permissions")||"").trim().split(/\s+/).filter(e=>e!=t);e&&i.push(t),this.element.setAttribute("mv-permissions",i.join(" "))}),this.permissions.can(["edit","add","delete"],()=>{this.autoEdit&&this.edit()}),this.observe({attribute:"mv-mode"},({element:r})=>{if(this.permissions.edit||this.permissions.add||this.permissions.delete){var s=n.Node.children(r);for(let i=0;i<s.length;i++){var a=s[i];let e=a.mode,t;if(a.element==r)t=a.element.getAttribute("mv-mode"),a.modes=t;else{if(a.modes)continue;t=n.getStyle(a.element.parentNode,"--mv-mode")}a.mode=t,e!=a.mode&&a["edit"==a.mode?"edit":"done"]()}}}),this.primaryBackend?this.permissions.can("read",()=>this.load()):requestAnimationFrame(()=>{this.dataLoaded.resolve(),this.expressions.update(),this.element.dispatchEvent(new Event("mv-load",{bubbles:!0}))}),o.bind(this.element,"mv-load.mavo",e=>{var t;location.hash&&!(t=()=>{var e=document.getElementById(location.hash.slice(1));return!e&&location.hash||this.element.contains(e)&&requestAnimationFrame(()=>{Mavo.scrollIntoViewIfNeeded(e)}),e})()&&this.observe({attribute:"id",once:!0},t),requestAnimationFrame(()=>Stretchy.resizeAll())}),this.dataLoaded.then(async e=>{await Mavo.defer(),this.permissions.can("save",()=>{if(this.autoSave){let t=n.debounce(()=>{this.save()},this.autoSaveDelay);o.bind(this.element,"mv-change.mavo:autosave",e=>{e.node.saved&&this.autoSave&&t()})}},()=>{o.unbind(this.element,"mv-change.mavo:autosave")})}),this.element.addEventListener("keydown",e=>{var t,i=e.target;this.permissions.save&&"S"==e.key&&e[n.superKey]&&!e.altKey?(e.preventDefault(),this.save()):"ArrowUp"!==e.key&&"ArrowDown"!==e.key||i.matches("textarea, input[type=range], input[type=number]")||(i.matches(".mv-editor")&&(t=!0,i=i.parentNode),(i=Mavo.Node.get(i))?.closestCollection&&(i=i.getCousin("ArrowUp"===e.key?-1:1,{wrap:!0}))&&((t&&i.editing?(i.edit(),i.editor):i.element).focus(),e.preventDefault()))}),o.bind(this.element,"click submit",n.Actions.listener),Mavo.hooks.run("init-end",this)}get editing(){return this.root.editing}observe(e={},t){e=Object.assign({element:this.element},e);return n.observers?.observe(e,t)}unobserve(e,t){e=Object.assign({element:this.element},e);return n.observers?.unobserve(e,t)}getData(e){var t={context:this,options:e};return t.data=this.root.getData(e),n.hooks.run("getdata-end",t),t.data}toJSON(){return n.toJSON(this.getData())}message(e,t={}){return new n.UI.Message(this,e,t)}error(e,...t){this.message(e,{type:"error",dismiss:["button","timeout"]}),0<t.length&&console.log(`%c${this.id}: `+e,"color: red; font-weight: bold",...t)}render(e){e={context:this,data:e};n.hooks.run("render-start",e),e.data&&this.root.render(e.data),this.unsavedChanges=!1,n.hooks.run("render-end",e)}edit(){this.bar?.edit&&this.bar.edit.click(),this.root.edit(),o.bind(this.element,"mouseenter.mavo:edit mouseleave.mavo:edit",e=>{var t;e.target.matches(n.selectors.multiple)&&(e.target.classList.remove("mv-has-hovered-item"),t=e.target.parentNode.closest(n.selectors.multiple))&&t.classList.toggle("mv-has-hovered-item","mouseenter"==e.type)},!0),this.setUnsavedChanges()}done(){this.root.done(),o.unbind(this.element,".mavo:edit"),this.unsavedChanges=!1}setUnsavedChanges(t){var i=!!t;return t||this.walk(e=>{if(e.unsavedChanges)return!(i=!0)===t&&(e.unsavedChanges=!1),!1}),this.unsavedChanges=i}updateBackend(e){let i=this[e],r,s;var a="mv-"+e;if(r=(r=(r=1==this.index?n.Functions.url(e):r)||n.Functions.url(this.id+"-"+e)||n.Functions.url(this.id.toLowerCase()+"-"+e)||this.element.getAttribute(a)||null)&&"none"==(r=r.trim())?null:r){let t=a+"-";a=Mavo.getAttributes(this.element,RegExp("^"+t)),a=Object.fromEntries(a.map(e=>[e.replace(t,""),this.element.getAttribute(e)]));i?.equals?.(r)||(this[e]=r=n.Backend.create(r,{format:this.element.getAttribute("mv-format"),...a,mavo:this},i),s=!0,o.bind(r,"mv-login mv-logout",e=>{o.fire(this.element,e.type,{backend:r})}))}else this[e]=null;if(s=s||(r?!r.equals(i):Boolean(i))){this.storage||this.source||!this.init||(this.source=this.init,this.init=null);a=this.storage?this.storage.permissions:new Mavo.Permissions({edit:!0,save:!1});a.parent=this.source?.permissions,this.permissions.parent=a,this.primaryBackend=this.storage||this.source,this.sourceBackend=this.source||this.storage||this.init;let t=e=>{e.target!==this.sourceBackend?e.target.removeEventListener("mv-remotedatachange",t):this.push(e.data)};this.sourceBackend?.addEventListener("mv-remotedatachange",t)}return s}async push(e,{conflictPolicy:t="stop"}={}){if(this.unsavedChanges)if("ask"===t){if(!confirm(this._("remote-data-conflict")))return}else if("stop"===t)return;return this.load({data:e})}async load({backend:e,data:i}={}){var r=e;if((e=e??this.sourceBackend)||i){var t=this.autoSave;if(this.autoSave=!1,void 0===i){this.inProgress="Loading",await e.ready,i=null;try{i=await e.load()}catch(t){if(!r&&this.init&&this.init!==e){await this.init.ready;try{i=await this.init.load(),e=this.init}catch(e){}}if(t&&null===i){r=t instanceof Response||t instanceof XMLHttpRequest?t:t.xhr;if(404!==r?.status){let e=this._("problem-loading");r&&(e+=r.status?this._("http-error",t):": "+this._("cant-connect")),this.error(e,t)}}}this.inProgress=!1}this.render(i),await Mavo.defer(),this.dataLoaded.resolve(),this.element.dispatchEvent(new CustomEvent("mv-load",{detail:e,bubbles:!0})),this.autoSave=t}}async store(){if(this.storage){this.inProgress="Saving";let t;try{t=await this.storage.store(this.getData())}catch(e){var i;e&&(i=this._("problem-saving"),e instanceof XMLHttpRequest&&(i+=": "+(e.status?this._("http-error",e):this._("cant-connect"))),this.error(i,e)),t=null}return this.inProgress=!1,t}}upload(e,t="images/"+e.name){return this.uploadBackend?(this.inProgress="Uploading",this.uploadBackend.upload(e,t).then(e=>(this.inProgress=!1,e)).catch(e=>(this.error(this._("error-uploading"),e),this.inProgress=!1,null))):Promise.reject()}async save(){n.hooks.run("save-start",this);var e=await this.store();e&&(o.fire(this.element,"mv-save",e),this.lastSaved=Date.now(),this.root.save(),this.unsavedChanges=!1)}walk(){return this.root.walk(...arguments)}calculateNeedsEdit(){var i=!1;return this.walk((e,t)=>!i&&(i=!(e.modes||e instanceof Mavo.Group),!e.modes),void 0,{descentReturn:!0}),i}changed(e){this.root&&this.expressions.active&&this.expressions.updateThrottled(e)}setDeleted(...e){if(this.deleted.forEach(e=>e.destroy()),this.deleted.length=0,this.deletionNotice?.close(),e.length){if(this.deleted.push(...e),1==e.length)var t=e[0].name;else{var i,r={},s=[];for(i in e.forEach(e=>{r[e.name]=(r[e.name]||0)+1}),r)s.push(this._("n-items",{name:i,n:r[i]}));t=s.join(", ")}var a=this.deletionNotice=this.message([this._("item-deleted",{name:t}),{tag:"button",type:"button",textContent:this._("undo"),events:{click:e=>{this.undoDelete(),this.deletionNotice.close(!0)}}}],{classes:"mv-deleted",dismiss:{button:!0,timeout:2e4}});a.closed.then(e=>{!e&&this.deleted.length&&(this.deleted.forEach(e=>e.destroy()),this.deleted.length=0),this.deletionNotice==a&&(this.deletionNotice=null)})}}undoDelete(){this.deleted.forEach(e=>e.collection.add(e,e.index)),this.deleted.length=0}destroy(){Mavo.hooks.run("mavo-destroy-start",this),this.editing&&this.done(),this.observer.destroy(),this.bar?.destroy(),Mavo.all[this.id]=Mavo.all[this.index-1]=null,this.root.destroy(),Mavo.hooks.run("mavo-destroy-end",this)}static version="v0.2.4";static all={};static get(e){if(e instanceof Element){for(var t in n.all)if(n.all[t].element==e)return n.all[t];return null}var i="number"==typeof e?Object.keys(n.all)[e]:e;return n.all[i]||null}static superKey=0===navigator.platform.indexOf("Mac")?"metaKey":"ctrlKey";static base=["blob:","about:"].includes(location.protocol)?document.currentScript?.src||"https://mavo.io":location;static dependencies=[o.ready().then(()=>n.Plugins.load())];static polyfillsNeeded={blissfuljs:Array.from&&document.documentElement.closest&&self.URL&&"searchParams"in URL.prototype,"Intl.~locale.en":self.Intl,IntersectionObserver:self.IntersectionObserver,Symbol:self.Symbol,"Element.prototype.remove":Element.prototype.remove,"Element.prototype.before":Element.prototype.before,"Element.prototype.after":Element.prototype.after,"Element.prototype.prepend":Element.prototype.prepend,"Array.prototype.flat":Array.prototype.flat,"Array.prototype.flatMap":Array.prototype.flatMap};static polyfills=[];static init(e=document){return(Array.isArray(arguments[0])?arguments[0]:r(n.selectors.init,e)).filter(e=>!n.get(e)).map(e=>new n(e))}static observe(e,t){return n.observers=n.observers||new Mavo.Observers,n.observers.observe(e,t)}static unobserve(e,t){n.observers.unobserve(e,t)}static warn(e,t={}){n.warn.history=n.warn.history||new Set,n.warn.history.has(e)||console.warn(e),!1!==t.once&&n.warn.history.add(e)}static thenAll(t){return r(t).forEach(e=>{"promise"==o.type(e)&&e.catch(e=>e)}),Promise.all(t).then(e=>t.length!=e.length?n.thenAll(t):e)}static promise(i){let r,s,t=new Promise((e,t)=>{"function"==typeof i?i(e,t):i instanceof Promise&&(i.then(e),i.catch(t)),r=e,s=t});return t.resolve=e=>(r(e),t),t.reject=e=>(s(e),t),t}static defer=t=>new Promise(e=>void 0===t?requestAnimationFrame(e):setTimeout(e,t));static UI={};static hooks=new o.Hooks;static properties=new Set;static attributes=["mv-app","mv-storage","mv-source","mv-init","mv-path","mv-format","mv-attribute","mv-default","mv-mode","mv-edit","mv-editor","mv-permisssions","mv-rel","mv-value"]},{live:{inProgress(e){o.toggleAttribute(this.element,"mv-progress",e,e),o.toggleAttribute(this.element,"aria-busy",!!e,!!e),this.element.style.setProperty("--mv-progress-text",e?`"${this._(e)}"`:"")},unsavedChanges(e){this.element.classList.toggle("mv-unsaved-changes",e)},needsEdit(e){this.bar&&this.bar.toggle("edit",e&&this.permissions.edit)},storage(e){e===this._storage||e||((e=new Mavo.Permissions({edit:!0,save:!1})).parent=this.permissions.parent,this.permissions.parent=e)},primaryBackend(e){if((e=e||null)!=this._primaryBackend)return e},uploadBackend:{get(){var e=this.uploads;return e?.upload?(e.permissions.login&&e.login(),this.uploads):this.storage?.upload?this.storage:void 0}}},lazy:{locale:()=>document.documentElement.lang||"en-GB"}});["toNode","isProxy","route","parent","property","mavo","groupedBy","as"].forEach(e=>{o.lazy(n,e,()=>Symbol(e))}),Object.defineProperty(n.all,"length",{get:function(){return Object.keys(this).length}});var e=n.selectors={init:"[mv-app], [data-mv-app]",property:"[property]",group:"[typeof], [mv-group]",list:"[mv-list]",multiple:"[mv-list-item]",formControl:"input, select, option, textarea",textInput:["text","email","url","tel","search","number"].map(e=>`input[type=${e}]`).join(", ")+", input:not([type]), textarea",ui:".mv-ui"};e.primitive=e.property+`:not(${e.group}, ${e.list})`,e.childGroup=e.property+`:is(${e.group})`,e.scope=`:is(${e.group}, ${e.multiple}, ${e.list})`,e.item=e.multiple+", "+e.group,e.output="[property=output], .mv-output",o.each(n.polyfillsNeeded,(e,t)=>{t||n.polyfills.push(e)}),n.ready=n.thenAll(n.dependencies),n.inited=n.promise(),await n.defer(),0<n.polyfills.length&&(e="https://cdn.polyfill.io/v2/polyfill.min.js?unknown=polyfill&features="+n.polyfills.map(e=>e+"|gated").join(","),n.dependencies.push(o.include(e))),await o.ready(),Mavo.attributeStartsWith("data-mv-").forEach(e=>{var t=e.ownerElement,i=e.name.replace("data-","");Mavo.setAttributeShy(t,i,e.value)}),r("[mv-list]:not([property])").forEach(e=>e.setAttribute("property",e.getAttribute("mv-list"))),r("[mv-list-item]:not([property])").forEach(e=>e.setAttribute("property",e.getAttribute("mv-list-item"))),n.containers={TR:"TBODY",OPTION:"OPTGROUP"},r("[mv-list]").forEach(t=>{var e;o(":scope > [mv-list-item]",t)||(1!==t.children.length||t.children[0].matches("[property]")?(e=Object.entries(n.containers).filter(([,e])=>e===t.tagName)[0]||"div",o.create(e,{className:"mv-container","mv-list-item":"",contents:[...t.childNodes],inside:t})):t.children[0].setAttribute("mv-list-item",""))}),r("[mv-list-item], [mv-multiple]").forEach(e=>{let t;e.hasAttribute("mv-list-item")||(i=e.getAttribute("mv-multiple"),e.setAttribute("mv-list-item",i),e.hasAttribute("property")||(i?e.setAttribute("property",i):(i=n.Node.getImplicitPropertyName(e)||n.Node.generatePropertyName("collection",e),e.setAttribute("property",i))),t=!0,Mavo.warn("@mv-multiple is deprecated. Please use @mv-list-item and @mv-list instead")),e.hasAttribute("property")||e.setAttribute("property",e.getAttribute("mv-list-item"));var i=e.parentNode;let r=i;var s=Mavo.Node.getProperty(e),i=(i.hasAttribute("mv-list")||(1===i.children.length&&!i.matches("[mv-app], [property], [mv-list-item]")||(i=n.containers[e.tagName]||"div",r=o.create(i,{className:"mv-container",around:e})),r.setAttribute("mv-list",""),s&&r.setAttribute("property",s),Mavo.moveAttribute("mv-initial-items",e,r),Mavo.moveAttribute("mv-order",e,r),Mavo.moveAttribute("mv-accepts",e,r),t?(Mavo.moveAttribute("mv-value",e,r),Mavo.moveAttribute("mv-mode",e,r),Mavo.moveAttribute("mv-multiple-path",e,r,{rename:"mv-path"})):Mavo.warn("Please wrap @mv-list-item elements with @mv-list elements")),r.getAttribute("property")),s=e.getAttribute("property");!i&&s?r.setAttribute("property",s):i===s&&i||(s=Mavo.Node.getProperty(r)||Mavo.Node.generatePropertyName("item",r),i||r.setAttribute("property",s),e.setAttribute("property",s))}),r("[property='']").forEach(e=>{var t=Mavo.Node.getProperty(e)||Mavo.Node.generatePropertyName("prop",e);e.setAttribute("property",t)}),r(n.selectors.init).forEach(function(e){n.get(e)||e.setAttribute("mv-progress","Loading")}),window.CSSPropertyRule&&document.documentElement.classList.add("mv-supports-atproperty"),await n.ready,n.init(),n.inited.resolve()}(Bliss,Bliss.$),function(a,i){var o=a.extend(Mavo,{load:(e,t=document.currentScript?.src??location)=>a.load(e,t),readFile:(i,r="DataURL")=>{var s=new FileReader;return new Promise((t,e)=>{s.onload=e=>t(s.result),s.onerror=s.onabort=e,s["readAs"+r](i)})},toJSON:e=>{if(null===e)return"";if("string"==typeof e)return e;try{return JSON.stringify(e,null,"\t")}catch(e){return e}},safeToJSON:function(e){var i=new WeakSet;return JSON.stringify(e,(e,t)=>{if("object"==typeof t&&null!==t){if(i.has(t))return;i.add(t)}return t})},isPlainObject:e=>{return"object"===a.type(e)&&"Object"===Object.getPrototypeOf(e).constructor?.name},primitivify:(e,t)=>(e&&(t&&"object"==typeof t&&(Object.assign(e,t),t=Mavo.value(t)),e.valueOf=e.toJSON=e[Symbol.toPrimitive]=()=>t),e),objectify:(e,t)=>{var i,r=Mavo.value(e);return"object"==typeof e&&null!==e||(null===e?e={[Symbol.toStringTag]:"Null",toJSON:()=>null}:(e=new(i=e.constructor)(r))[Symbol.toStringTag]=i.name,o.primitivify(e,r)),a.extend(e,t)},value:e=>e?.valueOf?e.valueOf():e,toArray:e=>void 0===e?[]:Array.isArray(e)?e:[e],union:(t,e)=>t instanceof Set&&e?(e.forEach(e=>t.add(e)),t):new Set([...t||[],...e||[]]),getStyle:(e,t)=>{if(e)return getComputedStyle(e).getPropertyValue(t)?.trim()},data:function(e,t,i){var r,s;return e?(r=o.elementData.get(e)||{},2==arguments.length?s=r[t]:void 0===i?delete r[t]:s=r[t]=i,o.elementData.set(e,r),s):null},elementData:new WeakMap,elementPath:function(e,t){if(Array.isArray(t)){var i=(o=t).reduce((e,t)=>e.children[t>>0]||e,e),r=o[o.length-1];if(r!=r>>0){var s=+(r+"").split(".")[1];r>>0<0&&(i=i.firstChild,s--);for(var a=0;a<s;a++)i=i.nextSibling}return i}for(var o=[],n=t;n&&n!=e;n=n.parentNode){for(var l=0,h=n===t&&1!==t.nodeType,s=h?1:0,u=n;u=u[`previous${h?"":"Element"}Sibling`];)h?(s++,1==u.nodeType&&(h=!1)):l++;o.unshift(l=0<s?l-1+"."+s:l)}return n?o:null},revocably:{add:function(e,t){var i=o.revocably.isRemoved(e);return i?.parentNode?i.parentNode.replaceChild(e,i):e&&t&&!e.parentNode&&("function"==typeof t?t(e):t.appendChild(e)),i},remove:function(e,t){var i;if(e)return(i=o.data(e,"commentstub"))||(t=t||e.id||e.className||e.nodeName,i=o.data(e,"commentstub",document.createComment(t))),e.parentNode&&e.parentNode.replaceChild(i,e),i},isRemoved:function(e){return!(!e||e.parentNode||!(e=o.data(e,"commentstub"))?.parentNode)&&e},setAttribute:function(e,t,i){void 0===o.data(e,"attribute-"+t)&&o.data(e,"attribute-"+t,e.getAttribute(t)),e.setAttribute(t,i)},restoreAttribute:function(e,t){var i=o.data(e,"attribute-"+t);void 0!==i&&(a.toggleAttribute(e,t,i),o.data(e,"attribute-"+t,void 0))}},inView:{is:e=>{e=e.getBoundingClientRect();return(0<=e.bottom&&e.bottom<=innerHeight||0<=e.top&&e.top<=innerHeight)&&(0<=e.right&&e.right<=innerWidth||0<=e.left&&e.left<=innerWidth)},when:(r,e=`${innerHeight/2}px ${innerWidth/2}px`)=>{var s=o.inView.observer=o.inView.observer||new IntersectionObserver(function(e,t){e.forEach(e=>{0<e.intersectionRatio&&(t.unobserve(e.target),a.fire(e.target,"mv-inview",{entry:e}))})},{rootMargin:e});return new Promise(t=>{o.inView.is(r)&&t(),s.observe(r);var i=e=>{r.removeEventListener("mv-inview",i),e.stopPropagation(),t()};r.addEventListener("mv-inview",i)})}},scrollIntoViewIfNeeded:e=>{e&&!Mavo.inView.is(e)&&e.scrollIntoView({behavior:"smooth"})},setAttributeShy:function(e,t,i){e.hasAttribute(t)||e.setAttribute(t,i)},getAttribute:function(i,...r){for(let e=0,t;t=r[e];e++){var s=i.getAttribute(t);if(s)return s}return null},getClosestAttribute:function(e,t){return e.closest(`[${t}]`)?.getAttribute(t)??null},moveAttribute(e,t,i,r={}){var s=t.getAttribute(e);null!==s&&(r=r.rename||e,i.setAttribute(r,s),t.removeAttribute(e))},getTarget:function(){var e=location.hash.substr(1);return document.getElementById(e)},XPath:function(e,t=document){var i,r=t.ownerDocument||t,s=[];if(r.evaluate)for(var a=r.evaluate(e,t,null,XPathResult.ANY_TYPE,null);i=a.iterateNext();)s.push(i);return s},attributeStartsWith:function(e,t=document.documentElement){return o.XPath(`.//@*[starts-with(name(), "${e}")]`,t)},getAttributes:function(e,t){return e.getAttributeNames().filter(e=>t.test(e))},usePropertyInsteadOfAttribute:function(e,t){return!(-1<["href","src"].indexOf(t)||t.startsWith("on")||"http://www.w3.org/2000/svg"==e.namespaceURI)},in:function(e,t){if(t)return"object"==typeof t&&e in t||void 0!==t[e]},getCanonicalProperty:function(e,t){if(e&&(t||0===t))return o.in(t,e)?t:t.toLowerCase?(t=t.toLowerCase(),o.in(t,e)?t:-1<(t=(e=Object.keys(e)).map(e=>e.toLowerCase()).indexOf(t))?e[t]:void 0):void 0},subset:function(e,o,t){var i,r;return 3==arguments.length?o.length?(i=o[o.length-1],r=a.value(e,...o.slice(0,-1)),Array.isArray(r)&&Array.isArray(t)?r.splice(i,1,...t):r&&(r[o[o.length-1]]=t),e):t:"object"==typeof e&&o?.length?o.reduce((e,t,i)=>{let r,s=t?.startsWith?.("id=")?t.substring(3):null;var a;return null!==s?(a=e.findIndex(e=>Mavo.Functions.get(e,"id")==s),r=-1<a?e[a]:{id:s},o[i]=-1<a?a:e.length):(r=Mavo.Functions.get(e,t),o[i]=t),r},e):e},clone:function(e){return e&&"object"==typeof e?JSON.parse(o.safeToJSON(e)):e},shallowClone:function(e){return e&&"object"==typeof e?Array.isArray(e)?[...e]:a.extend({},e):e},debounce:function(i,r){var s,a;return r?(s=null,function(){var e=this,t=arguments;a=function(){i.apply(e,t),removeEventListener("beforeunload",a)},clearTimeout(s),s=setTimeout(a,r),addEventListener("beforeunload",a)}):i},escapeRegExp:e=>e.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),observeResize:function(e,i){var r,t;if(self.ResizeObserver)return r=null,(t=i instanceof ResizeObserver?i:new ResizeObserver(e=>{var t=e[e.length-1].contentRect;r&&r.width==t.width&&r.height==t.height||(i(e),r=t)})).observe(e),t},Observer:class{constructor(e,t,i,r={}){i instanceof MutationObserver&&(this.observer=i),this.observer=this.observer||new MutationObserver(i),this.callback=i,this.update(e,t,r),this.run()}update(e,t,i){this.element=e,this.attribute=t,this.options=a.extend({},i),void 0!==i&&(i.attributes||i.childList||i.characterData)||(this.attribute&&Object.assign(this.options,{attributes:!0,attributeFilter:"all"==this.attribute?void 0:Mavo.toArray(this.attribute),attributeOldValue:!!i.oldValue}),this.attribute&&"all"!=this.attribute)||Object.assign(this.options,{characterData:!0,childList:!0,subtree:!0,characterDataOldValue:!!i.oldValue}),this.observer?.running&&(this.stop(),this.run())}flush(){var e=this.observer?.takeRecords();e&&this.callback(e)}stop(){return this.observer?.disconnect(),this.running=!1,this}run(){return this.observer&&(this.observer.observe(this.element,this.options),this.running=!0),this}pause(){this.runOnResume=this.running,this.stop()}resume(){!1!==this.runOnResume&&this.run(),delete this.runOnResume}destroy(){this.stop(),this.observer=this.element=null}},rr:function(e){return e(),e},wrap:(e,t)=>e<0?t-1:t<=e?0:e,options:(e,{map:s}={})=>{var a=s?new Map:{};return e.trim().match(/(?:\\[,;]|[^,;])+/g)?.forEach(i=>{if(i){var r=(i=i.trim().replace(/\\([,;])/g,"$1")).match(/^\s*((?:\\:|[^:])*?)\s*:\s*(.+)$/);let e,t;t=r?(e=r[1].replace(/\\:/g,":"),"false"!==r[2]&&r[2]):(e=i,!0),s?a.set(e,t):a[e]=t}}),a},BucketMap:class{constructor({arrays:e=!1}={}){this.map=new Map,this[Symbol.iterator]=this.map[Symbol.iterator],this.arrays=e}set(e,t){var i;this.arrays?(i=this.map.get(e)||[]).push(t):(i=this.map.get(e)||new Set).add(t),this.map.set(e,i)}delete(e,t){var i,r;2==arguments.length?(i=this.map.get(e))&&(this.arrays?-1<(r=i.indexOf(t))&&i.splice(r,1):i.delete(t)):this.map.delete(e)}forEach(...e){return this.map.forEach(...e)}}});function e(){var e=o.getTarget();const t="mv-target-within";for(i("."+t).forEach(e=>e.classList.remove(t));e?.classList;)e.classList.add(t),e=e.parentNode}o.Observers=class extends Map{constructor({observer:e,callback:t}={}){super();var i=o.Observers;this.callback=t||i.callback,this.observer=e||(i.observer=i.observer||new MutationObserver(this.callback))}applyRecord(e){for(var[t,i]of this.entries()){var r;o.Observers.matchesRecord(t,e)&&(r=Mavo.Node.get(e.target,!0),i.call(this,{node:r,element:e.target,type:e.type,attribute:e.attributeName,record:e}),t.once)&&this.unobserve(t,i)}}static matchesRecord(e,t){if(!1===e.active)return!1;var i=t.target;if(e.selector&&!i.matches?.(e.selector))return!1;if(e.attribute){if("attributes"!==t.type)return!1;if(!0!==e.attribute&&e.attribute!==t.attributeName&&!e.attribute.includes?.(t.attributeName))return!1}else if("attributes"===t.type&&!1===e.attribute)return!1;return!e.element||(!1===e.deep?i===e.element:e.element.contains(i))}flush(){var e=this.observer.takeRecords();e&&this.callback(e)}observe(e={},t){return this.set(e,t),t}unobserve(e,t){var i,r;for([i,r]of this.find(e,t).entries())this.delete(i)}pause(e){var t,i,e=this.find(e);for([t,i]of e.entries())t._active=!1!==t.active&&!1!==t._active,t.active=!1;return this.flush(),e}resume(e){e instanceof o.Observers||(e=this.find(e)),this.flush();for(var[t,i]of e.entries())t.active=t.active||t._active,delete t._active}find(i={},r){var s=Object.keys(i),a=new Mavo.Observers;for(let[t,e]of this.entries())r&&r!==e||s.every(e=>t[e]===i[e])&&a.set(t,e);return a}},o.Observers.callback=e=>{if(0!==this.size)for(var t of e)o.observers.applyRecord(t)},a.proxy=a.classProps.proxy=a.overload(function(e,t,i){return Object.defineProperty(e,t,{get:function(){return this[i][t]},set:function(e){this[i][t]=e},configurable:!0,enumerable:!0}),e}),document.addEventListener("mv-load",e),addEventListener("hashchange",e),Mavo.observe({attribute:"id"},e)}(Bliss,Bliss.$),function(t,i){var r=Mavo.Locale=t.Class({constructor:function(e,t){this.lang=e,this.phrases={},this.extend(t)},get fallback(){return r.all[this.baseLang]||(this!==r.default?r.default:void 0)},extend:function(e){t.extend(this.phrases,e)},phrase:function(e,t){var e=e.toLowerCase(),i=this.phrases[e];return void 0===(i=void 0===i&&this.fallback?this.fallback.phrase(e):i)?i=e.replace(/\b-\b/g," "):t&&(e=i.match(/\{\w+(?=\})/g)?.map(e=>e.slice(1))??[],Mavo.Functions.unique(e).forEach(e=>{e in t&&(i=i.replace(RegExp(`{${e}}`,"gi"),t[e]))})),i},live:{lang:function(e){this.baseLang=r.getBaseLang(e),e==this.baseLang&&(this.baseLang=null)}},static:{all:{},register:function(e,t){r.all[e]?r.all[e].extend(t):r.all[e]=new r(e,t)},match:function(e=""){return r.all[e]||r.all[r.getBaseLang(e)]},get:function(e){return r.match(e)||r.default},getBaseLang:function(e){return e.split("-")[0]},lazy:{default:()=>r.match(Mavo.locale)||r.all.en}}});Mavo.prototype._=function(e,t){return this.locale&&e?this.locale.phrase(e,t):e},Mavo.ready.then(()=>{i("datalist.mv-phrases[lang]").forEach(e=>{var t=i("option",e).reduce((e,t)=>(e[t.value]=t.textContent.trim(),e),{});Mavo.Locale.register(e.lang,t)})})}(Bliss,Bliss.$),Mavo.Locale.register("en",{second:"second",seconds:"seconds",minute:"minute",minutes:"minutes",hour:"hour",hours:"hours",day:"day",days:"days",week:"week",weeks:"weeks",month:"month",months:"months",year:"year",years:"years",edit:"Edit",editing:"Editing",save:"Save",import:"Import",export:"Export",logout:"Logout",login:"Login",loading:"Loading",uploading:"Uploading",saving:"Saving",dismiss:"Dismiss","logged-in-as":"Logged in to {id} as ","login-to":"Login to {id}","error-uploading":"Error uploading file","cannot-load-uploaded-file":"Cannot load uploaded file",filename:"Filename?","problem-saving":"Problem saving data","problem-loading":"Problem loading data","cannot-parse":"Can’t understand this file","http-error":"HTTP error {status}: {statusText}","cant-connect":"Can’t connect to the Internet","add-item":"Add {name}","add-item-before":"Add new {name} before","add-item-after":"Add new {name} after","drag-to-reorder":"Drag to reorder {name}","delete-item":"Delete this {name}","item-deleted":"{name} deleted","n-items":"{n} {name} items",undo:"Undo","gh-updated-file":"Updated {name}","gh-login-fork-options":"You have your own copy of this page, would you like to use it?","gh-use-my-fork":"Yes, show me my data.","remote-data-conflict":"There is new data but you have unsaved changes. Loading it will overwrite your changes. Load new data?"}),function(o,t){Mavo.attributes.push("mv-plugins");let n=Mavo.Plugins={loaded:{},async load(){n.plugins=new Set;let s={};var e;if(t("[mv-plugins]").forEach(e=>{e.getAttribute("mv-plugins").trim().split(/\s+/).forEach(e=>{var[e,t]=e.split("@");n.plugins.add(e),s[e]=t})}),n.plugins.size)return e=(await(await fetch(n.url+"/plugins.json")).json()).plugin,Mavo.thenAll(e.filter(e=>n.plugins.has(e.id)).map(async t=>{if(n.loaded[t.id])return Promise.resolve();var i=`mavo-${t.id}.js`;let r;if(t.repo){var e=s[t.id]||"latest";r=`https://cdn.jsdelivr.net/gh/${t.repo}@${e}/`+i;try{return await o.include(n.loaded[t.id],r)}catch(e){r=`https://cdn.jsdelivr.net/gh/${t.repo}/`+i;try{return await o.include(n.loaded[t.id],r)}catch(e){r="/res/js/lib/"+i}}}else r=`${n.url}/${t.id}/`+i;return o.include(n.loaded[t.id],r)}))},register:function(e,i={}){if(!n.loaded[e]){for(var t in Mavo.hooks.add(i.hooks),i.extend){var r="Mavo"==t?Mavo:Mavo[t];"function"===o.type(r)?o.Class(r,i.extend[t]):o.extend(r,i.extend[t])}var s=[];if(i.ready&&s.push(i.ready),i.dependencies){let t=document.currentScript?document.currentScript.src:location;var a=i.dependencies.map(e=>Mavo.load(e,t));s.push(...a)}s.length&&Mavo.dependencies.push(...s),(n.loaded[e]=i).init&&Promise.all(s).then(()=>i.init())}},url:"https://plugins.mavo.io"}}(Bliss,Bliss.$),function(s,e){Mavo.attributes.push("mv-bar");let h=Mavo.UI.Bar=class{constructor(e){if(this.mavo=e,this.element=s(".mv-bar",this.mavo.element),this.template=this.mavo.element.getAttribute("mv-bar")||"",Mavo.observers.pause(),this.element)for(var t in this.custom=!0,this.template+=" "+(this.element.getAttribute("mv-bar")||""),this.template=this.template.trim(),h.controls)this[t]=s(".mv-"+t,this.element),this[t]&&(this.template=this.template||"with",this.template+=" "+t);else this.element=s.create({className:"mv-bar mv-ui",start:"HTML"===this.mavo.element.tagName?document.body:this.mavo.element,innerHTML:"<button>&nbsp;</button>"});this.element.classList.contains("mv-compact")&&(this.noResize=!0),this.controls=h.getControls(this.template),this.controls.length&&(this.targetHeight=this.element.offsetHeight),this.custom||(this.element.innerHTML="");for(let t of this.controls){let e=h.controls[t];for(var i in this[t]&&this[t].remove(),e.create?this[t]=e.create.call(this.mavo,this[t]):this[t]||(this[t]=s.create("button",{type:"button",className:"mv-"+t,textContent:this.mavo._(t)})),this.add(t),e.permission?this.permissions.can(e.permission,()=>{this.toggle(t,!e.condition||e.condition.call(this.mavo))},()=>{this.remove(t)}):e.condition&&!e.condition.call(this.mavo)&&this.remove(t),e.events)s.bind(this[t],i,e.events[i].bind(this.mavo))}for(var r in h.controls){let t=h.controls[r];t.action&&s.delegate(this.mavo.element,"click",".mv-"+r,e=>{t.permission&&!this.permissions.is(t.permission)||(t.action.call(this.mavo),e.preventDefault())})}this.controls.length&&!this.noResize&&(this.resize(),self.ResizeObserver)&&(this.resizeObserver=Mavo.observeResize(this.element,e=>{this.resize()})),Mavo.observers.resume()}resize(){this.targetHeight?(this.resizeObserver?.disconnect(),this.element.classList.remove("mv-compact","mv-tiny"),e("button, .mv-button",this.element).forEach(e=>{e.title===e.textContent&&(e.title="")}),this.element.offsetHeight>1.6*this.targetHeight&&(this.element.classList.add("mv-compact"),this.element.offsetHeight>1.2*this.targetHeight)&&(this.element.classList.add("mv-tiny"),e("button, .mv-button",this.element).forEach(e=>{e.title||(e.title=e.textContent)})),this.resizeObserver?.observe(this.element)):this.targetHeight=this.element.offsetHeight}add(e){var t=h.controls[e];t.prepare&&t.prepare.call(this.mavo),Mavo.revocably.add(this[e],this.element),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())}remove(e){var t=h.controls[e];Mavo.revocably.remove(this[e],"mv-"+e),t.cleanup&&t.cleanup.call(this.mavo),this.resizeObserver||this.noResize||requestAnimationFrame(()=>this.resize())}toggle(e,t){return this[t?"add":"remove"](e)}get permissions(){return this.mavo.permissions}destroy(){this.resizeObserver.disconnect(),this.resizeObserver=null}static getControls(e,t=h.controls){if("none"===(e=e?.trim()))return[];let i=Object.keys(t);if(!e)return i.filter(e=>!t[e].optional);var r,s,a,o,n=/^with\s|\bno-\w+\b/.test(e);let l=(e=e.replace(/\b^with\s+/g,"")).split(/\s+/);i=new Set(i);for(r of l=new Set(l))r.startsWith("no-")?(l.delete(r),r=r.slice(3),l.has(r)||i.delete(r)):i.has(r)||l.delete(r);if(!n)return[...l];for(s of i)t[s].optional&&!l.has(s)&&i.delete(s);return i=[...i],0===l.size?i:(e=[...l].map(e=>i.indexOf(e)),n=Math.min(...e),e=Math.max(...e),a=i.slice(0,n),o=i.slice(e+1),n=i.slice(n,e+1).filter(e=>!l.has(e)),[...a,...n,...l,...o])}};h.controls={status:{create:function(e){return e||s.create({className:"mv-status"})},prepare:function(){var t=this.primaryBackend;if(t?.user){var i=t.user;let e=[i.name||""];i.avatar&&e.unshift(s.create("img",{className:"mv-avatar",src:i.avatar})," "),i.url&&(e=[s.create("a",{href:i.url,target:"_blank",contents:e})]),this.bar.status.textContent="",s.contents(this.bar.status,[{tag:"span",innerHTML:this._("logged-in-as",t)}," ",...e])}},permission:"logout"},edit:{action:function(){this.editing?(this.done(),this.bar.edit.textContent=this._("edit")):(this.edit(),this.bar.edit.textContent=this._("editing"))},permission:["edit","add","delete"],cleanup:function(){this.editing&&(this.done(),this.bar?.edit)&&(this.bar.edit.textContent=this._("edit"))},condition:function(){return this.needsEdit}},save:{action:function(){this.save()},events:{"mouseenter focus":function(){this.element.classList.add("mv-highlight-unsaved")},"mouseleave blur":function(){this.element.classList.remove("mv-highlight-unsaved")}},permission:"save",condition:function(){return!this.autoSave||0<this.autoSaveDelay}},export:{create:function(e){let t;return(t=e?e.matches("a")?e:s.create("a",{className:"mv-button",around:e}):s.create("a",{className:"mv-export mv-button",textContent:this._("export")})).setAttribute("download",this.id+".json"),t},events:{mousedown:function(){this.bar.export.href="data:application/json;charset=UTF-8,"+encodeURIComponent(this.toJSON())}},permission:"edit",optional:!0},import:{create:function(e){e=e||s.create("span",{role:"button",tabIndex:"0",className:"mv-import mv-button",textContent:this._("import"),events:{focus:e=>{t.focus()}}});let t=s.create("input",{type:"file",inside:e,events:{change:e=>{e=e.target.files[0];if(e){let i=s.extend(new FileReader,{onload:e=>{this.inProgress=!1;try{var t=JSON.parse(i.result);this.render(t)}catch(e){this.error(this._("cannot-parse"))}},onerror:e=>{this.error(this._("problem-loading"))}});this.inProgress=this._("uploading"),i.readAsText(e)}}}});return e},optional:!0},login:{action:function(){this.primaryBackend.login()},permission:"login"},logout:{action:function(){this.primaryBackend.logout()},permission:"logout"}}}(Bliss,Bliss.$),function(a){Mavo.UI.Message=a.Class({constructor:function(e,t,i={}){var r,s;this.mavo=e,this.message=t,this.closed=Mavo.promise(),this.options=i,this.element=a.create({className:"mv-ui mv-message"+(i.type?" mv-"+i.type:""),["string"==a.type(this.message)?"innerHTML":"contents"]:this.message,events:{click:e=>Mavo.scrollIntoViewIfNeeded(this.mavo.element)},[this.mavo.bar?"after":"start"]:(this.mavo.bar||this.mavo).element}),i.style&&a.style(this.element,i.style),i.classes&&this.element.classList.add(...i.classes.split(/\s+/)),"error"==i.type?this.element.setAttribute("role","alert"):this.element.setAttribute("aria-live","polite"),i.dismiss=i.dismiss||{},"string"!=typeof i.dismiss&&!Array.isArray(i.dismiss)||(r={},Mavo.toArray(i.dismiss).forEach(e=>{r[e]=!0}),i.dismiss=r),i.dismiss.button&&a.create("button",{type:"button",className:"mv-close mv-ui",textContent:"×",events:{click:e=>this.close()},start:this.element,title:this.mavo._("dismiss")}),i.dismiss.timeout&&(s="number"==typeof i.dismiss.timeout?i.dismiss.timeout:5e3,a.bind(this.element,{mouseenter:e=>clearTimeout(this.closeTimeout),mouseleave:Mavo.rr(e=>this.closeTimeout=setTimeout(()=>this.close(),s))})),i.dismiss.submit&&this.element.addEventListener("submit",e=>{e.preventDefault(),this.close(e.target)})},async close(e){clearTimeout(this.closeTimeout);var t=this.element.style.transition?1e3*parseFloat(window.getComputedStyle(this.element,null).transitionDuration):400;await a.transition(this.element,{opacity:0},t),a.remove(this.element),this.closed.resolve(e)}})}(Bliss,Bliss.$),function(t){var s=Mavo.Permissions=t.Class({constructor:function(e){this.triggers=[],this.hooks=new t.Hooks,this.parentChanged=s.prototype.parentChanged.bind(this),this.set(e)},set:function(e){for(var t in e)this[t]=e[t]},on:function(e){return Mavo.toArray(e).forEach(e=>this[e]=!0),this},off:function(e){return(e=Array.isArray(e)?e:[e]).forEach(e=>this[e]=!1),this},can:function(e,t,i){this.observe(e,!0,t),i&&this.cannot(e,i)},cannot:function(e,t){this.observe(e,!1,t)},observe:function(e,t,i){e=Mavo.toArray(e),this.is(e,t)&&i(),this.triggers.push({actions:e,value:t,callback:i,active:!0})},is:function(e,t=!0){e=Mavo.toArray(e).map(e=>!!this[e]).reduce((e,t)=>e||t);return t?e:!e},onchange:function(t){this.hooks.add("change",t),s.actions.forEach(e=>{t.call(this,{action:e,value:this[e]})})},parentChanged:function(e={}){void 0===this["_"+e.action]&&e.from!=e.value&&(this.fireTriggers(e.action),this.hooks.run("change",t.extend({context:this},e)))},changed:function(e,t,i){(t=!!t)!=(i=!!i)&&(this["_"+e]=t,this.fireTriggers(e),this.hooks.run("change",{action:e,value:t,from:i,context:this}))},fireTriggers:function(i){this.triggers.forEach(e=>{var t=this.is(e.actions,e.value);e.active&&-1<e.actions.indexOf(i)&&t?(e.active=!1,e.callback()):t||(e.active=!0)})},or:function(t){return s.actions.forEach(e=>{this[e]=this[e]||t[e]}),this},live:{parent:function(t){var e,i=this._parent;i!=t&&(this._parent=t,i&&-1<(e=i.hooks.change.indexOf(this.parentChanged))&&i.hooks.change.splice(e,1),s.actions.forEach(e=>{this.parentChanged({action:e,value:t?t[e]:void 0,from:i?i[e]:void 0})}),t)&&t.onchange(this.parentChanged)}},static:{actions:[],register:function(i,r){Array.isArray(i)?i.forEach(e=>s.register(e,r)):(t.live(s.prototype,i,{get:function(){var e=this["_"+i];return void 0===e&&this.parent?this.parent[i]:e},set:function(e,t){r&&r.call(this,e,t),this.changed(i,e,t)}}),s.actions.push(i))}}});s.register(["read","save"]),s.register("login",function(e){e&&this.logout&&(this.logout=!1)}),s.register("logout",function(e){e&&this.login&&(this.login=!1)}),s.register("edit",function(e){e&&(this.add=this.delete=!0)}),s.register(["add","delete"],function(e){e||(this.edit=!1)})}(Bliss,Bliss.$),function(n){var s=Mavo.Backend=class extends EventTarget{constructor(e,t={}){super(),this.permissions=new Mavo.Permissions,this.update(e,t)}update(e,t={}){this.source=e,this.url=new URL(this.source,Mavo.base),this.options=t,this.mavo=t.mavo,this.format=Mavo.Formats.create(t.format,this),(this.constructor.key??t.key)&&(this.key=t.key??this.constructor.key)}async get(e=new URL(this.url)){"data:"!=e.protocol&&!1!==this.constructor.useCache&&e.searchParams.set("timestamp",Date.now());try{var t=await fetch(e.href);return t.ok?t.text():Promise.reject(t)}catch(e){return null}}async load(){await this.ready;let e=await this.get();return"string"!=typeof e?e:(e=e.replace(/^\ufeff/,""),this.format.parse(e))}async store(e,{path:t,format:i=this.format}={}){await this.ready;i="string"==typeof e?e:await i.stringify(e);return await this.put(i,t),{data:e,serialized:i}}ready=Promise.resolve();async login(){}async logout(){}put(){return Promise.reject()}isAuthenticated(){return!!this.accessToken}oAuthParams=()=>"";toString(){return`${this.id} (${this.url})`}equals(e){return e===this||e&&this.id==e.id&&this.source==e.source}async request(e,t,i="GET",r={}){if((r=Object.assign({},r)).method=r.method||i,r.responseType=r.responseType||"json",r.headers=Object.assign({"Content-Type":"application/json; charset=utf-8"},r.headers||{}),this.isAuthenticated()&&(r.headers.Authorization=r.headers.Authorization||"Bearer "+this.accessToken),r.body=t,e=new URL(e,this.constructor.apiDomain),"GET"==r.method&&!1!==this.constructor.useCache&&e.searchParams.set("timestamp",Date.now()),"object"===n.type(r.body))if("GET"===r.method||"HEAD"===r.method){for(var s in r.body){var a=void 0===r.body[s]?"delete":"set";e.searchParams[a](s,r.body[s])}delete r.body}else r.body=JSON.stringify(r.body);let o;try{o=await fetch(e,r)}catch(e){this.mavo.error("Something went wrong while connecting to "+this.id,e)}if(o?.ok)return"HEAD"===r.method||"response"===r.responseType?o:o[r.responseType]();throw o}oAuthenticate(a){return this.ready.then(()=>this.isAuthenticated()?Promise.resolve():new Promise((i,r)=>{var e,t,s=this.id.toLowerCase();a?(this.accessToken=localStorage[`mavo:${s}token`],this.accessToken&&i(this.accessToken)):((e={width:Math.min(1e3,innerWidth-100),height:Math.min(800,innerHeight-100)}).top=(screen.height-e.height)/2,e.left=(screen.width-e.width)/2,t={url:location.href,backend:this.id},this.authPopup=open(`${this.constructor.oAuth}?client_id=${this.key}&state=`+encodeURIComponent(JSON.stringify(t))+this.oAuthParams(),"popup",`width=${e.width},height=${e.height},left=${e.left},top=`+e.top),this.authPopup||(this.mavo.error(t="Login popup was blocked! Please check your popup blocker settings."),r(Error(t))),addEventListener("message",e=>{if(e.source===this.authPopup)for(var t in e.data.backend==this.id&&(this.accessToken=localStorage[`mavo:${s}token`]=e.data.token),this.accessToken||r(Error("Authentication error")),i(this.accessToken),Mavo.all){t=Mavo.all[t].primaryBackend;t&&t.id===this.id&&t!==this&&!t.isAuthenticated()&&t.login(!0)}}))}))}oAuthLogout(){var e;return this.isAuthenticated()&&(e=this.id.toLowerCase(),localStorage.removeItem(`mavo:${e}token`),delete this.accessToken,this.permissions.off(["edit","add","delete","save"]).on("login"),n.fire(this,"mv-logout")),Promise.resolve()}static create(t,i={},e){let r;return i.type&&(r=Mavo.Functions.get(s,i.type)),(r=t&&!r?s.types.find(e=>e.test(t,i))||s.Remote:r)&&e?.constructor===r&&e.constructor.prototype.hasOwnProperty("update")?(e.update(t,i),e):r?new r(t,i):null}static types=[];static register(e){return s[e.name]=e,s.types.push(e),e}};s.register(class extends s{id="Element";constructor(e,t){super(e,t),this.permissions.on(["read","edit","save"])}update(e,t){super.update(e,t),this.observer?.disconnect(),this.element=n(this.source)??n.create("script",{type:"application/json",id:this.source.slice(1),inside:document.body}),this.observer=this.observer??new MutationObserver(e=>{n.fire(this,"mv-remotedatachange")}),this.observer.observe(this.element,{childList:!0,characterData:!0,subtree:!0})}async get(){return this.element.textContent}async put(e){this.observer.disconnect();e=this.element.textContent=e;return this.observer.observe(this.element,{childList:!0,characterData:!0,subtree:!0}),e}static test(e){return 0===e.indexOf("#")}}),s.register(class extends s{id="Remote";constructor(e,t){super(e,t),this.permissions.on("read")}static test(e){return!1}}),s.register(class extends s{id="Local";constructor(e,t){super(e,t),this.permissions.on(["read","edit","save"])}update(e,t){super.update(e,t),this.key=t.key||this.mavo.id}get(){return Promise[this.key in localStorage?"resolve":"reject"](localStorage[this.key])}put(e){return e?localStorage[this.key]=e:delete localStorage[this.key],Promise.resolve(e)}static test(e){return"local"==e}})}(Bliss,Bliss.$),function(t){var a=Mavo.Formats={},e=a.Base=t.Class({abstract:!0,constructor:function(e){this.backend=e},proxy:{mavo:"backend"},parse:function(e){return this.constructor.parse(e,this)},stringify:function(e){return this.constructor.stringify(e,this)},static:{parse:e=>Promise.resolve(e),stringify:e=>Promise.resolve(e),extensions:[],dependencies:[],ready:function(){return Promise.all(this.dependencies.map(e=>t.include(e.test(),e.url)))}}}),r=(a.JSON=t.Class({extends:a.Base,static:{parse:e=>Promise.resolve(e?JSON.parse(e):null),stringify:e=>Promise.resolve(Mavo.toJSON(e)),extensions:[".json",".jsonld"]}}),a.Text=t.Class({extends:a.Base,constructor:function(e){this.property=this.mavo.root.getNames("Primitive")[0]},static:{extensions:[".txt"],parse:(e,t)=>Promise.resolve({[t?t.property:"content"]:e}),stringify:(e,t)=>Promise.resolve(e[t?t.property:"content"])}}),a.CSV=t.Class({extends:a.Base,constructor:function(e){this.property=this.mavo.root.getNames("Collection")[0],this.options=t.extend({},a.CSV.defaultOptions)},static:{extensions:[".csv",".tsv"],defaultOptions:{header:!0,dynamicTyping:!0,skipEmptyLines:!0},dependencies:[{test:()=>self.Papa,url:"https://cdnjs.cloudflare.com/ajax/libs/PapaParse/4.1.4/papaparse.min.js"}],ready:e.ready,parse:async(e,t)=>{await r.ready();var e=Papa.parse(e,r.defaultOptions),i=t?t.property:"content";if(t&&(t.options.delimiter=e.meta.delimiter,t.options.linebreak=e.meta.linebreak),e.meta.aborted)throw e.meta.errors.pop();return{[i]:e.data}},stringify:async(e,t)=>{await r.ready();var i=t?t.property:"content",t=t?t.options:r.defaultOptions;return Papa.unparse(e[i],t)}}}));Object.defineProperty(a,"create",{value:function(e,t){if(e&&"object"==typeof e)return e;if("string"==typeof e)for(var i in e=e.toLowerCase(),a){var r=a[i];if(i.toLowerCase()==e)return new r(t)}if(!e){var s=(t.url?t.url.pathname:t.source).match(/\.\w+$/)?.[0]??".json",r=a.JSON;for(i in a)-1<a[i].extensions.indexOf(s)&&(r=a[i]);return new r(t)}}})}(Bliss,Bliss.$),function(s,a){var o=Mavo.Node=class{constructor(e,t,i={}){if(!e||!t)throw new Error("Mavo.Node constructor requires an element argument and a mavo object");i={context:this,options:i},this.uid=o.all.push(this)-1,this.property=null,this.element=e,this.isHelperVariable=this.element.matches("meta"),s.extend(this,i.options),o.elements.set(e,[...o.elements.get(this.element)||[],this]),this.mavo=t,this.group=this.parent=this.parentGroup=i.options.group,this.template=i.options.template,this.alias=this.element.getAttribute("mv-alias"),this.template?this.template.copies.add(this):this.copies=new Set,this.fromTemplate("property","type","storage","path")||(this.property=o.getProperty(e),this.type=Mavo.Group.normalize(e),this.storage=this.element.getAttribute("mv-storage"),this.path=this.getPath()),this.modes=this.element.getAttribute("mv-mode"),Mavo.hooks.run("node-init-start",i),this.mode=Mavo.getStyle(this.element,"--mv-mode")||"read",this.collection=i.options.collection,this.collection&&(this.group=this.parentGroup=this.collection.parentGroup),t=this.template;if(t?.expressions){this.expressions=new Set;for(var r of t.expressions)this.expressions.add(new Mavo.DOMExpression({template:r,item:this,mavo:this.mavo}))}this instanceof Mavo.Primitive||(e=Mavo.DOMExpression.search(this.element).filter(e=>"mv-value"==e.originalAttribute)[0])&&((e.mavoNode=this).expressionText=e,this.storage=this.storage||"none",this.modes=this.modes||"read"),Mavo.hooks.run("node-init-end",i)}get editing(){return"edit"==this.mode}get isRoot(){return!this.property}get name(){return Mavo.Functions.readable(this.property||this.type).toLowerCase()}get saved(){return"none"!==this.storage}get properties(){var e=this.liveData.data[Mavo.route];return e?Object.keys(e):[]}postInit(){"edit"==this.modes&&this.edit()}destroy(){this.template&&this.template.copies.delete(this),this.expressions&&this.expressions.forEach(e=>e.destroy()),this.itembar&&this.itembar.destroy(),delete o.all[this.uid],this.propagate("destroy")}getLiveData(){return this.liveData.proxy}isDataNull(e={}){e={context:this,options:e,result:!this.saved&&!e.live};return Mavo.hooks.run("node-isdatanull",e),e.result}walk(a,e=[],o={}){var n=(e,t)=>{if(!1!==(r=a(e,t)))for(var i in e.children){var r,s=e.children[i];if(s instanceof Mavo.Node)if(!1===(r=n.call(s,s,[...t,i]))&&!o.descentReturn)return!1}return!1!==r};return n(this,e)}walkUp(e){for(var t=this;t=t.parentGroup;){var i=e(t);if(void 0!==i)return i}}edit({force:e}={}){if(this.mode="edit",!e&&"edit"!=this.mode)return!1;s.fire(this.element,"mv-edit",{mavo:this.mavo,node:this}),Mavo.hooks.run("node-edit-end",this)}done({force:e}={}){if(this.mode=Mavo.getStyle(this.element.parentNode,"--mv-mode")||"read",!e&&"read"!=this.mode)return!1;s.unbind(this.element,".mavo:edit"),s.fire(this.element,"mv-done",{mavo:this.mavo,node:this}),this.propagate("done"),Mavo.hooks.run("node-done-end",this)}save(){this.unsavedChanges=!1,this.propagate("save")}propagate(e){for(var t in this.children){t=this.children[t];t instanceof Mavo.Node&&("function"==typeof e?e.call(t,t):e in t&&t[e]())}}fromTemplate(...e){return this.template&&e.forEach(e=>this[e]=this.template[e]),!!this.template}async render(t,e={}){if(e.live=e.live||Mavo.in(Mavo.isProxy,t),e.root=e.root||this,delete this.pending,"promise"===s.type(t)){var i=this.pending=t;try{t=await i}catch(e){t=e}if(this.pending!==i)return;delete this.pending}e.live&&(t=Mavo.clone(t)),this.oldData=this.data,this.data=t;var i={context:this,data:t=e.live?t:Mavo.subset(t,this.inPath),options:e},t=(Mavo.hooks.run("node-render-start",i),this.isHelperVariable||e.live||(!Array.isArray(this.children)&&Array.isArray(i.data)?(this.isRoot&&(r=this.children.main instanceof Mavo.Collection?"main":this.getNames((e,t)=>t instanceof Mavo.Collection&&!t.expressions?.[0]?.isDynamicObject)[0])&&(i.data={[r]:i.data}),this.isRoot&&r||(this.inPath.push("0"),i.data=i.data[0])):1==this.childrenNames?.length&&this.childrenNames[0]===this.property&&null!==i.data&&Mavo.isPlainObject(i.data)&&(i.data=i.data[this.property])),this===e.root&&(this.expressionsEnabled=!1),this.editing),r=(t&&this.done(),this.dataRender(i.data,e));return t&&this.edit(),this===e.root&&(this.save(),this.expressionsEnabled=!0,r)&&requestAnimationFrame(()=>this.mavo.expressions.update(this)),Mavo.hooks.run("node-render-end",i),r}dataChanged(e,t={}){e=s.extend({action:e,property:this.property,mavo:this.mavo,node:this},t);s.fire(t.element||this.element,"mv-change",e),this.mavo.changed(e)}toString(){return`#${this.uid}: ${this.constructor.name} (${this.property})`}getClosestCollection(){var e=this.closestItem;return e?e.collection:null}getClosestItem(){return Array.isArray(this.collection?.children)?this:this.parentGroup?.closestItem||null}getPath(){var e=this.parent?.path||[];return this.property?[...e,this.property]:e}pathFrom(e){for(var t=this.path,i=e.path,r=0;r<t.length&&i[r]==t[r];r++);return t.slice(r)}getDescendant(e){return e.reduce((e,t)=>e.children[t],this)}getCousin(e,t={}){if(!this.closestCollection)return null;var i=this.closestCollection,r=Math.abs(e),s=e<0?-1:1;if(i.length<r+1)return null;var a=this.closestItem.index+e;t.wrap&&(a=Mavo.wrap(a,i.length));for(var o=0;o<i.length;o++){var n=a+o*s,l=(t.wrap&&(n=Mavo.wrap(n,i.length)),i.children[n]);if(l)break}return l&&l!=this.closestItem?this.collection?l:(r=this.pathFrom(this.closestItem),l.getDescendant(r)):null}contains(e){do{if(e===this)return!0}while(e=e.parent);return!1}eval(e,t){return new Mavo.Expression(e).eval(this.getLiveData(),t)}static create(e,t,i={}){var r;return new(e.hasAttribute("mv-list")?Mavo.Collection:(r=e.matches(Mavo.selectors.group),Mavo[r?"Group":"Primitive"]))(e,t,i)}static getImplicitPropertyName(e){return e.getAttribute("itemprop")||e.getAttribute("mv-list")||e.getAttribute("mv-list-item")||e.name||e.id||[...e.classList].filter(e=>!e.startsWith("mv-"))[0]}static getProperty(e){if(!e.hasAttribute("property"))return null;let t=e.getAttribute("property");return t||(t=o.getImplicitPropertyName(e))&&e.setAttribute("property",t),t}static generatePropertyName(t,e=document.documentElement){var e=e.closest(Mavo.selectors.init),i=new Set(...a("[property]",e).map(e=>e.getAttribute("property")));for(let e="";e<1e3;e++){var r=t+e;if(!i.has(r))return r}}static get(e,t){let i=o.elements.get(e)||[];return(i=i.filter(e=>!(e instanceof Mavo.ImplicitCollection))).length<2||!t?i[0]:i[0]instanceof Mavo.Group?i[1]:void 0}static getClosest(e,t){let i;for(;!(i=o.get(e,t))&&(e=e?.parentNode););return i}static getClosestItem(e){e=o.getClosest(e);return e instanceof Mavo.Primitive&&!e.collection?e.parent:e}static children(t){var e=Mavo.Node.get(t);return e?[e]:(e=a(Mavo.selectors.property,t).map(e=>Mavo.Node.get(e)).filter(e=>!t.contains(e.parentGroup.element)).map(e=>e.collection||e),Mavo.Functions.unique(e))}};s.Class(o,{toJSON:Mavo.prototype.toJSON,lazy:{closestCollection:function(){return this.getClosestCollection()},closestItem:function(){return this.getClosestItem()},inPath:function(){return(this.element.getAttribute("mv-path")||"").split("/").filter(e=>e.length)}},live:{store:function(e){s.toggleAttribute(this.element,"mv-storage",e)},unsavedChanges:function(e){return!e||this.saved&&this.editing||(e=!1),Array.isArray(this.children)||this.element.classList.toggle("mv-unsaved-changes",e),e},mode:function(e){var t,i;if(this._mode!=e)return this.modes&&e!=this.modes&&(e=this.modes),this._mode=e,!Array.isArray(this.children)&&-1<[null,"","read","edit"].indexOf(this.element.getAttribute("mv-mode"))&&(t=this.modes||"edit"==e,i=Mavo.observers.pause({attribute:"mv-mode"}),s.toggleAttribute(this.element,"mv-mode",e,t),Mavo.observers.resume(i)),e},modes:function(e){if(e&&"read"!=e&&"edit"!=e)return null;(this._modes=e)&&this.mode!=e&&(this.mode=e)},collection:function(e){this.parent=e||this.parentGroup},index:function(e){this._index!==e&&(this._index=e,this.liveData.updateKey())},expressionsEnabled:{get:function(){return!1!==this._expressionsEnabled&&(!this.parent||this.parent.expressionsEnabled)}}},static:{all:[],elements:new WeakMap}}),Mavo.observe({attribute:"mv-storage"},function({node:e}){e&&(e.storage=e.element.getAttribute("mv-storage"))})}(Bliss,Bliss.$),function(h,l){var a=Mavo.Group=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.children={},this.group=this,Mavo.hooks.run("group-init-start",this),Mavo.Primitive.getValueAttribute(this.element)&&(this.children[this.property]=new Mavo.Primitive(this.element,this.mavo,{group:this}));var r=l(`[property]:not(:scope ${Mavo.selectors.scope} [property])`,this.element),s=r.map(e=>Mavo.Node.getProperty(e));for(let e=0,t;t=r[e];e++){var a=Mavo.Node.getProperty(t),o=this.children[a],n={template:this.template?this.template.children[a]:null,group:this};o?o.add(t):s.lastIndexOf(a)!==e?this.children[a]=new Mavo.ImplicitCollection(t,this.mavo,n):this.children[a]=Mavo.Node.create(t,this.mavo,n)}this.childrenNames=Object.keys(this.children),this.vocab=Mavo.getClosestAttribute(this.element,"vocab"),this.postInit(),Mavo.hooks.run("group-init-end",this)}get isRoot(){return!this.property}getNames(i="Node"){var t="function"==typeof i?i:(e,t)=>t instanceof Mavo[i];return Object.keys(this.children).filter(e=>t(e,this.children[e]))}getData(e={}){var t,i={context:this,options:e};if(this.isDataNull(e))return null;for(t in i.data=Mavo.shallowClone(Mavo.subset(this.data,this.inPath))||{},this.children){var r,s=this.children[t];s.saved&&(r=s.getData(i.options)),s.saved&&null!==Mavo.value(r)?i.data[s.property]=r:delete i.data[s.property]}return this.childrenNames.length||this.isRoot||this.collection?1===this.childrenNames.length&&this.property in this.children?i.data=i.data[this.property]:i.data&&"object"==typeof i.data&&(this.type&&this.type!=a.DEFAULT_TYPE&&(i.data["@type"]=this.type),this.vocab)&&(i.data["@context"]=this.vocab):i.data=null,i.data=Mavo.subset(this.data,this.inPath,i.data),Mavo.hooks.run("node-getdata-end",i),i.data}edit(t={}){return!1!==super.edit()&&Promise.all(Object.keys(this.children).map(e=>this.children[e].edit(t)))}dataRender(o,n={}){if(o){let e=!1,t,i;if("object"!=typeof o){i=!0;let e=this.property;if(!(this.property in this.children)){let t=h.type(o),i=e=>(this.children[e]instanceof Mavo.Primitive)+(this.children[e].datatype==t);e=Object.keys(this.children).filter(e=>!this.children[e].expressionText).sort((e,t)=>i(e)-i(t)).reverse()[0]}e||(e=this.property,t=!0),o={[e]:o},this.data=Mavo.subset(this.data,this.inPath,o)}let a;if(this.propagate(t=>{let i=o[t.property];if(t.alias){var r=t.alias.split(" ");for(let e=0;e<r.length;e++){var s=r[e];if(void 0!==o[s]){t.currentAlias=s,a=a||h.extend({},o),i=o[t.currentAlias];break}}}e=t.render(i,n)||e}),a&&this.propagate(e=>{e.currentAlias&&(o[e.property]=a[e.currentAlias],e.currentAlias in this.children||delete o[e.currentAlias])}),!i||t){var r,s,l=Mavo.subset(this.oldData,this.inPath);for(r in o)r in this.children||(s=o[r],e=e||o[r]!==this.liveData.data[r],this.liveData.set(r,s),!1===this.expressionsEnabled)||"object"==typeof s||l&&l[r]==s||this.dataChanged("propertychange",{property:r})}return e}}static normalize(e){var t;return e.matches(Mavo.selectors.group)?(t=Mavo.getAttribute(e,"typeof","mv-group")||a.DEFAULT_TYPE,e.setAttribute("typeof",t),t):null}};h.Class(a,{lazy:{liveData:function(){return new Mavo.Data(this,{})}},static:{all:new WeakMap,DEFAULT_TYPE:"Item"}})}(Bliss,Bliss.$),async function(n,t){var s=Mavo.Primitive=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.liveData=new Mavo.Data(this),this.fromTemplate("config","attribute","templateValue","originalEditor")||(this.config=s.getConfig(e),this.attribute=this.config.attribute,this.attribute&&!document.xmlVersion&&(this.attribute=this.attribute.toLowerCase())),this.datatype=this.config.datatype,"modes"in this.config&&(this.modes=this.config.modes,this.element.setAttribute("mv-mode",this.config.modes)),Mavo.hooks.run("primitive-init-start",this),this.expressionText=this.expressionText||Mavo.DOMExpression.search(this.element,this.attribute),this.expressionText&&!this.expressionText.mavoNode&&((this.expressionText.mavoNode=this).storage=this.storage||"none",this.modes="read",this.element.setAttribute("aria-live","polite")),this.config.init&&this.config.init.call(this,this.element),this.config.initOnce&&!this.config.initOnce.called&&(this.config.initOnce.call(this,this.element),this.config.initOnce.called=!0),this.config.changeEvents&&n.bind(this.element,this.config.changeEvents,e=>{e.target===this.element&&(this.value=this.getValue())}),this.expressionText?this.setValue(this.expressionText.value,{silent:!0}):(this.element.hasAttribute("aria-label")?this.label=this.element.getAttribute("aria-label"):(this.label=Mavo.Functions.readable(this.property),this.pauseObserver(),this.element.setAttribute("aria-label",this.label),this.resumeObserver()),this.element.hasAttribute("mv-editor")?(this.originalEditorUpdated({force:!0}),t=this.editorValue,this.datatype||"number"!=typeof t&&"boolean"!=typeof t||(this.datatype=typeof t)):this.element.hasAttribute("mv-options")&&this.updateOptions(),this.templateValue=this.getValue(),this._default=this.element.getAttribute("mv-default"),null===this.default?this.modes?(this._default=this.templateValue,this.defaultSource="template"):(this._default=this.editorValue,this.options&&(i=this.options.keys().next().value,this._default=this._default??i),this.defaultSource="editor"):""===this.default?(this._default=this.templateValue,this.defaultSource="template"):(this.defaultExpression=Mavo.DOMExpression.search(this.element,"mv-default"),this.defaultExpression&&(this.defaultExpression.output=e=>this.default=e),this.defaultSource="attribute"),this.setValue(this.initialValue,{silent:!0})),this.postInit(),Mavo.hooks.run("primitive-init-end",this)}get initialValue(){let e;var t=!this.template||this.template.templateValue!=this.templateValue||"edit"==this.modes;return e=void 0===(e=void 0===this.default&&t?this.templateValue:this.default)?this.emptyValue:e}get editorValue(){var e=this.editor||this.originalEditor;if(e)return s.isFormControl(e)?s.getValue(e,{datatype:this.datatype}):(e=n(Mavo.selectors.output+", "+Mavo.selectors.formControl,e))?s.getValue(e):void 0}set editorValue(t){if(this.config.setEditorValue&&"boolean"!==this.datatype)return this.config.setEditorValue.call(this,t);var e;this.editor&&(s.isFormControl(this.editor)?(this.editor.matches("select")&&void 0===[...this.editor.options].find(e=>e.value==t)?.textContent&&n.create("option",{className:"mv-volatile",textContent:t,inside:this.editor,selected:!0,disabled:!0}),s.setValue(this.editor,t,{config:this.editorDefaults})):(e=n(Mavo.selectors.output+", "+Mavo.selectors.formControl,this.editor))&&s.setValue(e,t))}destroy(){super.destroy(),this.originalEditorObserver?.destroy()}isDataNull(e){return super.isDataNull(e)||null===this._value||void 0===this._value}getData(e={}){var t={context:this,options:e};return this.isDataNull(e)?null:(t.data=this.value,""!==t.data||this.templateValue&&this.initialValue===this.templateValue||(t.data=null),this.inPath.length&&(t.data=Mavo.subset(this.data,this.inPath,t.data)),Mavo.hooks.run("node-getdata-end",t),t.data)}get pausedObserver(){return 0<this.observerPauses?.length}pauseObserver(){Mavo.observers.flush(),this.observerPauses=this.observerPauses||[],this.observerPauses.push(1)}resumeObserver(){Mavo.observers.flush(),this.observerPauses?.pop?.()}save(){this.savedValue=this.value,this.unsavedChanges=!1}initEdit(){!this.editor&&this.originalEditor&&(this.editor=this.originalEditor.cloneNode(!0)),this.editorUpdated(),this.initEdit=null}updateOptions(){var e,t,i=Mavo.options(this.element.getAttribute("mv-options"),{map:!0});for([e,t]of i)!0===t&&i.set(e,e);this.options=i}generateDefaultEditor(){if(this.element.hasAttribute("mv-options")){this.options||this.updateOptions();var e=[...this.options].map(([e,t])=>({tag:"option",value:e,textContent:t}));this.editor=n.create("select",{className:"mv-editor mv-options-select",contents:e})}else{let e=this.config.editor;e&&"boolean"!=this.datatype||(e=Mavo.Elements.defaultConfig[this.datatype||"string"].editor),this.editor=n.create("function"===n.type(e)?e.call(this):e)}this.editorValue=this.value}updateEditType(){let e=this.element.getAttribute("mv-edit-type")?.trim()??"auto";return"auto"===(e="auto"===e?this.config.editType??"auto":e)&&(e=this.attribute?"popup":"inline"),this.editType=e}editorUpdated(){var e;this.editor||this.generateDefaultEditor(),n.bind(this.editor,{"input change":e=>{this.value=this.editorValue},"mv-change":e=>{"output"===e.property&&(e.stopPropagation(),n.fire(this.editor,"input"))}}),this.editor.matches("textarea")||this.editor.addEventListener("focus",e=>{this.editor.select?.()});for(e of Mavo.getAttributes(this.element,/^mv-editor-/)){var t=this.element.getAttribute(e);e=e.replace(/^mv-editor-/,""),this.editor.setAttribute(e,t)}"placeholder"in this.editor&&!this.editor.placeholder&&(this.editor.placeholder="number"===this.editor.type?this.editor.min||0:`(${this.label})`),this.editor.matches("select")||delete this.options}originalEditorUpdated({force:e}={}){var t=this.originalEditor,i=this.element.getAttribute("mv-editor");try{this.originalEditor=n(i)}catch(e){this.originalEditor=null}(e||t!==this.originalEditor)&&(this.originalEditor?(this.editor&&(this.editor=this.originalEditor.cloneNode(!0),this.setValue(this.value,{force:!0,silent:!0})),"editor"==this.defaultSource&&(this.default=this.originalEditor.value),this.template&&this.originalEditor===this.template.originalEditor||(this.originalEditorObserver?.destroy(),this.originalEditorObserver=new Mavo.Observer(this.originalEditor,"all",e=>{var t,i=[this];if(this.copies)for(var r of this.copies)r.originalEditor===this.originalEditor&&i.push(r);for(t of i)t.originalEditorUpdated({force:!0}),t.setValue(t.value,{force:!0,silent:!0})}))):this.editor&&(this.generateDefaultEditor(),this.editorUpdated()),(i=this.editor??this.originalEditor)?.matches("select:not(.mv-options-select"))&&(e=[...i.options].filter(e=>!e.classList.contains("mv-volatile")).map(e=>[e.value,e.textContent]),this.options=new Map(e))}edit(e={}){var t=this.editing;if(!1===super.edit(e))return!1;if(e.force||!t||this.initEdit){if("object"===n.type(this._value))return!1;if(t||(-1===this.element.tabIndex&&Mavo.revocably.setAttribute(this.element,"tabindex","0"),n.bind(this.element,"click.mavo:edit",e=>{"edit"===this.mode&&e.target.closest("summary, a")&&e.preventDefault()})),this.config.edit?(this.config.edit.call(this),this.initEdit=null):(this.pauseObserver(),this.initEdit&&this.initEdit(),this.editor.classList.toggle("mv-editor","popup"!==this.editType),"popup"===this.editType?(this.popup||(this.popup=new Mavo.UI.Popup(this)),this.popup.prepare(),e="mousedown focus dragover dragenter".split(" ").map(e=>e+".mavo:edit").join(" "),n.bind(this.element,e,e=>this.popup.show())):"inline"===this.editType&&(this.editor.isConnected||(this.editorValue=this.value,this.config.hasChildren?this.element.textContent="":s.setText(this.element,""),this.contentExpression||(this.contentExpression=Mavo.DOMExpression.search(this.element,null)),this.contentExpression&&(this.contentExpression.active=!1),this.element.prepend(this.editor)),this.collection||Mavo.revocably.restoreAttribute(this.element,"tabindex")),this.resumeObserver()),this.closestCollection&&"inline"===this.editType&&this.editor?.matches(Mavo.selectors.textInput)){let r=this.editor.matches("textarea");r||n.bind(this.editor,"paste.mavo:edit",e=>{if(this.closestCollection.editing&&e.clipboardData){var t=e.clipboardData.getData("text/plain"),i=/\r?\n|\r/;if(i.test(t)){e.preventDefault();var r=t.split(i),s=(this.editor.setRangeText(r[0]),n.fire(this.editor,"input"),this.closestCollection),a=closestItem?.index||0;for(let e=1;e<r.length;e++){this.closestItem;var o=s.add(void 0,a+e);s.editItem(o),this.getCousin(e).render(r[e])}}}}),n.bind(this.editor,"keydown.mavo:edit",t=>{if(this.closestCollection.editing)if("Enter"!=t.key||!t.shiftKey&&r)"Backspace"==t.key&&this.empty&&(i=this.getCousin(1)||this.getCousin(-1),this.closestCollection.delete(this.closestItem),i&&(i.edit(),i.editor.focus()),t.preventDefault());else if(!this.bottomUp){var i=this.closestItem,i=this.closestCollection.add(void 0,i?.index+1);this.closestCollection.editItem(i);let e=this.getCousin(1);requestAnimationFrame(()=>{e.edit(),e.editor.focus()}),r&&t.preventDefault()}})}}return!0}done(e){if(!1===super.done(e))return!1;n.unbind(this.element,".mavo:edit"),this.pauseObserver(),this.config.done?this.config.done.call(this):("popup"===this.editType?this.popup?.close():"inline"===this.editType&&this.editor&&(this.editor.remove(),this.contentExpression&&(this.contentExpression.active=!0,this.contentExpression.update({force:!0})),this.setValue(this.editorValue,{silent:!0,force:!0})),this.editor?.matches("select")&&t(".mv-volatile",this.editor).forEach(e=>{e.selected||e.remove()}),this.resumeObserver(),this.collection||Mavo.revocably.restoreAttribute(this.element,"tabindex"))}dataRender(e,{}={}){var t=this._value;return"object"===n.type(e)&&(Symbol.toPrimitive in e?e=e[Symbol.toPrimitive]("default"):this.editing&&this.done()),void 0===e?this.modes||this.value!==this.templateValue||(this.value=this.closestCollection?this.default:this.templateValue):this.value=e,this._value!==t}find(e,t={}){if(this.property==e&&t.exclude!==this)return this}getValue(e){return this.editing&&this.editor&&this.editor!==this.element?this.editorValue:s.getValue(this.element,{config:this.config,attribute:this.attribute,datatype:this.datatype})}setValue(t,e={}){void 0===t&&(t=null);var i=this.datatype;if(this.datatype||"number"!=typeof t&&"boolean"!=typeof t||(this.datatype=typeof t),t=s.safeCast(t,this.datatype),e.force||t!==this._value||i!=this.datatype){if(this.pauseObserver(),this.editor&&this.editorValue!=t&&(this.editorValue=t),"popup"==this.editType||!this.editor||this.editor!==document.activeElement&&!this.element.contains(this.editor))if(this.config.setValue)this.config.setValue.call(this,this.element,t);else if(!e.dataOnly){let e;this.options&&(e=this.options.get(t)),s.setValue(this.element,t,{config:this.config,attribute:this.attribute,datatype:this.datatype,presentational:e,node:this})}this.empty=!t&&0!==t,this._value=t,this.liveData.update(),e.silent||(this.saved&&(this.unsavedChanges=this.mavo.unsavedChanges=!0),this.dataChanged("propertychange",{value:t})),this.resumeObserver()}return t}dataChanged(e="propertychange",t){return super.dataChanged(e,t)}async upload(t,i=t.name){if(this.mavo.uploadBackend&&self.FileReader){var r=URL.createObjectURL(t);this.pauseObserver(),this.element.setAttribute(this.attribute,r),this.resumeObserver();i=(this.element.getAttribute("mv-upload-path")||"")+"/"+i;let e=await this.mavo.upload(t,i);var s=Mavo.getClosestAttribute(this.element,"mv-upload-url");s&&(e=new URL(i,new URL(s,location))+""),this.value=e,this.element.matches("a")||(this.pauseObserver(),this.element.setAttribute(this.attribute,r),this.resumeObserver())}}createUploadPopup(s,a="file",e){var o,t={context:this,type:s,kind:a,ext:e};return t.mainInput=n.create("input",{type:"url",placeholder:`http://example.com/${a}.`+e,className:"mv-output","aria-label":"URL to "+a}),this.mavo.uploadBackend&&self.FileReader?(o=e=>e&&(!s||0===e.type.indexOf(s.replace("*",""))),t.events={paste:e=>{var t,i=Array.from(e.clipboardData.items).find(e=>"file"===e.kind),r=i?.type.split("/")[1];i&&o(i)&&(r=e.clipboardData.getData("text")||`pasted-${a}-${Date.now()}.`+r,null!==(t=""===(t=prompt(this.mavo._("filename"),r))?r:t))&&(this.upload(i.getAsFile(),t,s),e.preventDefault())},"drag dragstart dragend dragover dragenter dragleave drop":e=>{e.preventDefault(),e.stopPropagation()},"dragover dragenter":e=>{t.popup.classList.add("mv-dragover"),this.element.classList.add("mv-dragover")},"dragleave dragend drop":e=>{t.popup.classList.remove("mv-dragover"),this.element.classList.remove("mv-dragover")},drop:e=>{e=e.dataTransfer.files[0];e&&o(e)&&this.upload(e)}},Mavo.hooks.run("primitive-createuploadpopup-beforecreate",t),t.popup=n.create({className:"mv-upload-popup",contents:[t.mainInput,{tag:"input",type:"file","aria-label":"Upload "+a,accept:s,events:{change:e=>{e=e.target.files[0];e&&o(e)&&this.upload(e)}}},{className:"mv-tip",innerHTML:"<strong>Tip:</strong> You can also drag & drop or paste!"}],events:t.events}),n.bind(this.element,t.events),Mavo.hooks.run("primitive-createuploadpopup-beforereturn",t),t.popup):t.mainInput}static getText(e){e=e.nodeType===Node.TEXT_NODE?e:e.firstChild;return e?.nodeType===Node.TEXT_NODE?e.nodeValue:""}static setText(e,t){var i=e.nodeType===Node.TEXT_NODE?e:e.firstChild;i?.nodeType===Node.TEXT_NODE?i.nodeValue=t:e.prepend(t)}static getValueAttribute(e,t=Mavo.Elements.search(e)){t=e.getAttribute("mv-attribute")||t.attribute;return t=t&&"null"!==t&&"none"!==t?t:null}static safeCast(e,t){var i=s.cast(e,t);return"boolean"==t?!!e&&("true"===e||0<e||e):"number"==t?/^[-+]?[0-9.e]+$/i.test(e+"")?i:e:null==e?e:i}static cast(e,t){switch(t){case"number":return+e;case"boolean":return!!e;case"string":return e+""}return e}static getValue(e,{config:t,attribute:i,datatype:r}={}){return i=(t=t||s.getConfig(e,i)).attribute,r=t.datatype,t.getValue&&i==t.attribute?t.getValue(e):(t=i in e&&Mavo.usePropertyInsteadOfAttribute(e,i)?e[i]:i?e.getAttribute(i):e.getAttribute("content")||s.getText(e)||null,s.safeCast(t,r))}static getConfig(e,t,i){var r=e.getAttribute("mv-edit-as");return r&&r in Mavo.Elements?Mavo.Elements[r]:(r=void 0===(t="null"!=(t=void 0===t?e.getAttribute("mv-attribute")||void 0:t)&&"none"!=t?t:null)||t==s.getValueAttribute(e),!i&&r&&(i=e.getAttribute("datatype")||void 0),r=Mavo.Elements.search(e,t,i),void 0===(r=Object.assign({},r)).attribute&&(r.attribute=t||null),void 0===r.datatype&&(r.datatype=i),r)}static async setValue(e,t,i={}){if(delete s.pending.get(e)?.[i.attribute],"promise"===n.type(t)){s.pending.has(e)||s.pending.set(e,{});var r=t;s.pending.get(e)[i.attribute]=r;try{t=await r}catch(e){t=e}if(s.pending.get(e)[i.attribute]!==r)return;delete s.pending.get(e)?.[i.attribute]}if(1===e.nodeType&&(i.config||(i.config=s.getConfig(e,i.attribute)),i.attribute=(void 0!==i.attribute?i:i.config).attribute,i.datatype=(void 0!==i.datatype?i:i.config).datatype,i.config.setValue)&&i.attribute==i.config.attribute)return i.config.setValue(e,t,i.attribute);if(null!==t||i.datatype||(t=""),i.attribute){if(i.attribute in e&&Mavo.usePropertyInsteadOfAttribute(e,i.attribute)&&e[i.attribute]!==t)try{e[i.attribute],e[i.attribute]=t}catch(e){}"boolean"==i.datatype?t!=e.hasAttribute(i.attribute)&&n.toggleAttribute(e,i.attribute,t,t):e.getAttribute(i.attribute)!=t&&e.setAttribute(i.attribute,t)}else{r=i.presentational??s.format(t,i);i.node&&!i.config.hasChildren?s.setText(e,r):e.textContent=r,r!==t&&e.setAttribute&&e.setAttribute("content",t)}}static format(e,t={}){if("number"===n.type(e)||"number"==t.datatype){if(null===e)return"";if(!(t.attribute||t.element?.matches("style, pre")))return s.formatNumber(e)}return Array.isArray(e)?e.map(s.format).join(", "):"object"===n.type(e)?Mavo.toJSON(e):e}static isFormControl(e){return e.matches(Mavo.selectors.formControl)||e.matches('[mv-edit-as="formControl"]')}};n.Class(s,{lazy:{emptyValue:function(){switch(this.datatype){case"boolean":return!1;case"number":return 0}return""},editorDefaults:function(){return this.editor&&s.getConfig(this.editor)},editType:function(){return this.updateEditType()}},live:{editor:function(e){this._editor!==e&&(this._editor?.replaceWith(e),this._editor=e,"editor"===this.defaultSource&&(this.default=this.editorValue),this.editorUpdated())},default:function(e){this.value==this._default&&(this.value=e)},value:function(e){return this.setValue(e)},datatype:function(e){e!==this._datatype&&("boolean"!=e||this.attribute||(this.attribute=Mavo.Elements.defaultConfig.boolean.attribute),n.toggleAttribute(this.element,"datatype",e,e&&"string"!==e))},empty:function(e){e=e&&!this.modes&&(!this.attribute||!n(Mavo.selectors.property,this.element))&&("boolean"!==this.datatype||this.attribute===Mavo.Elements.defaultConfig.boolean.attribute);this.element.classList.toggle("mv-empty",!!e)}},static:{all:new WeakMap,pending:new Map,lazy:{formatNumber:()=>{var t=new Intl.NumberFormat(Mavo.locale,{maximumFractionDigits:2});return function(e){return e===1/0||e===-1/0?e<0?"-∞":"∞":t.format(e)}}}}}),Mavo.observe({id:"primitive"},function({node:t,type:i,attribute:r,element:e}){if(t instanceof Mavo.Primitive&&t.config&&!t.pausedObserver)if("mv-default"!==r||t.defaultExpression){if("aria-label"===r)t.label=e.getAttribute("aria-label"),Mavo.in("placeholder",t.editor)&&(t.editor.placeholder="number"===t.editor.type?t.editor.min||0:`(${t.label})`);else if("mv-editor"===r)t.originalEditorUpdated();else if("mv-edit-type"===r){var s=t.editing;s&&t.done({force:!0}),t.updateEditType(),s&&t.edit({force:!0})}else if("mv-options"===r)t.updateOptions(),t.editor&&t.generateDefaultEditor();else if(r&&0===r.indexOf("mv-editor-"))t.editor?.setAttribute(r.slice(10),e.getAttribute(r));else if(!1!==t.config.observer){let e=t.config.subtree;(e=e||t.editing&&"edit"!==t.modes?e:r===t.attribute||t.config.observedAttributes?.includes(r)||"characterData"===i&&!t.attribute)&&(t.value=t.getValue())}}else t.default=e.getAttribute("mv-default");else{s=Mavo.Node.getClosest(e.parentNode,!0);s?.config?.subtree&&(s.value=s.getValue())}}),await n.ready();let i=["checkbox","color","date","datetime-local","email","file","month","number","password","radio","range","search","submit","tel","text","time","url","week","datetime"];var e,r=Mavo.attributeStartsWith("mv-edit-").filter(e=>("mv-edit-type"!==e.name||i.includes(e.value))&&!["mv-edit-as"].includes(e.name)).map(e=>e.name);Mavo.attributeStartsWith("mv-editor-");if(n("[mv-edit]")&&r.unshift("mv-edit"),0<r.length)for(e of[...new Set(r)]){var a,o=e.replace(/^mv-edit(-|$)/,"mv-editor$1"),l=t(`[${e}]`);console.log(`You are using attribute ${e} on ${l.length} element(s). This syntax is deprecated and will be removed in the next version of Mavo. Please use ${o} instead.`);for(a of l)Mavo.setAttributeShy(a,o,a.getAttribute(e))}}(Bliss,Bliss.$),function(a){Mavo.UI.Popup=a.Class({constructor:function(e){this.primitive=e,this.position=e=>{var t=this.primitive.element.getBoundingClientRect(),i=t.left,r=t.bottom,s=!1;this.element.offsetHeight&&(this.height=this.element.getBoundingClientRect().height||this.height),this.height+r+20>innerHeight&&(r=20<t.top-this.height?(s=!0,t.top-this.height-20):innerHeight-this.height-20),this.element.classList.toggle("mv-point-down",s),a.style(this.element,{top:r+"px",left:i+"px"})},this.element=a.create("div",{className:"mv-popup",hidden:!0,contents:{tag:"fieldset",contents:[{tag:"legend",textContent:this.primitive.label+":"},this.editor]},events:{keyup:e=>{13!=e.keyCode&&27!=e.keyCode||(this.element.contains(document.activeElement)&&this.primitive.element.focus(),e.stopPropagation(),this.hide())},transitionend:this.position}}),this.editor.matches("select")&&(this.editor.size=Math.min(10,this.editor.children.length)),this.hideCallback=e=>{this.element.contains(e.target)||this.primitive.element.contains(e.target)||this.hide()}},show:function(){a.unbind([this.primitive.element,this.element],".mavo:showpopup"),this.shown=!0,this.element.style.transition="none",this.element.removeAttribute("hidden"),this.position(),this.element.setAttribute("hidden",""),this.element.style.transition="",document.body.appendChild(this.element),setTimeout(()=>{this.element.removeAttribute("hidden")},100),a.bind(document,"focus click",this.hideCallback,!0),window.addEventListener("scroll",this.position,{passive:!0})},hide:function(){a.unbind(document,"focus click",this.hideCallback,!0),window.removeEventListener("scroll",this.position,{passive:!0}),this.element.setAttribute("hidden",""),this.shown=!1,setTimeout(()=>{a.remove(this.element)},1e3*parseFloat(getComputedStyle(this.element).transitionDuration)||400)},prepare:function(){a.bind(this.primitive.element,{"click.mavo:edit":e=>{this.show()},"keyup.mavo:edit":e=>{-1<[13,113].indexOf(e.keyCode)&&(this.show(),this.editor.focus())}}),this.element.contains(this.editor)||this.element.append(this.editor)},close:function(){this.hide(),a.unbind(this.primitive.element,".mavo:edit .mavo:preedit .mavo:showpopup")},proxy:{editor:"primitive"}})}(Bliss,Bliss.$),function(o,r){var n=Mavo.Elements={};Object.defineProperties(n,{register:{value:function(i,r){var e,t;if("object"!=typeof i)return r.extend&&(e=n[r.extend],r=o.extend(o.extend({},e),r)),-1<i.indexOf("@")&&(e=i.split("@"),r.selector=r.selector||e[0]||"*",void 0===r.attribute)&&(r.attribute=e[1]),r.selector=r.selector||i,r.id=i,Array.isArray(r.attribute)?r.attribute.forEach(e=>{var t=o.extend({},r);t.attribute=e,n[i+"@"+e]=t}):n[i]=r,n;for(t in i)n.register(t,i[t])}},search:{value:function(e,t,i){var r=n.matches(e,t,i),e=(r=0===r.length&&i?n.matches(e,t):r)[r.length-1];return e||((r=o.extend({},n.defaultConfig[i||"string"])).attribute=void 0===t?r.attribute:t,r)}},matches:{value:function(e,t,i){var r,s=[];for(r in n){var a,o=n[r];!(void 0===t&&o.default||t===o.attribute)||void 0!==i&&"string"!==i&&i!==o.datatype||(a=o.selector||r,!e.matches(a))||o.test&&!o.test(e,t,i)||s.push(o)}return s}},isSVG:{value:e=>"http://www.w3.org/2000/svg"==e.namespaceURI},defaultConfig:{value:{string:{editor:{tag:"input"}},number:{editor:{tag:"input",type:"number"}},boolean:{attribute:"content",editor:{tag:"input",type:"checkbox"}}}}}),n.register({"@hidden":{datatype:"boolean"},"@y":{test:n.isSVG,datatype:"number"},"@x":{default:!0,test:n.isSVG,datatype:"number"},media:{default:!0,selector:"img, video, audio",attribute:"src",editor:function(){var e="img"==(e=this.element.nodeName.toLowerCase())?"image":e;return Mavo.setAttributeShy(this.element,"mv-upload-path",e+"s"),this.createUploadPopup(e+"/*",e,"png")}},"a, link":{default:!0,attribute:"href"},"a[mv-upload-path], link[mv-upload-path]":{default:!0,attribute:"href",editor:function(){var e=this.element.getAttribute("type"),t=e&&!/\/\*$/.test(e)?e.split("/")[1]:"pdf";return this.createUploadPopup(e,void 0,t)}},"video, audio":{attribute:["autoplay","buffered","loop"],datatype:"boolean"},details:{attribute:"open",datatype:"boolean"},"input, select, button, textarea":{attribute:"disabled",datatype:"boolean"},formControl:{selector:"input",default:!0,attribute:"value",modes:"edit",editType:"self",changeEvents:"input change",edit:()=>{},done:()=>{},init:function(){this._editor=this.element}},select:{extend:"formControl",selector:"select",subtree:!0},"select[multiple]":{extend:"select",selector:"select[multiple]",getValue:e=>Array.from(e.selectedOptions).map(e=>e.value).join(),setValue:(e,t)=>{t=Array.isArray(t)?t:(t+"").split(/\s*,/),Array.from(e.options).forEach(e=>{e.selected=!1,(t=t.map(e=>e+"")).includes(e.value)&&(e.selected=!0)})}},option:{attribute:null,modes:"read",default:!0},textarea:{extend:"formControl",selector:"textarea",attribute:null,getValue:e=>e.value,setValue:(e,t)=>e.value=t},formNumber:{extend:"formControl",selector:"input[type=range], input[type=number]",datatype:"number",setValue:function(t,e){t.value=e,t.setAttribute("value",e);var i=e>t.value?"max":"min";isNaN(e)||t.value==e||Mavo.data(t,"boundObserver")||(0===Mavo.observers.find({element:t,id:"oob"}).size&&Mavo.observe({id:"oob",element:t,attribute:i,once:!0},()=>t.value=e),requestAnimationFrame(()=>{o.bind(t,"input mv-change",function e(){Mavo.unobserve({element:t,id:"oob"}),o.unbind(t,"input mv-change",e)})}))},observedAttributes:["min","max"]},checkbox:{extend:"formControl",selector:"input[type=checkbox]",attribute:"checked",datatype:"boolean",changeEvents:"click"},"input[type=checkbox]":{attribute:"indeterminate",datatype:"boolean"},radio:{extend:"formControl",selector:"input[type=radio]",attribute:"checked",modes:"edit",getValue:e=>{return e.form?e.form[e.name].value:(e=o(`input[type=radio][name="${e.name}"]:checked`))&&e.value},setValue:(e,t)=>{e.form?e.form[e.name].value=t:(e=o(`input[type=radio][name="${e.name}"][value="${t}"]`))&&(e.checked=!0)},initOnce:function(e){function t(e){var t;e.name;for(t of r(`input[type=radio][name="${e.name}"]`)){var i=Mavo.Node.get(t,!0);i&&(i.value=i.getValue())}}document.addEventListener("change",e=>{e.target.matches("input[type=radio]")&&t(e.target)}),Mavo.observe({attribute:"value",selector:"input[type=radio]"},e=>t(e.element))},observedAttributes:["value"]},counter:{extend:"formControl",selector:"button, .counter",attribute:"mv-clicked",datatype:"number",init:function(i){"mv-clicked"===this.attribute&&(i.setAttribute("mv-clicked","0"),i.addEventListener("click",e=>{var t=+i.getAttribute("mv-clicked")||0;this.value=++t}))}},meter:{default:!0,selector:"meter, progress",attribute:"value",datatype:"number",edit:function(){let i=this.element.min??this.element.getAttribute("min")??0,r=this.element.max??this.element.getAttribute("max")??1,s=(i=+i,(r=+r)-i),a=this.element.step??this.element.getAttribute("step")??this.element.getAttribute("mv-editor-step")??(1<s?1:s/100);a=+a,o.bind(this.element,"mousemove.mavo:edit",e=>{var t=this.element.getBoundingClientRect().left,e=Math.max(0,(e.clientX-t)/this.element.offsetWidth),t=i+s*e,e=t%a;t+=e>a/2?a-e:-e,t=Math.max(i,Math.min(t,r)),this.pauseObserver(),this.element.setAttribute("value",t),this.resumeObserver()}),o.bind(this.element,"mouseleave.mavo:edit",e=>{this.pauseObserver(),this.element.setAttribute("value",this.value),this.resumeObserver()}),o.bind(this.element,"click.mavo:edit",e=>{this.value=this.getValue()}),o.bind(this.element,"keydown.mavo:edit",e=>{var t;e.target!=this.element||37!=e.keyCode&&39!=e.keyCode||(t=a*(39==e.keyCode?1:-1)*(e.shiftKey?10:1),t=this.value+t,t=Math.max(i,Math.min(t,r)),this.element.setAttribute("value",t),e.preventDefault())})},observedAttributes:["min","max"]},meta:{default:!0,attribute:"content"},block:{default:!0,selector:"p, div, dt, dd, h1, h2, h3, h4, h5, h6, article, section, address, pre",editor:function(){var e=getComputedStyle(this.element),t=0===e.display.indexOf("inline")?"input":"textarea",i=o.create(t);return"textarea"==t&&((t=this.element.offsetWidth)&&(i.width=t),i.style.whiteSpace={normal:"pre-wrap",nowrap:"pre"}[e.whiteSpace]||"inherit"),i},setEditorValue:function(e){this.datatype&&"string"!=this.datatype&&(e+="");var t=getComputedStyle(this.element);return e=e||"",-1<["normal","nowrap"].indexOf(t.whiteSpace)&&(e=e.replace(/\r?\n/g," ")),-1<["normal","nowrap","pre-line"].indexOf(t.whiteSpace)&&(e=e.replace(/^[ \t]+|[ \t]+$/gm,"").replace(/[ \t]+/g," ")),this.editor.value=e,!0}},time:{attribute:"datetime",default:!0,init:function(){if(!this.fromTemplate("dateType")){var e=Mavo.DOMExpression.search(this.element,null),t=this.element.getAttribute("datetime")||"YYYY-MM-DD",i=this.element.getAttribute("mv-editor-type");if(i in this.config.dateTypes)this.dateType=i;else for(var r in this.config.dateTypes)if(this.config.dateTypes[r].test(t)){this.dateType=r;break}!e&&(this.element.textContent=this.config.defaultFormats[this.dateType]?.(this.property)??"",this.mavo.expressions.extract(this.element,null),e=Mavo.DOMExpression.search(this.element,null))&&this.mavo.treeBuilt.then(()=>{e.update()})}},dateTypes:{month:/^[Y\d]{4}-[M\d]{2}$/i,time:/^[H\d]{2}:[M\d]{2}/i,"datetime-local":/^[Y\d]{4}-[M\d]{2}-[D\d]{2} [H\d]{2}:[Mi\d]{2}/i,date:/^[Y\d]{4}-[M\d]{2}-[D\d]{2}$/i},defaultFormats:{date:e=>`[readable_datetime(${e}, "days")]`,month:e=>`[readable_datetime(${e}, 'months')] `,time:e=>`[hour(${e}, '00')]:[minute(${e}, '00')]`,"datetime-local":function(e){return this.date(e)+" "+this.time(e)}},editor:function(){return{tag:"input",type:this.dateType}}},"circle@r":{default:!0,datatype:"number"},circle:{attribute:["cx","cy"],datatype:"number"},text:{default:!0,editType:"popup"},".mv-toggle":{default:!0,attribute:"aria-checked",datatype:"boolean",edit:function(){Mavo.revocably.setAttribute(this.element,"role","checkbox"),o.bind(this.element,"click.mavo:edit keyup.mavo:edit keydown.mavo:edit",e=>{"click"!=e.type&&" "!=e.key&&"Enter"!=e.key||("keydown"!=e.type&&(this.value=!this.value),e.preventDefault(),e.stopPropagation())})},done:function(){Mavo.revocably.restoreAttribute(this.element,"role"),o.unbind(this.element,".mavo:edit")}}})}(Bliss,Bliss.$),function(o,i){Mavo.attributes.push("mv-list","mv-list-item","mv-order","mv-accepts","mv-initial-items");var n=Mavo.Collection=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.firstItemElement=this.templateElement=o(Mavo.selectors.multiple,this.element),this.children=[],this.liveData=new Mavo.Data(this,[]),this.marker=document.createComment("mv-marker"),Mavo.data(this.marker,"collection",this),this.templateElement.after(this.marker),this.addButton=this.createAddButton(),this.templateElement.hasAttribute("mv-like")&&Mavo.warn("@mv-like is deprecated and will be removed in the next version of Mavo"),this.fromTemplate("templateElement","accepts","initialItems")||(this.accepts=this.element.getAttribute("mv-accepts"),this.accepts=new Set(this.accepts?.split(/\s+/)),this.initialItems=+(this.element.getAttribute("mv-initial-items")||1),this.templateElement=this.templateElement.cloneNode(!0)),this.initializeData(),this.postInit(),Mavo.hooks.run("collection-init-end",this)}initializeData(){var e=this.add(this.firstItemElement,void 0,{silent:!0});if(0===this.initialItems)e?this.delete(e,{silent:!0}):this.firstItemElement.remove();else if(1<this.initialItems)for(let e=1;e<this.initialItems;e++)this.add()}createAddButton(){var e=`button[class~="mv-add-${this.property}"]`,t=this.parentGroup.element,e=i(e,t).filter(e=>!this.element.contains(e)&&!Mavo.data(e,"collection"))[0];return e?(e.compareDocumentPosition(this.marker)&Node.DOCUMENT_POSITION_FOLLOWING&&Mavo.setAttributeShy(this.templateElement,"mv-order","desc"),Mavo.revocably.remove(e)):e=o.create("button",{type:"button",className:"mv-ui",textContent:this.mavo._("add-item",this)}),e.classList.add("mv-add","mv-add-"+this.property),Mavo.data(e,"collection",this),Mavo.setAttributeShy(e,"mv-action",`add(${this.property})`),e}get length(){return this.children.length}getData(e={}){var t={context:this,options:e};return t.data=this.children.map(e=>e.getData(t.options)).filter(e=>null!==Mavo.value(e)),t.data=Mavo.subset(this.data,this.inPath,t.data),Mavo.hooks.run("node-getdata-end",t),t.data}createItem(e){e=e||this.templateElement.cloneNode(!0);var t=this.itemTemplate||this.template?.itemTemplate||null,e=Mavo.Node.create(e,this.mavo,{collection:this,template:t,property:this.property,type:this.type});return this.itemTemplate||(this.itemTemplate=t||e),e}add(e,t,i={}){(e=e instanceof Node?Mavo.Node.get(e)||this.createItem(e):e||this.createItem()).collection!=this&&(e.collection&&(e.collection.splice({remove:e}),e.collection.dataChanged("delete")),r=e.getData(),s=e.editing,e.element.remove(),e.destroy(),e=this.createItem(),s&&this.editItem(e),e.render(r)),void 0===t&&(t=this.bottomUp?0:this.length);var r,s=this.children?.[t]?.element??this.marker,a=(o.before(e.element,s),{context:this,item:e});return a.previousIndex=e.index,a.changed=this.splice({remove:a.item},{index:t,add:a.item}),this.mavo.expressions.active&&!i.silent&&requestAnimationFrame(()=>{a.changed.forEach(e=>{e.dataChanged(e==a.item&&void 0===a.previousIndex?"add":"move"),e.unsavedChanges=!0}),this.unsavedChanges=this.mavo.unsavedChanges=!0,this.mavo.expressions.update(a.item)}),Mavo.hooks.run("collection-add-end",a),a.item}splice(...e){e.forEach(e=>{void 0===e.index&&e.remove&&isNaN(e.remove)&&(e.index=this.children.indexOf(e.remove),e.remove=1)}),e.sort((e,t)=>t.index-e.index);var t=[],i=[];e.forEach(e=>{-1<e.index&&(e.remove||e.add)&&(e.remove=e.remove||0,e.add=Mavo.toArray(e.add),i.push(...this.children.splice(e.index,+e.remove,...e.add)))}),i=new Set(i);for(let e=0;e<this.length;e++){var r=this.children[e];i.delete(r),r&&r.index!==e&&(r.index=e,t.push(r))}return i.forEach(t=>{t.expressions?.forEach(e=>{t.mavo.expressions.unregister(e)})}),this.liveData.update(),t}async delete(e,{silent:t,undoable:i=!t,transition:r=!t,destroy:s=!i}={}){return e.element.classList.remove("mv-highlight"),this.splice({remove:e}),!t&&r&&(await o.transition(e.element,{opacity:0}),e.element.style.opacity=""),o.remove(e.element),t||(this.unsavedChanges=e.unsavedChanges=this.mavo.unsavedChanges=!0,e.collection.dataChanged("delete",{index:e.index})),i?this.mavo.setDeleted(e):s&&e.destroy(),e}move(e,t){t=e.index+t+(0<t),t=Mavo.wrap(t,this.children.length+1);this.add(e,t)}editItem(t,i={}){t.preEdit?.resolve("abort");var e=i.immediately||Mavo.inView.is(t.element);return t.preEdit=Mavo.promise(e?Promise.resolve():Mavo.inView.when(t.element)),t.preEdit.then(e=>{if("abort"!==e)return t.itembar||(t.itembar=new Mavo.UI.Itembar(t)),t.itembar.add(),t.edit(i)})}doneItem(e){e.itembar?.remove(),e.preEdit?.resolve("abort")}edit(t={}){var i;return!1!==super.edit()&&(this.addButton.parentNode||(i=(i=this.bottomUp&&this.children[0]?this.children[0].element:i)||this.marker,Mavo.revocably.add(this.addButton,e=>o[this.bottomUp?"before":"after"](e,i))),n.dragula.then(()=>{this.getDragula()}),Promise.all(this.children.map(e=>this.editItem(e,t))))}done(){if(!1===super.done())return!1;Mavo.revocably.remove(this.addButton),this.propagate(e=>this.doneItem(e))}dataChanged(e,t={}){return t.element=t.element||this.marker,super.dataChanged(e,t)}dataRender(e,t={}){if(void 0!==e){e=null===e?[]:Mavo.toArray(e).filter(e=>null!==e);for(var i=!1,r=0;r<this.children.length;r++){var s=this.children[r];r<e.length?i=s.render(e[r],t)||i:(this.delete(s,{silent:i=!0}),r--)}if(e.length>r){for(var a=document.createDocumentFragment(),o=r;o<e.length;o++){i=(s=this.createItem()).render(e[o],t)||i;this.children.push(s),s.index=o,a.appendChild(s.element),Mavo.hooks.run("collection-add-end",{context:this,item:s})}this.marker.before(a)}if(this.liveData.update(),e.length>r)for(o=r;o<this.children.length;o++)this.children[o].dataChanged("add");return i}}isCompatible(e){return e&&this.itemTemplate.constructor==e.itemTemplate.constructor&&(e===this||e.template==this||this.template==e||this.template&&this.template==e.template||-1<this.accepts.has(e.property))}destroy(){super.destroy(),this.dragula?.destroy(),this.dragula=null,this.propagate("destroy")}getDragula(){if(!this.dragula){var e;if(this.template)return-1===(e=this.template.getDragula().containers).indexOf(this.marker.parentNode)&&e.push(this.marker.parentNode),this.dragula=this.template.dragula||this.template.getDragula();this.dragula=dragula({containers:[this.marker.parentNode],isContainer:e=>!!this.accepts.size&&Array.from(e.childNodes).some(e=>{e=n.get(e);return e&&this.accepts.has(e.property)}),moves:(e,t,i)=>i.classList.contains("mv-drag-handle")&&i.closest(Mavo.selectors.multiple)==e,accepts:function(e,t,i,r){return!e.contains(t)&&(t=r?.previousElementSibling??t.lastElementChild,!!(t=n.get(t)||n.get(r)))&&Mavo.Node.get(e)?.collection.isCompatible(t)}}),this.dragula.on("drop",(e,t,i)=>{var r=Mavo.Node.get(e),s=e.nextElementSibling,e=e.previousElementSibling,a=n.get(e)||n.get(s),s=Mavo.Node.get(e)||Mavo.Node.get(s);if(s&&s.collection!=a&&(s=null),!r.collection.isCompatible(a))return this.dragula.cancel(!0);s=s?s.index+(s.element===e):a.length;a.add(r,s)}),n.dragulas.push(this.dragula)}return this.dragula}getClosestCollection(){return this}static get(e){var t=Mavo.data(e,"collection");return t||Mavo.Node.get(e)?.collection||null}static async delete(e,t={}){if(0===(e=e.filter(e=>!!e.collection)).length)return[];if(1===e.length)return[await e[0].collection.delete(e[0],t)];let i=new Mavo.BucketMap({arrays:!0}),r=new Set;e=e.map(async e=>{r.add(e.collection);var t=await e.collection.delete(e,{silent:!0,undoable:!1,destroy:!1});return t.unsavedChanges=!0,i.set(e.mavo,e),t}),e=await Promise.all(e);return!1!==t.silent&&(r.forEach(e=>{e.unsavedChanges=e.mavo.unsavedChanges=!0,e.dataChanged("delete")}),!1!==t.undoable)&&i.forEach((e,t)=>{t.setDeleted(...e)}),e}};o.Class(n,{lazy:{bottomUp:function(){return/^desc\b/i.test(this.element.getAttribute("mv-order"))}},static:{dragulas:[],lazy:{dragula:()=>o.include(self.dragula,"https://cdnjs.cloudflare.com/ajax/libs/dragula/3.7.2/dragula.min.js")}}})}(Bliss,Bliss.$),Bliss,Bliss.$,Mavo.ImplicitCollection=class extends Mavo.Node{constructor(e,t,i){super(e,t,i),this.children=[],this.liveData=new Mavo.Data(this,[]),this.add(e),this.postInit(),Mavo.hooks.run("implicit-collection-init-end",this)}get length(){return this.children.length}getData(t={}){var e,i={context:this,options:t,data:[]};return this.children.forEach(e=>{e.isDataNull()||i.data.push(e.getData(t))}),this.data&&(e=Mavo.toArray(Mavo.subset(this.data,this.inPath))).length>i.data.length&&(i.data=i.data.concat(e.slice(i.data.length))),Array.isArray(i.data)&&i.data.length<=1&&(i.data=1===i.data.length?i.data[0]:null),i.data=Mavo.subset(this.data,this.inPath,i.data),Mavo.hooks.run("node-getdata-end",i),i.data}add(e){e=Mavo.Node.create(e,this.mavo,{collection:this,template:this.template?.children?.[this.length]??null,property:this.property,type:this.type});return e.index=this.length,this.children.push(e),this.liveData.update(),e}edit(t={}){return!1!==super.edit()&&Promise.all(this.children.map(e=>e.edit(t)))}dataRender(i,r={}){var s;void 0!==i&&(s=(i=null===i?[]:Mavo.toArray(i).filter(e=>null!==e)).length!==this.liveData.length,this.children.forEach((e,t)=>s=e.render(i?.[t],r)??s)),this.liveData.update()}},function(r,t){var i=Mavo.UI.Itembar=class{constructor(e){this.item=e,this.element=t(`.mv-item-bar:is(:not([mv-rel]), [mv-rel="${this.item.property}"])`,this.item.element).filter(e=>e.closest(Mavo.selectors.multiple)==this.item.element&&!Mavo.data(e,"item"))[0],!this.element&&this.item.template?.itembar?this.element=this.item.template.itembar.element.cloneNode(!0):(this.element=this.element||r.create({className:"mv-item-bar mv-ui"}),this.template=this.element.getAttribute("mv-item-bar")||this.item.element.getAttribute("mv-item-bar")||this.collection.element.getAttribute("mv-item-bar")||"",(e=Object.assign({},i.controls)).move={...e.move,optional:this.item instanceof Mavo.Primitive},this.controls=Mavo.UI.Bar.getControls(this.template,e),r.set(this.element,{"mv-rel":this.item.property,contents:this.controls.map(e=>{var t=i.controls[e],e=r(".mv-"+e,this.element);return r.create(t.create.call(this,e))})})),this.dragHandle=r(".mv-drag-handle",this.element)||this.item.element,this.element.setAttribute("hidden",""),r.bind([this.item.element,this.element],"focusin mouseover",this),r.bind(this.element,{mouseenter:e=>{this.item.element.classList.add("mv-highlight")},mouseleave:e=>{this.item.element.classList.remove("mv-highlight")}}),this.dragHandle.addEventListener("keydown",e=>{e.target===this.dragHandle&&this.item.editing&&37<=e.keyCode&&e.keyCode<=40&&(this.collection.move(this.item,e.keyCode<=38?-1:1),e.stopPropagation(),e.preventDefault(),e.target.focus())}),this.dragHandle!==this.item.element&&this.dragHandle.addEventListener("click",e=>e.target.focus()),Mavo.data(this.element,"item",this.item)}get collection(){return this.item.collection}get mavo(){return this.item.mavo}destroy(){this.hide()}show(t){i.visible.forEach(e=>{e==this||this.sticky&&!e.sticky||(clearTimeout(e.hideTimeout),e.hide(t,i.DELAY))}),i.visible.add(this),(this.element.hasAttribute("hidden")||t&&!this.sticky)&&(this.element.removeAttribute("hidden"),this.sticky=this.sticky||t,r.bind([this.item.element,this.element],"focusout mouseleave",this))}hide(e,t=0){this.sticky&&!e||(t?this.hideTimeout=setTimeout(()=>this.hide(e),t):(this.element.setAttribute("hidden",""),r.unbind([this.item.element,this.element],"focusout mouseleave",this),this.sticky=!1,i.visible.delete(this)))}handleEvent(e){var t=-1===e.type.indexOf("mouse");this.isWithinItem(e.target)&&(clearTimeout(this.hideTimeout),-1<["mouseleave","focusout","blur"].indexOf(e.type)?this.isWithinItem(e.relatedTarget)||this.hide(t,i.DELAY):(this.show(t),e.stopPropagation()))}isWithinItem(e){var t;return!!e&&((t=e.closest(".mv-item-bar"))?t===this.element:e.closest(Mavo.selectors.item)===this.item.element)}add(){var e,t;this.element.parentNode||Mavo.revocably.add(this.element)||((t=(e=this.item.element.nodeName.toLowerCase())in i.container?r(i.container[e],this.item.element):t)||this.item.element).appendChild(this.element),this.dragHandle==this.item.element&&this.item.element.classList.add("mv-drag-handle")}remove(){Mavo.revocably.remove(this.element),this.dragHandle==this.item.element&&this.item.element.classList.remove("mv-drag-handle")}};r.Class(i,{live:{sticky:function(e){this.element.classList.toggle("mv-sticky",e)}},static:{DELAY:100,visible:new Set,container:{details:"summary"},controls:{delete:{create(e){e=e||r.create("button",{type:"button",title:this.mavo._("delete-item",this.item),className:"mv-delete"});return Mavo.setAttributeShy(e,"mv-action","delete($item)"),e}},add:{create(e){var t=this.collection.bottomUp,i="$item"+(t?", $index + 1":""),e=e||r.create("button",{type:"button",title:this.mavo._("add-item-"+(t?"after":"before"),this.item),className:"mv-add"});return Mavo.setAttributeShy(e,"mv-action",`if($cmd, add($item, ${i}), add(${i}))`),e}},move:{create(e){e=e||r.create("button",{type:"button",title:this.mavo._("drag-to-reorder",this.item),className:"mv-move"});return e.classList.add("mv-drag-handle"),e}}}}})}(Bliss,Bliss.$),function(){var t=Mavo.Expression=class{constructor(e,t={}){this.options=t,this.expression=e}eval(t=Mavo.Data.stub){if(Mavo.hooks.run("expression-eval-beforeeval",this),this.function instanceof Error)return this.function;try{return this.function(t)}catch(e){return this.error("Something went wrong with the expression "+this.expression,e.message,"Data was: "+JSON.stringify(t)),Mavo.hooks.run("expression-eval-error",{context:this,error:e}),e}}error(e,...t){t=t.join("\n"),console.info(`%cOops! 😳 ${e}:`,"color: #c04; font-weight: bold;",t)}toString(){return this.expression}changedBy(e){return t.changedBy(this.identifiers,e)}};Bliss.Class(t,{live:{expression:function(t){try{this.function=Mavo.Script.compile(t,this.options)}catch(e){return this.error("There is something wrong with the expression "+t,e.message,"Not an expression? See https://mavo.io/docs/expressions/#disabling-expressions for information on how to disable expressions."),Mavo.hooks.run("expression-compile-error",{context:this,error:e}),this.function=e,t}if(this.ast=this.options.ast,delete this.options.ast,this.ast){let r=new Set;Mavo.Script.walk(this.ast,(e,t,i)=>{"Identifier"===e.type&&"callee"!==t?r.add(e.name):"MemberExpression"===e.type&&(e.object.name&&r.add(e.object.name),r.add(e.property.name))}),this.identifiers=[...r]}}}}),t.Syntax=class{constructor(e,t){this.start=e,this.end=t,this.regex=RegExp(Mavo.escapeRegExp(e)+"([\\S\\s]*?)"+Mavo.escapeRegExp(t),"gi")}test(e){return this.regex.lastIndex=0,this.regex.test(e)}tokenize(e){var t,i=[],r=0;for(this.regex.lastIndex=0;null!==(t=this.regex.exec(e));)t.index>r&&i.push(e.substring(r,t.index)),r=this.regex.lastIndex,/\S/.test(t[1])?i.push(new Mavo.Expression(t[1])):i.push(t[0]);return r<e.length&&i.push(e.substring(r)),i}static create(e){if(e){e=e.getAttribute("mv-expressions");if(e)return e=e.trim(),/\s/.test(e)?new t.Syntax(...e.split(/\s+/)):t.Syntax.ESCAPE}}},t.Syntax.ESCAPE=-1,t.Syntax.default=new t.Syntax("[","]")}(),function(s){var a=Mavo.DOMExpression=s.Class({async constructor(e={}){this.mavo=e.mavo,this.template=e.template?.template||e.template;for(var t of["item","path","syntax","fallback","attribute","originalAttribute","expression","parsed","identifiers"])this[t]=(void 0===e[t]&&this.template?this.template:e)[t];var i;this.node=e.node,this.node||(this.node=Mavo.elementPath(this.item.element,this.path)),this.element=this.node,this.attribute=this.attribute||null,Mavo.hooks.run("domexpression-init-start",this),"mv-value"==this.attribute&&(this.originalAttribute="mv-value",this.attribute=Mavo.Primitive.getValueAttribute(this.element),this.fallback=this.fallback||Mavo.Primitive.getValue(this.element,{attribute:this.attribute}),i=this.element.getAttribute("mv-value"),this.element.removeAttribute("mv-value"),this.parsed=[new Mavo.Expression(i)],this.expression=i),3===this.node.nodeType&&this.element===this.node&&(this.element=this.node.parentNode,this.node.parentNode.children.length&&!this.attribute||(this.element.normalize(),this.node.parentNode&&!this.attribute)||(this.node=this.element)),"string"!=typeof this.expression&&(this.attribute?(i=Element.prototype.getAttribute.call(this.node,this.attribute),this.expression=(i||"").trim()):(this.node.normalize(),1===this.node.childNodes.length&&3===this.node?.firstChild?.nodeType&&((i=this.node.firstChild.textContent.match(/^\s*|\s*$/g))[1]&&(this.node.firstChild.splitText(this.node.firstChild.textContent.length-i[1].length),this.node.after(this.node.lastChild)),i[0])&&(this.node.firstChild.splitText(i[0].length),this.node.parentNode.insertBefore(this.node.firstChild,this.node)),this.expression=this.node.textContent),this.parsed=this.template?this.template.parsed:this.syntax.tokenize(this.expression)),this.oldValue=this.value=this.parsed.map(e=>e instanceof Mavo.Expression?"":e),this.identifiers=this.identifiers||this.parsed.flatMap(e=>e.identifiers||[]),a.special.add(this),Mavo.hooks.run("domexpression-init-end",this),a.elements.set(this.element,[...a.elements.get(this.element)||[],this]),await this.mavo.treeBuilt,this.template||this.item||(this.item=Mavo.Node.getClosestItem(this.element)),"mv-value"==this.originalAttribute&&this.mavoNode&&this.mavoNode==this.item.collection&&this.item.expressions.delete(this),this.mavo.expressions.register(this),Mavo.hooks.run("domexpression-init-treebuilt",this)},destroy:function(){a.special.delete(this),this.mavo.expressions.unregister(this)},get isDynamicObject(){return"mv-value"==this.originalAttribute&&this.mavoNode&&!(this.mavoNode instanceof Mavo.Primitive)},changedBy:function(e){return this.isDynamicObject?!e||!this.mavoNode.contains(e.node):Mavo.Expression.changedBy(this.identifiers,e)},update:function(e){var t,s,i,a,o;!1!==this.active&&(s=t={context:this},a=this.item?(i=this.isDynamicObject?this.item.parent:this.item,this.data=i.getLiveData()):void 0===this.data?Mavo.Data.stub:this.data,Mavo.hooks.run("domexpression-update-start",t),this.oldValue=this.value,o=!1,t.value=this.value=this.parsed.map((e,t)=>{var i,r;return e instanceof Mavo.Expression?(t=Mavo.value(this.oldValue[t]),i={context:this,expr:e,parentEnv:s,oldValue:t},Mavo.hooks.run("domexpression-update-beforeeval",i),i.value=Mavo.value(i.expr.eval(a)),Mavo.hooks.run("domexpression-update-aftereval",i),i.value instanceof Error&&(i.value=void 0!==this.fallback?this.fallback:this.syntax.start+i.expr.expression+this.syntax.end),void 0!==i.value&&null!==i.value||(i.value=""),r=Mavo.value(i.value),this.evaluated&&"object"!=typeof r&&r===t||(o=!0),this.evaluated=!0,i.value):e}),o||e?.force)&&(1===t.value.length?t.value=t.value[0]:t.value=t.value.map(e=>Mavo.Primitive.format(e,{attribute:this.attribute,element:this.element})).join(""),this.output(t.value),Mavo.hooks.run("domexpression-update-end",t))},output:function(e){this.mavoNode?(Mavo.in(Mavo.isProxy,e)&&(e=Mavo.clone(e)),this.mavoNode.render(e,{live:!0})):(this.node.nodeType!==Node.TEXT_NODE||this.node.parentNode||(this.node=this.element),Mavo.Primitive.setValue(this.node,e,{attribute:this.attribute}))},live:{item:function(e){e&&this._item!=e&&(this._item&&this._item.expressions.delete(this),e.expressions=e.expressions||new Set,e.expressions.add(this))}},static:{elements:new WeakMap,search:function(e,t){if(null===e)return e;t&&!e.ownerDocument.xmlVersion&&(t=t.toLowerCase());var i=a.elements.get(e)||[];return 1<arguments.length?i.length&&i.filter(e=>e.attribute===t)[0]||null:i},special:{add:function(e,t){if(t){var i=this.vars[t],r=-1<e.identifiers.indexOf(t),s=t.startsWith("$")&&-1<e.identifiers.indexOf(t.substr(1));i&&(r||s)&&(i.all=i.all||new Set,i.all.add(e),1===i.all.size?i.observe():i.all.size||i.unobserve())}else for(var t in this.vars)this.add(e,t)},delete:function(e,t){if(t){var i=this.vars[t];i.all=i.all||new Set,i.all.delete(e),i.all.size||i.unobserve()}else for(var t in this.vars)this.delete(e,t)},update:function(){this.update?.(...arguments),this.all.forEach(e=>e.update())},event:function(t,{type:e,update:i,target:r=document}={}){this.vars[t]={observe:function(){this.callback=this.callback||a.special.update.bind(this),s.bind(r,e,this.callback)},unobserve:function(){s.unbind(r,e,this.callback)}},i&&(this.vars[t].update=function(e){Mavo.Functions[t]=i(e)})},vars:{$now:{observe:function(){var e=()=>{a.special.update.call(this),this.timer=requestAnimationFrame(e)};this.timer=requestAnimationFrame(e)},unobserve:function(){cancelAnimationFrame(this.timer)}}}}}});a.special.event("$mouse",{type:"mousemove",update:function(e){return{x:e.clientX,y:e.clientY}}}),a.special.event("$hash",{type:"hashchange",target:window})}(Bliss,Bliss.$),function(e,n){Mavo.attributes.push("mv-expressions");var s=Mavo.Expressions=e.Class({async constructor(e){this.mavo=e,this.active=!0,this.expressions=new Set,this.identifiers={};e=Mavo.Expression.Syntax.create(this.mavo.element.closest("[mv-expressions]"))||Mavo.Expression.Syntax.default;this.traverse(this.mavo.element,void 0,e),this.scheduled={},await this.mavo.treeBuilt,this.expressions=new Set,this.update()},register:function(t){var i=this.identifiers;t.registeredApp=t.registeredApp||new Set,t.identifiers.forEach(e=>{i[e]instanceof Set||(i[e]=new Set),i[e].add(t),Mavo.all[e]instanceof Mavo&&Mavo.all[e]!==this.mavo&&!t.registeredApp.has(e)&&(t.registeredApp.add(e),Mavo.all[e].expressions.register(t))})},unregister:function(t){var i=this.identifiers;t.identifiers.forEach(e=>{i[e]&&i[e].delete(t),e in Mavo.all&&"undefined"!=typeof domexpresssion&&Mavo.all[e].expressions.unregister(domexpresssion)})},updateThrottled:function(e){var t;this.active&&(t=this.scheduled[e.action]=this.scheduled[e.action]||new Set,e.node.template?t.has(e.node.template)||(setTimeout(()=>{t.delete(e.node.template),this.update(e)},s.THROTTLE),t.add(e.node.template)):requestAnimationFrame(()=>this.update(e)))},update:function(i){if(this.active){var e,t,r;if(i instanceof Mavo.Node)e=i;else if(i instanceof Element)t=i.closest(Mavo.selectors.item),e=Mavo.Node.get(t);else{if(i)return t={updated:new Set},this.updateByIdThrottled(i.property,i,t),void("propertychange"==i.action?i.node?.path&&this.updateByIdThrottled(i.node.path,i,t):(this.updateById(Object.keys(Mavo.Data.special),i,t),r=i.node.collection||i.node,this.updateById(r.properties,i,t)));e=this.mavo.root}e.walk((e,t)=>{if(!e.expressionsEnabled)return!1;e.expressions?.forEach(e=>{i&&e.mavoNode===i||e.update()})})}},updateByIdThrottled:function(e,t,i){var r;e&&(e.forEach?e.forEach(e=>this.updateByIdThrottled(e,t,i)):(r=this.scheduledIds=this.scheduledIds||new Set).has(e)||(setTimeout(()=>{r.delete(e),this.updateById(e,t,i)},s.THROTTLE),r.add(e)))},updateById:function(e,t,i){e.forEach?e.forEach(e=>this.updateById(e,t,i)):(e=this.identifiers[e])&&e.forEach(e=>{"mv-value"==e.originalAttribute&&e.mavoNode&&!(e.mavoNode instanceof Mavo.Primitive)&&e.mavoNode.contains(t.node)||i.updated.has(e)||e.update()})},extract:function(e,t,i,r=Mavo.Expression.Syntax.default){t&&-1<s.skip.indexOf(t.name)||(t&&-1<s.directives.indexOf(t.name)||r!==Mavo.Expression.Syntax.ESCAPE&&r.test(t?t.value:e.textContent))&&(void 0===i&&(i=Mavo.elementPath(e.closest(Mavo.selectors.scope),e)),this.expressions.add(new Mavo.DOMExpression({node:e,syntax:r,path:i,attribute:t?.name,mavo:this.mavo})))},traverse:function(t,i=[],r){var s,a,o;8!==t.nodeType&&(3===t.nodeType?this.extract(t,null,i,r):(t.normalize(),r=Mavo.Expression.Syntax.create(t)||r,t.matches(Mavo.selectors.scope)&&(i=[]),t.hasAttribute("mv-expressions-ignore")&&(s=new Set(t.getAttribute("mv-expressions-ignore").trim().split(/\s*,\s*/))),n(t.attributes).forEach(e=>{s&&s.has(e.name)||this.extract(t,e,i,r)}),a=-1,o=0,t.matches("script:not([mv-expressions])")||n(t.childNodes).forEach(e=>{var t;1==e.nodeType?(o=0,a++):o++,1!=e.nodeType&&3!=e.nodeType||(t=0<o?a+"."+o:a,this.traverse(e,[...i||[],t],r))})))},static:{directives:["mv-value"],skip:["mv-expressions","mv-action"],THROTTLE:50,directive:function(e,t){s.directives.push(e),Mavo.attributes.push(e),Mavo.Plugins.register(e,t)}}})}(Bliss,Bliss.$),function(t){Mavo.Expressions.directive("mv-if",{extend:{Primitive:{live:{hidden:function(e){this._hidden!==e&&(this._hidden=e,this.liveData.update(),this.dataChanged())}}},DOMExpression:{lazy:{childProperties:function(){var e=t(Mavo.selectors.property,this.element).filter(e=>e.closest("[mv-if]")==this.element).map(e=>Mavo.Node.get(e));return this.element.addEventListener("mv-change",e=>{requestAnimationFrame(()=>{this.element.parentNode||this.item.element.dispatchEvent(e)})}),e}}}},hooks:{"domexpression-init-start":function(){"mv-if"==this.attribute&&(Mavo.Node.prototype.fromTemplate.call(this,"parsed","expression")||(this.expression=this.element.getAttribute("mv-if"),this.parsed=[new Mavo.Expression(this.expression)],this.expression=this.syntax.start+this.expression+this.syntax.end),this.parentIf=this.element.parentNode&&Mavo.DOMExpression.search(this.element.parentNode.closest("[mv-if]"),"mv-if"),this.parentIf)&&(this.parentIf.childIfs=(this.parentIf.childIfs||new Set).add(this))},"domexpression-update-end":async function(){var t,e,i;"mv-if"===this.attribute&&(t=this.value[0],e=this.oldValue[0],await this.item.mavo.treeBuilt,this.parentIf&&(i=this.parentIf.value[0],this.value[0]=t=t&&i),!1!==i&&(t?Mavo.revocably.add(this.element):this.element.parentNode&&Mavo.revocably.remove(this.element,"mv-if")),t!==e)&&(this.childProperties?.forEach(e=>e.hidden=!t),this.childIfs?.forEach(e=>e.update()))},"node-isdatanull":function(e){e.result=e.result||this.hidden&&e.options.live}}})}((Bliss,Bliss.$)),function(o,a){var l=Mavo.Functions={operators:{"=":"eq"},get:function(e,t,...i){if(arguments.length<=1)return e;let r;t=a(t);var s=Mavo.getCanonicalProperty(e,t);if(void 0!==s)r=e[s];else{if(!(Array.isArray(e)&&t&&isNaN(t)))return null;r=e.map(e=>l.get(e,t))}return 0<i.length?l.get(r,...i):r},map:function(e,t){return Array.isArray(e)?e.map(e=>l.get(e,t)):e?l.get(e,t):void 0},url:(e,t=location)=>{var i;return void 0===e?location.href:(e&&(e=n(e).replace(/[^\w-:]/g),i=t.search.match(RegExp(`[?&]${e}(?:=(.+?))?(?=$|&)`))||t.pathname.match(RegExp(`(?:^|\\/)${e}\\/([^\\/]*)`))),null!==i&&e?decodeURIComponent(i[1]||""):null)},first:(e,t)=>{if(void 0===t&&(t=e,e=void 0),void 0===t)return null;if(!Array.isArray(t))return void 0!==e?[t]:t;if(e<0)return l.last(Math.abs(e),t);for(var i=[],r=void 0===e?1:Math.floor(e),s=0;s<t.length&&i.length<r;s++){var a=Mavo.value(t[s]);null!==a&&""!==a&&i.push(t[s])}return void 0===e?void 0!==i[0]?i[0]:null:i},last:(e,t)=>{if(void 0===t&&(t=e,e=void 0),void 0===t)return null;if(!Array.isArray(t))return void 0!==e?[t]:t;if(e<0)return l.first(Math.abs(e),t);for(var i=[],r=void 0===e?1:Math.floor(e),s=t.length-1;0<=s&&i.length<r;s--){var a=Mavo.value(t[s]);null!==a&&""!==a&&i.push(t[s])}return void 0===e?void 0!==i[0]?i[0]:null:i},condense:e=>l.first(e.length,e),unique:function(e){return Array.isArray(e)?[...new Set(e.map(a))]:e},intersects:function(e,t){var i;if(e&&t)return i=new Set(Mavo.toArray(t).map(a)),!(e=Mavo.toArray(e).map(a)).every(e=>!i.has(e))},intersection:function(e,t){if(!e||!t)return null;e=Mavo.toArray(e),t=Mavo.toArray(t);let i=new Set(t.map(a));return e.filter(e=>i.has(Mavo.value(e)))},sum:o.extend(function(e){return i.numbers(e,arguments).reduce((e,t)=>+e+(+t||0),0)},{isAggregate:!0}),average:o.extend(function(e){return(e=i.numbers(e,arguments)).length&&l.sum(e)/e.length},{isAggregate:!0,alias:"avg"}),median:o.extend(function(e){var t=((e=i.numbers(e,arguments).sort((e,t)=>e-t)).length-1)/2;return[m1,m2]=[e[Math.floor(t)],e[Math.ceil(t)]],(m1+m2)/2||0},{isAggregate:!0}),min:o.extend(function(e){return Math.min(...i.numbers(e,arguments))},{isAggregate:!0}),max:o.extend(function(e){return Math.max(...i.numbers(e,arguments))},{isAggregate:!0}),atan2:o.extend((e,t)=>Math.atan2(e,t),{multiValued:!0,rightUnary:e=>e,default:1}),pow:o.extend((e,t)=>Math.pow(e,t),{multiValued:!0,default:1}),imul:o.extend((e,t)=>Math.imul(e,t),{multiValued:!0,default:1}),count:o.extend(function(e){return Mavo.toArray(e).filter(e=>!r(e)).length},{isAggregate:!0}),reverse:function(e){return Mavo.toArray(e).slice().reverse()},round:o.extend((e,t)=>s(e)||s(t)||!isFinite(e)?Math.round(e):+(+e).toLocaleString("en-US",{useGrouping:!1,maximumFractionDigits:t}),{multiValued:!0,rightUnary:e=>e,default:0}),ordinal:o.extend(e=>{var t;return r(e)?"":(t=e<10||20<e?["th","st","nd","rd","th"][e%10]:t)||"th"},{multiValued:!0,alias:"th"}),pluralize:o.extend(function(e,...t){var i;return r(e)?"":0===t.length?e:(i=(t=t.reduce((e,t)=>(t=Mavo.value(t),"object"!==o.type(t)&&(t=e.one?Object.fromEntries(["zero","two","few","many","other"].map(e=>[e,t])):{one:t}),Object.assign(e,t)),{})).lang||Mavo.locale,i=t[new Intl.PluralRules(i,{type:t.type||"cardinal"}).select(e)]||t.other||t.two||t.zero||t.few||t.many||t.one,t.text_only?i:"ordinal"===t.type?""+e+i:e+" "+i)},{multiValued:!0,needsContext:!0}),digits:o.extend((e,t,i)=>{var r;return void 0===i&&(i=t,t=void 0),isNaN(i)?null:((r=(i+"").split("."))[0]=r[0].slice(-e),void 0!==t&&r[1]&&(r[1]=r[1].slice(0,t)),(i=+r.join(".")).toLocaleString("en",{useGrouping:!1,minimumIntegerDigits:e,minimumFractionDigits:t,maximumFractionDigits:t||20}))},{multiValued:!0}),iff:function(e,i=e,r=null){return Array.isArray(e)?e.map((e,t)=>{e=a(e)?i:r;return Array.isArray(e)?e[Math.min(t,e.length-1)]:e}):a(e)?i:r},group:(...e)=>Object.assign({},...e),list:(...e)=>e.flat(),random:o.extend((e=0,t=100,i=1)=>{1==arguments.length&&(t=e,e=0);var r=Math.random();return Math.floor(r*(1+(t-e)/i))*i+e},{multiValued:!0}),range:(i,e,r)=>{void 0===r&&(void 0===e&&([i,e]=[0<=i?1:-1,i]),r=i<=e?1:-1);var s=Math.floor((e-i)/r+1);if(s<=0||!isFinite(s))return[i];var a=[];for(let e=0,t=i;e++<s;t+=r)a.push(t);return a},shuffle:e=>{if(Array.isArray(e)){for(var t=e.slice(),i=t.length-1;0<i;i--){var r=Math.floor(Math.random()*(i+1));[t[i],t[r]]=[t[r],t[i]]}return t}return e},sort(e,i=e,...t){t=Object.assign({},...t);var r=Object.assign({numeric:!0},t);let s=new Intl.Collator(t.lang||Mavo.locale,r),a=(Array.isArray(i)||(i=l.get(e,i)),t.order?.startsWith("desc")),o=e.map((e,t)=>[e,i[t]]);return(o=o.sort((e,t)=>{e=e[1],t=t[1];return s.compare(e,t)*(a?-1:1)})).map(e=>e[0])},replace:o.extend((e,t,i="",r=1)=>{if(!Mavo.value(e))return e;if(Array.isArray(e))return e.map(e=>l.replace(e,t,i));for(var s,a=RegExp(Mavo.escapeRegExp(t),"g"),o=e,n=0;o!=s&&n++<r;)o=(s=o).replace(a,i);return o},{multiValued:!0}),len:o.extend(e=>n(e).length,{multiValued:!0}),contains:o.extend((e,t)=>{let i;var r,s=o.type(e);if("object"===o.type(t))return 0<=JSON.stringify(e).indexOf(JSON.stringify(t));if("object"!==s&&"array"!==s)return 0<=l.search(e,t);for(r in e)if(i=l.contains(e[r],t),i=Array.isArray(i)?Mavo.Functions.or(i):i)return!0;return i},{multiValued:!0}),search:o.extend((e,t)=>(e=n(e),t=n(t),e&&t?e.toLowerCase().indexOf(t.toLowerCase()):-1),{multiValued:!0}),starts:o.extend((e,t)=>0===l.search(n(e),n(t)),{multiValued:!0}),ends:o.extend((e,t)=>{[e,t]=[n(e),n(t)];var i=l.search(e,t);return-1<i&&i===e.length-t.length},{multiValued:!0}),join:function(e,t){return Mavo.toArray(e).filter(e=>!r(e)).join(n(t))},idify:o.extend(e=>n(e).normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s-]/g,"").trim().replace(/\s+/g,"-").toLowerCase(),{multiValued:!0}),readable:o.extend(e=>n(e).replace(/([a-z])([A-Z])(?=[a-z])/g,(e,t,i)=>t+" "+i.toLowerCase()).replace(/([a-z0-9])[_\/-](?=[a-z0-9])/g,"$1 ").replace(/^[a-z]/,e=>e.toUpperCase()),{multiValued:!0}),uppercase:o.extend(e=>n(e).toUpperCase(),{multiValued:!0}),lowercase:o.extend(e=>n(e).toLowerCase(),{multiValued:!0}),from:o.extend((e,t)=>l.between(e,t),{multiValued:!0}),fromlast:o.extend((e,t)=>l.between(e,t,"",!0),{multiValued:!0}),to:o.extend((e,t)=>l.between(e,"",t),{multiValued:!0}),tofirst:o.extend((e,t)=>l.between(e,"",t,!0),{multiValued:!0}),between:o.extend((e,t,i,r)=>{[e,t,i]=[n(e),n(t),n(i)];var s=t?e[r?"lastIndexOf":"indexOf"](t):0,a=i?e[r?"indexOf":"lastIndexOf"](i):e.length;return-1===s||-1===a?"":r&&a<=s?e.slice(a+i.length,s):e.slice(s+t.length,a)},{multiValued:!0}),phrase:o.extend(function(e,t,i){return 2===arguments.length&&"string"===o.type(t)&&([i,t]=[t]),(i?Mavo.Locale.get(i):this?.[Mavo.mavo]?.locale??Mavo.Locale.default).phrase(e,t)},{needsContext:!0}),filename:o.extend(e=>new URL(n(e),Mavo.base).pathname.match(/[^/]+?$/)?.[0],{multiValued:!0}),json:e=>Mavo.safeToJSON(e),split:o.extend((e,t=/\s+/)=>e?(e=n(e)).split(t):[],{multiValued:!0}),log:(...e)=>(console.log(...e.map(a)),e[0]),$mouse:{x:0,y:0},get $hash(){return location.hash.slice(1)},get $alt(){return!!l.$evt&&l.$evt.altKey},get $ctrl(){return!!l.$evt&&l.$evt.ctrlKey},get $shift(){return!!l.$evt&&l.$evt.shiftKey},get $cmd(){return!!l.$evt&&l.$evt[Mavo.superKey]},util:{numbers:function(e,t){return(e=Array.isArray(e)?e:t?$$(t):[e]).filter(e=>!isNaN(e)&&""!==a(e)&&null!==a(e)).map(e=>+e)},postProcess:function(a){var i,e=a.multiValued;if(!0===e||2===e?.length?i=(...i)=>{var r=e[0]||0,s=e[1]||1;return Mavo.Script.binaryOperation(i[r],i[s],{scalar:(e,t)=>(r in i&&(i[r]=e),s in i&&(i[s]=t),a(...i)),...a})}:a.isAggregate&&(i=function(e){var t;return Mavo.in(Mavo.groupedBy,e)?e.map(e=>i(e.$items)):void 0===(t=a.call(this,...arguments))?e:t}),i&&(o.extend(i,a),i.original=a),a.alias)for(var t of Mavo.toArray(a.alias))Mavo.Functions[t]=i||a;return i}}},i=l.util;function n(e=""){return(e=a(e))||0===e?e+"":""}function r(e){return null===(e=Mavo.value(e))||!1===e||""===e}function s(e){return!a(e)}Mavo.ready.then(()=>{Object.getOwnPropertyNames(Mavo.Functions).forEach(e=>{var t=i.postProcess(Mavo.Functions[e]);t&&(Mavo.Functions[e]=t)}),Object.getOwnPropertyNames(Math).forEach(t=>{1!==Math[t].length||Mavo.Functions.hasOwnProperty(t)||(Mavo.Functions[t]=e=>Mavo.Script.unaryOperation(e,e=>Math[t](e)))})})}(Bliss,Mavo.value),function(i,r,d,n=d.util){var c={seconds:1,minutes:60},o=(c.hours=60*c.minutes,c.days=24*c.hours,c.weeks=7*c.days,c.months=30.4368*c.days,c.years=52*c.weeks,{year:e=>e.getFullYear(),month:e=>e.getMonth()+1,day:e=>e.getDate(),weekday:e=>e.getDay()||7,hour:e=>e.getHours(),minute:e=>e.getMinutes(),second:e=>e.getSeconds(),ms:e=>e.getMilliseconds()});function l(e){e=e?.trim()||"";for(var t=Object.keys(c).reverse(),i={};i[p=t.shift()]=!0,!RegExp(p+"?").test(e)&&0<t.length;);return"ms"==e&&(i.ms=!0),i}i.extend(d,{get $now(){return new Date},$startup:new Date,get $today(){return d.date(new Date)},year:i.extend(function(){return n.dateComponent("year",...arguments)},{multiValued:!0}),month:i.extend(function(){return n.dateComponent("month",...arguments)},{multiValued:!0}),week:()=>1e3*c.weeks,day:i.extend(function(){return n.dateComponent("day",...arguments)},{multiValued:!0}),weekday:i.extend(function(){return n.dateComponent("weekday",...arguments)},{multiValued:!0}),hour:i.extend(function(){return n.dateComponent("hour",...arguments)},{multiValued:!0}),minute:i.extend(function(){return n.dateComponent("minute",...arguments)},{multiValued:!0}),second:i.extend(function(){return n.dateComponent("second",...arguments)},{multiValued:!0}),ms:i.extend(function(){return n.dateComponent("ms",...arguments)},{multiValued:!0}),datetime:i.extend((e,t,i)=>{if(!(e=n.date(e)))return"";let r;void 0!==t&&((s=t)&&("ms"==s||(a=s.replace(/s$/,""),s=s.replace(/s?$/,"s"),a in c)||s in c)?[t,i]=[,t]:r=!0);var s,a=l(i??="minutes");let o=d.date(e,i);return a.hours&&(r?o+=Mavo.value(t)?"T"+d.time(t,i):"":o+="T"+d.time(e,i)),o},{multiValued:!0}),date:i.extend((e,t="days")=>{var i;return(e=n.date(e))?(i=[],(t=l(t)).years&&i.push(d.year(e)),t.months&&i.push(d.month(e,"00")),t.days&&i.push(d.day(e,"00")),i.join("-")):""},{multiValued:!0}),time:i.extend((e,t="minutes")=>{if(!(e=n.date(e)))return"";t=l(t);let i="";return t.hours&&(i+=d.hour(e,"00")+":"+(t.minutes?d.minute(e,"00"):"00"),t.seconds)&&(i+=":"+d.second(e,"00"),t.ms)&&(i+="."+d.ms(e,"000")),i},{multiValued:!0}),readable_datetime:i.extend((e,...t)=>{t=t.map(e=>"string"==typeof e||e instanceof String?{precision:e}:e);var i=l((t=Object.assign({},...t)).precision),r=t.month||i.days?"shortname":"long",s=[];return i.days&&s.push(d.day(e)),i.months&&s.push(d.month(e,r)),i.years&&s.push(d.year(e)),i.hours&&s.push(d.time(e,t.precision)),s.join(" ")},{multiValued:!0}),localTimezone:-(new Date).getTimezoneOffset()}),d.msTo=(e,t)=>Math.floor(Math.abs(t)/(1e3*c[e]))||0;for(let t in c)d[t]=i.extend(function(e){return 0===arguments.length?1e3*c[t]:d.msTo(t,e)},{multiValued:!0});d.duration=i.extend(function(e,i){var r=e<0?-1:1;if(e=Math.abs(e),i&&isNaN(i)){var t,s="ms"!=i?i.replace(/s?$/,""):i,a=i.replace(/s?$/,"s");if(a in c)return r*(t=Math.floor(e/c[a]/1e3))+" "+d.phrase.call(this,1===t&&"ms"!==a?s:a);throw new TypeError(`Unknown duration unit ${i}. Please use one of `+Object.keys(c).join(", "))}0!=e&&void 0!==i||(i=1);let o=e,n=[];if(0==e)n=["0 ms"];else{var l=[...Object.keys(c).reverse(),"ms"];for(let e=0,t;t=l[e];e++){var h=t in c?1e3*c[t]:1,u=Math.floor(o/h);if(o%=h,0<u&&n.length<i){h=1===u&&"ms"!==t?t.slice(0,-1):t;n.push(r*u+" "+d.phrase.call(this,h))}else if(0<n.length)break}}return 1===arguments.length?n[0]:n},{needsContext:!0,multiValued:!0}),i.extend(d.util,{fixDateString:function(e){e=e.trim();var t=/^\d{4}-\d{2}(-\d{2})?/.test(e),i=-1<e.indexOf(":");return t||i?(e=t?e.replace(/^(\d{4}-\d{2})(?!-\d{2})/,"$1-01"):d.$today+" "+e,i?e=e.replace(/\-(\d{2})\s+(?=\d{2}:)/,"-$1T"):e+="T00:00:00",e.replace(/\s+/g,"")):null},dateComponent:function(e,t,i,r=Mavo.locale){var s,a;return 1===arguments.length&&e+"s"in c?d[e+"s"]():(s=n.date(t),"year"===e&&(t=t&&t.match?t:t+"",a=s?s.getFullYear()+"":(t.match(/\b[1-9]\d\d\b|\d+/)||[])[0]),a||s?(a=a||o[e](s),i?/^0+$/.test(i)?(a+"").padStart(i.length,"0").slice(-i.length):(i={name:"long",shortname:"short"}[i]||i,(a=s.toLocaleString(r,{[e]:i})).replace(/\u200e/g,"")):"year"===e?a:+a):"")},date:function(e){var t;return(e=r(e))?(t=new Date(e),"string"!==i.type(e)||!isNaN(t)&&t+""==e?t:null===(e=n.fixDateString(e))||(e=e.match(/[+-]\d{2}:?\d{2}|Z$/)?.[0]?new Date(e):(t=e.match(/\d+/g),new Date(t[0],(t[1]||1)-1,t[2]||1,t[3]||0,t[4]||0,t[5]||0,t[6]||0)),isNaN(e))?null:e):null}})}(Bliss,Mavo.value,Mavo.Functions),function(n,o,l){var e,h=Mavo.Script={$fn:self.Proxy?new Proxy({[Symbol.unscopables]:{undefined:!0}},{get:(e,t)=>{var i,r=t?.toLowerCase?.()??t;return i=void 0===(i=r in Mavo.Actions.Functions?Mavo.Actions.running?Mavo.Actions.Functions[r]:Mavo.Actions.nope:i)?r in Mavo.Functions?Mavo.Functions[r]:Math[t]||Math[r]:i},has:(e,t)=>{var i=t.toLowerCase();return i in Mavo.Functions||i in Mavo.Actions.Functions||t in Math||i in Math}}):Mavo.Functions,addUnaryOperator:function(t,i){return i.symbol&&Mavo.toArray(i.symbol).forEach(e=>{h.unarySymbols[e]=t,jsep.addUnaryOp(e)}),e=>h.unaryOperation(e,e=>i.scalar(o(e)))},unaryOperation:function(e,t){return Array.isArray(e)?e.map(t):t(e)},binaryOperation:function(t,i,r={}){if(r.scalar="function"==typeof r?r:r.scalar,Array.isArray(i))if(Array.isArray(t)){var s=[],a=Math.max(t.length,i.length),o=r.leftUnary||r.unary,n=r.rightUnary||r.unary,l=void 0===r.leftDefault?r.default:r.leftDefault,h=void 0===r.rightDefault?r.default:r.rightDefault;for(let e=0;e<a;e++)!r.comparison||void 0!==t[e]&&void 0!==i[e]?void 0===t[e]?s[e]=n?n(i[e]):r.scalar(l,i[e]):void 0===i[e]?s[e]=o?o(t[e]):r.scalar(t[e],h):s[e]=r.scalar(t[e],i[e]):s[e]=r.default}else s=i.map(e=>r.scalar(t,e));else s=Array.isArray(t)?t.map(e=>r.scalar(e,i)):r.scalar(t,i);return s},addBinaryOperator:function(t,a){return a.symbol&&Mavo.toArray(a.symbol).forEach(e=>{h.symbols[e]=t,a.precedence&&jsep.addBinaryOp(e,a.precedence)}),a.default=void 0===a.default?0:a.default,a.code||function(...i){1===i.length&&Array.isArray(i[0])&&(i=[...i[0]]),a.raw||(i=i.map(o));var r=!!a.comparison||i[0];for(let t=1;t<i.length;t++){var s=a.comparison?i[t-1]:r;let e=i[t];Array.isArray(e)&&"number"==typeof a.default&&(e=l.numbers(e));s=h.binaryOperation(s,e,a),r=a.comparison?h.binaryOperation(r,s,h.operators.and):s}return r}},symbols:{},unarySymbols:{},getOperatorName:(e,t)=>h[t?"unarySymbols":"symbols"][e]||e,isComparisonOperator:e=>{if(e)return(e=h.operators[h.symbols[e]])&&e.comparison},isStatic:e=>{if("Identifier"===e.type)return!1;for(var t of h.childProperties)if(e[t]&&"callee"!==t&&!h.isStatic(e[t]))return!1;return!0},operators:{not:{symbol:"!",scalar:e=>!o(e)},multiply:{scalar:(e,t)=>e*t,default:1,symbol:"*"},divide:{scalar:(e,t)=>e/t,rightUnary:e=>e,default:1,symbol:"/"},addition:{scalar:(e,t)=>{if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i||r)return+i+ +r}return+e+ +t},symbol:"+"},plus:{scalar:e=>+e,symbol:"+"},subtract:{scalar:(e,t)=>{if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i&&r)return i-r}return e-t},symbol:"-"},minus:{scalar:e=>-e,symbol:"-"},mod:{scalar:(e,t)=>{e%=t;return e+=e<0?t:0},symbol:"mod",precedence:10},lte:{comparison:!0,scalar:(e,t)=>([e,t]=h.getNumericalOperands(e,t),e<=t),default:!1,symbol:"<="},lt:{comparison:!0,scalar:(e,t)=>([e,t]=h.getNumericalOperands(e,t),e<t),default:!1,symbol:"<"},gte:{comparison:!0,scalar:(e,t)=>([e,t]=h.getNumericalOperands(e,t),t<=e),default:!1,symbol:">="},gt:{comparison:!0,scalar:(e,t)=>([e,t]=h.getNumericalOperands(e,t),t<e),default:!1,symbol:">"},eq:{comparison:!0,scalar:(e,t)=>e==t||Mavo.safeToJSON(e)===Mavo.safeToJSON(t),symbol:["=","=="],default:!1,precedence:7},neq:{comparison:!0,scalar:(e,t)=>e!=t&&Mavo.safeToJSON(e)!==Mavo.safeToJSON(t),symbol:["!="],default:!0,precedence:7},and:{scalar:(e,t)=>e&&t,default:!1,symbol:["&&","and"],precedence:2},or:{scalar:(e,t)=>e||t,default:!1,symbol:["||","or"],precedence:2},concatenate:{symbol:"&",default:"",scalar:(e,t)=>""+(e=Mavo.value(e)??"")+(t=Mavo.value(t)??""),precedence:10},keyvalue:{symbol:":",code:(...e)=>{for(var t=e.length-1,i=e[t];t--;)i={[e[t]]:i};return i},transformation:e=>{"Identifier"==e.left.type&&(e.left={type:"Literal",value:e.left.name,raw:JSON.stringify(e.left.name)})},precedence:4},filter:{symbol:"where",code:(e,...t)=>{for(let i of t)e=Array.isArray(e)?Array.isArray(i)?e.map((e,t)=>o(i[t])?e:null):"boolean"==typeof(i=o(i))?i?e:e.map(e=>null):e.map(e=>e==i?e:null):o(i)?e:null;return e},precedence:1,postFlattenTransformation:t=>{var i=t.arguments[0];for(let e=1;e<t.arguments.length;e++)h.isStatic(t.arguments[e])||(t.arguments[e]=Object.assign(h.parse("scope()"),{arguments:[i,t.arguments[e]]}))}},range:{symbol:"..",scalar:(e,t)=>Mavo.Functions.range(e,t),precedence:2,export:!1},has:{symbol:"in",code:function(t,...e){var r;return e.map(i=>{e=Array.isArray(i)?e=>{var t="object"===n.type(o(e))?Mavo.safeToJSON:o;return-1<i.map(t).indexOf(t(e))}:"object"===n.type(i)?e=>Mavo.in(o(e),i):e=>Mavo.Functions.eq(e,i);var e=Mavo.Script.unaryOperation(t,e);r=void 0===r?e:Mavo.Functions.and(e,r)}),r},precedence:3},groupby:{symbol:"by",code:(i,r)=>{i=Mavo.toArray(i);var s=(r=Mavo.toArray(r))[Mavo.as]||r[0]?.[Mavo.toNode]?.property,a=new Mavo.BucketMap({arrays:!0}),o=[];return o[Mavo.groupedBy]=!0,i.forEach((e,t)=>{t=t<r.length?Mavo.value(r[t]):null;a.set(t,e)}),Mavo.in(Mavo.route,i)&&(o[Mavo.route]=Object.assign({},i[Mavo.route])),a.forEach((e,t)=>{t={$value:t,[s||"$value"]:t,$items:e};Mavo.in(Mavo.route,i)&&(e[Mavo.route]=t[Mavo.route]=Object.assign({},i[Mavo.route]),t[Mavo.route]=n.each(e[Mavo.route],(e,t)=>new Set(["$items"]))),o.push(t)}),Mavo.Data.proxify(o)},precedence:2},as:{symbol:"as",code:(e,t)=>{var i;return void 0!==e&&"array"===n.type(e)&&void 0!==t?(i=e.slice(),Array.isArray(t)||void 0===t?.[Mavo.toNode]?.property?"string"===n.type(t)?(i[Mavo.as]=t,i):void 0!==t[0]?.[Mavo.toNode]?.property?(i[Mavo.as]=t[0]?.[Mavo.toNode]?.property,i):e:(i[Mavo.as]=t?.[Mavo.toNode]?.property,i)):e},precedence:3}},getNumericalOperands:function(e,t){if(isNaN(e)||isNaN(t)){var i=l.date(e),r=l.date(t);if(i&&r)return[i,r]}return[e,t]},childProperties:["arguments","callee","left","right","argument","elements","test","consequent","alternate","object","property","body"],walk:function(t,i,r={},e,s){var a;if(r.type&&t.type!==r.type||(a=i(t,e,s)),!r.ignore||-1===r.ignore.indexOf(t.type))if(Array.isArray(t))for(var o of t)h.walk(o,i,r,e,t);else h.childProperties.forEach(e=>{t[e]&&h.walk(t[e],i,r,e,t)});return void 0!==a&&s&&(s[e]=a),a},serializers:{BinaryExpression:e=>`${h.serialize(e.left,e)} ${e.operator} `+h.serialize(e.right,e),UnaryExpression:e=>""+e.operator+h.serialize(e.argument,e),CallExpression:t=>{t.callee;let e=t.callee,i=t,r="callee";for(;"MemberExpression"===e.type;)e=(i=e).object,r="object";if("MemberExpression"===t.callee.type&&"Identifier"===t.callee.property.type&&"call"===t.callee.property.name&&t.callee.object,"Identifier"===e.type){var s=e.name;if("scope"===s)return h.serializeScopeCall(t.arguments);s in Mavo.Script.$fn&&(i[r]={type:"MemberExpression",computed:!1,object:{type:"Identifier",name:"$fn"},property:e})}return`${h.serialize(t.callee,t)}(${t.arguments.map(e=>h.serialize(e,t)).join(", ")})`},ConditionalExpression:e=>`${h.serialize(e.test,e)}? ${h.serialize(e.consequent,e)} : `+h.serialize(e.alternate,e),MemberExpression:(e,t)=>{let i=e,r;for(;("CallExpression"!==i.type||i.callee!==r)&&(i=(r=i).parent););var s;if(i)return s=e.computed?`[${h.serialize(e.property,e)}]`:"."+e.property.name,h.serialize(e.object,e)+s;i=e;let a=[],o,n;for(;"MemberExpression"===i.type;){var l=i.computed?h.serialize(i.property,i):`"${i.property.name}"`;a.push(l),n=i,o=i=i.object}return`$fn.get(${h.serialize(o,n)}, ${a.reverse().join(", ")})`},ArrayExpression:t=>`[${t.elements.map(e=>h.serialize(e,t)).join(", ")}]`,Literal:t=>{var i=t.raw[0];if("'"!==i&&'"'!==i)return t.raw;{let e=t.raw.slice(1,-1);return i+(e=(e=e.replace(/\r/g,"\\r").replace(/\n/g,"\\n")).replaceAll(i,"\\"+i))+i}},Identifier:e=>e.name,ThisExpression:e=>"this",Compound:t=>t.body.map(e=>h.serialize(e,t)).join(", ")},transformations:{BinaryExpression:e=>{var t=h.getOperatorName(e.operator),i=h.operators[t],r=(i.transformation?.(e),e),s={type:"CallExpression",arguments:[],callee:{type:"Identifier",name:t}};if(i.comparison){var a=[];do{var o=h.getOperatorName(r.operator);a.unshift({comparison:o,operand:r.right}),r=r.left}while(!1!==i.flatten&&h.isComparisonOperator(r.operator));let t=!1;for(let e=0;e<a.length-1;e++)if(a[e].comparison!=a[e+1].comparison){t=!0;break}s.arguments.push(r),t?(s.callee.name="compare",a.forEach(e=>{s.arguments.push({type:"Literal",value:e.comparison,raw:`"${e.comparison}"`}),s.arguments.push(e.operand)})):a.forEach(e=>{s.arguments.push(e.operand)})}else{for(;s.arguments.unshift(r.right),r=r.left,!1!==i.flatten&&r.right&&h.getOperatorName(r.operator)===t;);s.arguments.unshift(r)}return i.postFlattenTransformation?.(s),s},UnaryExpression:e=>{var t=h.getOperatorName(e.operator,!0);if(t)return{type:"CallExpression",arguments:[e.argument],callee:{type:"Identifier",name:t}}},CallExpression:t=>{if("Identifier"==t.callee.type)if("if"==t.callee.name){t.callee.name="iff";var i=t.arguments[0];for(let e=1;e<t.arguments.length;e++)2==e&&(i=h.parse("not()")).arguments.push(t.arguments[0]),h.walk(t.arguments[e],e=>{var t=e.callee.name;Mavo.Actions.Functions.hasOwnProperty(t)&&!/if$/.test(t)&&(e.callee.name+="if",e.arguments.unshift(i))},{type:"CallExpression"})}else{var e;"delete"==t.callee.name?t.callee.name="clear":(e=Mavo.Functions[t.callee.name])&&e.needsContext&&(t.callee={type:"MemberExpression",computed:!1,object:t.callee,property:{type:"Identifier",name:"call"}},t.arguments.unshift({type:"Identifier",name:"$this"}))}},ThisExpression:e=>({type:"Identifier",name:"$this"})},closest(e,t){let i=e;do{if(i.type===t)return i}while(i=i.parent);return null},serialize:(e,t)=>{if("string"==typeof e)return e;t&&(e.parent=t);var i=h.transformations[e.type]?.(e,t);if("object"==typeof i&&i?.type)e=i;else if(void 0!==i)return i;if(e.type&&h.serializers[e.type])return h.serializers[e.type](e,t);throw new TypeError("Cannot understand this expression at all 😔")},rewrite:function(e,t){e=h.parse(e);return t&&(t.ast=e),h.serialize(e)},compile:function(e,t){return/\S/.test(e)?(e=`with (Mavo.Data.stub)
	with (data || {}) {
		let $fn = Mavo.Script.$fn;
		return (${e=h.rewrite(e,t)});
	}`,t?.actions&&(e=`
Mavo.Actions._running = Mavo.Actions.running;
Mavo.Actions.running = true;
${e}
Mavo.Actions.running = Mavo.Actions._running;`),new Function("data",e)):()=>""},parse:self.jsep,serializeScopeCall:e=>{var t=`with (Mavo.Script.subScope(scope, $this) || {}) { return (${h.serialize(e[1])}); }`;return`(function() {
	var scope = ${h.serialize(e[0])};
	if (Array.isArray(scope)) {
		return scope.map(function(scope) {
			${t}
		});
	}

	${t}
})()`},subScope:(e,t)=>{var r=Object.keys(t).reduce((e,t)=>(e[t]=!0,e),{$this:!0});return e&&"object"==typeof e?new Proxy(e,{get:(e,t,i)=>t===Symbol.unscopables?r:Reflect.get(e,t,i)}):e}};for(e in h.serializers.LogicalExpression=h.serializers.BinaryExpression,h.transformations.LogicalExpression=h.transformations.BinaryExpression,h.operators){var t,i=h.operators[e];t=i.scalar?.length<2?h.addUnaryOperator(e,i):h.addBinaryOperator(e,i),i.code=i.code||t,t&&!1!==i.export&&(Mavo.Functions[e]=t)}Mavo.Functions.compare=function(...t){let i=!0;for(let e=2;e<t.length;e+=2){var r=t[e-2],s=t[e-1],a=t[e],r=h.binaryOperation(r,a,Mavo.Script.operators[s]);i=h.binaryOperation(i,r,Mavo.Script.operators.and)}return i}}(Bliss,Mavo.value,Mavo.Functions.util),function(o){Mavo.attributes.push("mv-action");let n=Mavo.Actions={listener:e=>{var t,i="submit"===e.type?"form":":not(form)",i=e.target.closest(i+"[mv-action]");!i||(t=Mavo.Node.get(i))&&t.editing&&"edit"!==t.modes||("submit"===e.type&&e.preventDefault(),i&&n.run(i.getAttribute("mv-action"),i,e))},run:(e,t,i)=>{if(e){var r,t=Mavo.Node.getClosest(t);if(t)return e=new Mavo.Expression(e,{actions:!0}),r=Mavo.Functions.$evt,Mavo.Functions.$evt=i,i=e.eval(t.getLiveData()),Mavo.Functions.$evt=r,i}},getNodes:e=>{var t=n.getNode(e);return t?[t]:Mavo.toArray(e).map(e=>n.getNode(e)).filter(e=>void 0!==e)},getNode:e=>e instanceof Mavo.Node?e:e?.[Mavo.toNode]?e[Mavo.toNode]:void 0,getCollection:e=>{e=n.getNode(e);return e instanceof Mavo.Collection?e:e?.collection??null},nope:()=>{var e=Object.keys(n.Functions).map(e=>e+"()");Mavo.warn(`Mavo actions (${e}) can only be used in the mv-action attribute.`)},Functions:{add:Object.assign(function(e,t,i){let r=[...arguments],s;var a;if(arguments.length<3&&(arguments.length<=1?[e,t]=[void 0,e]:2!==arguments.length||(s=n.getCollection(t))||(s=n.getCollection(e))&&([e,t,i]=[void 0,e,t])),t)return(s=s||n.getCollection(t))||(s=n.getCollection(this))&&([e,i]=r),s?(void 0===i&&(a=n.getNode(t))&&a.collection===s&&(i=a.index),(Array.isArray(e)?e:[e]).map(e=>{var t=s.add(void 0,i);return void 0!==e&&t.render(e),s.editing&&s.editItem(t),t.getLiveData()})):(Mavo.warn("No collection or collection item provided to add().",{once:!1}),e)},{needsContext:!0}),move:(t,i,r)=>{if(t&&void 0!==i){let e=n.getNode(i);"number"!=o.type(i)||e?.collection||([r,i]=[i],e=void 0);var s,i=Mavo.toArray(t).map(n.getNode).filter(e=>e?.closestCollection),a=(e||i[0]).closestCollection;return i.length?(s=n.Functions.add(t,a,r),Mavo.Collection.delete(i,{silent:!0}),s):a?(Mavo.warn("First parameter of move() was not a collection or collection item, using add() instead.",{once:!1}),n.Functions.add(t,a,r)):(Mavo.warn("You need to provide at least one collection or collection item for move() to have something to do.",{once:!1}),t)}},clear:(...t)=>{if(t.length&&t[0]){t=n.getNodes(t.flat());let e=[];return t.forEach(t=>{t&&(t instanceof Mavo.Collection?e.push(...t.children):t.collection?e.push(t):t.walk(e=>{e instanceof Mavo.Primitive?e.value=null:e!==t&&n.Functions.clear(e)}))}),Mavo.Collection.delete(e),t.map(e=>e.getLiveData())}},clearif:(t,...e)=>(e=e.map(e=>Mavo.Functions.iff(t,e)),n.Functions.clear(...e)),set:(e,t)=>{var i,r;if(e)return(i=n.getNode(e))?i.render(t):(i=Array.isArray(e),(r=n.getNodes(e)).length?Mavo.Script.binaryOperation(i?r:r[0],t,{scalar:(e,t)=>e?e.render(t):null}):Mavo.warn(`The first parameter of set() needs to be one or more existing properties, ${Mavo.safeToJSON(e)} is not.`)),t}}};for(let r in n.Functions){var e=r+"if";e in n.Functions||(n.Functions[e]=(e,t,...i)=>(t=Mavo.Functions.iff(e,t),Mavo.value(e)?n.Functions[r](t,...i):null))}n.Functions.deleteif=n.Functions.clearif}(Bliss,Bliss.$),function(a){var l=Mavo.Data=a.Class(class{constructor(e,t){this.node=e,void 0!==t&&(this.data=t)}get parent(){return this.node.parent?.liveData??null}get collection(){return this.node.collection}get key(){return this._key=this.collection?this.node.index:this.node.property}proxify(){return l.proxify(this.data)}update(){if(this.node instanceof Mavo.Collection||this.node instanceof Mavo.ImplicitCollection){for(var e=this.data.length=0;e<this.node.children.length;e++)this.data[e]=this.node.children[e].liveData.data;if(this.node instanceof Mavo.ImplicitCollection){for(e=0;e<this.data.length;e++)null===Mavo.value(this.data[e])&&(this.data.splice(e,1),e--);this.updateParent()}}else{var t;this.node instanceof Mavo.Primitive&&(t=this.node.value,this.node.isDataNull({live:!0})&&(t=null),this.data=Mavo.objectify(t),(Mavo.isPlainObject(t)||Array.isArray(t))&&l.computeRoutes(this.data),this.updateParent())}}updateParent(){var e,t;this.parent&&(this.node instanceof Mavo.ImplicitCollection?(e=1===this.data.length?this.data[0]:this.data,this.parent.set(this.node.property,e,!0)):this.collection instanceof Mavo.ImplicitCollection?this.parent.update():(e=this.key,t=!1,this.collection instanceof Mavo.Collection&&(t=this.collection.children[this.node.index]!==this.node),void 0===e||t||this.parent.set(e,this.data,!0)))}set(e,t,i){this.data[e]=t,l["computeRoute"+(i?"":"s")](t,e,this.data)}updateKey(){var e=this._key;this.parent[e]===this.data&&delete this.parent[e],this.updateParent()}resolve(e){return l.resolve(e,this.data)}},{live:{data:function(e){if(e!==this._data)return this.isArray=Array.isArray(e),(this._data=e)[Mavo.toNode]=this.node,e[Mavo.parent]=this.parent?.data,e[Mavo.mavo]=this.node.mavo,this.proxy=this.proxify(),this.updateParent(),this._data}},static:{stub:self.Proxy?new Proxy({[Symbol.unscopables]:{data:!0,undefined:!0}},{get:(e,t)=>{e=Reflect.get(e,t);if(void 0!==e||"string"!=typeof t)return e;e=t.toLowerCase();if("$"===e[0]&&e in Mavo.Functions)return Mavo.Functions[e];e=t.toUpperCase();if(e in Math)return Math[e];if("undefined"!=typeof window&&window.hasOwnProperty(t))return window[t];if("$"!==t[0]){e="$"+t.toLowerCase();if(e in Mavo.Functions)return Mavo.Functions[e]}return t},has:(e,t)=>Reflect.has(e,t)||"string"==typeof t}):Mavo.Functions,isItem(e){return Array.isArray(e?.[Mavo.parent])},isCollection(e){return Array.isArray(e)&&e?.[Mavo.toNode]instanceof Mavo.Collection},closest(e,t){var i=[];do{if(t(e))return{value:e,path:i}}while(i.push(e[Mavo.property]),e=e[Mavo.parent]);return{value:null,path:i}},root(e){return l.closest(e,e=>!e[Mavo.parent])},closestItem(e){return l.closest(e,l.isItem)},closestArray(e){return l.closest(e,Array.isArray)},getProperty(e){return(l.isItem(e)?e[Mavo.parent]:e)[Mavo.property]},find(i,r,s={}){if(r&&s.exclude!==r){if(Mavo.in(i,r)&&s.exclude!==r[i])return r[i];if(r[Mavo.route]&&Mavo.in(i,r[Mavo.route])){var e,a=[],o=Array.isArray(r),t=(a[Mavo.route]={},a[Mavo.mavo]=r[Mavo.mavo],e=>{e=l.find(i,r[e],s);if(void 0!==e){if(Mavo.in(Mavo.route,e))for(var t in e[Mavo.route])a[Mavo.route][t]=!0;Array.isArray(e)?(a.push(...e),o=!0):a.push(e)}});if(Array.isArray(r)||!0===r[Mavo.route][i])for(var n in r)t(n);else r[Mavo.route][i].forEach(t);return o||1<a.length?a:a[0]}return r[Mavo.property]===i||l.isItem(r)&&l.getProperty(r)===i?r:Array.isArray(r)&&(e=r.map(e=>l.find(i,e)).filter(e=>void 0!==e)).length?e.flat():void 0}},findUp(e,t){let i=t,r;var s=l.isCollection(t);do{if(!l.isCollection(i)||s){var a=l.find(e,i,{exclude:r});if(void 0!==a)return a;if(l.getProperty(i)===e)return i}}while(i=(r=i)[Mavo.parent])},resolve(e,t){if(e===Mavo.isProxy)return!0;if("symbol"==typeof e)return t[e];var i,r,s=!isNaN(e);if(e in t)i=t[e];else{if(l.isCollection(t)&&t[Mavo.property]===e)return t;s||(e in l.special?i=l.special[e](t):t[Mavo.mavo]?(a=t[Mavo.mavo].root.liveData.data[Mavo.route],Mavo.in(e,a)&&(i=l.findUp(e,t))):Mavo.in(Mavo.route,t)&&Mavo.in(e,t[Mavo.route])&&(i=l.find(e,t)))}if(s||(r=e.toLowerCase()),void 0!==i)return null!==i&&"object"==typeof i&&(Mavo.route in i||Mavo.toNode in i)?l.proxify(i):i;if(!s){if(isNaN(e)&&Mavo.all?.[e]?.root)return Mavo.all[e].root.getLiveData();if("$"!==e[0]){var a="$"+r;if(a in l.special)return l.resolve(a,t)}}},has(t,e){if(t===Mavo.isProxy)return!0;if("string"!=typeof t)return Reflect.has(e,t);if(l.getProperty(e)===t)return!0;var i=[e,Mavo.all,l.special];if(i.some(e=>t in e))return!0;if("string"==typeof t){var r=t.toLowerCase();if(r!==t&&i.some(e=>r in e))return!0;if("$"!==r[0]&&"$"+r in l.special)return!0}return e[Mavo.mavo]?Mavo.in(t,e[Mavo.mavo].root.liveData.data[Mavo.route]):void 0},proxify(e){return e&&"object"==typeof e&&self.Proxy&&!e[Mavo.isProxy]?new Proxy(e,{get:(e,t,i)=>l.resolve(t,e),has:(e,t)=>l.has(t,e),set:function(e,t="",i){return"symbol"!=typeof t?(Mavo.warn(`You cannot set data via expressions. Attempt to set ${t.toString()} to ${i} ignored.`),i):Reflect.set(e,t,i)}}):e},computeMetadata(e,t,i){e&&"object"==typeof e&&(void 0!==t&&(e[Mavo.property]=t),i)&&!e[Mavo.parent]&&(e[Mavo.parent]=i)},computeRoute(e,t,i){if("function"!=typeof e&&(l.computeMetadata(e,t,i),!Mavo.isPlainObject(e)&&!Array.isArray(e)||e[Mavo.route]||(e[Mavo.route]={}),"number"!==a.type(t)))for(var r=e;i;){i[Mavo.route]||(i[Mavo.route]={});var s=r?.[Mavo.property];if(s&&!0!==i[Mavo.route][t]){if(i[Mavo.route][t]||(i[Mavo.route][t]=new Set),i[Mavo.route][t].has(s))break;i[Mavo.route][t].add(s)}else i[Mavo.route][t]=!0;i=(r=i)[Mavo.parent]}},computeRoutes(e,t,i){l.traverse(l.computeRoute,e,t,i)},traverseDown(i,r,e,t){if(Array.isArray(r))r.forEach((e,t)=>l.traverse(i,e,t,r));else if(Mavo.isPlainObject(r))for(var s in r)l.traverse(i,r[s],s,r)},traverse(e,t,i,r){e(t,i,r),l.traverseDown(e,t,i,r)},special:{$index:function(e){var t,e=l.closestItem(e).value;return e?(t=e[Mavo.property],isNaN(t)?e[Mavo.parent].indexOf(e):t):-1},$item:function(e){return l.closestItem(e).value},$all:function(e){e=l.closestArray(e);let t=e.path.reverse(),i;[i,...t]=t;var r=e.value.map(e=>a.value(e,...t));return 0<r.length&&r?.[0]?.[Mavo.route]&&(r[Mavo.route]=a.each(r[0][Mavo.route],(e,t)=>!0),r[Mavo.mavo]=r[0][Mavo.mavo]),a.lazy(r,{$previous:function(){return r.slice(0,i)},$next:function(){return r.slice(i)}}),r},$next:function(e){var e=l.closestArray(e),t=e.path.reverse(),i=e.path[0],t=t.slice(1),e=e.value?.[i+1];return e?a.value(e,...t):null},$previous:function(e){var e=l.closestArray(e),t=e.path.reverse(),i=e.path[0],t=t.slice(1),e=e.value?.[i-1];return e?a.value(e,...t):null},$this:function(e){return e}}}})}(Bliss,Bliss.$),function(r){function h(t){return new Promise(e=>setTimeout(e,t))}let u=Mavo.Backend.register(class extends Mavo.Backend{id="Github";constructor(e,t){super(e,t),this.permissions.on(["login","read"]),this.login(!0)}update(e,t){super.update(e,t);e=this.format.constructor.extensions[0]||".json";this.defaults={repo:"mv-data",filename:""+this.mavo.id+e},this.info=u.parseURL(this.source,this.defaults);for(const i in t)["format","mavo"].includes(i)||("graphql"===this.info.apiCall&&"query"===i?this.info.apiData={query:t.query}:this.info[i]=t[i]);r.extend(this,this.info)}async get(i){if(this.isAuthenticated()||!this.path||i){var r=i?u.parseURL(i):this.info;if(r.apiData)return this.request(r.apiCall,r.apiData,"POST").then(e=>e.errors?.length?Promise.reject(e.errors.map(e=>e.message).join("\n")):e.data);var s=void 0!==r.apiParams,a={responseType:s?"response":"json",headers:{Accept:"application/vnd.github.squirrel-girl-preview"}};let t=await this.request(r.apiCall,{ref:this.branch},"GET",a);if(s){var o=await t.json(),s=new URL(r.apiCall,this.constructor.apiDomain).searchParams;let e=s.get("max_pages")-1;if(0<e&&null===s.get("page")&&Array.isArray(o))do{if(!(n=t.headers.get("Link")?.match(/<(.+?)>; rel="next"/)?.[1]))break;if(!(t=await this.request(n,{ref:this.branch},"GET",a)).ok)break;var n=await t.json();if(!Array.isArray(n))break;o.push(...n)}while(0<--e);return o}return r.repo&&t.content?u.atob(t.content):t}{(i=new URL(`https://raw.githubusercontent.com/${this.username}/${this.repo}/${this.branch||"main"}/`+this.path)).searchParams.set("timestamp",Date.now());let e=await fetch(i.href);return e.ok?(this.branch=this.branch||"main",e.text()):404===e.status&&!this.branch&&(i.pathname=`/${this.username}/${this.repo}/master/`+this.path,(e=await fetch(i.href)).ok)?(this.branch="master",e.text()):null}}upload(e,r=this.path){return Mavo.readFile(e).then(e=>{let t=e.slice(5),i=t.match(/^\w+\/[\w+]+/)[0];return i=i.replace("+","\\+"),t=t.replace(RegExp(`^${i}(;base64)?,`),""),r=this.path.replace(/[^/]+$/,"")+r,this.put(t,r,{isEncoded:!0})}).then(e=>this.getURL(r,e.commit.sha))}async put(s,a=this.path,o={}){if(a){var n=`repos/${this.username}/`+this.repo;let i=n+"/contents/"+a;var l=this.mavo.element.getAttribute("mv-github-commit-prefix")||"";s=o.isEncoded?s:u.btoa(s);let r=await this.repoInfo;if(!r||r.owner.login!==this.username||r.name!==this.repo)try{r=await this.request(n),this.branch??=r.default_branch}catch(e){404===e.status&&(r=this.repoInfo=await this.request("user/repos",{name:this.repo,private:!!(this.options.private??o.private)},"POST"))}if(!this.canPush()){let e=await this.request(n+"/forks",{name:this.repo},"POST");i=`repos/${e.full_name}/contents/`+a,this.forkInfo=e;let t;for(;await h(1e3),!(t=await this.request(`repos/${e.full_name}/commits`,{until:"1970-01-01T00:00:00Z"},"HEAD")););r=e=t}let t;try{t=await this.request(i,{ref:this.branch}),t=await this.request(i,{message:l+this.mavo._("gh-updated-file",{name:t.name||"file"}),content:s,branch:this.branch,sha:t.sha},"PUT")}catch(e){404==e.status&&(t=await this.request(i,{message:l+"Created file",content:s,branch:this.branch},"PUT"))}o={context:this,fileInfo:t};return Mavo.hooks.run("gh-after-commit",o),o.fileInfo}}login(e){return this.oAuthenticate(e).then(()=>this.getUser()).catch(e=>{401==e.status&&this.logout()}).then(e=>{if(this.user&&(this.permissions.on("logout"),this.info.path&&this.permissions.on(["edit","save"]),this.repo))return this.request(`repos/${this.username}/`+this.repo).then(r=>{if((this.branch??=r.default_branch,this.repoInfo=r,!this.mavo.source)&&!this.canPush())return this.user.info.public_repos<r.forks?this.request("https://api.github.com/graphql",{query:`query {
													  viewer {
													    name
													      repositories(last: 100, isFork: true) {
													      nodes {
													        url
													        parent {
													          nameWithOwner
													        }
													      }
													    }
													  }
													}`},"POST").then(e=>{var t,i=e.data.viewer.repositories.nodes;for(t in i)if(i[t].parent.nameWithOwner===r.full_name)return this.switchToMyForkDialog(i[t].url),r;return r}):this.request(r.forks_url).then(e=>{for(var t in e)if(e[t].owner.login===this.user.username)return this.switchToMyForkDialog(e[t].html_url),r;return r});return r}).then(e=>{e={context:this,repoInfo:e};return Mavo.hooks.run("gh-after-login",e),e.repoInfo})})}canPush(){return this.repoInfo?this.repoInfo.permissions.push:this.user?.username?.toLowerCase()==this.username.toLowerCase()}oAuthParams=()=>"&scope=repo";logout(){return this.oAuthLogout().then(()=>{this.user=null})}getUser(){return this.user?Promise.resolve(this.user):this.request("user").then(e=>{this.user={username:e.login,name:e.name||e.login,avatar:e.avatar_url,url:"https://github.com/"+e.login,info:e},r.fire(this,"mv-login")})}getURL(t=this.path,i){var e=this.forkInfo||this.repoInfo;let r=e.full_name;return t=t.replace(/ /g,"%20"),e.pagesInfo=e.pagesInfo||this.request(`repos/${r}/pages`,{},"GET",{headers:{Accept:"application/vnd.github.mister-fantastic-preview+json"}}),e.pagesInfo.then(e=>e.html_url+t).catch(e=>`https://cdn.jsdelivr.net/gh/${r}@${i||this.branch||"latest"}/`+t)}switchToMyForkDialog(e){let t=new URL(location).searchParams;t.append(this.mavo.id+"-storage",e+"/"+this.path),this.notice=this.mavo.message(`
			${this.mavo._("gh-login-fork-options")}
			<form onsubmit="return false">
				<a href="${location.pathname}?${t}"><button>${this.mavo._("gh-use-my-fork")}</button></a>
			</form>`,{classes:"mv-inline",dismiss:["button","submit"]}),this.notice.closed.then(e=>{e&&(history.pushState({},"",location.pathname+"?"+t),location.replace(location.pathname+"?"+t))})}static apiDomain="https://api.github.com/";static oAuth="https://github.com/login/oauth/authorize";static key="7e08e016048000bc594e";static test(e){return e=new URL(e,Mavo.base),/^((api\.)?github\.com|raw\.githubusercontent\.com)/.test(e.host)}static parseURL(e,t={}){var i={},r=(Object.defineProperties(i,{apiCall:{get(){let e=`repos/${this.username}/${this.repo}/`+(this.resources??"contents");var t=this.path;return t&&(e+="/"+t),e+(this.apiParams??"")},set(e){delete this.apiCall,this.apiCall=e},configurable:!0,enumerable:!0},path:{get(){return this.filename?(this.filepath?this.filepath+"/":"")+this.filename:this.filepath},set(e){delete this.path,this.path=e},configurable:!0,enumerable:!0}}),new URL(e,Mavo.base));let s=r.pathname.slice(1).split("/");if(i.username=s.shift(),i.repo=s.shift()||t.repo,/raw.githubusercontent.com$/.test(r.host))i.branch=s.shift();else if(/api.github.com$/.test(r.host)){delete i.username,delete i.repo,i.apiParams=r.search,i.apiData=Mavo.Functions.from(e,"#");e=r.pathname.slice(1)+i.apiParams;if("graphql"==e)return i.apiCall=e,i.apiData={query:i.apiData},i;if("repos"!=(s=r.pathname.slice(1).split("/")).shift())return i.apiCall=e,i;i.username=s.shift(),i.repo=s.shift(),i.resources=s.shift()}else"blob"==s[0]&&(s.shift(),i.branch=s.shift());r=s[s.length-1];return/\.\w+$/.test(r)?(i.filename=r,s.splice(s.length-1,1)):i.filename=i.hasOwnProperty("apiParams")?"":t.filename,i.filepath=s.join("/")||t.filepath||"",i}static btoa=e=>btoa(unescape(encodeURIComponent(e)));static atob=e=>decodeURIComponent(escape(window.atob(e)))})}(Bliss,Bliss.$),Mavo.Locale.register("fr",{second:"seconde",seconds:"secondes",minute:"minute",minutes:"minutes",hour:"heure",hours:"heures",day:"jour",days:"jours",week:"semaine",weeks:"semaines",month:"mois",months:"mois",year:"année",years:"années",edit:"Modifier",editing:"Modification",save:"Enregistrer",import:"Import",export:"Export",clear:"Vider",logout:"Déconnexion",login:"Connexion",loading:"Chargement",uploading:"Téléchargement",saving:"Enregistrement",dismiss:"Abandonner","logged-in-as":"Connecté à {id} en tant que ","login-to":"Se connecter à {id}","error-uploading":"Erreur lors de l’envoi du fichier","cannot-load-uploaded-file":"Erreur lors du chargement du fichier envoyé",filename:"Nom du fichier ?","problem-saving":"Erreur lors de l’enregistrement des données","problem-loading":"Erreur lors du chargement des données","cannot-parse":"Ce fichier ne peut pas être lu correctement","http-error":"Erreur HTTP {status} : {statusText}","cant-connect":"Connexion à Internet impossible","add-item":"Ajouter {name}","add-item-before":"Ajouter un nouvel élément {name} avant","add-item-after":"Ajouter un nouvel élément {name} après","drag-to-reorder":"Faire glisser pour réordonner les {name}","delete-item":"Supprimer ce {name}","item-deleted":"{name} supprimé","n-items":"{n} éléments {name}",undo:"Défaire","delete-confirmation":"Toutes vos données vont être supprimées. Êtes-vous sûr ?","gh-updated-file":"{name} mis à jour","gh-edit-suggestion-saved-in-profile":'Vos modifications vont être enregistrées sur <a href="{previewURL}" target="_blank">votre profil</a>, car vous n’avez pas le droit de modifier cette page.',"gh-edit-suggestion-instructions":"Écrivez une description courte de vos modifications ci-dessous pour les suggérer aux administrateurs","gh-edit-suggestion-notreviewed":"Vous aviez choisi de suggérer les modifications aux administrateurs. Celles-ci n'ont pas encore été vérifiées.","gh-edit-suggestion-send":"Envoyer une suggestion de modification","gh-edit-suggestion-revoke":"Annuler votre suggestion de modification","gh-edit-suggestion-reason-placeholder":"J’ai ajouté / corrigé / supprimé ...","gh-edit-suggestion-cancelled":"Suggestion de modification correctement annulée !","gh-edit-suggestion-title":"Suggérer des modifications aux données","gh-edit-suggestion-body":`Bonjour ! J'ai utilisé Mavo pour vous suggérer les modifications suivantes :
{description}
Prévisualisez mes changements ici : {previewURL}`,"gh-edit-suggestion-sent":"Suggestion de modification correctement envoyée !","gh-login-fork-options":"Vous avez une version de cette page, voulez-vous l’utiliser ?","gh-use-my-fork":"Oui, utilise mes données."}),function(r){Mavo.Plugins.register("cropper",{dependencies:["https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js","https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css","https://cdn.jsdelivr.net/gh/DmitrySharabin/mavo-cropper/mavo-cropper.css"],hooks:{"primitive-createuploadpopup-beforereturn":function(e){if("image"===e.kind){const t={viewMode:2,autoCrop:!1},i=this;this.options=this.element.getAttribute("mv-cropper-options"),this.options?this.options=r.extend(t,Mavo.options(this.options)):this.options=t,void 0===this.data&&e.popup.classList.add("cropper-no-image"),r.create("div",{className:"cropper-wrapper",contents:[{tag:"img",src:this.data||"",alt:this.mavo._("cropper-image-preview"),className:"cropper-preview",style:{maxWidth:this.element.offsetWidth+"px",maxHeight:this.element.offsetHeight+"px"}}],inside:e.popup}),this.cropper=new Cropper(r(".cropper-preview",e.popup),this.options),r.create("div",{className:"cropper-bar",inside:e.popup}),this.cropper.options.rotatable&&(r.create("button",{type:"button",className:"cropper-rotate-left",title:this.mavo._("cropper-rotate-left"),events:{click:()=>{this.cropper.rotate(-90)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-rotate-right",title:this.mavo._("cropper-rotate-right"),events:{click:()=>{this.cropper.rotate(90)}},inside:r(".cropper-bar",e.popup)})),this.cropper.options.scalable&&(r.create("button",{type:"button",className:"cropper-flip-horizontal",title:this.mavo._("cropper-flip-horizontal"),events:{click:()=>{this.cropper.scaleX(-this.cropper.getData().scaleX||-1)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-flip-vertical",title:this.mavo._("cropper-flip-vertical"),events:{click:()=>{this.cropper.scaleY(-this.cropper.getData().scaleY||-1)}},inside:r(".cropper-bar",e.popup)})),r.create("button",{type:"button",className:"cropper-crop",events:{click:function(){this.classList.toggle("cropper-crop-hidden"),this.classList.contains("cropper-crop-hidden")?(this.setAttribute("title",i.mavo._("cropper-show")),r(".cropper-aspect-ratio",e.popup).disabled=!0,i.cropper.setDragMode(),i.cropper.clear()):(this.setAttribute("title",i.mavo._("cropper-hide")),r(".cropper-aspect-ratio",e.popup).disabled=!1,i.cropper.setDragMode("crop"),i.cropper.crop())}},inside:r(".cropper-bar",e.popup)}),r.create("select",{className:"cropper-aspect-ratio",title:this.mavo._("cropper-aspect-ratio"),contents:[{tag:"option",value:NaN,textContent:this.mavo._("cropper-aspect-ratio-free")},{tag:"option",value:1,textContent:"1:1"},{tag:"option",value:4/3,textContent:"4:3"},{tag:"option",value:16/9,textContent:"16:9"},{tag:"option",value:2/3,textContent:"2:3"}],events:{change:e=>{"custom"===e.target.value?this.cropper.setAspectRatio(this.options.aspectRatio):this.cropper.setAspectRatio(e.target.value)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-upload",title:this.mavo._("cropper-upload"),events:{click:()=>{this.fileName=this.element.src.split("/").pop(),this.fileType="image/"+("png"===this.fileName.split(".")[1]?"png":"jpeg"),this.cropper.getCroppedCanvas("image/png"===this.fileType?{}:{fillColor:"#fff"}).toBlob(e=>{this.upload(e,this.fileName),this.updatePreview()},this.fileType)}},inside:r(".cropper-bar",e.popup)}),r.create("button",{type:"button",className:"cropper-update",title:this.mavo._("cropper-update"),events:{click:()=>{this.updatePreview()}},inside:r(".cropper-bar",e.popup)}),this.cropper.options.autoCrop?(r.set(r(".cropper-crop",e.popup),{className:"cropper-crop",title:this.mavo._("cropper-hide")}),r.set(r(".cropper-aspect-ratio",e.popup),{disabled:!1}),this.cropper.options.aspectRatio&&r.set(document.createElement("option"),{value:"custom",textContent:this.mavo._("cropper-aspect-ratio-custom"),selected:!0,start:r(".cropper-aspect-ratio",e.popup)}),this.cropper.setDragMode(this.cropper.options.dragMode)):(r.set(r(".cropper-crop",e.popup),{className:"cropper-crop cropper-crop-hidden",title:this.mavo._("cropper-show")}),r(".cropper-aspect-ratio",e.popup).disabled=!0,this.cropper.options.dragMode="none"),r.bind(e.popup,"paste drop",()=>{this.updatePreview()}),r.bind(this.element,"paste drop",()=>{this.updatePreview()}),r.bind(r("input[type=url]",e.popup),"input",()=>{this.updatePreview()}),r.bind(r("input[type=file]",e.popup),"change",()=>{this.updatePreview()}),this.updatePreview=()=>{this.element.src?(r(".cropper-preview",e.popup).style.maxWidth=this.element.offsetWidth+"px",r(".cropper-preview",e.popup).style.maxHeight=this.element.offsetHeight+"px",this.cropper.replace(this.element.src),this.cropper.options.autoCrop?r("button.cropper-crop",r(".cropper-bar",e.popup)).classList.contains("cropper-crop-hidden")&&(this.cropper.options.dragMode="crop",r.fire(r("button.cropper-crop",r(".cropper-bar",e.popup)),"click")):r("button.cropper-crop",r(".cropper-bar",e.popup)).classList.contains("cropper-crop-hidden")||(this.cropper.options.dragMode="none",r.fire(r("button.cropper-crop",r(".cropper-bar",e.popup)),"click")),e.popup.classList.remove("cropper-no-image")):e.popup.classList.add("cropper-no-image")}}}}}),Mavo.Locale.register("en",{"cropper-image-preview":"Image preview","cropper-upload":"Upload Image","cropper-show":"Show Crop Box","cropper-hide":"Hide Crop Box","cropper-rotate-left":"Rotate Left","cropper-rotate-right":"Rotate Right","cropper-flip-horizontal":"Flip Horizontal","cropper-flip-vertical":"Flip Vertical","cropper-aspect-ratio":"Crop Box Aspect Ratio","cropper-aspect-ratio-free":"Free","cropper-aspect-ratio-custom":"Custom","cropper-update":"Update Preview"})}(Bliss),document.addEventListener("DOMContentLoaded",()=>{addMenuInteraction()});